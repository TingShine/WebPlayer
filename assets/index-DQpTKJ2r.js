var hh=(e,g)=>()=>(g||e((g={exports:{}}).exports,g),g.exports);var _v=hh((gB,$i)=>{function QJ(e,g){for(var l=0;l<g.length;l++){const t=g[l];if(typeof t!="string"&&!Array.isArray(t)){for(const I in t)if(I!=="default"&&!(I in e)){const i=Object.getOwnPropertyDescriptor(t,I);i&&Object.defineProperty(e,I,i.get?i:{enumerable:!0,get:()=>t[I]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))t(I);new MutationObserver(I=>{for(const i of I)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function l(I){const i={};return I.integrity&&(i.integrity=I.integrity),I.referrerPolicy&&(i.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?i.credentials="include":I.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(I){if(I.ep)return;I.ep=!0;const i=l(I);fetch(I.href,i)}})();function NA(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ir={exports:{}},LI={},or={exports:{}},qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qu;function Gh(){if(Qu)return qe;Qu=1;var e=Symbol.for("react.element"),g=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),t=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),a=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),s=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),Z=Symbol.iterator;function b(R){return R===null||typeof R!="object"?null:(R=Z&&R[Z]||R["@@iterator"],typeof R=="function"?R:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,G={};function h(R,H,E){this.props=R,this.context=H,this.refs=G,this.updater=E||p}h.prototype.isReactComponent={},h.prototype.setState=function(R,H){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,H,"setState")},h.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function f(){}f.prototype=h.prototype;function W(R,H,E){this.props=R,this.context=H,this.refs=G,this.updater=E||p}var X=W.prototype=new f;X.constructor=W,y(X,h.prototype),X.isPureReactComponent=!0;var B=Array.isArray,V=Object.prototype.hasOwnProperty,Q={current:null},v={key:!0,ref:!0,__self:!0,__source:!0};function Y(R,H,E){var j,ge={},ne=null,ie=null;if(H!=null)for(j in H.ref!==void 0&&(ie=H.ref),H.key!==void 0&&(ne=""+H.key),H)V.call(H,j)&&!v.hasOwnProperty(j)&&(ge[j]=H[j]);var Ae=arguments.length-2;if(Ae===1)ge.children=E;else if(1<Ae){for(var ae=Array(Ae),se=0;se<Ae;se++)ae[se]=arguments[se+2];ge.children=ae}if(R&&R.defaultProps)for(j in Ae=R.defaultProps,Ae)ge[j]===void 0&&(ge[j]=Ae[j]);return{$$typeof:e,type:R,key:ne,ref:ie,props:ge,_owner:Q.current}}function F(R,H){return{$$typeof:e,type:R.type,key:H,ref:R.ref,props:R.props,_owner:R._owner}}function L(R){return typeof R=="object"&&R!==null&&R.$$typeof===e}function M(R){var H={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(E){return H[E]})}var ee=/\/+/g;function q(R,H){return typeof R=="object"&&R!==null&&R.key!=null?M(""+R.key):H.toString(36)}function P(R,H,E,j,ge){var ne=typeof R;(ne==="undefined"||ne==="boolean")&&(R=null);var ie=!1;if(R===null)ie=!0;else switch(ne){case"string":case"number":ie=!0;break;case"object":switch(R.$$typeof){case e:case g:ie=!0}}if(ie)return ie=R,ge=ge(ie),R=j===""?"."+q(ie,0):j,B(ge)?(E="",R!=null&&(E=R.replace(ee,"$&/")+"/"),P(ge,H,E,"",function(se){return se})):ge!=null&&(L(ge)&&(ge=F(ge,E+(!ge.key||ie&&ie.key===ge.key?"":(""+ge.key).replace(ee,"$&/")+"/")+R)),H.push(ge)),1;if(ie=0,j=j===""?".":j+":",B(R))for(var Ae=0;Ae<R.length;Ae++){ne=R[Ae];var ae=j+q(ne,Ae);ie+=P(ne,H,E,ae,ge)}else if(ae=b(R),typeof ae=="function")for(R=ae.call(R),Ae=0;!(ne=R.next()).done;)ne=ne.value,ae=j+q(ne,Ae++),ie+=P(ne,H,E,ae,ge);else if(ne==="object")throw H=String(R),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return ie}function le(R,H,E){if(R==null)return R;var j=[],ge=0;return P(R,j,"","",function(ne){return H.call(E,ne,ge++)}),j}function N(R){if(R._status===-1){var H=R._result;H=H(),H.then(function(E){(R._status===0||R._status===-1)&&(R._status=1,R._result=E)},function(E){(R._status===0||R._status===-1)&&(R._status=2,R._result=E)}),R._status===-1&&(R._status=0,R._result=H)}if(R._status===1)return R._result.default;throw R._result}var w={current:null},K={transition:null},T={ReactCurrentDispatcher:w,ReactCurrentBatchConfig:K,ReactCurrentOwner:Q};function z(){throw Error("act(...) is not supported in production builds of React.")}return qe.Children={map:le,forEach:function(R,H,E){le(R,function(){H.apply(this,arguments)},E)},count:function(R){var H=0;return le(R,function(){H++}),H},toArray:function(R){return le(R,function(H){return H})||[]},only:function(R){if(!L(R))throw Error("React.Children.only expected to receive a single React element child.");return R}},qe.Component=h,qe.Fragment=l,qe.Profiler=I,qe.PureComponent=W,qe.StrictMode=t,qe.Suspense=s,qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T,qe.act=z,qe.cloneElement=function(R,H,E){if(R==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+R+".");var j=y({},R.props),ge=R.key,ne=R.ref,ie=R._owner;if(H!=null){if(H.ref!==void 0&&(ne=H.ref,ie=Q.current),H.key!==void 0&&(ge=""+H.key),R.type&&R.type.defaultProps)var Ae=R.type.defaultProps;for(ae in H)V.call(H,ae)&&!v.hasOwnProperty(ae)&&(j[ae]=H[ae]===void 0&&Ae!==void 0?Ae[ae]:H[ae])}var ae=arguments.length-2;if(ae===1)j.children=E;else if(1<ae){Ae=Array(ae);for(var se=0;se<ae;se++)Ae[se]=arguments[se+2];j.children=Ae}return{$$typeof:e,type:R.type,key:ge,ref:ne,props:j,_owner:ie}},qe.createContext=function(R){return R={$$typeof:a,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},R.Provider={$$typeof:i,_context:R},R.Consumer=R},qe.createElement=Y,qe.createFactory=function(R){var H=Y.bind(null,R);return H.type=R,H},qe.createRef=function(){return{current:null}},qe.forwardRef=function(R){return{$$typeof:r,render:R}},qe.isValidElement=L,qe.lazy=function(R){return{$$typeof:J,_payload:{_status:-1,_result:R},_init:N}},qe.memo=function(R,H){return{$$typeof:d,type:R,compare:H===void 0?null:H}},qe.startTransition=function(R){var H=K.transition;K.transition={};try{R()}finally{K.transition=H}},qe.unstable_act=z,qe.useCallback=function(R,H){return w.current.useCallback(R,H)},qe.useContext=function(R){return w.current.useContext(R)},qe.useDebugValue=function(){},qe.useDeferredValue=function(R){return w.current.useDeferredValue(R)},qe.useEffect=function(R,H){return w.current.useEffect(R,H)},qe.useId=function(){return w.current.useId()},qe.useImperativeHandle=function(R,H,E){return w.current.useImperativeHandle(R,H,E)},qe.useInsertionEffect=function(R,H){return w.current.useInsertionEffect(R,H)},qe.useLayoutEffect=function(R,H){return w.current.useLayoutEffect(R,H)},qe.useMemo=function(R,H){return w.current.useMemo(R,H)},qe.useReducer=function(R,H,E){return w.current.useReducer(R,H,E)},qe.useRef=function(R){return w.current.useRef(R)},qe.useState=function(R){return w.current.useState(R)},qe.useSyncExternalStore=function(R,H,E){return w.current.useSyncExternalStore(R,H,E)},qe.useTransition=function(){return w.current.useTransition()},qe.version="18.3.1",qe}var vu;function zA(){return vu||(vu=1,or.exports=Gh()),or.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bu;function yh(){if(Bu)return LI;Bu=1;var e=zA(),g=Symbol.for("react.element"),l=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,I=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(r,s,d){var J,Z={},b=null,p=null;d!==void 0&&(b=""+d),s.key!==void 0&&(b=""+s.key),s.ref!==void 0&&(p=s.ref);for(J in s)t.call(s,J)&&!i.hasOwnProperty(J)&&(Z[J]=s[J]);if(r&&r.defaultProps)for(J in s=r.defaultProps,s)Z[J]===void 0&&(Z[J]=s[J]);return{$$typeof:g,type:r,key:b,ref:p,props:Z,_owner:I.current}}return LI.Fragment=l,LI.jsx=a,LI.jsxs=a,LI}var Su;function kh(){return Su||(Su=1,Ir.exports=yh()),Ir.exports}var ng=kh(),u=zA();const de=NA(u),sc=QJ({__proto__:null,default:de},[u]);var Xi={},ir={exports:{}},Sg={},cr={exports:{}},ar={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yu;function ph(){return Yu||(Yu=1,function(e){function g(K,T){var z=K.length;K.push(T);e:for(;0<z;){var R=z-1>>>1,H=K[R];if(0<I(H,T))K[R]=T,K[z]=H,z=R;else break e}}function l(K){return K.length===0?null:K[0]}function t(K){if(K.length===0)return null;var T=K[0],z=K.pop();if(z!==T){K[0]=z;e:for(var R=0,H=K.length,E=H>>>1;R<E;){var j=2*(R+1)-1,ge=K[j],ne=j+1,ie=K[ne];if(0>I(ge,z))ne<H&&0>I(ie,ge)?(K[R]=ie,K[ne]=z,R=ne):(K[R]=ge,K[j]=z,R=j);else if(ne<H&&0>I(ie,z))K[R]=ie,K[ne]=z,R=ne;else break e}}return T}function I(K,T){var z=K.sortIndex-T.sortIndex;return z!==0?z:K.id-T.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,r=a.now();e.unstable_now=function(){return a.now()-r}}var s=[],d=[],J=1,Z=null,b=3,p=!1,y=!1,G=!1,h=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(K){for(var T=l(d);T!==null;){if(T.callback===null)t(d);else if(T.startTime<=K)t(d),T.sortIndex=T.expirationTime,g(s,T);else break;T=l(d)}}function B(K){if(G=!1,X(K),!y)if(l(s)!==null)y=!0,N(V);else{var T=l(d);T!==null&&w(B,T.startTime-K)}}function V(K,T){y=!1,G&&(G=!1,f(Y),Y=-1),p=!0;var z=b;try{for(X(T),Z=l(s);Z!==null&&(!(Z.expirationTime>T)||K&&!M());){var R=Z.callback;if(typeof R=="function"){Z.callback=null,b=Z.priorityLevel;var H=R(Z.expirationTime<=T);T=e.unstable_now(),typeof H=="function"?Z.callback=H:Z===l(s)&&t(s),X(T)}else t(s);Z=l(s)}if(Z!==null)var E=!0;else{var j=l(d);j!==null&&w(B,j.startTime-T),E=!1}return E}finally{Z=null,b=z,p=!1}}var Q=!1,v=null,Y=-1,F=5,L=-1;function M(){return!(e.unstable_now()-L<F)}function ee(){if(v!==null){var K=e.unstable_now();L=K;var T=!0;try{T=v(!0,K)}finally{T?q():(Q=!1,v=null)}}else Q=!1}var q;if(typeof W=="function")q=function(){W(ee)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,le=P.port2;P.port1.onmessage=ee,q=function(){le.postMessage(null)}}else q=function(){h(ee,0)};function N(K){v=K,Q||(Q=!0,q())}function w(K,T){Y=h(function(){K(e.unstable_now())},T)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(K){K.callback=null},e.unstable_continueExecution=function(){y||p||(y=!0,N(V))},e.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<K?Math.floor(1e3/K):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_getFirstCallbackNode=function(){return l(s)},e.unstable_next=function(K){switch(b){case 1:case 2:case 3:var T=3;break;default:T=b}var z=b;b=T;try{return K()}finally{b=z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(K,T){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var z=b;b=K;try{return T()}finally{b=z}},e.unstable_scheduleCallback=function(K,T,z){var R=e.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?R+z:R):z=R,K){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=z+H,K={id:J++,callback:T,priorityLevel:K,startTime:z,expirationTime:H,sortIndex:-1},z>R?(K.sortIndex=z,g(d,K),l(s)===null&&K===l(d)&&(G?(f(Y),Y=-1):G=!0,w(B,z-R))):(K.sortIndex=H,g(s,K),y||p||(y=!0,N(V))),K},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(K){var T=b;return function(){var z=b;b=T;try{return K.apply(this,arguments)}finally{b=z}}}}(ar)),ar}var Fu;function Wh(){return Fu||(Fu=1,cr.exports=ph()),cr.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ku;function Vh(){if(Ku)return Sg;Ku=1;var e=zA(),g=Wh();function l(C){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+C,o=1;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+C+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var t=new Set,I={};function i(C,n){a(C,n),a(C+"Capture",n)}function a(C,n){for(I[C]=n,C=0;C<n.length;C++)t.add(n[C])}var r=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,J={},Z={};function b(C){return s.call(Z,C)?!0:s.call(J,C)?!1:d.test(C)?Z[C]=!0:(J[C]=!0,!1)}function p(C,n,o,c){if(o!==null&&o.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return c?!1:o!==null?!o.acceptsBooleans:(C=C.toLowerCase().slice(0,5),C!=="data-"&&C!=="aria-");default:return!1}}function y(C,n,o,c){if(n===null||typeof n>"u"||p(C,n,o,c))return!0;if(c)return!1;if(o!==null)switch(o.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function G(C,n,o,c,A,m,k){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=c,this.attributeNamespace=A,this.mustUseProperty=o,this.propertyName=C,this.type=n,this.sanitizeURL=m,this.removeEmptyString=k}var h={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(C){h[C]=new G(C,0,!1,C,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(C){var n=C[0];h[n]=new G(n,1,!1,C[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(C){h[C]=new G(C,2,!1,C.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(C){h[C]=new G(C,2,!1,C,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(C){h[C]=new G(C,3,!1,C.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(C){h[C]=new G(C,3,!0,C,null,!1,!1)}),["capture","download"].forEach(function(C){h[C]=new G(C,4,!1,C,null,!1,!1)}),["cols","rows","size","span"].forEach(function(C){h[C]=new G(C,6,!1,C,null,!1,!1)}),["rowSpan","start"].forEach(function(C){h[C]=new G(C,5,!1,C.toLowerCase(),null,!1,!1)});var f=/[\-:]([a-z])/g;function W(C){return C[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(C){var n=C.replace(f,W);h[n]=new G(n,1,!1,C,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(C){var n=C.replace(f,W);h[n]=new G(n,1,!1,C,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(C){var n=C.replace(f,W);h[n]=new G(n,1,!1,C,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(C){h[C]=new G(C,1,!1,C.toLowerCase(),null,!1,!1)}),h.xlinkHref=new G("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(C){h[C]=new G(C,1,!1,C.toLowerCase(),null,!0,!0)});function X(C,n,o,c){var A=h.hasOwnProperty(n)?h[n]:null;(A!==null?A.type!==0:c||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(y(n,o,A,c)&&(o=null),c||A===null?b(n)&&(o===null?C.removeAttribute(n):C.setAttribute(n,""+o)):A.mustUseProperty?C[A.propertyName]=o===null?A.type===3?!1:"":o:(n=A.attributeName,c=A.attributeNamespace,o===null?C.removeAttribute(n):(A=A.type,o=A===3||A===4&&o===!0?"":""+o,c?C.setAttributeNS(c,n,o):C.setAttribute(n,o))))}var B=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,V=Symbol.for("react.element"),Q=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),Y=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),M=Symbol.for("react.context"),ee=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),le=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),w=Symbol.for("react.offscreen"),K=Symbol.iterator;function T(C){return C===null||typeof C!="object"?null:(C=K&&C[K]||C["@@iterator"],typeof C=="function"?C:null)}var z=Object.assign,R;function H(C){if(R===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);R=n&&n[1]||""}return`
`+R+C}var E=!1;function j(C,n){if(!C||E)return"";E=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(Ce){var c=Ce}Reflect.construct(C,[],n)}else{try{n.call()}catch(Ce){c=Ce}C.call(n.prototype)}else{try{throw Error()}catch(Ce){c=Ce}C()}}catch(Ce){if(Ce&&c&&typeof Ce.stack=="string"){for(var A=Ce.stack.split(`
`),m=c.stack.split(`
`),k=A.length-1,S=m.length-1;1<=k&&0<=S&&A[k]!==m[S];)S--;for(;1<=k&&0<=S;k--,S--)if(A[k]!==m[S]){if(k!==1||S!==1)do if(k--,S--,0>S||A[k]!==m[S]){var U=`
`+A[k].replace(" at new "," at ");return C.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",C.displayName)),U}while(1<=k&&0<=S);break}}}finally{E=!1,Error.prepareStackTrace=o}return(C=C?C.displayName||C.name:"")?H(C):""}function ge(C){switch(C.tag){case 5:return H(C.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return C=j(C.type,!1),C;case 11:return C=j(C.type.render,!1),C;case 1:return C=j(C.type,!0),C;default:return""}}function ne(C){if(C==null)return null;if(typeof C=="function")return C.displayName||C.name||null;if(typeof C=="string")return C;switch(C){case v:return"Fragment";case Q:return"Portal";case F:return"Profiler";case Y:return"StrictMode";case q:return"Suspense";case P:return"SuspenseList"}if(typeof C=="object")switch(C.$$typeof){case M:return(C.displayName||"Context")+".Consumer";case L:return(C._context.displayName||"Context")+".Provider";case ee:var n=C.render;return C=C.displayName,C||(C=n.displayName||n.name||"",C=C!==""?"ForwardRef("+C+")":"ForwardRef"),C;case le:return n=C.displayName||null,n!==null?n:ne(C.type)||"Memo";case N:n=C._payload,C=C._init;try{return ne(C(n))}catch{}}return null}function ie(C){var n=C.type;switch(C.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return C=n.render,C=C.displayName||C.name||"",n.displayName||(C!==""?"ForwardRef("+C+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ne(n);case 8:return n===Y?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Ae(C){switch(typeof C){case"boolean":case"number":case"string":case"undefined":return C;case"object":return C;default:return""}}function ae(C){var n=C.type;return(C=C.nodeName)&&C.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function se(C){var n=ae(C)?"checked":"value",o=Object.getOwnPropertyDescriptor(C.constructor.prototype,n),c=""+C[n];if(!C.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var A=o.get,m=o.set;return Object.defineProperty(C,n,{configurable:!0,get:function(){return A.call(this)},set:function(k){c=""+k,m.call(this,k)}}),Object.defineProperty(C,n,{enumerable:o.enumerable}),{getValue:function(){return c},setValue:function(k){c=""+k},stopTracking:function(){C._valueTracker=null,delete C[n]}}}}function ze(C){C._valueTracker||(C._valueTracker=se(C))}function We(C){if(!C)return!1;var n=C._valueTracker;if(!n)return!0;var o=n.getValue(),c="";return C&&(c=ae(C)?C.checked?"true":"false":C.value),C=c,C!==o?(n.setValue(C),!0):!1}function Je(C){if(C=C||(typeof document<"u"?document:void 0),typeof C>"u")return null;try{return C.activeElement||C.body}catch{return C.body}}function ue(C,n){var o=n.checked;return z({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??C._wrapperState.initialChecked})}function he(C,n){var o=n.defaultValue==null?"":n.defaultValue,c=n.checked!=null?n.checked:n.defaultChecked;o=Ae(n.value!=null?n.value:o),C._wrapperState={initialChecked:c,initialValue:o,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function Se(C,n){n=n.checked,n!=null&&X(C,"checked",n,!1)}function Ke(C,n){Se(C,n);var o=Ae(n.value),c=n.type;if(o!=null)c==="number"?(o===0&&C.value===""||C.value!=o)&&(C.value=""+o):C.value!==""+o&&(C.value=""+o);else if(c==="submit"||c==="reset"){C.removeAttribute("value");return}n.hasOwnProperty("value")?Ue(C,n.type,o):n.hasOwnProperty("defaultValue")&&Ue(C,n.type,Ae(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(C.defaultChecked=!!n.defaultChecked)}function Ye(C,n,o){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var c=n.type;if(!(c!=="submit"&&c!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+C._wrapperState.initialValue,o||n===C.value||(C.value=n),C.defaultValue=n}o=C.name,o!==""&&(C.name=""),C.defaultChecked=!!C._wrapperState.initialChecked,o!==""&&(C.name=o)}function Ue(C,n,o){(n!=="number"||Je(C.ownerDocument)!==C)&&(o==null?C.defaultValue=""+C._wrapperState.initialValue:C.defaultValue!==""+o&&(C.defaultValue=""+o))}var Me=Array.isArray;function Re(C,n,o,c){if(C=C.options,n){n={};for(var A=0;A<o.length;A++)n["$"+o[A]]=!0;for(o=0;o<C.length;o++)A=n.hasOwnProperty("$"+C[o].value),C[o].selected!==A&&(C[o].selected=A),A&&c&&(C[o].defaultSelected=!0)}else{for(o=""+Ae(o),n=null,A=0;A<C.length;A++){if(C[A].value===o){C[A].selected=!0,c&&(C[A].defaultSelected=!0);return}n!==null||C[A].disabled||(n=C[A])}n!==null&&(n.selected=!0)}}function De(C,n){if(n.dangerouslySetInnerHTML!=null)throw Error(l(91));return z({},n,{value:void 0,defaultValue:void 0,children:""+C._wrapperState.initialValue})}function fe(C,n){var o=n.value;if(o==null){if(o=n.children,n=n.defaultValue,o!=null){if(n!=null)throw Error(l(92));if(Me(o)){if(1<o.length)throw Error(l(93));o=o[0]}n=o}n==null&&(n=""),o=n}C._wrapperState={initialValue:Ae(o)}}function _e(C,n){var o=Ae(n.value),c=Ae(n.defaultValue);o!=null&&(o=""+o,o!==C.value&&(C.value=o),n.defaultValue==null&&C.defaultValue!==o&&(C.defaultValue=o)),c!=null&&(C.defaultValue=""+c)}function eC(C){var n=C.textContent;n===C._wrapperState.initialValue&&n!==""&&n!==null&&(C.value=n)}function IC(C){switch(C){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pC(C,n){return C==null||C==="http://www.w3.org/1999/xhtml"?IC(n):C==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":C}var cC,hC=function(C){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,o,c,A){MSApp.execUnsafeLocalFunction(function(){return C(n,o,c,A)})}:C}(function(C,n){if(C.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in C)C.innerHTML=n;else{for(cC=cC||document.createElement("div"),cC.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=cC.firstChild;C.firstChild;)C.removeChild(C.firstChild);for(;n.firstChild;)C.appendChild(n.firstChild)}});function WC(C,n){if(n){var o=C.firstChild;if(o&&o===C.lastChild&&o.nodeType===3){o.nodeValue=n;return}}C.textContent=n}var Pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lC=["Webkit","ms","Moz","O"];Object.keys(Pe).forEach(function(C){lC.forEach(function(n){n=n+C.charAt(0).toUpperCase()+C.substring(1),Pe[n]=Pe[C]})});function Te(C,n,o){return n==null||typeof n=="boolean"||n===""?"":o||typeof n!="number"||n===0||Pe.hasOwnProperty(C)&&Pe[C]?(""+n).trim():n+"px"}function Ze(C,n){C=C.style;for(var o in n)if(n.hasOwnProperty(o)){var c=o.indexOf("--")===0,A=Te(o,n[o],c);o==="float"&&(o="cssFloat"),c?C.setProperty(o,A):C[o]=A}}var Ee=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function je(C,n){if(n){if(Ee[C]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(l(137,C));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(l(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(l(61))}if(n.style!=null&&typeof n.style!="object")throw Error(l(62))}}function ve(C,n){if(C.indexOf("-")===-1)return typeof n.is=="string";switch(C){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Oe=null;function $e(C){return C=C.target||C.srcElement||window,C.correspondingUseElement&&(C=C.correspondingUseElement),C.nodeType===3?C.parentNode:C}var ZC=null,XC=null,LC=null;function ig(C){if(C=VI(C)){if(typeof ZC!="function")throw Error(l(280));var n=C.stateNode;n&&(n=Mo(n),ZC(C.stateNode,C.type,n))}}function OC(C){XC?LC?LC.push(C):LC=[C]:XC=C}function Kg(){if(XC){var C=XC,n=LC;if(LC=XC=null,ig(C),n)for(C=0;C<n.length;C++)ig(n[C])}}function SC(C,n){return C(n)}function mg(){}var nC=!1;function gC(C,n,o){if(nC)return C(n,o);nC=!0;try{return SC(C,n,o)}finally{nC=!1,(XC!==null||LC!==null)&&(mg(),Kg())}}function RC(C,n){var o=C.stateNode;if(o===null)return null;var c=Mo(o);if(c===null)return null;o=c[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(C=C.type,c=!(C==="button"||C==="input"||C==="select"||C==="textarea")),C=!c;break e;default:C=!1}if(C)return null;if(o&&typeof o!="function")throw Error(l(231,n,typeof o));return o}var Wg=!1;if(r)try{var wg={};Object.defineProperty(wg,"passive",{get:function(){Wg=!0}}),window.addEventListener("test",wg,wg),window.removeEventListener("test",wg,wg)}catch{Wg=!1}function aC(C,n,o,c,A,m,k,S,U){var Ce=Array.prototype.slice.call(arguments,3);try{n.apply(o,Ce)}catch(Ie){this.onError(Ie)}}var Hg=!1,_g=null,oC=!1,GC=null,cg={onError:function(C){Hg=!0,_g=C}};function _C(C,n,o,c,A,m,k,S,U){Hg=!1,_g=null,aC.apply(cg,arguments)}function Ng(C,n,o,c,A,m,k,S,U){if(_C.apply(this,arguments),Hg){if(Hg){var Ce=_g;Hg=!1,_g=null}else throw Error(l(198));oC||(oC=!0,GC=Ce)}}function Jg(C){var n=C,o=C;if(C.alternate)for(;n.return;)n=n.return;else{C=n;do n=C,n.flags&4098&&(o=n.return),C=n.return;while(C)}return n.tag===3?o:null}function zg(C){if(C.tag===13){var n=C.memoizedState;if(n===null&&(C=C.alternate,C!==null&&(n=C.memoizedState)),n!==null)return n.dehydrated}return null}function Vg(C){if(Jg(C)!==C)throw Error(l(188))}function fg(C){var n=C.alternate;if(!n){if(n=Jg(C),n===null)throw Error(l(188));return n!==C?null:C}for(var o=C,c=n;;){var A=o.return;if(A===null)break;var m=A.alternate;if(m===null){if(c=A.return,c!==null){o=c;continue}break}if(A.child===m.child){for(m=A.child;m;){if(m===o)return Vg(A),C;if(m===c)return Vg(A),n;m=m.sibling}throw Error(l(188))}if(o.return!==c.return)o=A,c=m;else{for(var k=!1,S=A.child;S;){if(S===o){k=!0,o=A,c=m;break}if(S===c){k=!0,c=A,o=m;break}S=S.sibling}if(!k){for(S=m.child;S;){if(S===o){k=!0,o=m,c=A;break}if(S===c){k=!0,c=m,o=A;break}S=S.sibling}if(!k)throw Error(l(189))}}if(o.alternate!==c)throw Error(l(190))}if(o.tag!==3)throw Error(l(188));return o.stateNode.current===o?C:n}function dl(C){return C=fg(C),C!==null?el(C):null}function el(C){if(C.tag===5||C.tag===6)return C;for(C=C.child;C!==null;){var n=el(C);if(n!==null)return n;C=C.sibling}return null}var zl=g.unstable_scheduleCallback,sC=g.unstable_cancelCallback,nt=g.unstable_shouldYield,cI=g.unstable_requestPaint,uC=g.unstable_now,tt=g.unstable_getCurrentPriorityLevel,Bn=g.unstable_ImmediatePriority,Sn=g.unstable_UserBlockingPriority,Ll=g.unstable_NormalPriority,Ul=g.unstable_LowPriority,Yn=g.unstable_IdlePriority,ul=null,UC=null;function It(C){if(UC&&typeof UC.onCommitFiberRoot=="function")try{UC.onCommitFiberRoot(ul,C,void 0,(C.current.flags&128)===128)}catch{}}var ag=Math.clz32?Math.clz32:ln,Cl=Math.log,Lg=Math.LN2;function ln(C){return C>>>=0,C===0?32:31-(Cl(C)/Lg|0)|0}var ml=64,Zg=4194304;function Ml(C){switch(C&-C){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return C&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return C&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return C}}function xl(C,n){var o=C.pendingLanes;if(o===0)return 0;var c=0,A=C.suspendedLanes,m=C.pingedLanes,k=o&268435455;if(k!==0){var S=k&~A;S!==0?c=Ml(S):(m&=k,m!==0&&(c=Ml(m)))}else k=o&~A,k!==0?c=Ml(k):m!==0&&(c=Ml(m));if(c===0)return 0;if(n!==0&&n!==c&&!(n&A)&&(A=c&-c,m=n&-n,A>=m||A===16&&(m&4194240)!==0))return n;if(c&4&&(c|=o&16),n=C.entangledLanes,n!==0)for(C=C.entanglements,n&=c;0<n;)o=31-ag(n),A=1<<o,c|=C[o],n&=~A;return c}function aI(C,n){switch(C){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fn(C,n){for(var o=C.suspendedLanes,c=C.pingedLanes,A=C.expirationTimes,m=C.pendingLanes;0<m;){var k=31-ag(m),S=1<<k,U=A[k];U===-1?(!(S&o)||S&c)&&(A[k]=aI(S,n)):U<=n&&(C.expiredLanes|=S),m&=~S}}function Kn(C){return C=C.pendingLanes&-1073741825,C!==0?C:C&1073741824?1073741824:0}function ot(){var C=ml;return ml<<=1,!(ml&4194240)&&(ml=64),C}function wn(C){for(var n=[],o=0;31>o;o++)n.push(C);return n}function Xl(C,n,o){C.pendingLanes|=n,n!==536870912&&(C.suspendedLanes=0,C.pingedLanes=0),C=C.eventTimes,n=31-ag(n),C[n]=o}function rI(C,n){var o=C.pendingLanes&~n;C.pendingLanes=n,C.suspendedLanes=0,C.pingedLanes=0,C.expiredLanes&=n,C.mutableReadLanes&=n,C.entangledLanes&=n,n=C.entanglements;var c=C.eventTimes;for(C=C.expirationTimes;0<o;){var A=31-ag(o),m=1<<A;n[A]=0,c[A]=-1,C[A]=-1,o&=~m}}function Hn(C,n){var o=C.entangledLanes|=n;for(C=C.entanglements;o;){var c=31-ag(o),A=1<<c;A&n|C[c]&n&&(C[c]|=n),o&=~A}}var tC=0;function it(C){return C&=-C,1<C?4<C?C&268435455?16:536870912:4:1}var ct,Tl,Ug,at,AI,rt=!1,MC=[],bg=null,hg=null,tg=null,gl=new Map,Rl=new Map,Mg=[],sI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ge(C,n){switch(C){case"focusin":case"focusout":bg=null;break;case"dragenter":case"dragleave":hg=null;break;case"mouseover":case"mouseout":tg=null;break;case"pointerover":case"pointerout":gl.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rl.delete(n.pointerId)}}function Fe(C,n,o,c,A,m){return C===null||C.nativeEvent!==m?(C={blockedOn:n,domEventName:o,eventSystemFlags:c,nativeEvent:m,targetContainers:[A]},n!==null&&(n=VI(n),n!==null&&Tl(n)),C):(C.eventSystemFlags|=c,n=C.targetContainers,A!==null&&n.indexOf(A)===-1&&n.push(A),C)}function yC(C,n,o,c,A){switch(n){case"focusin":return bg=Fe(bg,C,n,o,c,A),!0;case"dragenter":return hg=Fe(hg,C,n,o,c,A),!0;case"mouseover":return tg=Fe(tg,C,n,o,c,A),!0;case"pointerover":var m=A.pointerId;return gl.set(m,Fe(gl.get(m)||null,C,n,o,c,A)),!0;case"gotpointercapture":return m=A.pointerId,Rl.set(m,Fe(Rl.get(m)||null,C,n,o,c,A)),!0}return!1}function QC(C){var n=zn(C.target);if(n!==null){var o=Jg(n);if(o!==null){if(n=o.tag,n===13){if(n=zg(o),n!==null){C.blockedOn=n,AI(C.priority,function(){Ug(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){C.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}C.blockedOn=null}function mC(C){if(C.blockedOn!==null)return!1;for(var n=C.targetContainers;0<n.length;){var o=Sc(C.domEventName,C.eventSystemFlags,n[0],C.nativeEvent);if(o===null){o=C.nativeEvent;var c=new o.constructor(o.type,o);Oe=c,o.target.dispatchEvent(c),Oe=null}else return n=VI(o),n!==null&&Tl(n),C.blockedOn=o,!1;n.shift()}return!0}function Nn(C,n,o){mC(C)&&o.delete(n)}function dI(){rt=!1,bg!==null&&mC(bg)&&(bg=null),hg!==null&&mC(hg)&&(hg=null),tg!==null&&mC(tg)&&(tg=null),gl.forEach(Nn),Rl.forEach(Nn)}function nn(C,n){C.blockedOn===n&&(C.blockedOn=null,rt||(rt=!0,g.unstable_scheduleCallback(g.unstable_NormalPriority,dI)))}function Ql(C){function n(A){return nn(A,C)}if(0<MC.length){nn(MC[0],C);for(var o=1;o<MC.length;o++){var c=MC[o];c.blockedOn===C&&(c.blockedOn=null)}}for(bg!==null&&nn(bg,C),hg!==null&&nn(hg,C),tg!==null&&nn(tg,C),gl.forEach(n),Rl.forEach(n),o=0;o<Mg.length;o++)c=Mg[o],c.blockedOn===C&&(c.blockedOn=null);for(;0<Mg.length&&(o=Mg[0],o.blockedOn===null);)QC(o),o.blockedOn===null&&Mg.shift()}var At=B.ReactCurrentBatchConfig,Qo=!0;function T0(C,n,o,c){var A=tC,m=At.transition;At.transition=null;try{tC=1,Bc(C,n,o,c)}finally{tC=A,At.transition=m}}function D0(C,n,o,c){var A=tC,m=At.transition;At.transition=null;try{tC=4,Bc(C,n,o,c)}finally{tC=A,At.transition=m}}function Bc(C,n,o,c){if(Qo){var A=Sc(C,n,o,c);if(A===null)jc(C,n,c,vo,o),Ge(C,c);else if(yC(A,C,n,o,c))c.stopPropagation();else if(Ge(C,c),n&4&&-1<sI.indexOf(C)){for(;A!==null;){var m=VI(A);if(m!==null&&ct(m),m=Sc(C,n,o,c),m===null&&jc(C,n,c,vo,o),m===A)break;A=m}A!==null&&c.stopPropagation()}else jc(C,n,c,null,o)}}var vo=null;function Sc(C,n,o,c){if(vo=null,C=$e(c),C=zn(C),C!==null)if(n=Jg(C),n===null)C=null;else if(o=n.tag,o===13){if(C=zg(n),C!==null)return C;C=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;C=null}else n!==C&&(C=null);return vo=C,null}function ms(C){switch(C){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tt()){case Bn:return 1;case Sn:return 4;case Ll:case Ul:return 16;case Yn:return 536870912;default:return 16}default:return 16}}var tn=null,Yc=null,Bo=null;function Js(){if(Bo)return Bo;var C,n=Yc,o=n.length,c,A="value"in tn?tn.value:tn.textContent,m=A.length;for(C=0;C<o&&n[C]===A[C];C++);var k=o-C;for(c=1;c<=k&&n[o-c]===A[m-c];c++);return Bo=A.slice(C,1<c?1-c:void 0)}function So(C){var n=C.keyCode;return"charCode"in C?(C=C.charCode,C===0&&n===13&&(C=13)):C=n,C===10&&(C=13),32<=C||C===13?C:0}function Yo(){return!0}function Zs(){return!1}function xg(C){function n(o,c,A,m,k){this._reactName=o,this._targetInst=A,this.type=c,this.nativeEvent=m,this.target=k,this.currentTarget=null;for(var S in C)C.hasOwnProperty(S)&&(o=C[S],this[S]=o?o(m):m[S]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Yo:Zs,this.isPropagationStopped=Zs,this}return z(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),n}var st={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(C){return C.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fc=xg(st),uI=z({},st,{view:0,detail:0}),E0=xg(uI),Kc,wc,mI,Fo=z({},uI,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nc,button:0,buttons:0,relatedTarget:function(C){return C.relatedTarget===void 0?C.fromElement===C.srcElement?C.toElement:C.fromElement:C.relatedTarget},movementX:function(C){return"movementX"in C?C.movementX:(C!==mI&&(mI&&C.type==="mousemove"?(Kc=C.screenX-mI.screenX,wc=C.screenY-mI.screenY):wc=Kc=0,mI=C),Kc)},movementY:function(C){return"movementY"in C?C.movementY:wc}}),bs=xg(Fo),O0=z({},Fo,{dataTransfer:0}),P0=xg(O0),j0=z({},uI,{relatedTarget:0}),Hc=xg(j0),$0=z({},st,{animationName:0,elapsedTime:0,pseudoElement:0}),q0=xg($0),_0=z({},st,{clipboardData:function(C){return"clipboardData"in C?C.clipboardData:window.clipboardData}}),eb=xg(_0),Cb=z({},st,{data:0}),hs=xg(Cb),gb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tb(C){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(C):(C=nb[C])?!!n[C]:!1}function Nc(){return tb}var Ib=z({},uI,{key:function(C){if(C.key){var n=gb[C.key]||C.key;if(n!=="Unidentified")return n}return C.type==="keypress"?(C=So(C),C===13?"Enter":String.fromCharCode(C)):C.type==="keydown"||C.type==="keyup"?lb[C.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nc,charCode:function(C){return C.type==="keypress"?So(C):0},keyCode:function(C){return C.type==="keydown"||C.type==="keyup"?C.keyCode:0},which:function(C){return C.type==="keypress"?So(C):C.type==="keydown"||C.type==="keyup"?C.keyCode:0}}),ob=xg(Ib),ib=z({},Fo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gs=xg(ib),cb=z({},uI,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nc}),ab=xg(cb),rb=z({},st,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ab=xg(rb),sb=z({},Fo,{deltaX:function(C){return"deltaX"in C?C.deltaX:"wheelDeltaX"in C?-C.wheelDeltaX:0},deltaY:function(C){return"deltaY"in C?C.deltaY:"wheelDeltaY"in C?-C.wheelDeltaY:"wheelDelta"in C?-C.wheelDelta:0},deltaZ:0,deltaMode:0}),db=xg(sb),ub=[9,13,27,32],zc=r&&"CompositionEvent"in window,JI=null;r&&"documentMode"in document&&(JI=document.documentMode);var mb=r&&"TextEvent"in window&&!JI,ys=r&&(!zc||JI&&8<JI&&11>=JI),ks=" ",ps=!1;function Ws(C,n){switch(C){case"keyup":return ub.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vs(C){return C=C.detail,typeof C=="object"&&"data"in C?C.data:null}var dt=!1;function Jb(C,n){switch(C){case"compositionend":return Vs(n);case"keypress":return n.which!==32?null:(ps=!0,ks);case"textInput":return C=n.data,C===ks&&ps?null:C;default:return null}}function Zb(C,n){if(dt)return C==="compositionend"||!zc&&Ws(C,n)?(C=Js(),Bo=Yc=tn=null,dt=!1,C):null;switch(C){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return ys&&n.locale!=="ko"?null:n.data;default:return null}}var bb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fs(C){var n=C&&C.nodeName&&C.nodeName.toLowerCase();return n==="input"?!!bb[C.type]:n==="textarea"}function Xs(C,n,o,c){OC(c),n=zo(n,"onChange"),0<n.length&&(o=new Fc("onChange","change",null,o,c),C.push({event:o,listeners:n}))}var ZI=null,bI=null;function hb(C){Ds(C,0)}function Ko(C){var n=bt(C);if(We(n))return C}function Gb(C,n){if(C==="change")return n}var Rs=!1;if(r){var Lc;if(r){var Uc="oninput"in document;if(!Uc){var Qs=document.createElement("div");Qs.setAttribute("oninput","return;"),Uc=typeof Qs.oninput=="function"}Lc=Uc}else Lc=!1;Rs=Lc&&(!document.documentMode||9<document.documentMode)}function vs(){ZI&&(ZI.detachEvent("onpropertychange",Bs),bI=ZI=null)}function Bs(C){if(C.propertyName==="value"&&Ko(bI)){var n=[];Xs(n,bI,C,$e(C)),gC(hb,n)}}function yb(C,n,o){C==="focusin"?(vs(),ZI=n,bI=o,ZI.attachEvent("onpropertychange",Bs)):C==="focusout"&&vs()}function kb(C){if(C==="selectionchange"||C==="keyup"||C==="keydown")return Ko(bI)}function pb(C,n){if(C==="click")return Ko(n)}function Wb(C,n){if(C==="input"||C==="change")return Ko(n)}function Vb(C,n){return C===n&&(C!==0||1/C===1/n)||C!==C&&n!==n}var Jl=typeof Object.is=="function"?Object.is:Vb;function hI(C,n){if(Jl(C,n))return!0;if(typeof C!="object"||C===null||typeof n!="object"||n===null)return!1;var o=Object.keys(C),c=Object.keys(n);if(o.length!==c.length)return!1;for(c=0;c<o.length;c++){var A=o[c];if(!s.call(n,A)||!Jl(C[A],n[A]))return!1}return!0}function Ss(C){for(;C&&C.firstChild;)C=C.firstChild;return C}function Ys(C,n){var o=Ss(C);C=0;for(var c;o;){if(o.nodeType===3){if(c=C+o.textContent.length,C<=n&&c>=n)return{node:o,offset:n-C};C=c}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Ss(o)}}function Fs(C,n){return C&&n?C===n?!0:C&&C.nodeType===3?!1:n&&n.nodeType===3?Fs(C,n.parentNode):"contains"in C?C.contains(n):C.compareDocumentPosition?!!(C.compareDocumentPosition(n)&16):!1:!1}function Ks(){for(var C=window,n=Je();n instanceof C.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)C=n.contentWindow;else break;n=Je(C.document)}return n}function Mc(C){var n=C&&C.nodeName&&C.nodeName.toLowerCase();return n&&(n==="input"&&(C.type==="text"||C.type==="search"||C.type==="tel"||C.type==="url"||C.type==="password")||n==="textarea"||C.contentEditable==="true")}function fb(C){var n=Ks(),o=C.focusedElem,c=C.selectionRange;if(n!==o&&o&&o.ownerDocument&&Fs(o.ownerDocument.documentElement,o)){if(c!==null&&Mc(o)){if(n=c.start,C=c.end,C===void 0&&(C=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(C,o.value.length);else if(C=(n=o.ownerDocument||document)&&n.defaultView||window,C.getSelection){C=C.getSelection();var A=o.textContent.length,m=Math.min(c.start,A);c=c.end===void 0?m:Math.min(c.end,A),!C.extend&&m>c&&(A=c,c=m,m=A),A=Ys(o,m);var k=Ys(o,c);A&&k&&(C.rangeCount!==1||C.anchorNode!==A.node||C.anchorOffset!==A.offset||C.focusNode!==k.node||C.focusOffset!==k.offset)&&(n=n.createRange(),n.setStart(A.node,A.offset),C.removeAllRanges(),m>c?(C.addRange(n),C.extend(k.node,k.offset)):(n.setEnd(k.node,k.offset),C.addRange(n)))}}for(n=[],C=o;C=C.parentNode;)C.nodeType===1&&n.push({element:C,left:C.scrollLeft,top:C.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)C=n[o],C.element.scrollLeft=C.left,C.element.scrollTop=C.top}}var Xb=r&&"documentMode"in document&&11>=document.documentMode,ut=null,xc=null,GI=null,Tc=!1;function ws(C,n,o){var c=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Tc||ut==null||ut!==Je(c)||(c=ut,"selectionStart"in c&&Mc(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),GI&&hI(GI,c)||(GI=c,c=zo(xc,"onSelect"),0<c.length&&(n=new Fc("onSelect","select",null,n,o),C.push({event:n,listeners:c}),n.target=ut)))}function wo(C,n){var o={};return o[C.toLowerCase()]=n.toLowerCase(),o["Webkit"+C]="webkit"+n,o["Moz"+C]="moz"+n,o}var mt={animationend:wo("Animation","AnimationEnd"),animationiteration:wo("Animation","AnimationIteration"),animationstart:wo("Animation","AnimationStart"),transitionend:wo("Transition","TransitionEnd")},Dc={},Hs={};r&&(Hs=document.createElement("div").style,"AnimationEvent"in window||(delete mt.animationend.animation,delete mt.animationiteration.animation,delete mt.animationstart.animation),"TransitionEvent"in window||delete mt.transitionend.transition);function Ho(C){if(Dc[C])return Dc[C];if(!mt[C])return C;var n=mt[C],o;for(o in n)if(n.hasOwnProperty(o)&&o in Hs)return Dc[C]=n[o];return C}var Ns=Ho("animationend"),zs=Ho("animationiteration"),Ls=Ho("animationstart"),Us=Ho("transitionend"),Ms=new Map,xs="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function In(C,n){Ms.set(C,n),i(n,[C])}for(var Ec=0;Ec<xs.length;Ec++){var Oc=xs[Ec],Rb=Oc.toLowerCase(),Qb=Oc[0].toUpperCase()+Oc.slice(1);In(Rb,"on"+Qb)}In(Ns,"onAnimationEnd"),In(zs,"onAnimationIteration"),In(Ls,"onAnimationStart"),In("dblclick","onDoubleClick"),In("focusin","onFocus"),In("focusout","onBlur"),In(Us,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yI="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vb=new Set("cancel close invalid load scroll toggle".split(" ").concat(yI));function Ts(C,n,o){var c=C.type||"unknown-event";C.currentTarget=o,Ng(c,n,void 0,C),C.currentTarget=null}function Ds(C,n){n=(n&4)!==0;for(var o=0;o<C.length;o++){var c=C[o],A=c.event;c=c.listeners;e:{var m=void 0;if(n)for(var k=c.length-1;0<=k;k--){var S=c[k],U=S.instance,Ce=S.currentTarget;if(S=S.listener,U!==m&&A.isPropagationStopped())break e;Ts(A,S,Ce),m=U}else for(k=0;k<c.length;k++){if(S=c[k],U=S.instance,Ce=S.currentTarget,S=S.listener,U!==m&&A.isPropagationStopped())break e;Ts(A,S,Ce),m=U}}}if(oC)throw C=GC,oC=!1,GC=null,C}function VC(C,n){var o=n[ga];o===void 0&&(o=n[ga]=new Set);var c=C+"__bubble";o.has(c)||(Es(n,C,2,!1),o.add(c))}function Pc(C,n,o){var c=0;n&&(c|=4),Es(o,C,c,n)}var No="_reactListening"+Math.random().toString(36).slice(2);function kI(C){if(!C[No]){C[No]=!0,t.forEach(function(o){o!=="selectionchange"&&(vb.has(o)||Pc(o,!1,C),Pc(o,!0,C))});var n=C.nodeType===9?C:C.ownerDocument;n===null||n[No]||(n[No]=!0,Pc("selectionchange",!1,n))}}function Es(C,n,o,c){switch(ms(n)){case 1:var A=T0;break;case 4:A=D0;break;default:A=Bc}o=A.bind(null,n,o,C),A=void 0,!Wg||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(A=!0),c?A!==void 0?C.addEventListener(n,o,{capture:!0,passive:A}):C.addEventListener(n,o,!0):A!==void 0?C.addEventListener(n,o,{passive:A}):C.addEventListener(n,o,!1)}function jc(C,n,o,c,A){var m=c;if(!(n&1)&&!(n&2)&&c!==null)e:for(;;){if(c===null)return;var k=c.tag;if(k===3||k===4){var S=c.stateNode.containerInfo;if(S===A||S.nodeType===8&&S.parentNode===A)break;if(k===4)for(k=c.return;k!==null;){var U=k.tag;if((U===3||U===4)&&(U=k.stateNode.containerInfo,U===A||U.nodeType===8&&U.parentNode===A))return;k=k.return}for(;S!==null;){if(k=zn(S),k===null)return;if(U=k.tag,U===5||U===6){c=m=k;continue e}S=S.parentNode}}c=c.return}gC(function(){var Ce=m,Ie=$e(o),ce=[];e:{var te=Ms.get(C);if(te!==void 0){var be=Fc,pe=C;switch(C){case"keypress":if(So(o)===0)break e;case"keydown":case"keyup":be=ob;break;case"focusin":pe="focus",be=Hc;break;case"focusout":pe="blur",be=Hc;break;case"beforeblur":case"afterblur":be=Hc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":be=bs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":be=P0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":be=ab;break;case Ns:case zs:case Ls:be=q0;break;case Us:be=Ab;break;case"scroll":be=E0;break;case"wheel":be=db;break;case"copy":case"cut":case"paste":be=eb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":be=Gs}var Ve=(n&4)!==0,HC=!Ve&&C==="scroll",$=Ve?te!==null?te+"Capture":null:te;Ve=[];for(var x=Ce,_;x!==null;){_=x;var re=_.stateNode;if(_.tag===5&&re!==null&&(_=re,$!==null&&(re=RC(x,$),re!=null&&Ve.push(pI(x,re,_)))),HC)break;x=x.return}0<Ve.length&&(te=new be(te,pe,null,o,Ie),ce.push({event:te,listeners:Ve}))}}if(!(n&7)){e:{if(te=C==="mouseover"||C==="pointerover",be=C==="mouseout"||C==="pointerout",te&&o!==Oe&&(pe=o.relatedTarget||o.fromElement)&&(zn(pe)||pe[Dl]))break e;if((be||te)&&(te=Ie.window===Ie?Ie:(te=Ie.ownerDocument)?te.defaultView||te.parentWindow:window,be?(pe=o.relatedTarget||o.toElement,be=Ce,pe=pe?zn(pe):null,pe!==null&&(HC=Jg(pe),pe!==HC||pe.tag!==5&&pe.tag!==6)&&(pe=null)):(be=null,pe=Ce),be!==pe)){if(Ve=bs,re="onMouseLeave",$="onMouseEnter",x="mouse",(C==="pointerout"||C==="pointerover")&&(Ve=Gs,re="onPointerLeave",$="onPointerEnter",x="pointer"),HC=be==null?te:bt(be),_=pe==null?te:bt(pe),te=new Ve(re,x+"leave",be,o,Ie),te.target=HC,te.relatedTarget=_,re=null,zn(Ie)===Ce&&(Ve=new Ve($,x+"enter",pe,o,Ie),Ve.target=_,Ve.relatedTarget=HC,re=Ve),HC=re,be&&pe)C:{for(Ve=be,$=pe,x=0,_=Ve;_;_=Jt(_))x++;for(_=0,re=$;re;re=Jt(re))_++;for(;0<x-_;)Ve=Jt(Ve),x--;for(;0<_-x;)$=Jt($),_--;for(;x--;){if(Ve===$||$!==null&&Ve===$.alternate)break C;Ve=Jt(Ve),$=Jt($)}Ve=null}else Ve=null;be!==null&&Os(ce,te,be,Ve,!1),pe!==null&&HC!==null&&Os(ce,HC,pe,Ve,!0)}}e:{if(te=Ce?bt(Ce):window,be=te.nodeName&&te.nodeName.toLowerCase(),be==="select"||be==="input"&&te.type==="file")var Xe=Gb;else if(fs(te))if(Rs)Xe=Wb;else{Xe=kb;var we=yb}else(be=te.nodeName)&&be.toLowerCase()==="input"&&(te.type==="checkbox"||te.type==="radio")&&(Xe=pb);if(Xe&&(Xe=Xe(C,Ce))){Xs(ce,Xe,o,Ie);break e}we&&we(C,te,Ce),C==="focusout"&&(we=te._wrapperState)&&we.controlled&&te.type==="number"&&Ue(te,"number",te.value)}switch(we=Ce?bt(Ce):window,C){case"focusin":(fs(we)||we.contentEditable==="true")&&(ut=we,xc=Ce,GI=null);break;case"focusout":GI=xc=ut=null;break;case"mousedown":Tc=!0;break;case"contextmenu":case"mouseup":case"dragend":Tc=!1,ws(ce,o,Ie);break;case"selectionchange":if(Xb)break;case"keydown":case"keyup":ws(ce,o,Ie)}var He;if(zc)e:{switch(C){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else dt?Ws(C,o)&&(xe="onCompositionEnd"):C==="keydown"&&o.keyCode===229&&(xe="onCompositionStart");xe&&(ys&&o.locale!=="ko"&&(dt||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&dt&&(He=Js()):(tn=Ie,Yc="value"in tn?tn.value:tn.textContent,dt=!0)),we=zo(Ce,xe),0<we.length&&(xe=new hs(xe,C,null,o,Ie),ce.push({event:xe,listeners:we}),He?xe.data=He:(He=Vs(o),He!==null&&(xe.data=He)))),(He=mb?Jb(C,o):Zb(C,o))&&(Ce=zo(Ce,"onBeforeInput"),0<Ce.length&&(Ie=new hs("onBeforeInput","beforeinput",null,o,Ie),ce.push({event:Ie,listeners:Ce}),Ie.data=He))}Ds(ce,n)})}function pI(C,n,o){return{instance:C,listener:n,currentTarget:o}}function zo(C,n){for(var o=n+"Capture",c=[];C!==null;){var A=C,m=A.stateNode;A.tag===5&&m!==null&&(A=m,m=RC(C,o),m!=null&&c.unshift(pI(C,m,A)),m=RC(C,n),m!=null&&c.push(pI(C,m,A))),C=C.return}return c}function Jt(C){if(C===null)return null;do C=C.return;while(C&&C.tag!==5);return C||null}function Os(C,n,o,c,A){for(var m=n._reactName,k=[];o!==null&&o!==c;){var S=o,U=S.alternate,Ce=S.stateNode;if(U!==null&&U===c)break;S.tag===5&&Ce!==null&&(S=Ce,A?(U=RC(o,m),U!=null&&k.unshift(pI(o,U,S))):A||(U=RC(o,m),U!=null&&k.push(pI(o,U,S)))),o=o.return}k.length!==0&&C.push({event:n,listeners:k})}var Bb=/\r\n?/g,Sb=/\u0000|\uFFFD/g;function Ps(C){return(typeof C=="string"?C:""+C).replace(Bb,`
`).replace(Sb,"")}function Lo(C,n,o){if(n=Ps(n),Ps(C)!==n&&o)throw Error(l(425))}function Uo(){}var $c=null,qc=null;function _c(C,n){return C==="textarea"||C==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var ea=typeof setTimeout=="function"?setTimeout:void 0,Yb=typeof clearTimeout=="function"?clearTimeout:void 0,js=typeof Promise=="function"?Promise:void 0,Fb=typeof queueMicrotask=="function"?queueMicrotask:typeof js<"u"?function(C){return js.resolve(null).then(C).catch(Kb)}:ea;function Kb(C){setTimeout(function(){throw C})}function Ca(C,n){var o=n,c=0;do{var A=o.nextSibling;if(C.removeChild(o),A&&A.nodeType===8)if(o=A.data,o==="/$"){if(c===0){C.removeChild(A),Ql(n);return}c--}else o!=="$"&&o!=="$?"&&o!=="$!"||c++;o=A}while(o);Ql(n)}function on(C){for(;C!=null;C=C.nextSibling){var n=C.nodeType;if(n===1||n===3)break;if(n===8){if(n=C.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return C}function $s(C){C=C.previousSibling;for(var n=0;C;){if(C.nodeType===8){var o=C.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return C;n--}else o==="/$"&&n++}C=C.previousSibling}return null}var Zt=Math.random().toString(36).slice(2),vl="__reactFiber$"+Zt,WI="__reactProps$"+Zt,Dl="__reactContainer$"+Zt,ga="__reactEvents$"+Zt,wb="__reactListeners$"+Zt,Hb="__reactHandles$"+Zt;function zn(C){var n=C[vl];if(n)return n;for(var o=C.parentNode;o;){if(n=o[Dl]||o[vl]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(C=$s(C);C!==null;){if(o=C[vl])return o;C=$s(C)}return n}C=o,o=C.parentNode}return null}function VI(C){return C=C[vl]||C[Dl],!C||C.tag!==5&&C.tag!==6&&C.tag!==13&&C.tag!==3?null:C}function bt(C){if(C.tag===5||C.tag===6)return C.stateNode;throw Error(l(33))}function Mo(C){return C[WI]||null}var la=[],ht=-1;function cn(C){return{current:C}}function fC(C){0>ht||(C.current=la[ht],la[ht]=null,ht--)}function kC(C,n){ht++,la[ht]=C.current,C.current=n}var an={},rg=cn(an),Xg=cn(!1),Ln=an;function Gt(C,n){var o=C.type.contextTypes;if(!o)return an;var c=C.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===n)return c.__reactInternalMemoizedMaskedChildContext;var A={},m;for(m in o)A[m]=n[m];return c&&(C=C.stateNode,C.__reactInternalMemoizedUnmaskedChildContext=n,C.__reactInternalMemoizedMaskedChildContext=A),A}function Rg(C){return C=C.childContextTypes,C!=null}function xo(){fC(Xg),fC(rg)}function qs(C,n,o){if(rg.current!==an)throw Error(l(168));kC(rg,n),kC(Xg,o)}function _s(C,n,o){var c=C.stateNode;if(n=n.childContextTypes,typeof c.getChildContext!="function")return o;c=c.getChildContext();for(var A in c)if(!(A in n))throw Error(l(108,ie(C)||"Unknown",A));return z({},o,c)}function To(C){return C=(C=C.stateNode)&&C.__reactInternalMemoizedMergedChildContext||an,Ln=rg.current,kC(rg,C),kC(Xg,Xg.current),!0}function ed(C,n,o){var c=C.stateNode;if(!c)throw Error(l(169));o?(C=_s(C,n,Ln),c.__reactInternalMemoizedMergedChildContext=C,fC(Xg),fC(rg),kC(rg,C)):fC(Xg),kC(Xg,o)}var El=null,Do=!1,na=!1;function Cd(C){El===null?El=[C]:El.push(C)}function Nb(C){Do=!0,Cd(C)}function rn(){if(!na&&El!==null){na=!0;var C=0,n=tC;try{var o=El;for(tC=1;C<o.length;C++){var c=o[C];do c=c(!0);while(c!==null)}El=null,Do=!1}catch(A){throw El!==null&&(El=El.slice(C+1)),zl(Bn,rn),A}finally{tC=n,na=!1}}return null}var yt=[],kt=0,Eo=null,Oo=0,ll=[],nl=0,Un=null,Ol=1,Pl="";function Mn(C,n){yt[kt++]=Oo,yt[kt++]=Eo,Eo=C,Oo=n}function gd(C,n,o){ll[nl++]=Ol,ll[nl++]=Pl,ll[nl++]=Un,Un=C;var c=Ol;C=Pl;var A=32-ag(c)-1;c&=~(1<<A),o+=1;var m=32-ag(n)+A;if(30<m){var k=A-A%5;m=(c&(1<<k)-1).toString(32),c>>=k,A-=k,Ol=1<<32-ag(n)+A|o<<A|c,Pl=m+C}else Ol=1<<m|o<<A|c,Pl=C}function ta(C){C.return!==null&&(Mn(C,1),gd(C,1,0))}function Ia(C){for(;C===Eo;)Eo=yt[--kt],yt[kt]=null,Oo=yt[--kt],yt[kt]=null;for(;C===Un;)Un=ll[--nl],ll[nl]=null,Pl=ll[--nl],ll[nl]=null,Ol=ll[--nl],ll[nl]=null}var Tg=null,Dg=null,vC=!1,Zl=null;function ld(C,n){var o=il(5,null,null,0);o.elementType="DELETED",o.stateNode=n,o.return=C,n=C.deletions,n===null?(C.deletions=[o],C.flags|=16):n.push(o)}function nd(C,n){switch(C.tag){case 5:var o=C.type;return n=n.nodeType!==1||o.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(C.stateNode=n,Tg=C,Dg=on(n.firstChild),!0):!1;case 6:return n=C.pendingProps===""||n.nodeType!==3?null:n,n!==null?(C.stateNode=n,Tg=C,Dg=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(o=Un!==null?{id:Ol,overflow:Pl}:null,C.memoizedState={dehydrated:n,treeContext:o,retryLane:1073741824},o=il(18,null,null,0),o.stateNode=n,o.return=C,C.child=o,Tg=C,Dg=null,!0):!1;default:return!1}}function oa(C){return(C.mode&1)!==0&&(C.flags&128)===0}function ia(C){if(vC){var n=Dg;if(n){var o=n;if(!nd(C,n)){if(oa(C))throw Error(l(418));n=on(o.nextSibling);var c=Tg;n&&nd(C,n)?ld(c,o):(C.flags=C.flags&-4097|2,vC=!1,Tg=C)}}else{if(oa(C))throw Error(l(418));C.flags=C.flags&-4097|2,vC=!1,Tg=C}}}function td(C){for(C=C.return;C!==null&&C.tag!==5&&C.tag!==3&&C.tag!==13;)C=C.return;Tg=C}function Po(C){if(C!==Tg)return!1;if(!vC)return td(C),vC=!0,!1;var n;if((n=C.tag!==3)&&!(n=C.tag!==5)&&(n=C.type,n=n!=="head"&&n!=="body"&&!_c(C.type,C.memoizedProps)),n&&(n=Dg)){if(oa(C))throw Id(),Error(l(418));for(;n;)ld(C,n),n=on(n.nextSibling)}if(td(C),C.tag===13){if(C=C.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(l(317));e:{for(C=C.nextSibling,n=0;C;){if(C.nodeType===8){var o=C.data;if(o==="/$"){if(n===0){Dg=on(C.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++}C=C.nextSibling}Dg=null}}else Dg=Tg?on(C.stateNode.nextSibling):null;return!0}function Id(){for(var C=Dg;C;)C=on(C.nextSibling)}function pt(){Dg=Tg=null,vC=!1}function ca(C){Zl===null?Zl=[C]:Zl.push(C)}var zb=B.ReactCurrentBatchConfig;function fI(C,n,o){if(C=o.ref,C!==null&&typeof C!="function"&&typeof C!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(l(309));var c=o.stateNode}if(!c)throw Error(l(147,C));var A=c,m=""+C;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===m?n.ref:(n=function(k){var S=A.refs;k===null?delete S[m]:S[m]=k},n._stringRef=m,n)}if(typeof C!="string")throw Error(l(284));if(!o._owner)throw Error(l(290,C))}return C}function jo(C,n){throw C=Object.prototype.toString.call(n),Error(l(31,C==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":C))}function od(C){var n=C._init;return n(C._payload)}function id(C){function n($,x){if(C){var _=$.deletions;_===null?($.deletions=[x],$.flags|=16):_.push(x)}}function o($,x){if(!C)return null;for(;x!==null;)n($,x),x=x.sibling;return null}function c($,x){for($=new Map;x!==null;)x.key!==null?$.set(x.key,x):$.set(x.index,x),x=x.sibling;return $}function A($,x){return $=bn($,x),$.index=0,$.sibling=null,$}function m($,x,_){return $.index=_,C?(_=$.alternate,_!==null?(_=_.index,_<x?($.flags|=2,x):_):($.flags|=2,x)):($.flags|=1048576,x)}function k($){return C&&$.alternate===null&&($.flags|=2),$}function S($,x,_,re){return x===null||x.tag!==6?(x=er(_,$.mode,re),x.return=$,x):(x=A(x,_),x.return=$,x)}function U($,x,_,re){var Xe=_.type;return Xe===v?Ie($,x,_.props.children,re,_.key):x!==null&&(x.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===N&&od(Xe)===x.type)?(re=A(x,_.props),re.ref=fI($,x,_),re.return=$,re):(re=hi(_.type,_.key,_.props,null,$.mode,re),re.ref=fI($,x,_),re.return=$,re)}function Ce($,x,_,re){return x===null||x.tag!==4||x.stateNode.containerInfo!==_.containerInfo||x.stateNode.implementation!==_.implementation?(x=Cr(_,$.mode,re),x.return=$,x):(x=A(x,_.children||[]),x.return=$,x)}function Ie($,x,_,re,Xe){return x===null||x.tag!==7?(x=$n(_,$.mode,re,Xe),x.return=$,x):(x=A(x,_),x.return=$,x)}function ce($,x,_){if(typeof x=="string"&&x!==""||typeof x=="number")return x=er(""+x,$.mode,_),x.return=$,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case V:return _=hi(x.type,x.key,x.props,null,$.mode,_),_.ref=fI($,null,x),_.return=$,_;case Q:return x=Cr(x,$.mode,_),x.return=$,x;case N:var re=x._init;return ce($,re(x._payload),_)}if(Me(x)||T(x))return x=$n(x,$.mode,_,null),x.return=$,x;jo($,x)}return null}function te($,x,_,re){var Xe=x!==null?x.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return Xe!==null?null:S($,x,""+_,re);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case V:return _.key===Xe?U($,x,_,re):null;case Q:return _.key===Xe?Ce($,x,_,re):null;case N:return Xe=_._init,te($,x,Xe(_._payload),re)}if(Me(_)||T(_))return Xe!==null?null:Ie($,x,_,re,null);jo($,_)}return null}function be($,x,_,re,Xe){if(typeof re=="string"&&re!==""||typeof re=="number")return $=$.get(_)||null,S(x,$,""+re,Xe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case V:return $=$.get(re.key===null?_:re.key)||null,U(x,$,re,Xe);case Q:return $=$.get(re.key===null?_:re.key)||null,Ce(x,$,re,Xe);case N:var we=re._init;return be($,x,_,we(re._payload),Xe)}if(Me(re)||T(re))return $=$.get(_)||null,Ie(x,$,re,Xe,null);jo(x,re)}return null}function pe($,x,_,re){for(var Xe=null,we=null,He=x,xe=x=0,gg=null;He!==null&&xe<_.length;xe++){He.index>xe?(gg=He,He=null):gg=He.sibling;var rC=te($,He,_[xe],re);if(rC===null){He===null&&(He=gg);break}C&&He&&rC.alternate===null&&n($,He),x=m(rC,x,xe),we===null?Xe=rC:we.sibling=rC,we=rC,He=gg}if(xe===_.length)return o($,He),vC&&Mn($,xe),Xe;if(He===null){for(;xe<_.length;xe++)He=ce($,_[xe],re),He!==null&&(x=m(He,x,xe),we===null?Xe=He:we.sibling=He,we=He);return vC&&Mn($,xe),Xe}for(He=c($,He);xe<_.length;xe++)gg=be(He,$,xe,_[xe],re),gg!==null&&(C&&gg.alternate!==null&&He.delete(gg.key===null?xe:gg.key),x=m(gg,x,xe),we===null?Xe=gg:we.sibling=gg,we=gg);return C&&He.forEach(function(hn){return n($,hn)}),vC&&Mn($,xe),Xe}function Ve($,x,_,re){var Xe=T(_);if(typeof Xe!="function")throw Error(l(150));if(_=Xe.call(_),_==null)throw Error(l(151));for(var we=Xe=null,He=x,xe=x=0,gg=null,rC=_.next();He!==null&&!rC.done;xe++,rC=_.next()){He.index>xe?(gg=He,He=null):gg=He.sibling;var hn=te($,He,rC.value,re);if(hn===null){He===null&&(He=gg);break}C&&He&&hn.alternate===null&&n($,He),x=m(hn,x,xe),we===null?Xe=hn:we.sibling=hn,we=hn,He=gg}if(rC.done)return o($,He),vC&&Mn($,xe),Xe;if(He===null){for(;!rC.done;xe++,rC=_.next())rC=ce($,rC.value,re),rC!==null&&(x=m(rC,x,xe),we===null?Xe=rC:we.sibling=rC,we=rC);return vC&&Mn($,xe),Xe}for(He=c($,He);!rC.done;xe++,rC=_.next())rC=be(He,$,xe,rC.value,re),rC!==null&&(C&&rC.alternate!==null&&He.delete(rC.key===null?xe:rC.key),x=m(rC,x,xe),we===null?Xe=rC:we.sibling=rC,we=rC);return C&&He.forEach(function(bh){return n($,bh)}),vC&&Mn($,xe),Xe}function HC($,x,_,re){if(typeof _=="object"&&_!==null&&_.type===v&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case V:e:{for(var Xe=_.key,we=x;we!==null;){if(we.key===Xe){if(Xe=_.type,Xe===v){if(we.tag===7){o($,we.sibling),x=A(we,_.props.children),x.return=$,$=x;break e}}else if(we.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===N&&od(Xe)===we.type){o($,we.sibling),x=A(we,_.props),x.ref=fI($,we,_),x.return=$,$=x;break e}o($,we);break}else n($,we);we=we.sibling}_.type===v?(x=$n(_.props.children,$.mode,re,_.key),x.return=$,$=x):(re=hi(_.type,_.key,_.props,null,$.mode,re),re.ref=fI($,x,_),re.return=$,$=re)}return k($);case Q:e:{for(we=_.key;x!==null;){if(x.key===we)if(x.tag===4&&x.stateNode.containerInfo===_.containerInfo&&x.stateNode.implementation===_.implementation){o($,x.sibling),x=A(x,_.children||[]),x.return=$,$=x;break e}else{o($,x);break}else n($,x);x=x.sibling}x=Cr(_,$.mode,re),x.return=$,$=x}return k($);case N:return we=_._init,HC($,x,we(_._payload),re)}if(Me(_))return pe($,x,_,re);if(T(_))return Ve($,x,_,re);jo($,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,x!==null&&x.tag===6?(o($,x.sibling),x=A(x,_),x.return=$,$=x):(o($,x),x=er(_,$.mode,re),x.return=$,$=x),k($)):o($,x)}return HC}var Wt=id(!0),cd=id(!1),$o=cn(null),qo=null,Vt=null,aa=null;function ra(){aa=Vt=qo=null}function Aa(C){var n=$o.current;fC($o),C._currentValue=n}function sa(C,n,o){for(;C!==null;){var c=C.alternate;if((C.childLanes&n)!==n?(C.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),C===o)break;C=C.return}}function ft(C,n){qo=C,aa=Vt=null,C=C.dependencies,C!==null&&C.firstContext!==null&&(C.lanes&n&&(Qg=!0),C.firstContext=null)}function tl(C){var n=C._currentValue;if(aa!==C)if(C={context:C,memoizedValue:n,next:null},Vt===null){if(qo===null)throw Error(l(308));Vt=C,qo.dependencies={lanes:0,firstContext:C}}else Vt=Vt.next=C;return n}var xn=null;function da(C){xn===null?xn=[C]:xn.push(C)}function ad(C,n,o,c){var A=n.interleaved;return A===null?(o.next=o,da(n)):(o.next=A.next,A.next=o),n.interleaved=o,jl(C,c)}function jl(C,n){C.lanes|=n;var o=C.alternate;for(o!==null&&(o.lanes|=n),o=C,C=C.return;C!==null;)C.childLanes|=n,o=C.alternate,o!==null&&(o.childLanes|=n),o=C,C=C.return;return o.tag===3?o.stateNode:null}var An=!1;function ua(C){C.updateQueue={baseState:C.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rd(C,n){C=C.updateQueue,n.updateQueue===C&&(n.updateQueue={baseState:C.baseState,firstBaseUpdate:C.firstBaseUpdate,lastBaseUpdate:C.lastBaseUpdate,shared:C.shared,effects:C.effects})}function $l(C,n){return{eventTime:C,lane:n,tag:0,payload:null,callback:null,next:null}}function sn(C,n,o){var c=C.updateQueue;if(c===null)return null;if(c=c.shared,iC&2){var A=c.pending;return A===null?n.next=n:(n.next=A.next,A.next=n),c.pending=n,jl(C,o)}return A=c.interleaved,A===null?(n.next=n,da(c)):(n.next=A.next,A.next=n),c.interleaved=n,jl(C,o)}function _o(C,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194240)!==0)){var c=n.lanes;c&=C.pendingLanes,o|=c,n.lanes=o,Hn(C,o)}}function Ad(C,n){var o=C.updateQueue,c=C.alternate;if(c!==null&&(c=c.updateQueue,o===c)){var A=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var k={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};m===null?A=m=k:m=m.next=k,o=o.next}while(o!==null);m===null?A=m=n:m=m.next=n}else A=m=n;o={baseState:c.baseState,firstBaseUpdate:A,lastBaseUpdate:m,shared:c.shared,effects:c.effects},C.updateQueue=o;return}C=o.lastBaseUpdate,C===null?o.firstBaseUpdate=n:C.next=n,o.lastBaseUpdate=n}function ei(C,n,o,c){var A=C.updateQueue;An=!1;var m=A.firstBaseUpdate,k=A.lastBaseUpdate,S=A.shared.pending;if(S!==null){A.shared.pending=null;var U=S,Ce=U.next;U.next=null,k===null?m=Ce:k.next=Ce,k=U;var Ie=C.alternate;Ie!==null&&(Ie=Ie.updateQueue,S=Ie.lastBaseUpdate,S!==k&&(S===null?Ie.firstBaseUpdate=Ce:S.next=Ce,Ie.lastBaseUpdate=U))}if(m!==null){var ce=A.baseState;k=0,Ie=Ce=U=null,S=m;do{var te=S.lane,be=S.eventTime;if((c&te)===te){Ie!==null&&(Ie=Ie.next={eventTime:be,lane:0,tag:S.tag,payload:S.payload,callback:S.callback,next:null});e:{var pe=C,Ve=S;switch(te=n,be=o,Ve.tag){case 1:if(pe=Ve.payload,typeof pe=="function"){ce=pe.call(be,ce,te);break e}ce=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=Ve.payload,te=typeof pe=="function"?pe.call(be,ce,te):pe,te==null)break e;ce=z({},ce,te);break e;case 2:An=!0}}S.callback!==null&&S.lane!==0&&(C.flags|=64,te=A.effects,te===null?A.effects=[S]:te.push(S))}else be={eventTime:be,lane:te,tag:S.tag,payload:S.payload,callback:S.callback,next:null},Ie===null?(Ce=Ie=be,U=ce):Ie=Ie.next=be,k|=te;if(S=S.next,S===null){if(S=A.shared.pending,S===null)break;te=S,S=te.next,te.next=null,A.lastBaseUpdate=te,A.shared.pending=null}}while(!0);if(Ie===null&&(U=ce),A.baseState=U,A.firstBaseUpdate=Ce,A.lastBaseUpdate=Ie,n=A.shared.interleaved,n!==null){A=n;do k|=A.lane,A=A.next;while(A!==n)}else m===null&&(A.shared.lanes=0);En|=k,C.lanes=k,C.memoizedState=ce}}function sd(C,n,o){if(C=n.effects,n.effects=null,C!==null)for(n=0;n<C.length;n++){var c=C[n],A=c.callback;if(A!==null){if(c.callback=null,c=o,typeof A!="function")throw Error(l(191,A));A.call(c)}}}var XI={},Bl=cn(XI),RI=cn(XI),QI=cn(XI);function Tn(C){if(C===XI)throw Error(l(174));return C}function ma(C,n){switch(kC(QI,n),kC(RI,C),kC(Bl,XI),C=n.nodeType,C){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:pC(null,"");break;default:C=C===8?n.parentNode:n,n=C.namespaceURI||null,C=C.tagName,n=pC(n,C)}fC(Bl),kC(Bl,n)}function Xt(){fC(Bl),fC(RI),fC(QI)}function dd(C){Tn(QI.current);var n=Tn(Bl.current),o=pC(n,C.type);n!==o&&(kC(RI,C),kC(Bl,o))}function Ja(C){RI.current===C&&(fC(Bl),fC(RI))}var YC=cn(0);function Ci(C){for(var n=C;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===C)break;for(;n.sibling===null;){if(n.return===null||n.return===C)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Za=[];function ba(){for(var C=0;C<Za.length;C++)Za[C]._workInProgressVersionPrimary=null;Za.length=0}var gi=B.ReactCurrentDispatcher,ha=B.ReactCurrentBatchConfig,Dn=0,FC=null,PC=null,eg=null,li=!1,vI=!1,BI=0,Lb=0;function Ag(){throw Error(l(321))}function Ga(C,n){if(n===null)return!1;for(var o=0;o<n.length&&o<C.length;o++)if(!Jl(C[o],n[o]))return!1;return!0}function ya(C,n,o,c,A,m){if(Dn=m,FC=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,gi.current=C===null||C.memoizedState===null?Tb:Db,C=o(c,A),vI){m=0;do{if(vI=!1,BI=0,25<=m)throw Error(l(301));m+=1,eg=PC=null,n.updateQueue=null,gi.current=Eb,C=o(c,A)}while(vI)}if(gi.current=Ii,n=PC!==null&&PC.next!==null,Dn=0,eg=PC=FC=null,li=!1,n)throw Error(l(300));return C}function ka(){var C=BI!==0;return BI=0,C}function Sl(){var C={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return eg===null?FC.memoizedState=eg=C:eg=eg.next=C,eg}function Il(){if(PC===null){var C=FC.alternate;C=C!==null?C.memoizedState:null}else C=PC.next;var n=eg===null?FC.memoizedState:eg.next;if(n!==null)eg=n,PC=C;else{if(C===null)throw Error(l(310));PC=C,C={memoizedState:PC.memoizedState,baseState:PC.baseState,baseQueue:PC.baseQueue,queue:PC.queue,next:null},eg===null?FC.memoizedState=eg=C:eg=eg.next=C}return eg}function SI(C,n){return typeof n=="function"?n(C):n}function pa(C){var n=Il(),o=n.queue;if(o===null)throw Error(l(311));o.lastRenderedReducer=C;var c=PC,A=c.baseQueue,m=o.pending;if(m!==null){if(A!==null){var k=A.next;A.next=m.next,m.next=k}c.baseQueue=A=m,o.pending=null}if(A!==null){m=A.next,c=c.baseState;var S=k=null,U=null,Ce=m;do{var Ie=Ce.lane;if((Dn&Ie)===Ie)U!==null&&(U=U.next={lane:0,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),c=Ce.hasEagerState?Ce.eagerState:C(c,Ce.action);else{var ce={lane:Ie,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null};U===null?(S=U=ce,k=c):U=U.next=ce,FC.lanes|=Ie,En|=Ie}Ce=Ce.next}while(Ce!==null&&Ce!==m);U===null?k=c:U.next=S,Jl(c,n.memoizedState)||(Qg=!0),n.memoizedState=c,n.baseState=k,n.baseQueue=U,o.lastRenderedState=c}if(C=o.interleaved,C!==null){A=C;do m=A.lane,FC.lanes|=m,En|=m,A=A.next;while(A!==C)}else A===null&&(o.lanes=0);return[n.memoizedState,o.dispatch]}function Wa(C){var n=Il(),o=n.queue;if(o===null)throw Error(l(311));o.lastRenderedReducer=C;var c=o.dispatch,A=o.pending,m=n.memoizedState;if(A!==null){o.pending=null;var k=A=A.next;do m=C(m,k.action),k=k.next;while(k!==A);Jl(m,n.memoizedState)||(Qg=!0),n.memoizedState=m,n.baseQueue===null&&(n.baseState=m),o.lastRenderedState=m}return[m,c]}function ud(){}function md(C,n){var o=FC,c=Il(),A=n(),m=!Jl(c.memoizedState,A);if(m&&(c.memoizedState=A,Qg=!0),c=c.queue,Va(bd.bind(null,o,c,C),[C]),c.getSnapshot!==n||m||eg!==null&&eg.memoizedState.tag&1){if(o.flags|=2048,YI(9,Zd.bind(null,o,c,A,n),void 0,null),Cg===null)throw Error(l(349));Dn&30||Jd(o,n,A)}return A}function Jd(C,n,o){C.flags|=16384,C={getSnapshot:n,value:o},n=FC.updateQueue,n===null?(n={lastEffect:null,stores:null},FC.updateQueue=n,n.stores=[C]):(o=n.stores,o===null?n.stores=[C]:o.push(C))}function Zd(C,n,o,c){n.value=o,n.getSnapshot=c,hd(n)&&Gd(C)}function bd(C,n,o){return o(function(){hd(n)&&Gd(C)})}function hd(C){var n=C.getSnapshot;C=C.value;try{var o=n();return!Jl(C,o)}catch{return!0}}function Gd(C){var n=jl(C,1);n!==null&&yl(n,C,1,-1)}function yd(C){var n=Sl();return typeof C=="function"&&(C=C()),n.memoizedState=n.baseState=C,C={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:SI,lastRenderedState:C},n.queue=C,C=C.dispatch=xb.bind(null,FC,C),[n.memoizedState,C]}function YI(C,n,o,c){return C={tag:C,create:n,destroy:o,deps:c,next:null},n=FC.updateQueue,n===null?(n={lastEffect:null,stores:null},FC.updateQueue=n,n.lastEffect=C.next=C):(o=n.lastEffect,o===null?n.lastEffect=C.next=C:(c=o.next,o.next=C,C.next=c,n.lastEffect=C)),C}function kd(){return Il().memoizedState}function ni(C,n,o,c){var A=Sl();FC.flags|=C,A.memoizedState=YI(1|n,o,void 0,c===void 0?null:c)}function ti(C,n,o,c){var A=Il();c=c===void 0?null:c;var m=void 0;if(PC!==null){var k=PC.memoizedState;if(m=k.destroy,c!==null&&Ga(c,k.deps)){A.memoizedState=YI(n,o,m,c);return}}FC.flags|=C,A.memoizedState=YI(1|n,o,m,c)}function pd(C,n){return ni(8390656,8,C,n)}function Va(C,n){return ti(2048,8,C,n)}function Wd(C,n){return ti(4,2,C,n)}function Vd(C,n){return ti(4,4,C,n)}function fd(C,n){if(typeof n=="function")return C=C(),n(C),function(){n(null)};if(n!=null)return C=C(),n.current=C,function(){n.current=null}}function Xd(C,n,o){return o=o!=null?o.concat([C]):null,ti(4,4,fd.bind(null,n,C),o)}function fa(){}function Rd(C,n){var o=Il();n=n===void 0?null:n;var c=o.memoizedState;return c!==null&&n!==null&&Ga(n,c[1])?c[0]:(o.memoizedState=[C,n],C)}function Qd(C,n){var o=Il();n=n===void 0?null:n;var c=o.memoizedState;return c!==null&&n!==null&&Ga(n,c[1])?c[0]:(C=C(),o.memoizedState=[C,n],C)}function vd(C,n,o){return Dn&21?(Jl(o,n)||(o=ot(),FC.lanes|=o,En|=o,C.baseState=!0),n):(C.baseState&&(C.baseState=!1,Qg=!0),C.memoizedState=o)}function Ub(C,n){var o=tC;tC=o!==0&&4>o?o:4,C(!0);var c=ha.transition;ha.transition={};try{C(!1),n()}finally{tC=o,ha.transition=c}}function Bd(){return Il().memoizedState}function Mb(C,n,o){var c=Jn(C);if(o={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null},Sd(C))Yd(n,o);else if(o=ad(C,n,o,c),o!==null){var A=yg();yl(o,C,c,A),Fd(o,n,c)}}function xb(C,n,o){var c=Jn(C),A={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null};if(Sd(C))Yd(n,A);else{var m=C.alternate;if(C.lanes===0&&(m===null||m.lanes===0)&&(m=n.lastRenderedReducer,m!==null))try{var k=n.lastRenderedState,S=m(k,o);if(A.hasEagerState=!0,A.eagerState=S,Jl(S,k)){var U=n.interleaved;U===null?(A.next=A,da(n)):(A.next=U.next,U.next=A),n.interleaved=A;return}}catch{}finally{}o=ad(C,n,A,c),o!==null&&(A=yg(),yl(o,C,c,A),Fd(o,n,c))}}function Sd(C){var n=C.alternate;return C===FC||n!==null&&n===FC}function Yd(C,n){vI=li=!0;var o=C.pending;o===null?n.next=n:(n.next=o.next,o.next=n),C.pending=n}function Fd(C,n,o){if(o&4194240){var c=n.lanes;c&=C.pendingLanes,o|=c,n.lanes=o,Hn(C,o)}}var Ii={readContext:tl,useCallback:Ag,useContext:Ag,useEffect:Ag,useImperativeHandle:Ag,useInsertionEffect:Ag,useLayoutEffect:Ag,useMemo:Ag,useReducer:Ag,useRef:Ag,useState:Ag,useDebugValue:Ag,useDeferredValue:Ag,useTransition:Ag,useMutableSource:Ag,useSyncExternalStore:Ag,useId:Ag,unstable_isNewReconciler:!1},Tb={readContext:tl,useCallback:function(C,n){return Sl().memoizedState=[C,n===void 0?null:n],C},useContext:tl,useEffect:pd,useImperativeHandle:function(C,n,o){return o=o!=null?o.concat([C]):null,ni(4194308,4,fd.bind(null,n,C),o)},useLayoutEffect:function(C,n){return ni(4194308,4,C,n)},useInsertionEffect:function(C,n){return ni(4,2,C,n)},useMemo:function(C,n){var o=Sl();return n=n===void 0?null:n,C=C(),o.memoizedState=[C,n],C},useReducer:function(C,n,o){var c=Sl();return n=o!==void 0?o(n):n,c.memoizedState=c.baseState=n,C={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:C,lastRenderedState:n},c.queue=C,C=C.dispatch=Mb.bind(null,FC,C),[c.memoizedState,C]},useRef:function(C){var n=Sl();return C={current:C},n.memoizedState=C},useState:yd,useDebugValue:fa,useDeferredValue:function(C){return Sl().memoizedState=C},useTransition:function(){var C=yd(!1),n=C[0];return C=Ub.bind(null,C[1]),Sl().memoizedState=C,[n,C]},useMutableSource:function(){},useSyncExternalStore:function(C,n,o){var c=FC,A=Sl();if(vC){if(o===void 0)throw Error(l(407));o=o()}else{if(o=n(),Cg===null)throw Error(l(349));Dn&30||Jd(c,n,o)}A.memoizedState=o;var m={value:o,getSnapshot:n};return A.queue=m,pd(bd.bind(null,c,m,C),[C]),c.flags|=2048,YI(9,Zd.bind(null,c,m,o,n),void 0,null),o},useId:function(){var C=Sl(),n=Cg.identifierPrefix;if(vC){var o=Pl,c=Ol;o=(c&~(1<<32-ag(c)-1)).toString(32)+o,n=":"+n+"R"+o,o=BI++,0<o&&(n+="H"+o.toString(32)),n+=":"}else o=Lb++,n=":"+n+"r"+o.toString(32)+":";return C.memoizedState=n},unstable_isNewReconciler:!1},Db={readContext:tl,useCallback:Rd,useContext:tl,useEffect:Va,useImperativeHandle:Xd,useInsertionEffect:Wd,useLayoutEffect:Vd,useMemo:Qd,useReducer:pa,useRef:kd,useState:function(){return pa(SI)},useDebugValue:fa,useDeferredValue:function(C){var n=Il();return vd(n,PC.memoizedState,C)},useTransition:function(){var C=pa(SI)[0],n=Il().memoizedState;return[C,n]},useMutableSource:ud,useSyncExternalStore:md,useId:Bd,unstable_isNewReconciler:!1},Eb={readContext:tl,useCallback:Rd,useContext:tl,useEffect:Va,useImperativeHandle:Xd,useInsertionEffect:Wd,useLayoutEffect:Vd,useMemo:Qd,useReducer:Wa,useRef:kd,useState:function(){return Wa(SI)},useDebugValue:fa,useDeferredValue:function(C){var n=Il();return PC===null?n.memoizedState=C:vd(n,PC.memoizedState,C)},useTransition:function(){var C=Wa(SI)[0],n=Il().memoizedState;return[C,n]},useMutableSource:ud,useSyncExternalStore:md,useId:Bd,unstable_isNewReconciler:!1};function bl(C,n){if(C&&C.defaultProps){n=z({},n),C=C.defaultProps;for(var o in C)n[o]===void 0&&(n[o]=C[o]);return n}return n}function Xa(C,n,o,c){n=C.memoizedState,o=o(c,n),o=o==null?n:z({},n,o),C.memoizedState=o,C.lanes===0&&(C.updateQueue.baseState=o)}var oi={isMounted:function(C){return(C=C._reactInternals)?Jg(C)===C:!1},enqueueSetState:function(C,n,o){C=C._reactInternals;var c=yg(),A=Jn(C),m=$l(c,A);m.payload=n,o!=null&&(m.callback=o),n=sn(C,m,A),n!==null&&(yl(n,C,A,c),_o(n,C,A))},enqueueReplaceState:function(C,n,o){C=C._reactInternals;var c=yg(),A=Jn(C),m=$l(c,A);m.tag=1,m.payload=n,o!=null&&(m.callback=o),n=sn(C,m,A),n!==null&&(yl(n,C,A,c),_o(n,C,A))},enqueueForceUpdate:function(C,n){C=C._reactInternals;var o=yg(),c=Jn(C),A=$l(o,c);A.tag=2,n!=null&&(A.callback=n),n=sn(C,A,c),n!==null&&(yl(n,C,c,o),_o(n,C,c))}};function Kd(C,n,o,c,A,m,k){return C=C.stateNode,typeof C.shouldComponentUpdate=="function"?C.shouldComponentUpdate(c,m,k):n.prototype&&n.prototype.isPureReactComponent?!hI(o,c)||!hI(A,m):!0}function wd(C,n,o){var c=!1,A=an,m=n.contextType;return typeof m=="object"&&m!==null?m=tl(m):(A=Rg(n)?Ln:rg.current,c=n.contextTypes,m=(c=c!=null)?Gt(C,A):an),n=new n(o,m),C.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=oi,C.stateNode=n,n._reactInternals=C,c&&(C=C.stateNode,C.__reactInternalMemoizedUnmaskedChildContext=A,C.__reactInternalMemoizedMaskedChildContext=m),n}function Hd(C,n,o,c){C=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,c),n.state!==C&&oi.enqueueReplaceState(n,n.state,null)}function Ra(C,n,o,c){var A=C.stateNode;A.props=o,A.state=C.memoizedState,A.refs={},ua(C);var m=n.contextType;typeof m=="object"&&m!==null?A.context=tl(m):(m=Rg(n)?Ln:rg.current,A.context=Gt(C,m)),A.state=C.memoizedState,m=n.getDerivedStateFromProps,typeof m=="function"&&(Xa(C,n,m,o),A.state=C.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(n=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),n!==A.state&&oi.enqueueReplaceState(A,A.state,null),ei(C,o,A,c),A.state=C.memoizedState),typeof A.componentDidMount=="function"&&(C.flags|=4194308)}function Rt(C,n){try{var o="",c=n;do o+=ge(c),c=c.return;while(c);var A=o}catch(m){A=`
Error generating stack: `+m.message+`
`+m.stack}return{value:C,source:n,stack:A,digest:null}}function Qa(C,n,o){return{value:C,source:null,stack:o??null,digest:n??null}}function va(C,n){try{console.error(n.value)}catch(o){setTimeout(function(){throw o})}}var Ob=typeof WeakMap=="function"?WeakMap:Map;function Nd(C,n,o){o=$l(-1,o),o.tag=3,o.payload={element:null};var c=n.value;return o.callback=function(){di||(di=!0,Da=c),va(C,n)},o}function zd(C,n,o){o=$l(-1,o),o.tag=3;var c=C.type.getDerivedStateFromError;if(typeof c=="function"){var A=n.value;o.payload=function(){return c(A)},o.callback=function(){va(C,n)}}var m=C.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(o.callback=function(){va(C,n),typeof c!="function"&&(un===null?un=new Set([this]):un.add(this));var k=n.stack;this.componentDidCatch(n.value,{componentStack:k!==null?k:""})}),o}function Ld(C,n,o){var c=C.pingCache;if(c===null){c=C.pingCache=new Ob;var A=new Set;c.set(n,A)}else A=c.get(n),A===void 0&&(A=new Set,c.set(n,A));A.has(o)||(A.add(o),C=ih.bind(null,C,n,o),n.then(C,C))}function Ud(C){do{var n;if((n=C.tag===13)&&(n=C.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return C;C=C.return}while(C!==null);return null}function Md(C,n,o,c,A){return C.mode&1?(C.flags|=65536,C.lanes=A,C):(C===n?C.flags|=65536:(C.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(n=$l(-1,1),n.tag=2,sn(o,n,1))),o.lanes|=1),C)}var Pb=B.ReactCurrentOwner,Qg=!1;function Gg(C,n,o,c){n.child=C===null?cd(n,null,o,c):Wt(n,C.child,o,c)}function xd(C,n,o,c,A){o=o.render;var m=n.ref;return ft(n,A),c=ya(C,n,o,c,m,A),o=ka(),C!==null&&!Qg?(n.updateQueue=C.updateQueue,n.flags&=-2053,C.lanes&=~A,ql(C,n,A)):(vC&&o&&ta(n),n.flags|=1,Gg(C,n,c,A),n.child)}function Td(C,n,o,c,A){if(C===null){var m=o.type;return typeof m=="function"&&!_a(m)&&m.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(n.tag=15,n.type=m,Dd(C,n,m,c,A)):(C=hi(o.type,null,c,n,n.mode,A),C.ref=n.ref,C.return=n,n.child=C)}if(m=C.child,!(C.lanes&A)){var k=m.memoizedProps;if(o=o.compare,o=o!==null?o:hI,o(k,c)&&C.ref===n.ref)return ql(C,n,A)}return n.flags|=1,C=bn(m,c),C.ref=n.ref,C.return=n,n.child=C}function Dd(C,n,o,c,A){if(C!==null){var m=C.memoizedProps;if(hI(m,c)&&C.ref===n.ref)if(Qg=!1,n.pendingProps=c=m,(C.lanes&A)!==0)C.flags&131072&&(Qg=!0);else return n.lanes=C.lanes,ql(C,n,A)}return Ba(C,n,o,c,A)}function Ed(C,n,o){var c=n.pendingProps,A=c.children,m=C!==null?C.memoizedState:null;if(c.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},kC(vt,Eg),Eg|=o;else{if(!(o&1073741824))return C=m!==null?m.baseLanes|o:o,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:C,cachePool:null,transitions:null},n.updateQueue=null,kC(vt,Eg),Eg|=C,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=m!==null?m.baseLanes:o,kC(vt,Eg),Eg|=c}else m!==null?(c=m.baseLanes|o,n.memoizedState=null):c=o,kC(vt,Eg),Eg|=c;return Gg(C,n,A,o),n.child}function Od(C,n){var o=n.ref;(C===null&&o!==null||C!==null&&C.ref!==o)&&(n.flags|=512,n.flags|=2097152)}function Ba(C,n,o,c,A){var m=Rg(o)?Ln:rg.current;return m=Gt(n,m),ft(n,A),o=ya(C,n,o,c,m,A),c=ka(),C!==null&&!Qg?(n.updateQueue=C.updateQueue,n.flags&=-2053,C.lanes&=~A,ql(C,n,A)):(vC&&c&&ta(n),n.flags|=1,Gg(C,n,o,A),n.child)}function Pd(C,n,o,c,A){if(Rg(o)){var m=!0;To(n)}else m=!1;if(ft(n,A),n.stateNode===null)ci(C,n),wd(n,o,c),Ra(n,o,c,A),c=!0;else if(C===null){var k=n.stateNode,S=n.memoizedProps;k.props=S;var U=k.context,Ce=o.contextType;typeof Ce=="object"&&Ce!==null?Ce=tl(Ce):(Ce=Rg(o)?Ln:rg.current,Ce=Gt(n,Ce));var Ie=o.getDerivedStateFromProps,ce=typeof Ie=="function"||typeof k.getSnapshotBeforeUpdate=="function";ce||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(S!==c||U!==Ce)&&Hd(n,k,c,Ce),An=!1;var te=n.memoizedState;k.state=te,ei(n,c,k,A),U=n.memoizedState,S!==c||te!==U||Xg.current||An?(typeof Ie=="function"&&(Xa(n,o,Ie,c),U=n.memoizedState),(S=An||Kd(n,o,S,c,te,U,Ce))?(ce||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(n.flags|=4194308)):(typeof k.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=U),k.props=c,k.state=U,k.context=Ce,c=S):(typeof k.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{k=n.stateNode,rd(C,n),S=n.memoizedProps,Ce=n.type===n.elementType?S:bl(n.type,S),k.props=Ce,ce=n.pendingProps,te=k.context,U=o.contextType,typeof U=="object"&&U!==null?U=tl(U):(U=Rg(o)?Ln:rg.current,U=Gt(n,U));var be=o.getDerivedStateFromProps;(Ie=typeof be=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(S!==ce||te!==U)&&Hd(n,k,c,U),An=!1,te=n.memoizedState,k.state=te,ei(n,c,k,A);var pe=n.memoizedState;S!==ce||te!==pe||Xg.current||An?(typeof be=="function"&&(Xa(n,o,be,c),pe=n.memoizedState),(Ce=An||Kd(n,o,Ce,c,te,pe,U)||!1)?(Ie||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(c,pe,U),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(c,pe,U)),typeof k.componentDidUpdate=="function"&&(n.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof k.componentDidUpdate!="function"||S===C.memoizedProps&&te===C.memoizedState||(n.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||S===C.memoizedProps&&te===C.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=pe),k.props=c,k.state=pe,k.context=U,c=Ce):(typeof k.componentDidUpdate!="function"||S===C.memoizedProps&&te===C.memoizedState||(n.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||S===C.memoizedProps&&te===C.memoizedState||(n.flags|=1024),c=!1)}return Sa(C,n,o,c,m,A)}function Sa(C,n,o,c,A,m){Od(C,n);var k=(n.flags&128)!==0;if(!c&&!k)return A&&ed(n,o,!1),ql(C,n,m);c=n.stateNode,Pb.current=n;var S=k&&typeof o.getDerivedStateFromError!="function"?null:c.render();return n.flags|=1,C!==null&&k?(n.child=Wt(n,C.child,null,m),n.child=Wt(n,null,S,m)):Gg(C,n,S,m),n.memoizedState=c.state,A&&ed(n,o,!0),n.child}function jd(C){var n=C.stateNode;n.pendingContext?qs(C,n.pendingContext,n.pendingContext!==n.context):n.context&&qs(C,n.context,!1),ma(C,n.containerInfo)}function $d(C,n,o,c,A){return pt(),ca(A),n.flags|=256,Gg(C,n,o,c),n.child}var Ya={dehydrated:null,treeContext:null,retryLane:0};function Fa(C){return{baseLanes:C,cachePool:null,transitions:null}}function qd(C,n,o){var c=n.pendingProps,A=YC.current,m=!1,k=(n.flags&128)!==0,S;if((S=k)||(S=C!==null&&C.memoizedState===null?!1:(A&2)!==0),S?(m=!0,n.flags&=-129):(C===null||C.memoizedState!==null)&&(A|=1),kC(YC,A&1),C===null)return ia(n),C=n.memoizedState,C!==null&&(C=C.dehydrated,C!==null)?(n.mode&1?C.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(k=c.children,C=c.fallback,m?(c=n.mode,m=n.child,k={mode:"hidden",children:k},!(c&1)&&m!==null?(m.childLanes=0,m.pendingProps=k):m=Gi(k,c,0,null),C=$n(C,c,o,null),m.return=n,C.return=n,m.sibling=C,n.child=m,n.child.memoizedState=Fa(o),n.memoizedState=Ya,C):Ka(n,k));if(A=C.memoizedState,A!==null&&(S=A.dehydrated,S!==null))return jb(C,n,k,c,S,A,o);if(m){m=c.fallback,k=n.mode,A=C.child,S=A.sibling;var U={mode:"hidden",children:c.children};return!(k&1)&&n.child!==A?(c=n.child,c.childLanes=0,c.pendingProps=U,n.deletions=null):(c=bn(A,U),c.subtreeFlags=A.subtreeFlags&14680064),S!==null?m=bn(S,m):(m=$n(m,k,o,null),m.flags|=2),m.return=n,c.return=n,c.sibling=m,n.child=c,c=m,m=n.child,k=C.child.memoizedState,k=k===null?Fa(o):{baseLanes:k.baseLanes|o,cachePool:null,transitions:k.transitions},m.memoizedState=k,m.childLanes=C.childLanes&~o,n.memoizedState=Ya,c}return m=C.child,C=m.sibling,c=bn(m,{mode:"visible",children:c.children}),!(n.mode&1)&&(c.lanes=o),c.return=n,c.sibling=null,C!==null&&(o=n.deletions,o===null?(n.deletions=[C],n.flags|=16):o.push(C)),n.child=c,n.memoizedState=null,c}function Ka(C,n){return n=Gi({mode:"visible",children:n},C.mode,0,null),n.return=C,C.child=n}function ii(C,n,o,c){return c!==null&&ca(c),Wt(n,C.child,null,o),C=Ka(n,n.pendingProps.children),C.flags|=2,n.memoizedState=null,C}function jb(C,n,o,c,A,m,k){if(o)return n.flags&256?(n.flags&=-257,c=Qa(Error(l(422))),ii(C,n,k,c)):n.memoizedState!==null?(n.child=C.child,n.flags|=128,null):(m=c.fallback,A=n.mode,c=Gi({mode:"visible",children:c.children},A,0,null),m=$n(m,A,k,null),m.flags|=2,c.return=n,m.return=n,c.sibling=m,n.child=c,n.mode&1&&Wt(n,C.child,null,k),n.child.memoizedState=Fa(k),n.memoizedState=Ya,m);if(!(n.mode&1))return ii(C,n,k,null);if(A.data==="$!"){if(c=A.nextSibling&&A.nextSibling.dataset,c)var S=c.dgst;return c=S,m=Error(l(419)),c=Qa(m,c,void 0),ii(C,n,k,c)}if(S=(k&C.childLanes)!==0,Qg||S){if(c=Cg,c!==null){switch(k&-k){case 4:A=2;break;case 16:A=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:A=32;break;case 536870912:A=268435456;break;default:A=0}A=A&(c.suspendedLanes|k)?0:A,A!==0&&A!==m.retryLane&&(m.retryLane=A,jl(C,A),yl(c,C,A,-1))}return qa(),c=Qa(Error(l(421))),ii(C,n,k,c)}return A.data==="$?"?(n.flags|=128,n.child=C.child,n=ch.bind(null,C),A._reactRetry=n,null):(C=m.treeContext,Dg=on(A.nextSibling),Tg=n,vC=!0,Zl=null,C!==null&&(ll[nl++]=Ol,ll[nl++]=Pl,ll[nl++]=Un,Ol=C.id,Pl=C.overflow,Un=n),n=Ka(n,c.children),n.flags|=4096,n)}function _d(C,n,o){C.lanes|=n;var c=C.alternate;c!==null&&(c.lanes|=n),sa(C.return,n,o)}function wa(C,n,o,c,A){var m=C.memoizedState;m===null?C.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:o,tailMode:A}:(m.isBackwards=n,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=o,m.tailMode=A)}function eu(C,n,o){var c=n.pendingProps,A=c.revealOrder,m=c.tail;if(Gg(C,n,c.children,o),c=YC.current,c&2)c=c&1|2,n.flags|=128;else{if(C!==null&&C.flags&128)e:for(C=n.child;C!==null;){if(C.tag===13)C.memoizedState!==null&&_d(C,o,n);else if(C.tag===19)_d(C,o,n);else if(C.child!==null){C.child.return=C,C=C.child;continue}if(C===n)break e;for(;C.sibling===null;){if(C.return===null||C.return===n)break e;C=C.return}C.sibling.return=C.return,C=C.sibling}c&=1}if(kC(YC,c),!(n.mode&1))n.memoizedState=null;else switch(A){case"forwards":for(o=n.child,A=null;o!==null;)C=o.alternate,C!==null&&Ci(C)===null&&(A=o),o=o.sibling;o=A,o===null?(A=n.child,n.child=null):(A=o.sibling,o.sibling=null),wa(n,!1,A,o,m);break;case"backwards":for(o=null,A=n.child,n.child=null;A!==null;){if(C=A.alternate,C!==null&&Ci(C)===null){n.child=A;break}C=A.sibling,A.sibling=o,o=A,A=C}wa(n,!0,o,null,m);break;case"together":wa(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function ci(C,n){!(n.mode&1)&&C!==null&&(C.alternate=null,n.alternate=null,n.flags|=2)}function ql(C,n,o){if(C!==null&&(n.dependencies=C.dependencies),En|=n.lanes,!(o&n.childLanes))return null;if(C!==null&&n.child!==C.child)throw Error(l(153));if(n.child!==null){for(C=n.child,o=bn(C,C.pendingProps),n.child=o,o.return=n;C.sibling!==null;)C=C.sibling,o=o.sibling=bn(C,C.pendingProps),o.return=n;o.sibling=null}return n.child}function $b(C,n,o){switch(n.tag){case 3:jd(n),pt();break;case 5:dd(n);break;case 1:Rg(n.type)&&To(n);break;case 4:ma(n,n.stateNode.containerInfo);break;case 10:var c=n.type._context,A=n.memoizedProps.value;kC($o,c._currentValue),c._currentValue=A;break;case 13:if(c=n.memoizedState,c!==null)return c.dehydrated!==null?(kC(YC,YC.current&1),n.flags|=128,null):o&n.child.childLanes?qd(C,n,o):(kC(YC,YC.current&1),C=ql(C,n,o),C!==null?C.sibling:null);kC(YC,YC.current&1);break;case 19:if(c=(o&n.childLanes)!==0,C.flags&128){if(c)return eu(C,n,o);n.flags|=128}if(A=n.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),kC(YC,YC.current),c)break;return null;case 22:case 23:return n.lanes=0,Ed(C,n,o)}return ql(C,n,o)}var Cu,Ha,gu,lu;Cu=function(C,n){for(var o=n.child;o!==null;){if(o.tag===5||o.tag===6)C.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return;o=o.return}o.sibling.return=o.return,o=o.sibling}},Ha=function(){},gu=function(C,n,o,c){var A=C.memoizedProps;if(A!==c){C=n.stateNode,Tn(Bl.current);var m=null;switch(o){case"input":A=ue(C,A),c=ue(C,c),m=[];break;case"select":A=z({},A,{value:void 0}),c=z({},c,{value:void 0}),m=[];break;case"textarea":A=De(C,A),c=De(C,c),m=[];break;default:typeof A.onClick!="function"&&typeof c.onClick=="function"&&(C.onclick=Uo)}je(o,c);var k;o=null;for(Ce in A)if(!c.hasOwnProperty(Ce)&&A.hasOwnProperty(Ce)&&A[Ce]!=null)if(Ce==="style"){var S=A[Ce];for(k in S)S.hasOwnProperty(k)&&(o||(o={}),o[k]="")}else Ce!=="dangerouslySetInnerHTML"&&Ce!=="children"&&Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&Ce!=="autoFocus"&&(I.hasOwnProperty(Ce)?m||(m=[]):(m=m||[]).push(Ce,null));for(Ce in c){var U=c[Ce];if(S=A!=null?A[Ce]:void 0,c.hasOwnProperty(Ce)&&U!==S&&(U!=null||S!=null))if(Ce==="style")if(S){for(k in S)!S.hasOwnProperty(k)||U&&U.hasOwnProperty(k)||(o||(o={}),o[k]="");for(k in U)U.hasOwnProperty(k)&&S[k]!==U[k]&&(o||(o={}),o[k]=U[k])}else o||(m||(m=[]),m.push(Ce,o)),o=U;else Ce==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,S=S?S.__html:void 0,U!=null&&S!==U&&(m=m||[]).push(Ce,U)):Ce==="children"?typeof U!="string"&&typeof U!="number"||(m=m||[]).push(Ce,""+U):Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&(I.hasOwnProperty(Ce)?(U!=null&&Ce==="onScroll"&&VC("scroll",C),m||S===U||(m=[])):(m=m||[]).push(Ce,U))}o&&(m=m||[]).push("style",o);var Ce=m;(n.updateQueue=Ce)&&(n.flags|=4)}},lu=function(C,n,o,c){o!==c&&(n.flags|=4)};function FI(C,n){if(!vC)switch(C.tailMode){case"hidden":n=C.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?C.tail=null:o.sibling=null;break;case"collapsed":o=C.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?n||C.tail===null?C.tail=null:C.tail.sibling=null:c.sibling=null}}function sg(C){var n=C.alternate!==null&&C.alternate.child===C.child,o=0,c=0;if(n)for(var A=C.child;A!==null;)o|=A.lanes|A.childLanes,c|=A.subtreeFlags&14680064,c|=A.flags&14680064,A.return=C,A=A.sibling;else for(A=C.child;A!==null;)o|=A.lanes|A.childLanes,c|=A.subtreeFlags,c|=A.flags,A.return=C,A=A.sibling;return C.subtreeFlags|=c,C.childLanes=o,n}function qb(C,n,o){var c=n.pendingProps;switch(Ia(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sg(n),null;case 1:return Rg(n.type)&&xo(),sg(n),null;case 3:return c=n.stateNode,Xt(),fC(Xg),fC(rg),ba(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(C===null||C.child===null)&&(Po(n)?n.flags|=4:C===null||C.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Zl!==null&&(Pa(Zl),Zl=null))),Ha(C,n),sg(n),null;case 5:Ja(n);var A=Tn(QI.current);if(o=n.type,C!==null&&n.stateNode!=null)gu(C,n,o,c,A),C.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!c){if(n.stateNode===null)throw Error(l(166));return sg(n),null}if(C=Tn(Bl.current),Po(n)){c=n.stateNode,o=n.type;var m=n.memoizedProps;switch(c[vl]=n,c[WI]=m,C=(n.mode&1)!==0,o){case"dialog":VC("cancel",c),VC("close",c);break;case"iframe":case"object":case"embed":VC("load",c);break;case"video":case"audio":for(A=0;A<yI.length;A++)VC(yI[A],c);break;case"source":VC("error",c);break;case"img":case"image":case"link":VC("error",c),VC("load",c);break;case"details":VC("toggle",c);break;case"input":he(c,m),VC("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!m.multiple},VC("invalid",c);break;case"textarea":fe(c,m),VC("invalid",c)}je(o,m),A=null;for(var k in m)if(m.hasOwnProperty(k)){var S=m[k];k==="children"?typeof S=="string"?c.textContent!==S&&(m.suppressHydrationWarning!==!0&&Lo(c.textContent,S,C),A=["children",S]):typeof S=="number"&&c.textContent!==""+S&&(m.suppressHydrationWarning!==!0&&Lo(c.textContent,S,C),A=["children",""+S]):I.hasOwnProperty(k)&&S!=null&&k==="onScroll"&&VC("scroll",c)}switch(o){case"input":ze(c),Ye(c,m,!0);break;case"textarea":ze(c),eC(c);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(c.onclick=Uo)}c=A,n.updateQueue=c,c!==null&&(n.flags|=4)}else{k=A.nodeType===9?A:A.ownerDocument,C==="http://www.w3.org/1999/xhtml"&&(C=IC(o)),C==="http://www.w3.org/1999/xhtml"?o==="script"?(C=k.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild)):typeof c.is=="string"?C=k.createElement(o,{is:c.is}):(C=k.createElement(o),o==="select"&&(k=C,c.multiple?k.multiple=!0:c.size&&(k.size=c.size))):C=k.createElementNS(C,o),C[vl]=n,C[WI]=c,Cu(C,n,!1,!1),n.stateNode=C;e:{switch(k=ve(o,c),o){case"dialog":VC("cancel",C),VC("close",C),A=c;break;case"iframe":case"object":case"embed":VC("load",C),A=c;break;case"video":case"audio":for(A=0;A<yI.length;A++)VC(yI[A],C);A=c;break;case"source":VC("error",C),A=c;break;case"img":case"image":case"link":VC("error",C),VC("load",C),A=c;break;case"details":VC("toggle",C),A=c;break;case"input":he(C,c),A=ue(C,c),VC("invalid",C);break;case"option":A=c;break;case"select":C._wrapperState={wasMultiple:!!c.multiple},A=z({},c,{value:void 0}),VC("invalid",C);break;case"textarea":fe(C,c),A=De(C,c),VC("invalid",C);break;default:A=c}je(o,A),S=A;for(m in S)if(S.hasOwnProperty(m)){var U=S[m];m==="style"?Ze(C,U):m==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,U!=null&&hC(C,U)):m==="children"?typeof U=="string"?(o!=="textarea"||U!=="")&&WC(C,U):typeof U=="number"&&WC(C,""+U):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(I.hasOwnProperty(m)?U!=null&&m==="onScroll"&&VC("scroll",C):U!=null&&X(C,m,U,k))}switch(o){case"input":ze(C),Ye(C,c,!1);break;case"textarea":ze(C),eC(C);break;case"option":c.value!=null&&C.setAttribute("value",""+Ae(c.value));break;case"select":C.multiple=!!c.multiple,m=c.value,m!=null?Re(C,!!c.multiple,m,!1):c.defaultValue!=null&&Re(C,!!c.multiple,c.defaultValue,!0);break;default:typeof A.onClick=="function"&&(C.onclick=Uo)}switch(o){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return sg(n),null;case 6:if(C&&n.stateNode!=null)lu(C,n,C.memoizedProps,c);else{if(typeof c!="string"&&n.stateNode===null)throw Error(l(166));if(o=Tn(QI.current),Tn(Bl.current),Po(n)){if(c=n.stateNode,o=n.memoizedProps,c[vl]=n,(m=c.nodeValue!==o)&&(C=Tg,C!==null))switch(C.tag){case 3:Lo(c.nodeValue,o,(C.mode&1)!==0);break;case 5:C.memoizedProps.suppressHydrationWarning!==!0&&Lo(c.nodeValue,o,(C.mode&1)!==0)}m&&(n.flags|=4)}else c=(o.nodeType===9?o:o.ownerDocument).createTextNode(c),c[vl]=n,n.stateNode=c}return sg(n),null;case 13:if(fC(YC),c=n.memoizedState,C===null||C.memoizedState!==null&&C.memoizedState.dehydrated!==null){if(vC&&Dg!==null&&n.mode&1&&!(n.flags&128))Id(),pt(),n.flags|=98560,m=!1;else if(m=Po(n),c!==null&&c.dehydrated!==null){if(C===null){if(!m)throw Error(l(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(l(317));m[vl]=n}else pt(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;sg(n),m=!1}else Zl!==null&&(Pa(Zl),Zl=null),m=!0;if(!m)return n.flags&65536?n:null}return n.flags&128?(n.lanes=o,n):(c=c!==null,c!==(C!==null&&C.memoizedState!==null)&&c&&(n.child.flags|=8192,n.mode&1&&(C===null||YC.current&1?jC===0&&(jC=3):qa())),n.updateQueue!==null&&(n.flags|=4),sg(n),null);case 4:return Xt(),Ha(C,n),C===null&&kI(n.stateNode.containerInfo),sg(n),null;case 10:return Aa(n.type._context),sg(n),null;case 17:return Rg(n.type)&&xo(),sg(n),null;case 19:if(fC(YC),m=n.memoizedState,m===null)return sg(n),null;if(c=(n.flags&128)!==0,k=m.rendering,k===null)if(c)FI(m,!1);else{if(jC!==0||C!==null&&C.flags&128)for(C=n.child;C!==null;){if(k=Ci(C),k!==null){for(n.flags|=128,FI(m,!1),c=k.updateQueue,c!==null&&(n.updateQueue=c,n.flags|=4),n.subtreeFlags=0,c=o,o=n.child;o!==null;)m=o,C=c,m.flags&=14680066,k=m.alternate,k===null?(m.childLanes=0,m.lanes=C,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=k.childLanes,m.lanes=k.lanes,m.child=k.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=k.memoizedProps,m.memoizedState=k.memoizedState,m.updateQueue=k.updateQueue,m.type=k.type,C=k.dependencies,m.dependencies=C===null?null:{lanes:C.lanes,firstContext:C.firstContext}),o=o.sibling;return kC(YC,YC.current&1|2),n.child}C=C.sibling}m.tail!==null&&uC()>Bt&&(n.flags|=128,c=!0,FI(m,!1),n.lanes=4194304)}else{if(!c)if(C=Ci(k),C!==null){if(n.flags|=128,c=!0,o=C.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),FI(m,!0),m.tail===null&&m.tailMode==="hidden"&&!k.alternate&&!vC)return sg(n),null}else 2*uC()-m.renderingStartTime>Bt&&o!==1073741824&&(n.flags|=128,c=!0,FI(m,!1),n.lanes=4194304);m.isBackwards?(k.sibling=n.child,n.child=k):(o=m.last,o!==null?o.sibling=k:n.child=k,m.last=k)}return m.tail!==null?(n=m.tail,m.rendering=n,m.tail=n.sibling,m.renderingStartTime=uC(),n.sibling=null,o=YC.current,kC(YC,c?o&1|2:o&1),n):(sg(n),null);case 22:case 23:return $a(),c=n.memoizedState!==null,C!==null&&C.memoizedState!==null!==c&&(n.flags|=8192),c&&n.mode&1?Eg&1073741824&&(sg(n),n.subtreeFlags&6&&(n.flags|=8192)):sg(n),null;case 24:return null;case 25:return null}throw Error(l(156,n.tag))}function _b(C,n){switch(Ia(n),n.tag){case 1:return Rg(n.type)&&xo(),C=n.flags,C&65536?(n.flags=C&-65537|128,n):null;case 3:return Xt(),fC(Xg),fC(rg),ba(),C=n.flags,C&65536&&!(C&128)?(n.flags=C&-65537|128,n):null;case 5:return Ja(n),null;case 13:if(fC(YC),C=n.memoizedState,C!==null&&C.dehydrated!==null){if(n.alternate===null)throw Error(l(340));pt()}return C=n.flags,C&65536?(n.flags=C&-65537|128,n):null;case 19:return fC(YC),null;case 4:return Xt(),null;case 10:return Aa(n.type._context),null;case 22:case 23:return $a(),null;case 24:return null;default:return null}}var ai=!1,dg=!1,eh=typeof WeakSet=="function"?WeakSet:Set,ke=null;function Qt(C,n){var o=C.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(c){KC(C,n,c)}else o.current=null}function Na(C,n,o){try{o()}catch(c){KC(C,n,c)}}var nu=!1;function Ch(C,n){if($c=Qo,C=Ks(),Mc(C)){if("selectionStart"in C)var o={start:C.selectionStart,end:C.selectionEnd};else e:{o=(o=C.ownerDocument)&&o.defaultView||window;var c=o.getSelection&&o.getSelection();if(c&&c.rangeCount!==0){o=c.anchorNode;var A=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var k=0,S=-1,U=-1,Ce=0,Ie=0,ce=C,te=null;C:for(;;){for(var be;ce!==o||A!==0&&ce.nodeType!==3||(S=k+A),ce!==m||c!==0&&ce.nodeType!==3||(U=k+c),ce.nodeType===3&&(k+=ce.nodeValue.length),(be=ce.firstChild)!==null;)te=ce,ce=be;for(;;){if(ce===C)break C;if(te===o&&++Ce===A&&(S=k),te===m&&++Ie===c&&(U=k),(be=ce.nextSibling)!==null)break;ce=te,te=ce.parentNode}ce=be}o=S===-1||U===-1?null:{start:S,end:U}}else o=null}o=o||{start:0,end:0}}else o=null;for(qc={focusedElem:C,selectionRange:o},Qo=!1,ke=n;ke!==null;)if(n=ke,C=n.child,(n.subtreeFlags&1028)!==0&&C!==null)C.return=n,ke=C;else for(;ke!==null;){n=ke;try{var pe=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(pe!==null){var Ve=pe.memoizedProps,HC=pe.memoizedState,$=n.stateNode,x=$.getSnapshotBeforeUpdate(n.elementType===n.type?Ve:bl(n.type,Ve),HC);$.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var _=n.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(re){KC(n,n.return,re)}if(C=n.sibling,C!==null){C.return=n.return,ke=C;break}ke=n.return}return pe=nu,nu=!1,pe}function KI(C,n,o){var c=n.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var A=c=c.next;do{if((A.tag&C)===C){var m=A.destroy;A.destroy=void 0,m!==void 0&&Na(n,o,m)}A=A.next}while(A!==c)}}function ri(C,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&C)===C){var c=o.create;o.destroy=c()}o=o.next}while(o!==n)}}function za(C){var n=C.ref;if(n!==null){var o=C.stateNode;switch(C.tag){case 5:C=o;break;default:C=o}typeof n=="function"?n(C):n.current=C}}function tu(C){var n=C.alternate;n!==null&&(C.alternate=null,tu(n)),C.child=null,C.deletions=null,C.sibling=null,C.tag===5&&(n=C.stateNode,n!==null&&(delete n[vl],delete n[WI],delete n[ga],delete n[wb],delete n[Hb])),C.stateNode=null,C.return=null,C.dependencies=null,C.memoizedProps=null,C.memoizedState=null,C.pendingProps=null,C.stateNode=null,C.updateQueue=null}function Iu(C){return C.tag===5||C.tag===3||C.tag===4}function ou(C){e:for(;;){for(;C.sibling===null;){if(C.return===null||Iu(C.return))return null;C=C.return}for(C.sibling.return=C.return,C=C.sibling;C.tag!==5&&C.tag!==6&&C.tag!==18;){if(C.flags&2||C.child===null||C.tag===4)continue e;C.child.return=C,C=C.child}if(!(C.flags&2))return C.stateNode}}function La(C,n,o){var c=C.tag;if(c===5||c===6)C=C.stateNode,n?o.nodeType===8?o.parentNode.insertBefore(C,n):o.insertBefore(C,n):(o.nodeType===8?(n=o.parentNode,n.insertBefore(C,o)):(n=o,n.appendChild(C)),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=Uo));else if(c!==4&&(C=C.child,C!==null))for(La(C,n,o),C=C.sibling;C!==null;)La(C,n,o),C=C.sibling}function Ua(C,n,o){var c=C.tag;if(c===5||c===6)C=C.stateNode,n?o.insertBefore(C,n):o.appendChild(C);else if(c!==4&&(C=C.child,C!==null))for(Ua(C,n,o),C=C.sibling;C!==null;)Ua(C,n,o),C=C.sibling}var Ig=null,hl=!1;function dn(C,n,o){for(o=o.child;o!==null;)iu(C,n,o),o=o.sibling}function iu(C,n,o){if(UC&&typeof UC.onCommitFiberUnmount=="function")try{UC.onCommitFiberUnmount(ul,o)}catch{}switch(o.tag){case 5:dg||Qt(o,n);case 6:var c=Ig,A=hl;Ig=null,dn(C,n,o),Ig=c,hl=A,Ig!==null&&(hl?(C=Ig,o=o.stateNode,C.nodeType===8?C.parentNode.removeChild(o):C.removeChild(o)):Ig.removeChild(o.stateNode));break;case 18:Ig!==null&&(hl?(C=Ig,o=o.stateNode,C.nodeType===8?Ca(C.parentNode,o):C.nodeType===1&&Ca(C,o),Ql(C)):Ca(Ig,o.stateNode));break;case 4:c=Ig,A=hl,Ig=o.stateNode.containerInfo,hl=!0,dn(C,n,o),Ig=c,hl=A;break;case 0:case 11:case 14:case 15:if(!dg&&(c=o.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){A=c=c.next;do{var m=A,k=m.destroy;m=m.tag,k!==void 0&&(m&2||m&4)&&Na(o,n,k),A=A.next}while(A!==c)}dn(C,n,o);break;case 1:if(!dg&&(Qt(o,n),c=o.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=o.memoizedProps,c.state=o.memoizedState,c.componentWillUnmount()}catch(S){KC(o,n,S)}dn(C,n,o);break;case 21:dn(C,n,o);break;case 22:o.mode&1?(dg=(c=dg)||o.memoizedState!==null,dn(C,n,o),dg=c):dn(C,n,o);break;default:dn(C,n,o)}}function cu(C){var n=C.updateQueue;if(n!==null){C.updateQueue=null;var o=C.stateNode;o===null&&(o=C.stateNode=new eh),n.forEach(function(c){var A=ah.bind(null,C,c);o.has(c)||(o.add(c),c.then(A,A))})}}function Gl(C,n){var o=n.deletions;if(o!==null)for(var c=0;c<o.length;c++){var A=o[c];try{var m=C,k=n,S=k;e:for(;S!==null;){switch(S.tag){case 5:Ig=S.stateNode,hl=!1;break e;case 3:Ig=S.stateNode.containerInfo,hl=!0;break e;case 4:Ig=S.stateNode.containerInfo,hl=!0;break e}S=S.return}if(Ig===null)throw Error(l(160));iu(m,k,A),Ig=null,hl=!1;var U=A.alternate;U!==null&&(U.return=null),A.return=null}catch(Ce){KC(A,n,Ce)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)au(n,C),n=n.sibling}function au(C,n){var o=C.alternate,c=C.flags;switch(C.tag){case 0:case 11:case 14:case 15:if(Gl(n,C),Yl(C),c&4){try{KI(3,C,C.return),ri(3,C)}catch(Ve){KC(C,C.return,Ve)}try{KI(5,C,C.return)}catch(Ve){KC(C,C.return,Ve)}}break;case 1:Gl(n,C),Yl(C),c&512&&o!==null&&Qt(o,o.return);break;case 5:if(Gl(n,C),Yl(C),c&512&&o!==null&&Qt(o,o.return),C.flags&32){var A=C.stateNode;try{WC(A,"")}catch(Ve){KC(C,C.return,Ve)}}if(c&4&&(A=C.stateNode,A!=null)){var m=C.memoizedProps,k=o!==null?o.memoizedProps:m,S=C.type,U=C.updateQueue;if(C.updateQueue=null,U!==null)try{S==="input"&&m.type==="radio"&&m.name!=null&&Se(A,m),ve(S,k);var Ce=ve(S,m);for(k=0;k<U.length;k+=2){var Ie=U[k],ce=U[k+1];Ie==="style"?Ze(A,ce):Ie==="dangerouslySetInnerHTML"?hC(A,ce):Ie==="children"?WC(A,ce):X(A,Ie,ce,Ce)}switch(S){case"input":Ke(A,m);break;case"textarea":_e(A,m);break;case"select":var te=A._wrapperState.wasMultiple;A._wrapperState.wasMultiple=!!m.multiple;var be=m.value;be!=null?Re(A,!!m.multiple,be,!1):te!==!!m.multiple&&(m.defaultValue!=null?Re(A,!!m.multiple,m.defaultValue,!0):Re(A,!!m.multiple,m.multiple?[]:"",!1))}A[WI]=m}catch(Ve){KC(C,C.return,Ve)}}break;case 6:if(Gl(n,C),Yl(C),c&4){if(C.stateNode===null)throw Error(l(162));A=C.stateNode,m=C.memoizedProps;try{A.nodeValue=m}catch(Ve){KC(C,C.return,Ve)}}break;case 3:if(Gl(n,C),Yl(C),c&4&&o!==null&&o.memoizedState.isDehydrated)try{Ql(n.containerInfo)}catch(Ve){KC(C,C.return,Ve)}break;case 4:Gl(n,C),Yl(C);break;case 13:Gl(n,C),Yl(C),A=C.child,A.flags&8192&&(m=A.memoizedState!==null,A.stateNode.isHidden=m,!m||A.alternate!==null&&A.alternate.memoizedState!==null||(Ta=uC())),c&4&&cu(C);break;case 22:if(Ie=o!==null&&o.memoizedState!==null,C.mode&1?(dg=(Ce=dg)||Ie,Gl(n,C),dg=Ce):Gl(n,C),Yl(C),c&8192){if(Ce=C.memoizedState!==null,(C.stateNode.isHidden=Ce)&&!Ie&&C.mode&1)for(ke=C,Ie=C.child;Ie!==null;){for(ce=ke=Ie;ke!==null;){switch(te=ke,be=te.child,te.tag){case 0:case 11:case 14:case 15:KI(4,te,te.return);break;case 1:Qt(te,te.return);var pe=te.stateNode;if(typeof pe.componentWillUnmount=="function"){c=te,o=te.return;try{n=c,pe.props=n.memoizedProps,pe.state=n.memoizedState,pe.componentWillUnmount()}catch(Ve){KC(c,o,Ve)}}break;case 5:Qt(te,te.return);break;case 22:if(te.memoizedState!==null){su(ce);continue}}be!==null?(be.return=te,ke=be):su(ce)}Ie=Ie.sibling}e:for(Ie=null,ce=C;;){if(ce.tag===5){if(Ie===null){Ie=ce;try{A=ce.stateNode,Ce?(m=A.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(S=ce.stateNode,U=ce.memoizedProps.style,k=U!=null&&U.hasOwnProperty("display")?U.display:null,S.style.display=Te("display",k))}catch(Ve){KC(C,C.return,Ve)}}}else if(ce.tag===6){if(Ie===null)try{ce.stateNode.nodeValue=Ce?"":ce.memoizedProps}catch(Ve){KC(C,C.return,Ve)}}else if((ce.tag!==22&&ce.tag!==23||ce.memoizedState===null||ce===C)&&ce.child!==null){ce.child.return=ce,ce=ce.child;continue}if(ce===C)break e;for(;ce.sibling===null;){if(ce.return===null||ce.return===C)break e;Ie===ce&&(Ie=null),ce=ce.return}Ie===ce&&(Ie=null),ce.sibling.return=ce.return,ce=ce.sibling}}break;case 19:Gl(n,C),Yl(C),c&4&&cu(C);break;case 21:break;default:Gl(n,C),Yl(C)}}function Yl(C){var n=C.flags;if(n&2){try{e:{for(var o=C.return;o!==null;){if(Iu(o)){var c=o;break e}o=o.return}throw Error(l(160))}switch(c.tag){case 5:var A=c.stateNode;c.flags&32&&(WC(A,""),c.flags&=-33);var m=ou(C);Ua(C,m,A);break;case 3:case 4:var k=c.stateNode.containerInfo,S=ou(C);La(C,S,k);break;default:throw Error(l(161))}}catch(U){KC(C,C.return,U)}C.flags&=-3}n&4096&&(C.flags&=-4097)}function gh(C,n,o){ke=C,ru(C)}function ru(C,n,o){for(var c=(C.mode&1)!==0;ke!==null;){var A=ke,m=A.child;if(A.tag===22&&c){var k=A.memoizedState!==null||ai;if(!k){var S=A.alternate,U=S!==null&&S.memoizedState!==null||dg;S=ai;var Ce=dg;if(ai=k,(dg=U)&&!Ce)for(ke=A;ke!==null;)k=ke,U=k.child,k.tag===22&&k.memoizedState!==null?du(A):U!==null?(U.return=k,ke=U):du(A);for(;m!==null;)ke=m,ru(m),m=m.sibling;ke=A,ai=S,dg=Ce}Au(C)}else A.subtreeFlags&8772&&m!==null?(m.return=A,ke=m):Au(C)}}function Au(C){for(;ke!==null;){var n=ke;if(n.flags&8772){var o=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:dg||ri(5,n);break;case 1:var c=n.stateNode;if(n.flags&4&&!dg)if(o===null)c.componentDidMount();else{var A=n.elementType===n.type?o.memoizedProps:bl(n.type,o.memoizedProps);c.componentDidUpdate(A,o.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var m=n.updateQueue;m!==null&&sd(n,m,c);break;case 3:var k=n.updateQueue;if(k!==null){if(o=null,n.child!==null)switch(n.child.tag){case 5:o=n.child.stateNode;break;case 1:o=n.child.stateNode}sd(n,k,o)}break;case 5:var S=n.stateNode;if(o===null&&n.flags&4){o=S;var U=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":U.autoFocus&&o.focus();break;case"img":U.src&&(o.src=U.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var Ce=n.alternate;if(Ce!==null){var Ie=Ce.memoizedState;if(Ie!==null){var ce=Ie.dehydrated;ce!==null&&Ql(ce)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(l(163))}dg||n.flags&512&&za(n)}catch(te){KC(n,n.return,te)}}if(n===C){ke=null;break}if(o=n.sibling,o!==null){o.return=n.return,ke=o;break}ke=n.return}}function su(C){for(;ke!==null;){var n=ke;if(n===C){ke=null;break}var o=n.sibling;if(o!==null){o.return=n.return,ke=o;break}ke=n.return}}function du(C){for(;ke!==null;){var n=ke;try{switch(n.tag){case 0:case 11:case 15:var o=n.return;try{ri(4,n)}catch(U){KC(n,o,U)}break;case 1:var c=n.stateNode;if(typeof c.componentDidMount=="function"){var A=n.return;try{c.componentDidMount()}catch(U){KC(n,A,U)}}var m=n.return;try{za(n)}catch(U){KC(n,m,U)}break;case 5:var k=n.return;try{za(n)}catch(U){KC(n,k,U)}}}catch(U){KC(n,n.return,U)}if(n===C){ke=null;break}var S=n.sibling;if(S!==null){S.return=n.return,ke=S;break}ke=n.return}}var lh=Math.ceil,Ai=B.ReactCurrentDispatcher,Ma=B.ReactCurrentOwner,ol=B.ReactCurrentBatchConfig,iC=0,Cg=null,xC=null,og=0,Eg=0,vt=cn(0),jC=0,wI=null,En=0,si=0,xa=0,HI=null,vg=null,Ta=0,Bt=1/0,_l=null,di=!1,Da=null,un=null,ui=!1,mn=null,mi=0,NI=0,Ea=null,Ji=-1,Zi=0;function yg(){return iC&6?uC():Ji!==-1?Ji:Ji=uC()}function Jn(C){return C.mode&1?iC&2&&og!==0?og&-og:zb.transition!==null?(Zi===0&&(Zi=ot()),Zi):(C=tC,C!==0||(C=window.event,C=C===void 0?16:ms(C.type)),C):1}function yl(C,n,o,c){if(50<NI)throw NI=0,Ea=null,Error(l(185));Xl(C,o,c),(!(iC&2)||C!==Cg)&&(C===Cg&&(!(iC&2)&&(si|=o),jC===4&&Zn(C,og)),Bg(C,c),o===1&&iC===0&&!(n.mode&1)&&(Bt=uC()+500,Do&&rn()))}function Bg(C,n){var o=C.callbackNode;Fn(C,n);var c=xl(C,C===Cg?og:0);if(c===0)o!==null&&sC(o),C.callbackNode=null,C.callbackPriority=0;else if(n=c&-c,C.callbackPriority!==n){if(o!=null&&sC(o),n===1)C.tag===0?Nb(mu.bind(null,C)):Cd(mu.bind(null,C)),Fb(function(){!(iC&6)&&rn()}),o=null;else{switch(it(c)){case 1:o=Bn;break;case 4:o=Sn;break;case 16:o=Ll;break;case 536870912:o=Yn;break;default:o=Ll}o=pu(o,uu.bind(null,C))}C.callbackPriority=n,C.callbackNode=o}}function uu(C,n){if(Ji=-1,Zi=0,iC&6)throw Error(l(327));var o=C.callbackNode;if(St()&&C.callbackNode!==o)return null;var c=xl(C,C===Cg?og:0);if(c===0)return null;if(c&30||c&C.expiredLanes||n)n=bi(C,c);else{n=c;var A=iC;iC|=2;var m=Zu();(Cg!==C||og!==n)&&(_l=null,Bt=uC()+500,Pn(C,n));do try{Ih();break}catch(S){Ju(C,S)}while(!0);ra(),Ai.current=m,iC=A,xC!==null?n=0:(Cg=null,og=0,n=jC)}if(n!==0){if(n===2&&(A=Kn(C),A!==0&&(c=A,n=Oa(C,A))),n===1)throw o=wI,Pn(C,0),Zn(C,c),Bg(C,uC()),o;if(n===6)Zn(C,c);else{if(A=C.current.alternate,!(c&30)&&!nh(A)&&(n=bi(C,c),n===2&&(m=Kn(C),m!==0&&(c=m,n=Oa(C,m))),n===1))throw o=wI,Pn(C,0),Zn(C,c),Bg(C,uC()),o;switch(C.finishedWork=A,C.finishedLanes=c,n){case 0:case 1:throw Error(l(345));case 2:jn(C,vg,_l);break;case 3:if(Zn(C,c),(c&130023424)===c&&(n=Ta+500-uC(),10<n)){if(xl(C,0)!==0)break;if(A=C.suspendedLanes,(A&c)!==c){yg(),C.pingedLanes|=C.suspendedLanes&A;break}C.timeoutHandle=ea(jn.bind(null,C,vg,_l),n);break}jn(C,vg,_l);break;case 4:if(Zn(C,c),(c&4194240)===c)break;for(n=C.eventTimes,A=-1;0<c;){var k=31-ag(c);m=1<<k,k=n[k],k>A&&(A=k),c&=~m}if(c=A,c=uC()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*lh(c/1960))-c,10<c){C.timeoutHandle=ea(jn.bind(null,C,vg,_l),c);break}jn(C,vg,_l);break;case 5:jn(C,vg,_l);break;default:throw Error(l(329))}}}return Bg(C,uC()),C.callbackNode===o?uu.bind(null,C):null}function Oa(C,n){var o=HI;return C.current.memoizedState.isDehydrated&&(Pn(C,n).flags|=256),C=bi(C,n),C!==2&&(n=vg,vg=o,n!==null&&Pa(n)),C}function Pa(C){vg===null?vg=C:vg.push.apply(vg,C)}function nh(C){for(var n=C;;){if(n.flags&16384){var o=n.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var c=0;c<o.length;c++){var A=o[c],m=A.getSnapshot;A=A.value;try{if(!Jl(m(),A))return!1}catch{return!1}}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===C)break;for(;n.sibling===null;){if(n.return===null||n.return===C)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Zn(C,n){for(n&=~xa,n&=~si,C.suspendedLanes|=n,C.pingedLanes&=~n,C=C.expirationTimes;0<n;){var o=31-ag(n),c=1<<o;C[o]=-1,n&=~c}}function mu(C){if(iC&6)throw Error(l(327));St();var n=xl(C,0);if(!(n&1))return Bg(C,uC()),null;var o=bi(C,n);if(C.tag!==0&&o===2){var c=Kn(C);c!==0&&(n=c,o=Oa(C,c))}if(o===1)throw o=wI,Pn(C,0),Zn(C,n),Bg(C,uC()),o;if(o===6)throw Error(l(345));return C.finishedWork=C.current.alternate,C.finishedLanes=n,jn(C,vg,_l),Bg(C,uC()),null}function ja(C,n){var o=iC;iC|=1;try{return C(n)}finally{iC=o,iC===0&&(Bt=uC()+500,Do&&rn())}}function On(C){mn!==null&&mn.tag===0&&!(iC&6)&&St();var n=iC;iC|=1;var o=ol.transition,c=tC;try{if(ol.transition=null,tC=1,C)return C()}finally{tC=c,ol.transition=o,iC=n,!(iC&6)&&rn()}}function $a(){Eg=vt.current,fC(vt)}function Pn(C,n){C.finishedWork=null,C.finishedLanes=0;var o=C.timeoutHandle;if(o!==-1&&(C.timeoutHandle=-1,Yb(o)),xC!==null)for(o=xC.return;o!==null;){var c=o;switch(Ia(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&xo();break;case 3:Xt(),fC(Xg),fC(rg),ba();break;case 5:Ja(c);break;case 4:Xt();break;case 13:fC(YC);break;case 19:fC(YC);break;case 10:Aa(c.type._context);break;case 22:case 23:$a()}o=o.return}if(Cg=C,xC=C=bn(C.current,null),og=Eg=n,jC=0,wI=null,xa=si=En=0,vg=HI=null,xn!==null){for(n=0;n<xn.length;n++)if(o=xn[n],c=o.interleaved,c!==null){o.interleaved=null;var A=c.next,m=o.pending;if(m!==null){var k=m.next;m.next=A,c.next=k}o.pending=c}xn=null}return C}function Ju(C,n){do{var o=xC;try{if(ra(),gi.current=Ii,li){for(var c=FC.memoizedState;c!==null;){var A=c.queue;A!==null&&(A.pending=null),c=c.next}li=!1}if(Dn=0,eg=PC=FC=null,vI=!1,BI=0,Ma.current=null,o===null||o.return===null){jC=1,wI=n,xC=null;break}e:{var m=C,k=o.return,S=o,U=n;if(n=og,S.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){var Ce=U,Ie=S,ce=Ie.tag;if(!(Ie.mode&1)&&(ce===0||ce===11||ce===15)){var te=Ie.alternate;te?(Ie.updateQueue=te.updateQueue,Ie.memoizedState=te.memoizedState,Ie.lanes=te.lanes):(Ie.updateQueue=null,Ie.memoizedState=null)}var be=Ud(k);if(be!==null){be.flags&=-257,Md(be,k,S,m,n),be.mode&1&&Ld(m,Ce,n),n=be,U=Ce;var pe=n.updateQueue;if(pe===null){var Ve=new Set;Ve.add(U),n.updateQueue=Ve}else pe.add(U);break e}else{if(!(n&1)){Ld(m,Ce,n),qa();break e}U=Error(l(426))}}else if(vC&&S.mode&1){var HC=Ud(k);if(HC!==null){!(HC.flags&65536)&&(HC.flags|=256),Md(HC,k,S,m,n),ca(Rt(U,S));break e}}m=U=Rt(U,S),jC!==4&&(jC=2),HI===null?HI=[m]:HI.push(m),m=k;do{switch(m.tag){case 3:m.flags|=65536,n&=-n,m.lanes|=n;var $=Nd(m,U,n);Ad(m,$);break e;case 1:S=U;var x=m.type,_=m.stateNode;if(!(m.flags&128)&&(typeof x.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(un===null||!un.has(_)))){m.flags|=65536,n&=-n,m.lanes|=n;var re=zd(m,S,n);Ad(m,re);break e}}m=m.return}while(m!==null)}hu(o)}catch(Xe){n=Xe,xC===o&&o!==null&&(xC=o=o.return);continue}break}while(!0)}function Zu(){var C=Ai.current;return Ai.current=Ii,C===null?Ii:C}function qa(){(jC===0||jC===3||jC===2)&&(jC=4),Cg===null||!(En&268435455)&&!(si&268435455)||Zn(Cg,og)}function bi(C,n){var o=iC;iC|=2;var c=Zu();(Cg!==C||og!==n)&&(_l=null,Pn(C,n));do try{th();break}catch(A){Ju(C,A)}while(!0);if(ra(),iC=o,Ai.current=c,xC!==null)throw Error(l(261));return Cg=null,og=0,jC}function th(){for(;xC!==null;)bu(xC)}function Ih(){for(;xC!==null&&!nt();)bu(xC)}function bu(C){var n=ku(C.alternate,C,Eg);C.memoizedProps=C.pendingProps,n===null?hu(C):xC=n,Ma.current=null}function hu(C){var n=C;do{var o=n.alternate;if(C=n.return,n.flags&32768){if(o=_b(o,n),o!==null){o.flags&=32767,xC=o;return}if(C!==null)C.flags|=32768,C.subtreeFlags=0,C.deletions=null;else{jC=6,xC=null;return}}else if(o=qb(o,n,Eg),o!==null){xC=o;return}if(n=n.sibling,n!==null){xC=n;return}xC=n=C}while(n!==null);jC===0&&(jC=5)}function jn(C,n,o){var c=tC,A=ol.transition;try{ol.transition=null,tC=1,oh(C,n,o,c)}finally{ol.transition=A,tC=c}return null}function oh(C,n,o,c){do St();while(mn!==null);if(iC&6)throw Error(l(327));o=C.finishedWork;var A=C.finishedLanes;if(o===null)return null;if(C.finishedWork=null,C.finishedLanes=0,o===C.current)throw Error(l(177));C.callbackNode=null,C.callbackPriority=0;var m=o.lanes|o.childLanes;if(rI(C,m),C===Cg&&(xC=Cg=null,og=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||ui||(ui=!0,pu(Ll,function(){return St(),null})),m=(o.flags&15990)!==0,o.subtreeFlags&15990||m){m=ol.transition,ol.transition=null;var k=tC;tC=1;var S=iC;iC|=4,Ma.current=null,Ch(C,o),au(o,C),fb(qc),Qo=!!$c,qc=$c=null,C.current=o,gh(o),cI(),iC=S,tC=k,ol.transition=m}else C.current=o;if(ui&&(ui=!1,mn=C,mi=A),m=C.pendingLanes,m===0&&(un=null),It(o.stateNode),Bg(C,uC()),n!==null)for(c=C.onRecoverableError,o=0;o<n.length;o++)A=n[o],c(A.value,{componentStack:A.stack,digest:A.digest});if(di)throw di=!1,C=Da,Da=null,C;return mi&1&&C.tag!==0&&St(),m=C.pendingLanes,m&1?C===Ea?NI++:(NI=0,Ea=C):NI=0,rn(),null}function St(){if(mn!==null){var C=it(mi),n=ol.transition,o=tC;try{if(ol.transition=null,tC=16>C?16:C,mn===null)var c=!1;else{if(C=mn,mn=null,mi=0,iC&6)throw Error(l(331));var A=iC;for(iC|=4,ke=C.current;ke!==null;){var m=ke,k=m.child;if(ke.flags&16){var S=m.deletions;if(S!==null){for(var U=0;U<S.length;U++){var Ce=S[U];for(ke=Ce;ke!==null;){var Ie=ke;switch(Ie.tag){case 0:case 11:case 15:KI(8,Ie,m)}var ce=Ie.child;if(ce!==null)ce.return=Ie,ke=ce;else for(;ke!==null;){Ie=ke;var te=Ie.sibling,be=Ie.return;if(tu(Ie),Ie===Ce){ke=null;break}if(te!==null){te.return=be,ke=te;break}ke=be}}}var pe=m.alternate;if(pe!==null){var Ve=pe.child;if(Ve!==null){pe.child=null;do{var HC=Ve.sibling;Ve.sibling=null,Ve=HC}while(Ve!==null)}}ke=m}}if(m.subtreeFlags&2064&&k!==null)k.return=m,ke=k;else e:for(;ke!==null;){if(m=ke,m.flags&2048)switch(m.tag){case 0:case 11:case 15:KI(9,m,m.return)}var $=m.sibling;if($!==null){$.return=m.return,ke=$;break e}ke=m.return}}var x=C.current;for(ke=x;ke!==null;){k=ke;var _=k.child;if(k.subtreeFlags&2064&&_!==null)_.return=k,ke=_;else e:for(k=x;ke!==null;){if(S=ke,S.flags&2048)try{switch(S.tag){case 0:case 11:case 15:ri(9,S)}}catch(Xe){KC(S,S.return,Xe)}if(S===k){ke=null;break e}var re=S.sibling;if(re!==null){re.return=S.return,ke=re;break e}ke=S.return}}if(iC=A,rn(),UC&&typeof UC.onPostCommitFiberRoot=="function")try{UC.onPostCommitFiberRoot(ul,C)}catch{}c=!0}return c}finally{tC=o,ol.transition=n}}return!1}function Gu(C,n,o){n=Rt(o,n),n=Nd(C,n,1),C=sn(C,n,1),n=yg(),C!==null&&(Xl(C,1,n),Bg(C,n))}function KC(C,n,o){if(C.tag===3)Gu(C,C,o);else for(;n!==null;){if(n.tag===3){Gu(n,C,o);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(un===null||!un.has(c))){C=Rt(o,C),C=zd(n,C,1),n=sn(n,C,1),C=yg(),n!==null&&(Xl(n,1,C),Bg(n,C));break}}n=n.return}}function ih(C,n,o){var c=C.pingCache;c!==null&&c.delete(n),n=yg(),C.pingedLanes|=C.suspendedLanes&o,Cg===C&&(og&o)===o&&(jC===4||jC===3&&(og&130023424)===og&&500>uC()-Ta?Pn(C,0):xa|=o),Bg(C,n)}function yu(C,n){n===0&&(C.mode&1?(n=Zg,Zg<<=1,!(Zg&130023424)&&(Zg=4194304)):n=1);var o=yg();C=jl(C,n),C!==null&&(Xl(C,n,o),Bg(C,o))}function ch(C){var n=C.memoizedState,o=0;n!==null&&(o=n.retryLane),yu(C,o)}function ah(C,n){var o=0;switch(C.tag){case 13:var c=C.stateNode,A=C.memoizedState;A!==null&&(o=A.retryLane);break;case 19:c=C.stateNode;break;default:throw Error(l(314))}c!==null&&c.delete(n),yu(C,o)}var ku;ku=function(C,n,o){if(C!==null)if(C.memoizedProps!==n.pendingProps||Xg.current)Qg=!0;else{if(!(C.lanes&o)&&!(n.flags&128))return Qg=!1,$b(C,n,o);Qg=!!(C.flags&131072)}else Qg=!1,vC&&n.flags&1048576&&gd(n,Oo,n.index);switch(n.lanes=0,n.tag){case 2:var c=n.type;ci(C,n),C=n.pendingProps;var A=Gt(n,rg.current);ft(n,o),A=ya(null,n,c,C,A,o);var m=ka();return n.flags|=1,typeof A=="object"&&A!==null&&typeof A.render=="function"&&A.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Rg(c)?(m=!0,To(n)):m=!1,n.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,ua(n),A.updater=oi,n.stateNode=A,A._reactInternals=n,Ra(n,c,C,o),n=Sa(null,n,c,!0,m,o)):(n.tag=0,vC&&m&&ta(n),Gg(null,n,A,o),n=n.child),n;case 16:c=n.elementType;e:{switch(ci(C,n),C=n.pendingProps,A=c._init,c=A(c._payload),n.type=c,A=n.tag=Ah(c),C=bl(c,C),A){case 0:n=Ba(null,n,c,C,o);break e;case 1:n=Pd(null,n,c,C,o);break e;case 11:n=xd(null,n,c,C,o);break e;case 14:n=Td(null,n,c,bl(c.type,C),o);break e}throw Error(l(306,c,""))}return n;case 0:return c=n.type,A=n.pendingProps,A=n.elementType===c?A:bl(c,A),Ba(C,n,c,A,o);case 1:return c=n.type,A=n.pendingProps,A=n.elementType===c?A:bl(c,A),Pd(C,n,c,A,o);case 3:e:{if(jd(n),C===null)throw Error(l(387));c=n.pendingProps,m=n.memoizedState,A=m.element,rd(C,n),ei(n,c,null,o);var k=n.memoizedState;if(c=k.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:k.cache,pendingSuspenseBoundaries:k.pendingSuspenseBoundaries,transitions:k.transitions},n.updateQueue.baseState=m,n.memoizedState=m,n.flags&256){A=Rt(Error(l(423)),n),n=$d(C,n,c,o,A);break e}else if(c!==A){A=Rt(Error(l(424)),n),n=$d(C,n,c,o,A);break e}else for(Dg=on(n.stateNode.containerInfo.firstChild),Tg=n,vC=!0,Zl=null,o=cd(n,null,c,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(pt(),c===A){n=ql(C,n,o);break e}Gg(C,n,c,o)}n=n.child}return n;case 5:return dd(n),C===null&&ia(n),c=n.type,A=n.pendingProps,m=C!==null?C.memoizedProps:null,k=A.children,_c(c,A)?k=null:m!==null&&_c(c,m)&&(n.flags|=32),Od(C,n),Gg(C,n,k,o),n.child;case 6:return C===null&&ia(n),null;case 13:return qd(C,n,o);case 4:return ma(n,n.stateNode.containerInfo),c=n.pendingProps,C===null?n.child=Wt(n,null,c,o):Gg(C,n,c,o),n.child;case 11:return c=n.type,A=n.pendingProps,A=n.elementType===c?A:bl(c,A),xd(C,n,c,A,o);case 7:return Gg(C,n,n.pendingProps,o),n.child;case 8:return Gg(C,n,n.pendingProps.children,o),n.child;case 12:return Gg(C,n,n.pendingProps.children,o),n.child;case 10:e:{if(c=n.type._context,A=n.pendingProps,m=n.memoizedProps,k=A.value,kC($o,c._currentValue),c._currentValue=k,m!==null)if(Jl(m.value,k)){if(m.children===A.children&&!Xg.current){n=ql(C,n,o);break e}}else for(m=n.child,m!==null&&(m.return=n);m!==null;){var S=m.dependencies;if(S!==null){k=m.child;for(var U=S.firstContext;U!==null;){if(U.context===c){if(m.tag===1){U=$l(-1,o&-o),U.tag=2;var Ce=m.updateQueue;if(Ce!==null){Ce=Ce.shared;var Ie=Ce.pending;Ie===null?U.next=U:(U.next=Ie.next,Ie.next=U),Ce.pending=U}}m.lanes|=o,U=m.alternate,U!==null&&(U.lanes|=o),sa(m.return,o,n),S.lanes|=o;break}U=U.next}}else if(m.tag===10)k=m.type===n.type?null:m.child;else if(m.tag===18){if(k=m.return,k===null)throw Error(l(341));k.lanes|=o,S=k.alternate,S!==null&&(S.lanes|=o),sa(k,o,n),k=m.sibling}else k=m.child;if(k!==null)k.return=m;else for(k=m;k!==null;){if(k===n){k=null;break}if(m=k.sibling,m!==null){m.return=k.return,k=m;break}k=k.return}m=k}Gg(C,n,A.children,o),n=n.child}return n;case 9:return A=n.type,c=n.pendingProps.children,ft(n,o),A=tl(A),c=c(A),n.flags|=1,Gg(C,n,c,o),n.child;case 14:return c=n.type,A=bl(c,n.pendingProps),A=bl(c.type,A),Td(C,n,c,A,o);case 15:return Dd(C,n,n.type,n.pendingProps,o);case 17:return c=n.type,A=n.pendingProps,A=n.elementType===c?A:bl(c,A),ci(C,n),n.tag=1,Rg(c)?(C=!0,To(n)):C=!1,ft(n,o),wd(n,c,A),Ra(n,c,A,o),Sa(null,n,c,!0,C,o);case 19:return eu(C,n,o);case 22:return Ed(C,n,o)}throw Error(l(156,n.tag))};function pu(C,n){return zl(C,n)}function rh(C,n,o,c){this.tag=C,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function il(C,n,o,c){return new rh(C,n,o,c)}function _a(C){return C=C.prototype,!(!C||!C.isReactComponent)}function Ah(C){if(typeof C=="function")return _a(C)?1:0;if(C!=null){if(C=C.$$typeof,C===ee)return 11;if(C===le)return 14}return 2}function bn(C,n){var o=C.alternate;return o===null?(o=il(C.tag,n,C.key,C.mode),o.elementType=C.elementType,o.type=C.type,o.stateNode=C.stateNode,o.alternate=C,C.alternate=o):(o.pendingProps=n,o.type=C.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=C.flags&14680064,o.childLanes=C.childLanes,o.lanes=C.lanes,o.child=C.child,o.memoizedProps=C.memoizedProps,o.memoizedState=C.memoizedState,o.updateQueue=C.updateQueue,n=C.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=C.sibling,o.index=C.index,o.ref=C.ref,o}function hi(C,n,o,c,A,m){var k=2;if(c=C,typeof C=="function")_a(C)&&(k=1);else if(typeof C=="string")k=5;else e:switch(C){case v:return $n(o.children,A,m,n);case Y:k=8,A|=8;break;case F:return C=il(12,o,n,A|2),C.elementType=F,C.lanes=m,C;case q:return C=il(13,o,n,A),C.elementType=q,C.lanes=m,C;case P:return C=il(19,o,n,A),C.elementType=P,C.lanes=m,C;case w:return Gi(o,A,m,n);default:if(typeof C=="object"&&C!==null)switch(C.$$typeof){case L:k=10;break e;case M:k=9;break e;case ee:k=11;break e;case le:k=14;break e;case N:k=16,c=null;break e}throw Error(l(130,C==null?C:typeof C,""))}return n=il(k,o,n,A),n.elementType=C,n.type=c,n.lanes=m,n}function $n(C,n,o,c){return C=il(7,C,c,n),C.lanes=o,C}function Gi(C,n,o,c){return C=il(22,C,c,n),C.elementType=w,C.lanes=o,C.stateNode={isHidden:!1},C}function er(C,n,o){return C=il(6,C,null,n),C.lanes=o,C}function Cr(C,n,o){return n=il(4,C.children!==null?C.children:[],C.key,n),n.lanes=o,n.stateNode={containerInfo:C.containerInfo,pendingChildren:null,implementation:C.implementation},n}function sh(C,n,o,c,A){this.tag=n,this.containerInfo=C,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wn(0),this.expirationTimes=wn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wn(0),this.identifierPrefix=c,this.onRecoverableError=A,this.mutableSourceEagerHydrationData=null}function gr(C,n,o,c,A,m,k,S,U){return C=new sh(C,n,o,S,U),n===1?(n=1,m===!0&&(n|=8)):n=0,m=il(3,null,null,n),C.current=m,m.stateNode=C,m.memoizedState={element:c,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},ua(m),C}function dh(C,n,o){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Q,key:c==null?null:""+c,children:C,containerInfo:n,implementation:o}}function Wu(C){if(!C)return an;C=C._reactInternals;e:{if(Jg(C)!==C||C.tag!==1)throw Error(l(170));var n=C;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Rg(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(l(171))}if(C.tag===1){var o=C.type;if(Rg(o))return _s(C,o,n)}return n}function Vu(C,n,o,c,A,m,k,S,U){return C=gr(o,c,!0,C,A,m,k,S,U),C.context=Wu(null),o=C.current,c=yg(),A=Jn(o),m=$l(c,A),m.callback=n??null,sn(o,m,A),C.current.lanes=A,Xl(C,A,c),Bg(C,c),C}function yi(C,n,o,c){var A=n.current,m=yg(),k=Jn(A);return o=Wu(o),n.context===null?n.context=o:n.pendingContext=o,n=$l(m,k),n.payload={element:C},c=c===void 0?null:c,c!==null&&(n.callback=c),C=sn(A,n,k),C!==null&&(yl(C,A,k,m),_o(C,A,k)),k}function ki(C){if(C=C.current,!C.child)return null;switch(C.child.tag){case 5:return C.child.stateNode;default:return C.child.stateNode}}function fu(C,n){if(C=C.memoizedState,C!==null&&C.dehydrated!==null){var o=C.retryLane;C.retryLane=o!==0&&o<n?o:n}}function lr(C,n){fu(C,n),(C=C.alternate)&&fu(C,n)}function uh(){return null}var Xu=typeof reportError=="function"?reportError:function(C){console.error(C)};function nr(C){this._internalRoot=C}pi.prototype.render=nr.prototype.render=function(C){var n=this._internalRoot;if(n===null)throw Error(l(409));yi(C,n,null,null)},pi.prototype.unmount=nr.prototype.unmount=function(){var C=this._internalRoot;if(C!==null){this._internalRoot=null;var n=C.containerInfo;On(function(){yi(null,C,null,null)}),n[Dl]=null}};function pi(C){this._internalRoot=C}pi.prototype.unstable_scheduleHydration=function(C){if(C){var n=at();C={blockedOn:null,target:C,priority:n};for(var o=0;o<Mg.length&&n!==0&&n<Mg[o].priority;o++);Mg.splice(o,0,C),o===0&&QC(C)}};function tr(C){return!(!C||C.nodeType!==1&&C.nodeType!==9&&C.nodeType!==11)}function Wi(C){return!(!C||C.nodeType!==1&&C.nodeType!==9&&C.nodeType!==11&&(C.nodeType!==8||C.nodeValue!==" react-mount-point-unstable "))}function Ru(){}function mh(C,n,o,c,A){if(A){if(typeof c=="function"){var m=c;c=function(){var Ce=ki(k);m.call(Ce)}}var k=Vu(n,c,C,0,null,!1,!1,"",Ru);return C._reactRootContainer=k,C[Dl]=k.current,kI(C.nodeType===8?C.parentNode:C),On(),k}for(;A=C.lastChild;)C.removeChild(A);if(typeof c=="function"){var S=c;c=function(){var Ce=ki(U);S.call(Ce)}}var U=gr(C,0,!1,null,null,!1,!1,"",Ru);return C._reactRootContainer=U,C[Dl]=U.current,kI(C.nodeType===8?C.parentNode:C),On(function(){yi(n,U,o,c)}),U}function Vi(C,n,o,c,A){var m=o._reactRootContainer;if(m){var k=m;if(typeof A=="function"){var S=A;A=function(){var U=ki(k);S.call(U)}}yi(n,k,C,A)}else k=mh(o,n,C,A,c);return ki(k)}ct=function(C){switch(C.tag){case 3:var n=C.stateNode;if(n.current.memoizedState.isDehydrated){var o=Ml(n.pendingLanes);o!==0&&(Hn(n,o|1),Bg(n,uC()),!(iC&6)&&(Bt=uC()+500,rn()))}break;case 13:On(function(){var c=jl(C,1);if(c!==null){var A=yg();yl(c,C,1,A)}}),lr(C,1)}},Tl=function(C){if(C.tag===13){var n=jl(C,134217728);if(n!==null){var o=yg();yl(n,C,134217728,o)}lr(C,134217728)}},Ug=function(C){if(C.tag===13){var n=Jn(C),o=jl(C,n);if(o!==null){var c=yg();yl(o,C,n,c)}lr(C,n)}},at=function(){return tC},AI=function(C,n){var o=tC;try{return tC=C,n()}finally{tC=o}},ZC=function(C,n,o){switch(n){case"input":if(Ke(C,o),n=o.name,o.type==="radio"&&n!=null){for(o=C;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<o.length;n++){var c=o[n];if(c!==C&&c.form===C.form){var A=Mo(c);if(!A)throw Error(l(90));We(c),Ke(c,A)}}}break;case"textarea":_e(C,o);break;case"select":n=o.value,n!=null&&Re(C,!!o.multiple,n,!1)}},SC=ja,mg=On;var Jh={usingClientEntryPoint:!1,Events:[VI,bt,Mo,OC,Kg,ja]},zI={findFiberByHostInstance:zn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Zh={bundleType:zI.bundleType,version:zI.version,rendererPackageName:zI.rendererPackageName,rendererConfig:zI.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B.ReactCurrentDispatcher,findHostInstanceByFiber:function(C){return C=dl(C),C===null?null:C.stateNode},findFiberByHostInstance:zI.findFiberByHostInstance||uh,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fi.isDisabled&&fi.supportsFiber)try{ul=fi.inject(Zh),UC=fi}catch{}}return Sg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jh,Sg.createPortal=function(C,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tr(n))throw Error(l(200));return dh(C,n,null,o)},Sg.createRoot=function(C,n){if(!tr(C))throw Error(l(299));var o=!1,c="",A=Xu;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(A=n.onRecoverableError)),n=gr(C,1,!1,null,null,o,!1,c,A),C[Dl]=n.current,kI(C.nodeType===8?C.parentNode:C),new nr(n)},Sg.findDOMNode=function(C){if(C==null)return null;if(C.nodeType===1)return C;var n=C._reactInternals;if(n===void 0)throw typeof C.render=="function"?Error(l(188)):(C=Object.keys(C).join(","),Error(l(268,C)));return C=dl(n),C=C===null?null:C.stateNode,C},Sg.flushSync=function(C){return On(C)},Sg.hydrate=function(C,n,o){if(!Wi(n))throw Error(l(200));return Vi(null,C,n,!0,o)},Sg.hydrateRoot=function(C,n,o){if(!tr(C))throw Error(l(405));var c=o!=null&&o.hydratedSources||null,A=!1,m="",k=Xu;if(o!=null&&(o.unstable_strictMode===!0&&(A=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(k=o.onRecoverableError)),n=Vu(n,null,C,1,o??null,A,!1,m,k),C[Dl]=n.current,kI(C),c)for(C=0;C<c.length;C++)o=c[C],A=o._getVersion,A=A(o._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[o,A]:n.mutableSourceEagerHydrationData.push(o,A);return new pi(n)},Sg.render=function(C,n,o){if(!Wi(n))throw Error(l(200));return Vi(null,C,n,!1,o)},Sg.unmountComponentAtNode=function(C){if(!Wi(C))throw Error(l(40));return C._reactRootContainer?(On(function(){Vi(null,null,C,!1,function(){C._reactRootContainer=null,C[Dl]=null})}),!0):!1},Sg.unstable_batchedUpdates=ja,Sg.unstable_renderSubtreeIntoContainer=function(C,n,o,c){if(!Wi(o))throw Error(l(200));if(C==null||C._reactInternals===void 0)throw Error(l(38));return Vi(C,n,o,!1,c)},Sg.version="18.3.1-next-f1338f8080-20240426",Sg}var wu;function vJ(){if(wu)return ir.exports;wu=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(g){console.error(g)}}return e(),ir.exports=Vh(),ir.exports}var Hu;function fh(){if(Hu)return Xi;Hu=1;var e=vJ();return Xi.createRoot=e.createRoot,Xi.hydrateRoot=e.hydrateRoot,Xi}var Xh=fh();function ug(e,g,l,t){if(l==="a"&&!t)throw new TypeError("Private accessor was defined without a getter");if(typeof g=="function"?e!==g||!t:!g.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return l==="m"?t:l==="a"?t.call(e):t?t.value:g.get(e)}function Nu(e,g,l,t,I){if(typeof g=="function"?e!==g||!0:!g.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return g.set(e,l),l}var kl;(function(e){e.INIT="init",e.ERROR="error",e.FIND="find",e.THUMBNAILS="thumbnails",e.CLOSE="close"})(kl||(kl={}));var gt;(function(e){e.UN_LOADED="unloaded",e.TERMINATED="terminated"})(gt||(gt={}));const Rh=new Map([[gt.UN_LOADED,"The instance has not loaded data, please invoke `load` method first"],[gt.TERMINATED,"Error occurs due to manually terminated"]]);class rr extends Error{constructor(g,l=""){super(),this.errorType=g,this.customMsg=l}get message(){return this.customMsg||Rh.get(this.errorType)||""}}var BJ=null;try{var Qh=typeof $i<"u"&&typeof $i.require=="function"&&$i.require("worker_threads")||typeof __non_webpack_require__=="function"&&__non_webpack_require__("worker_threads")||typeof require=="function"&&require("worker_threads");BJ=Qh.Worker}catch{}function vh(e,g){return Buffer.from(e,"base64").toString("utf8")}function Bh(e,g,l){var t=vh(e),I=t.indexOf(`
`,10)+1,i=t.substring(I)+"";return function(r){return new BJ(i,Object.assign({},r,{eval:!0}))}}function Sh(e,g){var l=atob(e);return l}function Yh(e,g,l){var t=Sh(e),I=t.indexOf(`
`,10)+1,i=t.substring(I)+"",a=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(a)}function Fh(e,g,l){var t;return function(i){return t=t||Yh(e),new Worker(t,i)}}var Kh=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";function wh(){return Kh}function Hh(e,g,l){return wh()?Bh(e):Fh(e)}var Nh=Hh("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4NCg0KICAgIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQ0KICAgIHB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC4NCg0KICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIDQogICAgUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZDQogICAgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULA0KICAgIElORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTQ0KICAgIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SDQogICAgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUg0KICAgIFBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuDQogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8NCiAgICAvKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSwgU3VwcHJlc3NlZEVycm9yLCBTeW1ib2wsIEl0ZXJhdG9yICovDQoNCg0KICAgIGZ1bmN0aW9uIF9fYXdhaXRlciQyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEocmVjZWl2ZXIsIHN0YXRlLCBraW5kLCBmKSB7DQogICAgICAgIGlmIChraW5kID09PSAiYSIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlciIpOw0KICAgICAgICBpZiAodHlwZW9mIHN0YXRlID09PSAiZnVuY3Rpb24iID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOw0KICAgICAgICByZXR1cm4ga2luZCA9PT0gIm0iID8gZiA6IGtpbmQgPT09ICJhIiA/IGYuY2FsbChyZWNlaXZlcikgOiBmID8gZi52YWx1ZSA6IHN0YXRlLmdldChyZWNlaXZlcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHJlY2VpdmVyLCBzdGF0ZSwgdmFsdWUsIGtpbmQsIGYpIHsNCiAgICAgICAgaWYgKGtpbmQgPT09ICJtIikgdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlIik7DQogICAgICAgIGlmIChraW5kID09PSAiYSIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIHNldHRlciIpOw0KICAgICAgICBpZiAodHlwZW9mIHN0YXRlID09PSAiZnVuY3Rpb24iID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCB3cml0ZSBwcml2YXRlIG1lbWJlciB0byBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0Iik7DQogICAgICAgIHJldHVybiAoa2luZCA9PT0gImEiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTsNCiAgICB9DQoNCiAgICB0eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSAiZnVuY3Rpb24iID8gU3VwcHJlc3NlZEVycm9yIDogZnVuY3Rpb24gKGVycm9yLCBzdXBwcmVzc2VkLCBtZXNzYWdlKSB7DQogICAgICAgIHZhciBlID0gbmV3IEVycm9yKG1lc3NhZ2UpOw0KICAgICAgICByZXR1cm4gZS5uYW1lID0gIlN1cHByZXNzZWRFcnJvciIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTsNCiAgICB9OwoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4NCg0KICAgIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQ0KICAgIHB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC4NCg0KICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIDQogICAgUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZDQogICAgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULA0KICAgIElORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTQ0KICAgIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SDQogICAgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUg0KICAgIFBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuDQogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8NCiAgICAvKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSwgU3VwcHJlc3NlZEVycm9yLCBTeW1ib2wsIEl0ZXJhdG9yICovDQoNCg0KICAgIGZ1bmN0aW9uIF9fYXdhaXRlciQxKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIFtdKSkubmV4dCgpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgdHlwZW9mIFN1cHByZXNzZWRFcnJvciA9PT0gImZ1bmN0aW9uIiA/IFN1cHByZXNzZWRFcnJvciA6IGZ1bmN0aW9uIChlcnJvciwgc3VwcHJlc3NlZCwgbWVzc2FnZSkgew0KICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTsNCiAgICAgICAgcmV0dXJuIGUubmFtZSA9ICJTdXBwcmVzc2VkRXJyb3IiLCBlLmVycm9yID0gZXJyb3IsIGUuc3VwcHJlc3NlZCA9IHN1cHByZXNzZWQsIGU7DQogICAgfTsKCiAgICBmdW5jdGlvbiBnZXREZWZhdWx0RXhwb3J0RnJvbUNqcyAoeCkgewogICAgCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CiAgICB9CgogICAgdmFyIG1wNGJveF9hbGwgPSB7fTsKCiAgICB2YXIgaGFzUmVxdWlyZWRNcDRib3hfYWxsOwoKICAgIGZ1bmN0aW9uIHJlcXVpcmVNcDRib3hfYWxsICgpIHsKICAgIAlpZiAoaGFzUmVxdWlyZWRNcDRib3hfYWxsKSByZXR1cm4gbXA0Ym94X2FsbDsKICAgIAloYXNSZXF1aXJlZE1wNGJveF9hbGwgPSAxOwogICAgCShmdW5jdGlvbiAoZXhwb3J0cykgewogICAgCQkvLyBmaWxlOnNyYy9sb2cuanMKICAgIAkJLyogCiAgICAJCSAqIENvcHlyaWdodCAoYykgMjAxMi0yMDEzLiBUZWxlY29tIFBhcmlzVGVjaC9UU0kvTU0vR1BBQyBDeXJpbCBDb25jb2xhdG8KICAgIAkJICogTGljZW5zZTogQlNELTMtQ2xhdXNlIChzZWUgTElDRU5TRSBmaWxlKQogICAgCQkgKi8KICAgIAkJdmFyIExvZyA9IChmdW5jdGlvbiAoKXsKICAgIAkJCQl2YXIgc3RhcnQgPSBuZXcgRGF0ZSgpOwogICAgCQkJCXZhciBMT0dfTEVWRUxfRVJST1IgCT0gNDsKICAgIAkJCQl2YXIgTE9HX0xFVkVMX1dBUk5JTkcgCT0gMzsKICAgIAkJCQl2YXIgTE9HX0xFVkVMX0lORk8gCQk9IDI7CiAgICAJCQkJdmFyIExPR19MRVZFTF9ERUJVRwkJPSAxOwogICAgCQkJCXZhciBsb2dfbGV2ZWwgPSBMT0dfTEVWRUxfRVJST1I7CiAgICAJCQkJdmFyIGxvZ09iamVjdCA9IHsKICAgIAkJCQkJc2V0TG9nTGV2ZWwgOiBmdW5jdGlvbihsZXZlbCkgewogICAgCQkJCQkJaWYgKGxldmVsID09IHRoaXMuZGVidWcpIGxvZ19sZXZlbCA9IExPR19MRVZFTF9ERUJVRzsKICAgIAkJCQkJCWVsc2UgaWYgKGxldmVsID09IHRoaXMuaW5mbykgbG9nX2xldmVsID0gTE9HX0xFVkVMX0lORk87CiAgICAJCQkJCQllbHNlIGlmIChsZXZlbCA9PSB0aGlzLndhcm4pIGxvZ19sZXZlbCA9IExPR19MRVZFTF9XQVJOSU5HOwogICAgCQkJCQkJZWxzZSBpZiAobGV2ZWwgPT0gdGhpcy5lcnJvcikgbG9nX2xldmVsID0gTE9HX0xFVkVMX0VSUk9SOwogICAgCQkJCQkJZWxzZSBsb2dfbGV2ZWwgPSBMT0dfTEVWRUxfRVJST1I7CiAgICAJCQkJCX0sCiAgICAJCQkJCWRlYnVnIDogZnVuY3Rpb24obW9kdWxlLCBtc2cpIHsKICAgIAkJCQkJCWlmIChjb25zb2xlLmRlYnVnID09PSB1bmRlZmluZWQpIHsKICAgIAkJCQkJCQljb25zb2xlLmRlYnVnID0gY29uc29sZS5sb2c7CiAgICAJCQkJCQl9CiAgICAJCQkJCQlpZiAoTE9HX0xFVkVMX0RFQlVHID49IGxvZ19sZXZlbCkgewogICAgCQkJCQkJCWNvbnNvbGUuZGVidWcoIlsiK0xvZy5nZXREdXJhdGlvblN0cmluZyhuZXcgRGF0ZSgpLXN0YXJ0LDEwMDApKyJdIiwiWyIrbW9kdWxlKyJdIixtc2cpOwogICAgCQkJCQkJfQogICAgCQkJCQl9LAogICAgCQkJCQlsb2cgOiBmdW5jdGlvbihtb2R1bGUsIG1zZykgewogICAgCQkJCQkJdGhpcy5kZWJ1Zyhtb2R1bGUubXNnKTsKICAgIAkJCQkJfSwKICAgIAkJCQkJaW5mbyA6IGZ1bmN0aW9uKG1vZHVsZSwgbXNnKSB7CiAgICAJCQkJCQlpZiAoTE9HX0xFVkVMX0lORk8gPj0gbG9nX2xldmVsKSB7CiAgICAJCQkJCQkJY29uc29sZS5pbmZvKCJbIitMb2cuZ2V0RHVyYXRpb25TdHJpbmcobmV3IERhdGUoKS1zdGFydCwxMDAwKSsiXSIsIlsiK21vZHVsZSsiXSIsbXNnKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJfSwKICAgIAkJCQkJd2FybiA6IGZ1bmN0aW9uKG1vZHVsZSwgbXNnKSB7CiAgICAJCQkJCQlpZiAoTE9HX0xFVkVMX1dBUk5JTkcgPj0gbG9nX2xldmVsKSB7CiAgICAJCQkJCQkJY29uc29sZS53YXJuKCJbIitMb2cuZ2V0RHVyYXRpb25TdHJpbmcobmV3IERhdGUoKS1zdGFydCwxMDAwKSsiXSIsIlsiK21vZHVsZSsiXSIsbXNnKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJfSwKICAgIAkJCQkJZXJyb3IgOiBmdW5jdGlvbihtb2R1bGUsIG1zZykgewogICAgCQkJCQkJaWYgKExPR19MRVZFTF9FUlJPUiA+PSBsb2dfbGV2ZWwpIHsKICAgIAkJCQkJCQljb25zb2xlLmVycm9yKCJbIitMb2cuZ2V0RHVyYXRpb25TdHJpbmcobmV3IERhdGUoKS1zdGFydCwxMDAwKSsiXSIsIlsiK21vZHVsZSsiXSIsbXNnKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX07CiAgICAJCQkJcmV0dXJuIGxvZ09iamVjdDsKICAgIAkJCX0pKCk7CiAgICAJCQkKICAgIAkJLyogSGVscGVyIGZ1bmN0aW9uIHRvIHByaW50IGEgZHVyYXRpb24gdmFsdWUgaW4gdGhlIGZvcm0gSDpNTTpTUy5NUyAqLwogICAgCQlMb2cuZ2V0RHVyYXRpb25TdHJpbmcgPSBmdW5jdGlvbihkdXJhdGlvbiwgX3RpbWVzY2FsZSkgewogICAgCQkJdmFyIG5lZzsKICAgIAkJCS8qIEhlbHBlciBmdW5jdGlvbiB0byBwcmludCBhIG51bWJlciBvbiBhIGZpeGVkIG51bWJlciBvZiBkaWdpdHMgKi8KICAgIAkJCWZ1bmN0aW9uIHBhZChudW1iZXIsIGxlbmd0aCkgewogICAgCQkJCXZhciBzdHIgPSAnJyArIG51bWJlcjsKICAgIAkJCQl2YXIgYSA9IHN0ci5zcGxpdCgnLicpOwkJCiAgICAJCQkJd2hpbGUgKGFbMF0ubGVuZ3RoIDwgbGVuZ3RoKSB7CiAgICAJCQkJCWFbMF0gPSAnMCcgKyBhWzBdOwogICAgCQkJCX0KICAgIAkJCQlyZXR1cm4gYS5qb2luKCcuJyk7CiAgICAJCQl9CiAgICAJCQlpZiAoZHVyYXRpb24gPCAwKSB7CiAgICAJCQkJbmVnID0gdHJ1ZTsKICAgIAkJCQlkdXJhdGlvbiA9IC1kdXJhdGlvbjsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJbmVnID0gZmFsc2U7CQogICAgCQkJfQogICAgCQkJdmFyIHRpbWVzY2FsZSA9IF90aW1lc2NhbGUgfHwgMTsKICAgIAkJCXZhciBkdXJhdGlvbl9zZWMgPSBkdXJhdGlvbi90aW1lc2NhbGU7CiAgICAJCQl2YXIgaG91cnMgPSBNYXRoLmZsb29yKGR1cmF0aW9uX3NlYy8zNjAwKTsKICAgIAkJCWR1cmF0aW9uX3NlYyAtPSBob3VycyAqIDM2MDA7CiAgICAJCQl2YXIgbWludXRlcyA9IE1hdGguZmxvb3IoZHVyYXRpb25fc2VjLzYwKTsKICAgIAkJCWR1cmF0aW9uX3NlYyAtPSBtaW51dGVzICogNjA7CQkKICAgIAkJCXZhciBtc2VjID0gZHVyYXRpb25fc2VjKjEwMDA7CiAgICAJCQlkdXJhdGlvbl9zZWMgPSBNYXRoLmZsb29yKGR1cmF0aW9uX3NlYyk7CiAgICAJCQltc2VjIC09IGR1cmF0aW9uX3NlYyoxMDAwOwogICAgCQkJbXNlYyA9IE1hdGguZmxvb3IobXNlYyk7CiAgICAJCQlyZXR1cm4gKG5lZyA/ICItIjogIiIpK2hvdXJzKyI6IitwYWQobWludXRlcywyKSsiOiIrcGFkKGR1cmF0aW9uX3NlYywyKSsiLiIrcGFkKG1zZWMsMyk7CiAgICAJCX07CiAgICAJCQkKICAgIAkJLyogSGVscGVyIGZ1bmN0aW9uIHRvIHN0cmluZ2lmeSBIVE1MNSBUaW1lUmFuZ2VzIG9iamVjdHMgKi8JCiAgICAJCUxvZy5wcmludFJhbmdlcyA9IGZ1bmN0aW9uKHJhbmdlcykgewogICAgCQkJdmFyIGxlbmd0aCA9IHJhbmdlcy5sZW5ndGg7CiAgICAJCQlpZiAobGVuZ3RoID4gMCkgewogICAgCQkJCXZhciBzdHIgPSAiIjsKICAgIAkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAJCQkJICBpZiAoaSA+IDApIHN0ciArPSAiLCI7CiAgICAJCQkJICBzdHIgKz0gIlsiK0xvZy5nZXREdXJhdGlvblN0cmluZyhyYW5nZXMuc3RhcnQoaSkpKyAiLCIrTG9nLmdldER1cmF0aW9uU3RyaW5nKHJhbmdlcy5lbmQoaSkpKyJdIjsKICAgIAkJCQl9CiAgICAJCQkJcmV0dXJuIHN0cjsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuICIoZW1wdHkpIjsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCXsKICAgIAkJCWV4cG9ydHMuTG9nID0gTG9nOwogICAgCQl9CiAgICAJCS8vIGZpbGU6c3JjL3N0cmVhbS5qcwogICAgCQl2YXIgTVA0Qm94U3RyZWFtID0gZnVuY3Rpb24oYXJyYXlCdWZmZXIpIHsKICAgIAkJICBpZiAoYXJyYXlCdWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgCQkgICAgdGhpcy5idWZmZXIgPSBhcnJheUJ1ZmZlcjsKICAgIAkJICAgIHRoaXMuZGF0YXZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpOwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICB0aHJvdyAoIk5lZWRzIGFuIGFycmF5IGJ1ZmZlciIpOwogICAgCQkgIH0KICAgIAkJICB0aGlzLnBvc2l0aW9uID0gMDsKICAgIAkJfTsKCiAgICAJCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAJCSAgQ29tbW9uIEFQSSBiZXR3ZWVuIE11bHRpQnVmZmVyU3RyZWFtIGFuZCBTaW1wbGVTdHJlYW0KICAgIAkJICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5wb3NpdGlvbjsKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUuZ2V0RW5kUG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aDsKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUuZ2V0TGVuZ3RoID0gZnVuY3Rpb24oKSB7CiAgICAJCSAgcmV0dXJuIHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAJCX07CgogICAgCQlNUDRCb3hTdHJlYW0ucHJvdG90eXBlLnNlZWsgPSBmdW5jdGlvbiAocG9zKSB7CiAgICAJCSAgdmFyIG5wb3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoLCBwb3MpKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uID0gKGlzTmFOKG5wb3MpIHx8ICFpc0Zpbml0ZShucG9zKSkgPyAwIDogbnBvczsKICAgIAkJICByZXR1cm4gdHJ1ZTsKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUuaXNFb3MgPSBmdW5jdGlvbiAoKSB7CiAgICAJCSAgcmV0dXJuIHRoaXMuZ2V0UG9zaXRpb24oKSA+PSB0aGlzLmdldEVuZFBvc2l0aW9uKCk7CiAgICAJCX07CgogICAgCQkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgCQkgIFJlYWQgbWV0aG9kcywgc2ltaW1hciB0byBEYXRhU3RyZWFtIGJ1dCBzaW1wbGVyCiAgICAJCSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgCQlNUDRCb3hTdHJlYW0ucHJvdG90eXBlLnJlYWRBbnlJbnQgPSBmdW5jdGlvbihzaXplLCBzaWduZWQpIHsKICAgIAkJICB2YXIgcmVzID0gMDsKICAgIAkJICBpZiAodGhpcy5wb3NpdGlvbiArIHNpemUgPD0gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aCkgewogICAgCQkgICAgc3dpdGNoIChzaXplKSB7CiAgICAJCSAgICAgIGNhc2UgMToKICAgIAkJICAgICAgICBpZiAoc2lnbmVkKSB7CiAgICAJCSAgICAgICAgICByZXMgPSB0aGlzLmRhdGF2aWV3LmdldEludDgodGhpcy5wb3NpdGlvbik7CiAgICAJCSAgICAgICAgfSBlbHNlIHsKICAgIAkJICAgICAgICAgIHJlcyA9IHRoaXMuZGF0YXZpZXcuZ2V0VWludDgodGhpcy5wb3NpdGlvbik7CiAgICAJCSAgICAgICAgfQogICAgCQkgICAgICAgIGJyZWFrOwogICAgCQkgICAgICBjYXNlIDI6CiAgICAJCSAgICAgICAgaWYgKHNpZ25lZCkgewogICAgCQkgICAgICAgICAgcmVzID0gdGhpcy5kYXRhdmlldy5nZXRJbnQxNih0aGlzLnBvc2l0aW9uKTsKICAgIAkJICAgICAgICB9IGVsc2UgewogICAgCQkgICAgICAgICAgcmVzID0gdGhpcy5kYXRhdmlldy5nZXRVaW50MTYodGhpcy5wb3NpdGlvbik7CiAgICAJCSAgICAgICAgfQogICAgCQkgICAgICAgIGJyZWFrOwogICAgCQkgICAgICBjYXNlIDM6CiAgICAJCSAgICAgICAgaWYgKHNpZ25lZCkgewogICAgCQkgICAgICAgICAgdGhyb3cgKCJObyBtZXRob2QgZm9yIHJlYWRpbmcgc2lnbmVkIDI0IGJpdHMgdmFsdWVzIik7CiAgICAJCSAgICAgICAgfSBlbHNlIHsKICAgIAkJICAgICAgICAgIHJlcyA9IHRoaXMuZGF0YXZpZXcuZ2V0VWludDgodGhpcy5wb3NpdGlvbikgPDwgMTY7CiAgICAJCSAgICAgICAgICByZXMgfD0gdGhpcy5kYXRhdmlldy5nZXRVaW50OCh0aGlzLnBvc2l0aW9uKzEpIDw8IDg7CiAgICAJCSAgICAgICAgICByZXMgfD0gdGhpcy5kYXRhdmlldy5nZXRVaW50OCh0aGlzLnBvc2l0aW9uKzIpOwogICAgCQkgICAgICAgIH0KICAgIAkJICAgICAgICBicmVhazsKICAgIAkJICAgICAgY2FzZSA0OgogICAgCQkgICAgICAgIGlmIChzaWduZWQpIHsKICAgIAkJICAgICAgICAgIHJlcyA9IHRoaXMuZGF0YXZpZXcuZ2V0SW50MzIodGhpcy5wb3NpdGlvbik7CiAgICAJCSAgICAgICAgfSBlbHNlIHsKICAgIAkJICAgICAgICAgIHJlcyA9IHRoaXMuZGF0YXZpZXcuZ2V0VWludDMyKHRoaXMucG9zaXRpb24pOwogICAgCQkgICAgICAgIH0KICAgIAkJICAgICAgICBicmVhazsKICAgIAkJICAgICAgY2FzZSA4OgogICAgCQkgICAgICAgIGlmIChzaWduZWQpIHsKICAgIAkJICAgICAgICAgIHRocm93ICgiTm8gbWV0aG9kIGZvciByZWFkaW5nIHNpZ25lZCA2NCBiaXRzIHZhbHVlcyIpOwogICAgCQkgICAgICAgIH0gZWxzZSB7CiAgICAJCSAgICAgICAgICByZXMgPSB0aGlzLmRhdGF2aWV3LmdldFVpbnQzMih0aGlzLnBvc2l0aW9uKSA8PCAzMjsKICAgIAkJICAgICAgICAgIHJlcyB8PSB0aGlzLmRhdGF2aWV3LmdldFVpbnQzMih0aGlzLnBvc2l0aW9uKzQpOwogICAgCQkgICAgICAgIH0KICAgIAkJICAgICAgICBicmVhazsKICAgIAkJICAgICAgZGVmYXVsdDoKICAgIAkJICAgICAgICB0aHJvdyAoInJlYWRJbnQgbWV0aG9kIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2l6ZTogIitzaXplKTsKICAgIAkJICAgIH0KICAgIAkJICAgIHRoaXMucG9zaXRpb24rPSBzaXplOwogICAgCQkgICAgcmV0dXJuIHJlczsKICAgIAkJICB9IGVsc2UgewogICAgCQkgICAgdGhyb3cgKCJOb3QgZW5vdWdoIGJ5dGVzIGluIGJ1ZmZlciIpOwogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUucmVhZFVpbnQ4ID0gZnVuY3Rpb24oKSB7CiAgICAJCSAgcmV0dXJuIHRoaXMucmVhZEFueUludCgxLCBmYWxzZSk7CiAgICAJCX07CgogICAgCQlNUDRCb3hTdHJlYW0ucHJvdG90eXBlLnJlYWRVaW50MTYgPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5yZWFkQW55SW50KDIsIGZhbHNlKTsKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUucmVhZFVpbnQyNCA9IGZ1bmN0aW9uKCkgewogICAgCQkgIHJldHVybiB0aGlzLnJlYWRBbnlJbnQoMywgZmFsc2UpOwogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkVWludDMyID0gZnVuY3Rpb24oKSB7CiAgICAJCSAgcmV0dXJuIHRoaXMucmVhZEFueUludCg0LCBmYWxzZSk7CiAgICAJCX07CgogICAgCQlNUDRCb3hTdHJlYW0ucHJvdG90eXBlLnJlYWRVaW50NjQgPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5yZWFkQW55SW50KDgsIGZhbHNlKTsKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUucmVhZFN0cmluZyA9IGZ1bmN0aW9uKGxlbmd0aCkgewogICAgCQkgIGlmICh0aGlzLnBvc2l0aW9uICsgbGVuZ3RoIDw9IHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGgpIHsKICAgIAkJICAgIHZhciBzID0gIiI7CiAgICAJCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAJCSAgICAgIHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh0aGlzLnJlYWRVaW50OCgpKTsKICAgIAkJICAgIH0KICAgIAkJICAgIHJldHVybiBzOwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICB0aHJvdyAoIk5vdCBlbm91Z2ggYnl0ZXMgaW4gYnVmZmVyIik7CiAgICAJCSAgfQogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkQ1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgCQkgIHZhciBhcnIgPSBbXTsKICAgIAkJICB3aGlsZSh0cnVlKSB7CiAgICAJCSAgICB2YXIgYiA9IHRoaXMucmVhZFVpbnQ4KCk7CiAgICAJCSAgICBpZiAoYiAhPT0gMCkgewogICAgCQkgICAgICBhcnIucHVzaChiKTsKICAgIAkJICAgIH0gZWxzZSB7CiAgICAJCSAgICAgIGJyZWFrOwogICAgCQkgICAgfQogICAgCQkgIH0KICAgIAkJICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBhcnIpOyAKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5yZWFkQW55SW50KDEsIHRydWUpOwogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkSW50MTYgPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5yZWFkQW55SW50KDIsIHRydWUpOwogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkSW50MzIgPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5yZWFkQW55SW50KDQsIHRydWUpOwogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkSW50NjQgPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5yZWFkQW55SW50KDgsIGZhbHNlKTsKICAgIAkJfTsKCiAgICAJCU1QNEJveFN0cmVhbS5wcm90b3R5cGUucmVhZFVpbnQ4QXJyYXkgPSBmdW5jdGlvbihsZW5ndGgpIHsKICAgIAkJICB2YXIgYXJyID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgIAkJICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAJCSAgICBhcnJbaV0gPSB0aGlzLnJlYWRVaW50OCgpOwogICAgCQkgIH0KICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkSW50MTZBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCkgewogICAgCQkgIHZhciBhcnIgPSBuZXcgSW50MTZBcnJheShsZW5ndGgpOwogICAgCQkgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIAkJICAgIGFycltpXSA9IHRoaXMucmVhZEludDE2KCk7CiAgICAJCSAgfQogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQlNUDRCb3hTdHJlYW0ucHJvdG90eXBlLnJlYWRVaW50MTZBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCkgewogICAgCQkgIHZhciBhcnIgPSBuZXcgSW50MTZBcnJheShsZW5ndGgpOwogICAgCQkgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIAkJICAgIGFycltpXSA9IHRoaXMucmVhZFVpbnQxNigpOwogICAgCQkgIH0KICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKICAgIAkJTVA0Qm94U3RyZWFtLnByb3RvdHlwZS5yZWFkVWludDMyQXJyYXkgPSBmdW5jdGlvbihsZW5ndGgpIHsKICAgIAkJICB2YXIgYXJyID0gbmV3IFVpbnQzMkFycmF5KGxlbmd0aCk7CiAgICAJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgCQkgICAgYXJyW2ldID0gdGhpcy5yZWFkVWludDMyKCk7CiAgICAJCSAgfQogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQlNUDRCb3hTdHJlYW0ucHJvdG90eXBlLnJlYWRJbnQzMkFycmF5ID0gZnVuY3Rpb24obGVuZ3RoKSB7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBJbnQzMkFycmF5KGxlbmd0aCk7CiAgICAJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgCQkgICAgYXJyW2ldID0gdGhpcy5yZWFkSW50MzIoKTsKICAgIAkJICB9CiAgICAJCSAgcmV0dXJuIGFycjsKICAgIAkJfTsKCiAgICAJCXsKICAgIAkJICBleHBvcnRzLk1QNEJveFN0cmVhbSA9IE1QNEJveFN0cmVhbTsKICAgIAkJfS8vIGZpbGU6c3JjL0RhdGFTdHJlYW0uanMKICAgIAkJLyoqCiAgICAJCSAgRGF0YVN0cmVhbSByZWFkcyBzY2FsYXJzLCBhcnJheXMgYW5kIHN0cnVjdHMgb2YgZGF0YSBmcm9tIGFuIEFycmF5QnVmZmVyLgogICAgCQkgIEl0J3MgbGlrZSBhIGZpbGUtbGlrZSBEYXRhVmlldyBvbiBzdGVyb2lkcy4KCiAgICAJCSAgQHBhcmFtIHtBcnJheUJ1ZmZlcn0gYXJyYXlCdWZmZXIgQXJyYXlCdWZmZXIgdG8gcmVhZCBmcm9tLgogICAgCQkgIEBwYXJhbSB7P051bWJlcn0gYnl0ZU9mZnNldCBPZmZzZXQgZnJvbSBhcnJheUJ1ZmZlciBiZWdpbm5pbmcgZm9yIHRoZSBEYXRhU3RyZWFtLgogICAgCQkgIEBwYXJhbSB7P0Jvb2xlYW59IGVuZGlhbm5lc3MgRGF0YVN0cmVhbS5CSUdfRU5ESUFOIG9yIERhdGFTdHJlYW0uTElUVExFX0VORElBTiAodGhlIGRlZmF1bHQpLgogICAgCQkgICovCiAgICAJCXZhciBEYXRhU3RyZWFtID0gZnVuY3Rpb24oYXJyYXlCdWZmZXIsIGJ5dGVPZmZzZXQsIGVuZGlhbm5lc3MpIHsKICAgIAkJICB0aGlzLl9ieXRlT2Zmc2V0ID0gYnl0ZU9mZnNldCB8fCAwOwogICAgCQkgIGlmIChhcnJheUJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICAJCSAgICB0aGlzLmJ1ZmZlciA9IGFycmF5QnVmZmVyOwogICAgCQkgIH0gZWxzZSBpZiAodHlwZW9mIGFycmF5QnVmZmVyID09ICJvYmplY3QiKSB7CiAgICAJCSAgICB0aGlzLmRhdGFWaWV3ID0gYXJyYXlCdWZmZXI7CiAgICAJCSAgICBpZiAoYnl0ZU9mZnNldCkgewogICAgCQkgICAgICB0aGlzLl9ieXRlT2Zmc2V0ICs9IGJ5dGVPZmZzZXQ7CiAgICAJCSAgICB9CiAgICAJCSAgfSBlbHNlIHsKICAgIAkJICAgIHRoaXMuYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGFycmF5QnVmZmVyIHx8IDApOwogICAgCQkgIH0KICAgIAkJICB0aGlzLnBvc2l0aW9uID0gMDsKICAgIAkJICB0aGlzLmVuZGlhbm5lc3MgPSBlbmRpYW5uZXNzID09IG51bGwgPyBEYXRhU3RyZWFtLkxJVFRMRV9FTkRJQU4gOiBlbmRpYW5uZXNzOwogICAgCQl9OwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZSA9IHt9OwoKICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gdGhpcy5wb3NpdGlvbjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIEludGVybmFsIGZ1bmN0aW9uIHRvIHJlc2l6ZSB0aGUgRGF0YVN0cmVhbSBidWZmZXIgd2hlbiByZXF1aXJlZC4KICAgIAkJICBAcGFyYW0ge251bWJlcn0gZXh0cmEgTnVtYmVyIG9mIGJ5dGVzIHRvIGFkZCB0byB0aGUgYnVmZmVyIGFsbG9jYXRpb24uCiAgICAJCSAgQHJldHVybiB7bnVsbH0KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5fcmVhbGxvYyA9IGZ1bmN0aW9uKGV4dHJhKSB7CiAgICAJCSAgaWYgKCF0aGlzLl9keW5hbWljU2l6ZSkgewogICAgCQkgICAgcmV0dXJuOwogICAgCQkgIH0KICAgIAkJICB2YXIgcmVxID0gdGhpcy5fYnl0ZU9mZnNldCArIHRoaXMucG9zaXRpb24gKyBleHRyYTsKICAgIAkJICB2YXIgYmxlbiA9IHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoOwogICAgCQkgIGlmIChyZXEgPD0gYmxlbikgewogICAgCQkgICAgaWYgKHJlcSA+IHRoaXMuX2J5dGVMZW5ndGgpIHsKICAgIAkJICAgICAgdGhpcy5fYnl0ZUxlbmd0aCA9IHJlcTsKICAgIAkJICAgIH0KICAgIAkJICAgIHJldHVybjsKICAgIAkJICB9CiAgICAJCSAgaWYgKGJsZW4gPCAxKSB7CiAgICAJCSAgICBibGVuID0gMTsKICAgIAkJICB9CiAgICAJCSAgd2hpbGUgKHJlcSA+IGJsZW4pIHsKICAgIAkJICAgIGJsZW4gKj0gMjsKICAgIAkJICB9CiAgICAJCSAgdmFyIGJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihibGVuKTsKICAgIAkJICB2YXIgc3JjID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fYnVmZmVyKTsKICAgIAkJICB2YXIgZHN0ID0gbmV3IFVpbnQ4QXJyYXkoYnVmLCAwLCBzcmMubGVuZ3RoKTsKICAgIAkJICBkc3Quc2V0KHNyYyk7CiAgICAJCSAgdGhpcy5idWZmZXIgPSBidWY7CiAgICAJCSAgdGhpcy5fYnl0ZUxlbmd0aCA9IHJlcTsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIEludGVybmFsIGZ1bmN0aW9uIHRvIHRyaW0gdGhlIERhdGFTdHJlYW0gYnVmZmVyIHdoZW4gcmVxdWlyZWQuCiAgICAJCSAgVXNlZCBmb3Igc3RyaXBwaW5nIG91dCB0aGUgZXh0cmEgYnl0ZXMgZnJvbSB0aGUgYmFja2luZyBidWZmZXIgd2hlbgogICAgCQkgIHRoZSB2aXJ0dWFsIGJ5dGVMZW5ndGggaXMgc21hbGxlciB0aGFuIHRoZSBidWZmZXIgYnl0ZUxlbmd0aCAoaGFwcGVucyBhZnRlcgogICAgCQkgIGdyb3dpbmcgdGhlIGJ1ZmZlciB3aXRoIHdyaXRlcyBhbmQgbm90IGZpbGxpbmcgdGhlIGV4dHJhIHNwYWNlIGNvbXBsZXRlbHkpLgoKICAgIAkJICBAcmV0dXJuIHtudWxsfQogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLl90cmltQWxsb2MgPSBmdW5jdGlvbigpIHsKICAgIAkJICBpZiAodGhpcy5fYnl0ZUxlbmd0aCA9PSB0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aCkgewogICAgCQkgICAgcmV0dXJuOwogICAgCQkgIH0KICAgIAkJICB2YXIgYnVmID0gbmV3IEFycmF5QnVmZmVyKHRoaXMuX2J5dGVMZW5ndGgpOwogICAgCQkgIHZhciBkc3QgPSBuZXcgVWludDhBcnJheShidWYpOwogICAgCQkgIHZhciBzcmMgPSBuZXcgVWludDhBcnJheSh0aGlzLl9idWZmZXIsIDAsIGRzdC5sZW5ndGgpOwogICAgCQkgIGRzdC5zZXQoc3JjKTsKICAgIAkJICB0aGlzLmJ1ZmZlciA9IGJ1ZjsKICAgIAkJfTsKCgogICAgCQkvKioKICAgIAkJICBCaWctZW5kaWFuIGNvbnN0IHRvIHVzZSBhcyBkZWZhdWx0IGVuZGlhbm5lc3MuCiAgICAJCSAgQHR5cGUge2Jvb2xlYW59CiAgICAJCSAgKi8KICAgIAkJRGF0YVN0cmVhbS5CSUdfRU5ESUFOID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICBMaXR0bGUtZW5kaWFuIGNvbnN0IHRvIHVzZSBhcyBkZWZhdWx0IGVuZGlhbm5lc3MuCiAgICAJCSAgQHR5cGUge2Jvb2xlYW59CiAgICAJCSAgKi8KICAgIAkJRGF0YVN0cmVhbS5MSVRUTEVfRU5ESUFOID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgIFZpcnR1YWwgYnl0ZSBsZW5ndGggb2YgdGhlIERhdGFTdHJlYW0gYmFja2luZyBidWZmZXIuCiAgICAJCSAgVXBkYXRlZCB0byBiZSBtYXggb2Ygb3JpZ2luYWwgYnVmZmVyIHNpemUgYW5kIGxhc3Qgd3JpdHRlbiBzaXplLgogICAgCQkgIElmIGR5bmFtaWNTaXplIGlzIGZhbHNlIGlzIHNldCB0byBidWZmZXIgc2l6ZS4KICAgIAkJICBAdHlwZSB7bnVtYmVyfQogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLl9ieXRlTGVuZ3RoID0gMDsKCiAgICAJCS8qKgogICAgCQkgIFJldHVybnMgdGhlIGJ5dGUgbGVuZ3RoIG9mIHRoZSBEYXRhU3RyZWFtIG9iamVjdC4KICAgIAkJICBAdHlwZSB7bnVtYmVyfQogICAgCQkgICovCiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEYXRhU3RyZWFtLnByb3RvdHlwZSwgJ2J5dGVMZW5ndGgnLAogICAgCQkgIHsgZ2V0OiBmdW5jdGlvbigpIHsKICAgIAkJICAgIHJldHVybiB0aGlzLl9ieXRlTGVuZ3RoIC0gdGhpcy5fYnl0ZU9mZnNldDsKICAgIAkJICB9fSk7CgogICAgCQkvKioKICAgIAkJICBTZXQvZ2V0IHRoZSBiYWNraW5nIEFycmF5QnVmZmVyIG9mIHRoZSBEYXRhU3RyZWFtIG9iamVjdC4KICAgIAkJICBUaGUgc2V0dGVyIHVwZGF0ZXMgdGhlIERhdGFWaWV3IHRvIHBvaW50IHRvIHRoZSBuZXcgYnVmZmVyLgogICAgCQkgIEB0eXBlIHtPYmplY3R9CiAgICAJCSAgKi8KICAgIAkJT2JqZWN0LmRlZmluZVByb3BlcnR5KERhdGFTdHJlYW0ucHJvdG90eXBlLCAnYnVmZmVyJywKICAgIAkJICB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAJCSAgICAgIHRoaXMuX3RyaW1BbGxvYygpOwogICAgCQkgICAgICByZXR1cm4gdGhpcy5fYnVmZmVyOwogICAgCQkgICAgfSwKICAgIAkJICAgIHNldDogZnVuY3Rpb24odikgewogICAgCQkgICAgICB0aGlzLl9idWZmZXIgPSB2OwogICAgCQkgICAgICB0aGlzLl9kYXRhVmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLl9idWZmZXIsIHRoaXMuX2J5dGVPZmZzZXQpOwogICAgCQkgICAgICB0aGlzLl9ieXRlTGVuZ3RoID0gdGhpcy5fYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAJCSAgICB9IH0pOwoKICAgIAkJLyoqCiAgICAJCSAgU2V0L2dldCB0aGUgYnl0ZU9mZnNldCBvZiB0aGUgRGF0YVN0cmVhbSBvYmplY3QuCiAgICAJCSAgVGhlIHNldHRlciB1cGRhdGVzIHRoZSBEYXRhVmlldyB0byBwb2ludCB0byB0aGUgbmV3IGJ5dGVPZmZzZXQuCiAgICAJCSAgQHR5cGUge251bWJlcn0KICAgIAkJICAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YVN0cmVhbS5wcm90b3R5cGUsICdieXRlT2Zmc2V0JywKICAgIAkJICB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAJCSAgICAgIHJldHVybiB0aGlzLl9ieXRlT2Zmc2V0OwogICAgCQkgICAgfSwKICAgIAkJICAgIHNldDogZnVuY3Rpb24odikgewogICAgCQkgICAgICB0aGlzLl9ieXRlT2Zmc2V0ID0gdjsKICAgIAkJICAgICAgdGhpcy5fZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5fYnVmZmVyLCB0aGlzLl9ieXRlT2Zmc2V0KTsKICAgIAkJICAgICAgdGhpcy5fYnl0ZUxlbmd0aCA9IHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoOwogICAgCQkgICAgfSB9KTsKCiAgICAJCS8qKgogICAgCQkgIFNldC9nZXQgdGhlIGJhY2tpbmcgRGF0YVZpZXcgb2YgdGhlIERhdGFTdHJlYW0gb2JqZWN0LgogICAgCQkgIFRoZSBzZXR0ZXIgdXBkYXRlcyB0aGUgYnVmZmVyIGFuZCBieXRlT2Zmc2V0IHRvIHBvaW50IHRvIHRoZSBEYXRhVmlldyB2YWx1ZXMuCiAgICAJCSAgQHR5cGUge09iamVjdH0KICAgIAkJICAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YVN0cmVhbS5wcm90b3R5cGUsICdkYXRhVmlldycsCiAgICAJCSAgeyBnZXQ6IGZ1bmN0aW9uKCkgewogICAgCQkgICAgICByZXR1cm4gdGhpcy5fZGF0YVZpZXc7CiAgICAJCSAgICB9LAogICAgCQkgICAgc2V0OiBmdW5jdGlvbih2KSB7CiAgICAJCSAgICAgIHRoaXMuX2J5dGVPZmZzZXQgPSB2LmJ5dGVPZmZzZXQ7CiAgICAJCSAgICAgIHRoaXMuX2J1ZmZlciA9IHYuYnVmZmVyOwogICAgCQkgICAgICB0aGlzLl9kYXRhVmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLl9idWZmZXIsIHRoaXMuX2J5dGVPZmZzZXQpOwogICAgCQkgICAgICB0aGlzLl9ieXRlTGVuZ3RoID0gdGhpcy5fYnl0ZU9mZnNldCArIHYuYnl0ZUxlbmd0aDsKICAgIAkJICAgIH0gfSk7CgogICAgCQkvKioKICAgIAkJICBTZXRzIHRoZSBEYXRhU3RyZWFtIHJlYWQvd3JpdGUgcG9zaXRpb24gdG8gZ2l2ZW4gcG9zaXRpb24uCiAgICAJCSAgQ2xhbXBzIGJldHdlZW4gMCBhbmQgRGF0YVN0cmVhbSBsZW5ndGguCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBwb3MgUG9zaXRpb24gdG8gc2VlayB0by4KICAgIAkJICBAcmV0dXJuIHtudWxsfQogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnNlZWsgPSBmdW5jdGlvbihwb3MpIHsKICAgIAkJICB2YXIgbnBvcyA9IE1hdGgubWF4KDAsIE1hdGgubWluKHRoaXMuYnl0ZUxlbmd0aCwgcG9zKSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiA9IChpc05hTihucG9zKSB8fCAhaXNGaW5pdGUobnBvcykpID8gMCA6IG5wb3M7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBSZXR1cm5zIHRydWUgaWYgdGhlIERhdGFTdHJlYW0gc2VlayBwb2ludGVyIGlzIGF0IHRoZSBlbmQgb2YgYnVmZmVyIGFuZAogICAgCQkgIHRoZXJlJ3Mgbm8gbW9yZSBkYXRhIHRvIHJlYWQuCgogICAgCQkgIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIHNlZWsgcG9pbnRlciBpcyBhdCB0aGUgZW5kIG9mIHRoZSBidWZmZXIuCiAgICAJCSAgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUuaXNFb2YgPSBmdW5jdGlvbigpIHsKICAgIAkJICByZXR1cm4gKHRoaXMucG9zaXRpb24gPj0gdGhpcy5fYnl0ZUxlbmd0aCk7CiAgICAJCX07CgoKICAgIAkJLyoqCiAgICAJCSAgTWFwcyBhIFVpbnQ4QXJyYXkgaW50byB0aGUgRGF0YVN0cmVhbSBidWZmZXIuCgogICAgCQkgIE5pY2UgZm9yIHF1aWNrbHkgcmVhZGluZyBpbiBkYXRhLgoKICAgIAkJICBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIE51bWJlciBvZiBlbGVtZW50cyB0byBtYXAuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBkYXRhIHRvIHJlYWQuCiAgICAJCSAgQHJldHVybiB7T2JqZWN0fSBVaW50OEFycmF5IHRvIHRoZSBEYXRhU3RyZWFtIGJhY2tpbmcgYnVmZmVyLgogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLm1hcFVpbnQ4QXJyYXkgPSBmdW5jdGlvbihsZW5ndGgpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKGxlbmd0aCAqIDEpOwogICAgCQkgIHZhciBhcnIgPSBuZXcgVWludDhBcnJheSh0aGlzLl9idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLCBsZW5ndGgpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gbGVuZ3RoICogMTsKICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGFuIEludDMyQXJyYXkgb2YgZGVzaXJlZCBsZW5ndGggYW5kIGVuZGlhbm5lc3MgZnJvbSB0aGUgRGF0YVN0cmVhbS4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gbWFwLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgZGF0YSB0byByZWFkLgogICAgCQkgIEByZXR1cm4ge09iamVjdH0gVGhlIHJlYWQgSW50MzJBcnJheS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRJbnQzMkFycmF5ID0gZnVuY3Rpb24obGVuZ3RoLCBlKSB7CiAgICAJCSAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyAodGhpcy5ieXRlTGVuZ3RoLXRoaXMucG9zaXRpb24gLyA0KSA6IGxlbmd0aDsKICAgIAkJICB2YXIgYXJyID0gbmV3IEludDMyQXJyYXkobGVuZ3RoKTsKICAgIAkJICBEYXRhU3RyZWFtLm1lbWNweShhcnIuYnVmZmVyLCAwLAogICAgCQkgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwKICAgIAkJICAgICAgICAgICAgICAgICAgICBsZW5ndGgqYXJyLkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIAkJICBEYXRhU3RyZWFtLmFycmF5VG9OYXRpdmUoYXJyLCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IGFyci5ieXRlTGVuZ3RoOwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBSZWFkcyBhbiBJbnQxNkFycmF5IG9mIGRlc2lyZWQgbGVuZ3RoIGFuZCBlbmRpYW5uZXNzIGZyb20gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IFRoZSByZWFkIEludDE2QXJyYXkuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkSW50MTZBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCwgZSkgewogICAgCQkgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gKHRoaXMuYnl0ZUxlbmd0aC10aGlzLnBvc2l0aW9uIC8gMikgOiBsZW5ndGg7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBJbnQxNkFycmF5KGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5tZW1jcHkoYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sCiAgICAJCSAgICAgICAgICAgICAgICAgICAgbGVuZ3RoKmFyci5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAJCSAgRGF0YVN0cmVhbS5hcnJheVRvTmF0aXZlKGFyciwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBhcnIuYnl0ZUxlbmd0aDsKICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgUmVhZHMgYW4gSW50OEFycmF5IG9mIGRlc2lyZWQgbGVuZ3RoIGZyb20gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IFRoZSByZWFkIEludDhBcnJheS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRJbnQ4QXJyYXkgPSBmdW5jdGlvbihsZW5ndGgpIHsKICAgIAkJICBsZW5ndGggPSBsZW5ndGggPT0gbnVsbCA/ICh0aGlzLmJ5dGVMZW5ndGgtdGhpcy5wb3NpdGlvbikgOiBsZW5ndGg7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBJbnQ4QXJyYXkobGVuZ3RoKTsKICAgIAkJICBEYXRhU3RyZWFtLm1lbWNweShhcnIuYnVmZmVyLCAwLAogICAgCQkgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwKICAgIAkJICAgICAgICAgICAgICAgICAgICBsZW5ndGgqYXJyLkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IGFyci5ieXRlTGVuZ3RoOwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBSZWFkcyBhIFVpbnQzMkFycmF5IG9mIGRlc2lyZWQgbGVuZ3RoIGFuZCBlbmRpYW5uZXNzIGZyb20gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IFRoZSByZWFkIFVpbnQzMkFycmF5LgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUucmVhZFVpbnQzMkFycmF5ID0gZnVuY3Rpb24obGVuZ3RoLCBlKSB7CiAgICAJCSAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyAodGhpcy5ieXRlTGVuZ3RoLXRoaXMucG9zaXRpb24gLyA0KSA6IGxlbmd0aDsKICAgIAkJICB2YXIgYXJyID0gbmV3IFVpbnQzMkFycmF5KGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5tZW1jcHkoYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sCiAgICAJCSAgICAgICAgICAgICAgICAgICAgbGVuZ3RoKmFyci5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAJCSAgRGF0YVN0cmVhbS5hcnJheVRvTmF0aXZlKGFyciwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBhcnIuYnl0ZUxlbmd0aDsKICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgUmVhZHMgYSBVaW50MTZBcnJheSBvZiBkZXNpcmVkIGxlbmd0aCBhbmQgZW5kaWFubmVzcyBmcm9tIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIE51bWJlciBvZiBlbGVtZW50cyB0byBtYXAuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBkYXRhIHRvIHJlYWQuCiAgICAJCSAgQHJldHVybiB7T2JqZWN0fSBUaGUgcmVhZCBVaW50MTZBcnJheS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRVaW50MTZBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCwgZSkgewogICAgCQkgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gKHRoaXMuYnl0ZUxlbmd0aC10aGlzLnBvc2l0aW9uIC8gMikgOiBsZW5ndGg7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBVaW50MTZBcnJheShsZW5ndGgpOwogICAgCQkgIERhdGFTdHJlYW0ubWVtY3B5KGFyci5idWZmZXIsIDAsCiAgICAJCSAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLAogICAgCQkgICAgICAgICAgICAgICAgICAgIGxlbmd0aCphcnIuQllURVNfUEVSX0VMRU1FTlQpOwogICAgCQkgIERhdGFTdHJlYW0uYXJyYXlUb05hdGl2ZShhcnIsIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gYXJyLmJ5dGVMZW5ndGg7CiAgICAJCSAgcmV0dXJuIGFycjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGEgVWludDhBcnJheSBvZiBkZXNpcmVkIGxlbmd0aCBmcm9tIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIE51bWJlciBvZiBlbGVtZW50cyB0byBtYXAuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBkYXRhIHRvIHJlYWQuCiAgICAJCSAgQHJldHVybiB7T2JqZWN0fSBUaGUgcmVhZCBVaW50OEFycmF5LgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUucmVhZFVpbnQ4QXJyYXkgPSBmdW5jdGlvbihsZW5ndGgpIHsKICAgIAkJICBsZW5ndGggPSBsZW5ndGggPT0gbnVsbCA/ICh0aGlzLmJ5dGVMZW5ndGgtdGhpcy5wb3NpdGlvbikgOiBsZW5ndGg7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5tZW1jcHkoYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sCiAgICAJCSAgICAgICAgICAgICAgICAgICAgbGVuZ3RoKmFyci5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBhcnIuYnl0ZUxlbmd0aDsKICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgUmVhZHMgYSBGbG9hdDY0QXJyYXkgb2YgZGVzaXJlZCBsZW5ndGggYW5kIGVuZGlhbm5lc3MgZnJvbSB0aGUgRGF0YVN0cmVhbS4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gbWFwLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgZGF0YSB0byByZWFkLgogICAgCQkgIEByZXR1cm4ge09iamVjdH0gVGhlIHJlYWQgRmxvYXQ2NEFycmF5LgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUucmVhZEZsb2F0NjRBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCwgZSkgewogICAgCQkgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gKHRoaXMuYnl0ZUxlbmd0aC10aGlzLnBvc2l0aW9uIC8gOCkgOiBsZW5ndGg7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBGbG9hdDY0QXJyYXkobGVuZ3RoKTsKICAgIAkJICBEYXRhU3RyZWFtLm1lbWNweShhcnIuYnVmZmVyLCAwLAogICAgCQkgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwKICAgIAkJICAgICAgICAgICAgICAgICAgICBsZW5ndGgqYXJyLkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIAkJICBEYXRhU3RyZWFtLmFycmF5VG9OYXRpdmUoYXJyLCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IGFyci5ieXRlTGVuZ3RoOwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBSZWFkcyBhIEZsb2F0MzJBcnJheSBvZiBkZXNpcmVkIGxlbmd0aCBhbmQgZW5kaWFubmVzcyBmcm9tIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIE51bWJlciBvZiBlbGVtZW50cyB0byBtYXAuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBkYXRhIHRvIHJlYWQuCiAgICAJCSAgQHJldHVybiB7T2JqZWN0fSBUaGUgcmVhZCBGbG9hdDMyQXJyYXkuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkRmxvYXQzMkFycmF5ID0gZnVuY3Rpb24obGVuZ3RoLCBlKSB7CiAgICAJCSAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyAodGhpcy5ieXRlTGVuZ3RoLXRoaXMucG9zaXRpb24gLyA0KSA6IGxlbmd0aDsKICAgIAkJICB2YXIgYXJyID0gbmV3IEZsb2F0MzJBcnJheShsZW5ndGgpOwogICAgCQkgIERhdGFTdHJlYW0ubWVtY3B5KGFyci5idWZmZXIsIDAsCiAgICAJCSAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLAogICAgCQkgICAgICAgICAgICAgICAgICAgIGxlbmd0aCphcnIuQllURVNfUEVSX0VMRU1FTlQpOwogICAgCQkgIERhdGFTdHJlYW0uYXJyYXlUb05hdGl2ZShhcnIsIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gYXJyLmJ5dGVMZW5ndGg7CiAgICAJCSAgcmV0dXJuIGFycjsKICAgIAkJfTsKCgogICAgCQkvKioKICAgIAkJICBSZWFkcyBhIDMyLWJpdCBpbnQgZnJvbSB0aGUgRGF0YVN0cmVhbSB3aXRoIHRoZSBkZXNpcmVkIGVuZGlhbm5lc3MuCgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgbnVtYmVyLgogICAgCQkgIEByZXR1cm4ge251bWJlcn0gVGhlIHJlYWQgbnVtYmVyLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUucmVhZEludDMyID0gZnVuY3Rpb24oZSkgewogICAgCQkgIHZhciB2ID0gdGhpcy5fZGF0YVZpZXcuZ2V0SW50MzIodGhpcy5wb3NpdGlvbiwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSA0OwogICAgCQkgIHJldHVybiB2OwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgUmVhZHMgYSAxNi1iaXQgaW50IGZyb20gdGhlIERhdGFTdHJlYW0gd2l0aCB0aGUgZGVzaXJlZCBlbmRpYW5uZXNzLgoKICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIG51bWJlci4KICAgIAkJICBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZWFkIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRJbnQxNiA9IGZ1bmN0aW9uKGUpIHsKICAgIAkJICB2YXIgdiA9IHRoaXMuX2RhdGFWaWV3LmdldEludDE2KHRoaXMucG9zaXRpb24sIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gMjsKICAgIAkJICByZXR1cm4gdjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGFuIDgtYml0IGludCBmcm9tIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZWFkIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRJbnQ4ID0gZnVuY3Rpb24oKSB7CiAgICAJCSAgdmFyIHYgPSB0aGlzLl9kYXRhVmlldy5nZXRJbnQ4KHRoaXMucG9zaXRpb24pOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gMTsKICAgIAkJICByZXR1cm4gdjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGEgMzItYml0IHVuc2lnbmVkIGludCBmcm9tIHRoZSBEYXRhU3RyZWFtIHdpdGggdGhlIGRlc2lyZWQgZW5kaWFubmVzcy4KCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBudW1iZXIuCiAgICAJCSAgQHJldHVybiB7bnVtYmVyfSBUaGUgcmVhZCBudW1iZXIuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkVWludDMyID0gZnVuY3Rpb24oZSkgewogICAgCQkgIHZhciB2ID0gdGhpcy5fZGF0YVZpZXcuZ2V0VWludDMyKHRoaXMucG9zaXRpb24sIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gNDsKICAgIAkJICByZXR1cm4gdjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGEgMTYtYml0IHVuc2lnbmVkIGludCBmcm9tIHRoZSBEYXRhU3RyZWFtIHdpdGggdGhlIGRlc2lyZWQgZW5kaWFubmVzcy4KCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBudW1iZXIuCiAgICAJCSAgQHJldHVybiB7bnVtYmVyfSBUaGUgcmVhZCBudW1iZXIuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkVWludDE2ID0gZnVuY3Rpb24oZSkgewogICAgCQkgIHZhciB2ID0gdGhpcy5fZGF0YVZpZXcuZ2V0VWludDE2KHRoaXMucG9zaXRpb24sIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gMjsKICAgIAkJICByZXR1cm4gdjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGFuIDgtYml0IHVuc2lnbmVkIGludCBmcm9tIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZWFkIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRVaW50OCA9IGZ1bmN0aW9uKCkgewogICAgCQkgIHZhciB2ID0gdGhpcy5fZGF0YVZpZXcuZ2V0VWludDgodGhpcy5wb3NpdGlvbik7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSAxOwogICAgCQkgIHJldHVybiB2OwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgUmVhZHMgYSAzMi1iaXQgZmxvYXQgZnJvbSB0aGUgRGF0YVN0cmVhbSB3aXRoIHRoZSBkZXNpcmVkIGVuZGlhbm5lc3MuCgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgbnVtYmVyLgogICAgCQkgIEByZXR1cm4ge251bWJlcn0gVGhlIHJlYWQgbnVtYmVyLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUucmVhZEZsb2F0MzIgPSBmdW5jdGlvbihlKSB7CiAgICAJCSAgdmFyIHYgPSB0aGlzLl9kYXRhVmlldy5nZXRGbG9hdDMyKHRoaXMucG9zaXRpb24sIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gNDsKICAgIAkJICByZXR1cm4gdjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFJlYWRzIGEgNjQtYml0IGZsb2F0IGZyb20gdGhlIERhdGFTdHJlYW0gd2l0aCB0aGUgZGVzaXJlZCBlbmRpYW5uZXNzLgoKICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIG51bWJlci4KICAgIAkJICBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZWFkIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRGbG9hdDY0ID0gZnVuY3Rpb24oZSkgewogICAgCQkgIHZhciB2ID0gdGhpcy5fZGF0YVZpZXcuZ2V0RmxvYXQ2NCh0aGlzLnBvc2l0aW9uLCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IDg7CiAgICAJCSAgcmV0dXJuIHY7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBOYXRpdmUgZW5kaWFubmVzcy4gRWl0aGVyIERhdGFTdHJlYW0uQklHX0VORElBTiBvciBEYXRhU3RyZWFtLkxJVFRMRV9FTkRJQU4KICAgIAkJICBkZXBlbmRpbmcgb24gdGhlIHBsYXRmb3JtIGVuZGlhbm5lc3MuCgogICAgCQkgIEB0eXBlIHtib29sZWFufQogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5lbmRpYW5uZXNzID0gbmV3IEludDhBcnJheShuZXcgSW50MTZBcnJheShbMV0pLmJ1ZmZlcilbMF0gPiAwOwoKICAgIAkJLyoqCiAgICAJCSAgQ29waWVzIGJ5dGVMZW5ndGggYnl0ZXMgZnJvbSB0aGUgc3JjIGJ1ZmZlciBhdCBzcmNPZmZzZXQgdG8gdGhlCiAgICAJCSAgZHN0IGJ1ZmZlciBhdCBkc3RPZmZzZXQuCgogICAgCQkgIEBwYXJhbSB7T2JqZWN0fSBkc3QgRGVzdGluYXRpb24gQXJyYXlCdWZmZXIgdG8gd3JpdGUgdG8uCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IGRzdE9mZnNldCBPZmZzZXQgdG8gdGhlIGRlc3RpbmF0aW9uIEFycmF5QnVmZmVyLgogICAgCQkgIEBwYXJhbSB7T2JqZWN0fSBzcmMgU291cmNlIEFycmF5QnVmZmVyIHRvIHJlYWQgZnJvbS4KICAgIAkJICBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0IE9mZnNldCB0byB0aGUgc291cmNlIEFycmF5QnVmZmVyLgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBieXRlTGVuZ3RoIE51bWJlciBvZiBieXRlcyB0byBjb3B5LgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5tZW1jcHkgPSBmdW5jdGlvbihkc3QsIGRzdE9mZnNldCwgc3JjLCBzcmNPZmZzZXQsIGJ5dGVMZW5ndGgpIHsKICAgIAkJICB2YXIgZHN0VTggPSBuZXcgVWludDhBcnJheShkc3QsIGRzdE9mZnNldCwgYnl0ZUxlbmd0aCk7CiAgICAJCSAgdmFyIHNyY1U4ID0gbmV3IFVpbnQ4QXJyYXkoc3JjLCBzcmNPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgCQkgIGRzdFU4LnNldChzcmNVOCk7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBDb252ZXJ0cyBhcnJheSB0byBuYXRpdmUgZW5kaWFubmVzcyBpbi1wbGFjZS4KCiAgICAJCSAgQHBhcmFtIHtPYmplY3R9IGFycmF5IFR5cGVkIGFycmF5IHRvIGNvbnZlcnQuCiAgICAJCSAgQHBhcmFtIHtib29sZWFufSBhcnJheUlzTGl0dGxlRW5kaWFuIFRydWUgaWYgdGhlIGRhdGEgaW4gdGhlIGFycmF5IGlzCiAgICAJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpdHRsZS1lbmRpYW4uIFNldCBmYWxzZSBmb3IgYmlnLWVuZGlhbi4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IFRoZSBjb252ZXJ0ZWQgdHlwZWQgYXJyYXkuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLmFycmF5VG9OYXRpdmUgPSBmdW5jdGlvbihhcnJheSwgYXJyYXlJc0xpdHRsZUVuZGlhbikgewogICAgCQkgIGlmIChhcnJheUlzTGl0dGxlRW5kaWFuID09IHRoaXMuZW5kaWFubmVzcykgewogICAgCQkgICAgcmV0dXJuIGFycmF5OwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICByZXR1cm4gdGhpcy5mbGlwQXJyYXlFbmRpYW5uZXNzKGFycmF5KTsKICAgIAkJICB9CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBDb252ZXJ0cyBuYXRpdmUgZW5kaWFubmVzcyBhcnJheSB0byBkZXNpcmVkIGVuZGlhbm5lc3MgaW4tcGxhY2UuCgogICAgCQkgIEBwYXJhbSB7T2JqZWN0fSBhcnJheSBUeXBlZCBhcnJheSB0byBjb252ZXJ0LgogICAgCQkgIEBwYXJhbSB7Ym9vbGVhbn0gbGl0dGxlRW5kaWFuIFRydWUgaWYgdGhlIGNvbnZlcnRlZCBhcnJheSBzaG91bGQgYmUKICAgIAkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXR0bGUtZW5kaWFuLiBTZXQgZmFsc2UgZm9yIGJpZy1lbmRpYW4uCiAgICAJCSAgQHJldHVybiB7T2JqZWN0fSBUaGUgY29udmVydGVkIHR5cGVkIGFycmF5LgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5uYXRpdmVUb0VuZGlhbiA9IGZ1bmN0aW9uKGFycmF5LCBsaXR0bGVFbmRpYW4pIHsKICAgIAkJICBpZiAodGhpcy5lbmRpYW5uZXNzID09IGxpdHRsZUVuZGlhbikgewogICAgCQkgICAgcmV0dXJuIGFycmF5OwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICByZXR1cm4gdGhpcy5mbGlwQXJyYXlFbmRpYW5uZXNzKGFycmF5KTsKICAgIAkJICB9CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBGbGlwcyB0eXBlZCBhcnJheSBlbmRpYW5uZXNzIGluLXBsYWNlLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gYXJyYXkgVHlwZWQgYXJyYXkgdG8gZmxpcC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IFRoZSBjb252ZXJ0ZWQgdHlwZWQgYXJyYXkuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLmZsaXBBcnJheUVuZGlhbm5lc3MgPSBmdW5jdGlvbihhcnJheSkgewogICAgCQkgIHZhciB1OCA9IG5ldyBVaW50OEFycmF5KGFycmF5LmJ1ZmZlciwgYXJyYXkuYnl0ZU9mZnNldCwgYXJyYXkuYnl0ZUxlbmd0aCk7CiAgICAJCSAgZm9yICh2YXIgaT0wOyBpPGFycmF5LmJ5dGVMZW5ndGg7IGkrPWFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKSB7CiAgICAJCSAgICBmb3IgKHZhciBqPWkrYXJyYXkuQllURVNfUEVSX0VMRU1FTlQtMSwgaz1pOyBqPms7IGotLSwgaysrKSB7CiAgICAJCSAgICAgIHZhciB0bXAgPSB1OFtrXTsKICAgIAkJICAgICAgdThba10gPSB1OFtqXTsKICAgIAkJICAgICAgdThbal0gPSB0bXA7CiAgICAJCSAgICB9CiAgICAJCSAgfQogICAgCQkgIHJldHVybiBhcnJheTsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFNlZWsgcG9zaXRpb24gd2hlcmUgRGF0YVN0cmVhbSNyZWFkU3RydWN0IHJhbiBpbnRvIGEgcHJvYmxlbS4KICAgIAkJICBVc2VmdWwgZm9yIGRlYnVnZ2luZyBzdHJ1Y3QgcGFyc2luZy4KCiAgICAJCSAgQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLmZhaWx1cmVQb3NpdGlvbiA9IDA7CgogICAgCQlTdHJpbmcuZnJvbUNoYXJDb2RlVWludDggPSBmdW5jdGlvbih1aW50OGFycikgewogICAgCQkgICAgdmFyIGFyciA9IFtdOwogICAgCQkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1aW50OGFyci5sZW5ndGg7IGkrKykgewogICAgCQkgICAgICBhcnJbaV0gPSB1aW50OGFycltpXTsKICAgIAkJICAgIH0KICAgIAkJICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGFycik7CiAgICAJCX07CiAgICAJCS8qKgogICAgCQkgIFJlYWQgYSBzdHJpbmcgb2YgZGVzaXJlZCBsZW5ndGggYW5kIGVuY29kaW5nIGZyb20gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nIHRvIHJlYWQgaW4gYnl0ZXMuCiAgICAJCSAgQHBhcmFtIHs/c3RyaW5nfSBlbmNvZGluZyBUaGUgZW5jb2Rpbmcgb2YgdGhlIHN0cmluZyBkYXRhIGluIHRoZSBEYXRhU3RyZWFtLgogICAgCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdHMgdG8gQVNDSUkuCiAgICAJCSAgQHJldHVybiB7c3RyaW5nfSBUaGUgcmVhZCBzdHJpbmcuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkU3RyaW5nID0gZnVuY3Rpb24obGVuZ3RoLCBlbmNvZGluZykgewogICAgCQkgIGlmIChlbmNvZGluZyA9PSBudWxsIHx8IGVuY29kaW5nID09ICJBU0NJSSIpIHsKICAgIAkJICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlVWludDguYXBwbHkobnVsbCwgW3RoaXMubWFwVWludDhBcnJheShsZW5ndGggPT0gbnVsbCA/IHRoaXMuYnl0ZUxlbmd0aC10aGlzLnBvc2l0aW9uIDogbGVuZ3RoKV0pOwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICByZXR1cm4gKG5ldyBUZXh0RGVjb2RlcihlbmNvZGluZykpLmRlY29kZSh0aGlzLm1hcFVpbnQ4QXJyYXkobGVuZ3RoKSk7CiAgICAJCSAgfQogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgUmVhZCBudWxsLXRlcm1pbmF0ZWQgc3RyaW5nIG9mIGRlc2lyZWQgbGVuZ3RoIGZyb20gdGhlIERhdGFTdHJlYW0uIFRydW5jYXRlcwogICAgCQkgIHRoZSByZXR1cm5lZCBzdHJpbmcgc28gdGhhdCB0aGUgbnVsbCBieXRlIGlzIG5vdCBhIHBhcnQgb2YgaXQuCgogICAgCQkgIEBwYXJhbSB7P251bWJlcn0gbGVuZ3RoIFRoZSBsZW5ndGggb2YgdGhlIHN0cmluZyB0byByZWFkLgogICAgCQkgIEByZXR1cm4ge3N0cmluZ30gVGhlIHJlYWQgc3RyaW5nLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUucmVhZENTdHJpbmcgPSBmdW5jdGlvbihsZW5ndGgpIHsKICAgIAkJICB2YXIgYmxlbiA9IHRoaXMuYnl0ZUxlbmd0aC10aGlzLnBvc2l0aW9uOwogICAgCQkgIHZhciB1OCA9IG5ldyBVaW50OEFycmF5KHRoaXMuX2J1ZmZlciwgdGhpcy5fYnl0ZU9mZnNldCArIHRoaXMucG9zaXRpb24pOwogICAgCQkgIHZhciBsZW4gPSBibGVuOwogICAgCQkgIGlmIChsZW5ndGggIT0gbnVsbCkgewogICAgCQkgICAgbGVuID0gTWF0aC5taW4obGVuZ3RoLCBibGVuKTsKICAgIAkJICB9CiAgICAJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW4gJiYgdThbaV0gIT09IDA7IGkrKyk7IC8vIGZpbmQgZmlyc3QgemVybyBieXRlCiAgICAJCSAgdmFyIHMgPSBTdHJpbmcuZnJvbUNoYXJDb2RlVWludDguYXBwbHkobnVsbCwgW3RoaXMubWFwVWludDhBcnJheShpKV0pOwogICAgCQkgIGlmIChsZW5ndGggIT0gbnVsbCkgewogICAgCQkgICAgdGhpcy5wb3NpdGlvbiArPSBsZW4taTsKICAgIAkJICB9IGVsc2UgaWYgKGkgIT0gYmxlbikgewogICAgCQkgICAgdGhpcy5wb3NpdGlvbiArPSAxOyAvLyB0cmFpbGluZyB6ZXJvIGlmIG5vdCBhdCBlbmQgb2YgYnVmZmVyCiAgICAJCSAgfQogICAgCQkgIHJldHVybiBzOwogICAgCQl9OwoKICAgIAkJLyogCiAgICAJCSAgIFRPRE86IGZpeCBlbmRpYW5uZXNzIGZvciAyNC82NC1iaXQgZmllbGRzCiAgICAJCSAgIFRPRE86IGNoZWNrIHJhbmdlL3N1cHBvcnQgZm9yIDY0LWJpdHMgbnVtYmVycyBpbiBKYXZhU2NyaXB0CiAgICAJCSovCiAgICAJCXZhciBNQVhfU0laRSA9IE1hdGgucG93KDIsIDMyKTsKCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLnJlYWRJbnQ2NCA9IGZ1bmN0aW9uICgpIHsKICAgIAkJICByZXR1cm4gKHRoaXMucmVhZEludDMyKCkqTUFYX1NJWkUpK3RoaXMucmVhZFVpbnQzMigpOwogICAgCQl9OwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkVWludDY0ID0gZnVuY3Rpb24gKCkgewogICAgCQkJcmV0dXJuICh0aGlzLnJlYWRVaW50MzIoKSpNQVhfU0laRSkrdGhpcy5yZWFkVWludDMyKCk7CiAgICAJCX07CgogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkSW50NjQgPSBmdW5jdGlvbiAoKSB7CiAgICAJCSAgcmV0dXJuICh0aGlzLnJlYWRVaW50MzIoKSpNQVhfU0laRSkrdGhpcy5yZWFkVWludDMyKCk7CiAgICAJCX07CgogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5yZWFkVWludDI0ID0gZnVuY3Rpb24gKCkgewogICAgCQkJcmV0dXJuICh0aGlzLnJlYWRVaW50OCgpPDwxNikrKHRoaXMucmVhZFVpbnQ4KCk8PDgpK3RoaXMucmVhZFVpbnQ4KCk7CiAgICAJCX07CgogICAgCQl7CiAgICAJCSAgZXhwb3J0cy5EYXRhU3RyZWFtID0gRGF0YVN0cmVhbTsgIAogICAgCQl9CiAgICAJCS8vIGZpbGU6c3JjL0RhdGFTdHJlYW0td3JpdGUuanMKICAgIAkJLyoqCiAgICAJCSAgU2F2ZXMgdGhlIERhdGFTdHJlYW0gY29udGVudHMgdG8gdGhlIGdpdmVuIGZpbGVuYW1lLgogICAgCQkgIFVzZXMgQ2hyb21lJ3MgYW5jaG9yIGRvd25sb2FkIHByb3BlcnR5IHRvIGluaXRpYXRlIGRvd25sb2FkLgogICAgCQkgCiAgICAJCSAgQHBhcmFtIHtzdHJpbmd9IGZpbGVuYW1lIEZpbGVuYW1lIHRvIHNhdmUgYXMuCiAgICAJCSAgQHJldHVybiB7bnVsbH0KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24oZmlsZW5hbWUpIHsKICAgIAkJICB2YXIgYmxvYiA9IG5ldyBCbG9iKFt0aGlzLmJ1ZmZlcl0pOwogICAgCQkgIGlmICh3aW5kb3cuVVJMICYmIFVSTC5jcmVhdGVPYmplY3RVUkwpIHsKICAgIAkJICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgCQkgICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgIAkJICAgICAgLy8gUmVxdWlyZWQgaW4gRmlyZWZveDoKICAgIAkJICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgIAkJICAgICAgYS5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmwpOwogICAgCQkgICAgICBhLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBmaWxlbmFtZSk7CiAgICAJCSAgICAgIC8vIFJlcXVpcmVkIGluIEZpcmVmb3g6CiAgICAJCSAgICAgIGEuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCAnX3NlbGYnKTsKICAgIAkJICAgICAgYS5jbGljaygpOwogICAgCQkgICAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICAgIHRocm93KCJEYXRhU3RyZWFtLnNhdmU6IENhbid0IGNyZWF0ZSBvYmplY3QgVVJMLiIpOwogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdoZXRoZXIgdG8gZXh0ZW5kIERhdGFTdHJlYW0gYnVmZmVyIHdoZW4gdHJ5aW5nIHRvIHdyaXRlIGJleW9uZCBpdHMgc2l6ZS4KICAgIAkJICBJZiBzZXQsIHRoZSBidWZmZXIgaXMgcmVhbGxvY2F0ZWQgdG8gdHdpY2UgaXRzIGN1cnJlbnQgc2l6ZSB1bnRpbCB0aGUKICAgIAkJICByZXF1ZXN0ZWQgd3JpdGUgZml0cyB0aGUgYnVmZmVyLgogICAgCQkgIEB0eXBlIHtib29sZWFufQogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLl9keW5hbWljU2l6ZSA9IHRydWU7CiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEYXRhU3RyZWFtLnByb3RvdHlwZSwgJ2R5bmFtaWNTaXplJywKICAgIAkJICB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAJCSAgICAgIHJldHVybiB0aGlzLl9keW5hbWljU2l6ZTsKICAgIAkJICAgIH0sCiAgICAJCSAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsKICAgIAkJICAgICAgaWYgKCF2KSB7CiAgICAJCSAgICAgICAgdGhpcy5fdHJpbUFsbG9jKCk7CiAgICAJCSAgICAgIH0KICAgIAkJICAgICAgdGhpcy5fZHluYW1pY1NpemUgPSB2OwogICAgCQkgICAgfSB9KTsKCiAgICAJCS8qKgogICAgCQkgIEludGVybmFsIGZ1bmN0aW9uIHRvIHRyaW0gdGhlIERhdGFTdHJlYW0gYnVmZmVyIHdoZW4gcmVxdWlyZWQuCiAgICAJCSAgVXNlZCBmb3Igc3RyaXBwaW5nIG91dCB0aGUgZmlyc3QgYnl0ZXMgd2hlbiBub3QgbmVlZGVkIGFueW1vcmUuCgogICAgCQkgIEByZXR1cm4ge251bGx9CiAgICAJCSAgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUuc2hpZnQgPSBmdW5jdGlvbihvZmZzZXQpIHsKICAgIAkJICB2YXIgYnVmID0gbmV3IEFycmF5QnVmZmVyKHRoaXMuX2J5dGVMZW5ndGgtb2Zmc2V0KTsKICAgIAkJICB2YXIgZHN0ID0gbmV3IFVpbnQ4QXJyYXkoYnVmKTsKICAgIAkJICB2YXIgc3JjID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fYnVmZmVyLCBvZmZzZXQsIGRzdC5sZW5ndGgpOwogICAgCQkgIGRzdC5zZXQoc3JjKTsKICAgIAkJICB0aGlzLmJ1ZmZlciA9IGJ1ZjsKICAgIAkJICB0aGlzLnBvc2l0aW9uIC09IG9mZnNldDsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhbiBJbnQzMkFycmF5IG9mIHNwZWNpZmllZCBlbmRpYW5uZXNzIHRvIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gYXJyIFRoZSBhcnJheSB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gd3JpdGUuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS53cml0ZUludDMyQXJyYXkgPSBmdW5jdGlvbihhcnIsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKGFyci5sZW5ndGggKiA0KTsKICAgIAkJICBpZiAoYXJyIGluc3RhbmNlb2YgSW50MzJBcnJheSAmJgogICAgCQkgICAgICB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiAlIGFyci5CWVRFU19QRVJfRUxFTUVOVCA9PT0gMCkgewogICAgCQkgICAgRGF0YVN0cmVhbS5tZW1jcHkodGhpcy5fYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIGFyci5idWZmZXIsIDAsCiAgICAJCSAgICAgICAgICAgICAgICAgICAgICBhcnIuYnl0ZUxlbmd0aCk7CiAgICAJCSAgICB0aGlzLm1hcEludDMyQXJyYXkoYXJyLmxlbmd0aCwgZSk7CiAgICAJCSAgfSBlbHNlIHsKICAgIAkJICAgIGZvciAodmFyIGk9MDsgaTxhcnIubGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgdGhpcy53cml0ZUludDMyKGFycltpXSwgZSk7CiAgICAJCSAgICB9CiAgICAJCSAgfQogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgV3JpdGVzIGFuIEludDE2QXJyYXkgb2Ygc3BlY2lmaWVkIGVuZGlhbm5lc3MgdG8gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7T2JqZWN0fSBhcnIgVGhlIGFycmF5IHRvIHdyaXRlLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgZGF0YSB0byB3cml0ZS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlSW50MTZBcnJheSA9IGZ1bmN0aW9uKGFyciwgZSkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MoYXJyLmxlbmd0aCAqIDIpOwogICAgCQkgIGlmIChhcnIgaW5zdGFuY2VvZiBJbnQxNkFycmF5ICYmCiAgICAJCSAgICAgIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uICUgYXJyLkJZVEVTX1BFUl9FTEVNRU5UID09PSAwKSB7CiAgICAJCSAgICBEYXRhU3RyZWFtLm1lbWNweSh0aGlzLl9idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLAogICAgCQkgICAgICAgICAgICAgICAgICAgICAgYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIGFyci5ieXRlTGVuZ3RoKTsKICAgIAkJICAgIHRoaXMubWFwSW50MTZBcnJheShhcnIubGVuZ3RoLCBlKTsKICAgIAkJICB9IGVsc2UgewogICAgCQkgICAgZm9yICh2YXIgaT0wOyBpPGFyci5sZW5ndGg7IGkrKykgewogICAgCQkgICAgICB0aGlzLndyaXRlSW50MTYoYXJyW2ldLCBlKTsKICAgIAkJICAgIH0KICAgIAkJICB9CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBXcml0ZXMgYW4gSW50OEFycmF5IHRvIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gYXJyIFRoZSBhcnJheSB0byB3cml0ZS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlSW50OEFycmF5ID0gZnVuY3Rpb24oYXJyKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyhhcnIubGVuZ3RoICogMSk7CiAgICAJCSAgaWYgKGFyciBpbnN0YW5jZW9mIEludDhBcnJheSAmJgogICAgCQkgICAgICB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiAlIGFyci5CWVRFU19QRVJfRUxFTUVOVCA9PT0gMCkgewogICAgCQkgICAgRGF0YVN0cmVhbS5tZW1jcHkodGhpcy5fYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIGFyci5idWZmZXIsIDAsCiAgICAJCSAgICAgICAgICAgICAgICAgICAgICBhcnIuYnl0ZUxlbmd0aCk7CiAgICAJCSAgICB0aGlzLm1hcEludDhBcnJheShhcnIubGVuZ3RoKTsKICAgIAkJICB9IGVsc2UgewogICAgCQkgICAgZm9yICh2YXIgaT0wOyBpPGFyci5sZW5ndGg7IGkrKykgewogICAgCQkgICAgICB0aGlzLndyaXRlSW50OChhcnJbaV0pOwogICAgCQkgICAgfQogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIFVpbnQzMkFycmF5IG9mIHNwZWNpZmllZCBlbmRpYW5uZXNzIHRvIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gYXJyIFRoZSBhcnJheSB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gd3JpdGUuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS53cml0ZVVpbnQzMkFycmF5ID0gZnVuY3Rpb24oYXJyLCBlKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyhhcnIubGVuZ3RoICogNCk7CiAgICAJCSAgaWYgKGFyciBpbnN0YW5jZW9mIFVpbnQzMkFycmF5ICYmCiAgICAJCSAgICAgIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uICUgYXJyLkJZVEVTX1BFUl9FTEVNRU5UID09PSAwKSB7CiAgICAJCSAgICBEYXRhU3RyZWFtLm1lbWNweSh0aGlzLl9idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLAogICAgCQkgICAgICAgICAgICAgICAgICAgICAgYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIGFyci5ieXRlTGVuZ3RoKTsKICAgIAkJICAgIHRoaXMubWFwVWludDMyQXJyYXkoYXJyLmxlbmd0aCwgZSk7CiAgICAJCSAgfSBlbHNlIHsKICAgIAkJICAgIGZvciAodmFyIGk9MDsgaTxhcnIubGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgdGhpcy53cml0ZVVpbnQzMihhcnJbaV0sIGUpOwogICAgCQkgICAgfQogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIFVpbnQxNkFycmF5IG9mIHNwZWNpZmllZCBlbmRpYW5uZXNzIHRvIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gYXJyIFRoZSBhcnJheSB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gd3JpdGUuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS53cml0ZVVpbnQxNkFycmF5ID0gZnVuY3Rpb24oYXJyLCBlKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyhhcnIubGVuZ3RoICogMik7CiAgICAJCSAgaWYgKGFyciBpbnN0YW5jZW9mIFVpbnQxNkFycmF5ICYmCiAgICAJCSAgICAgIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uICUgYXJyLkJZVEVTX1BFUl9FTEVNRU5UID09PSAwKSB7CiAgICAJCSAgICBEYXRhU3RyZWFtLm1lbWNweSh0aGlzLl9idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLAogICAgCQkgICAgICAgICAgICAgICAgICAgICAgYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIGFyci5ieXRlTGVuZ3RoKTsKICAgIAkJICAgIHRoaXMubWFwVWludDE2QXJyYXkoYXJyLmxlbmd0aCwgZSk7CiAgICAJCSAgfSBlbHNlIHsKICAgIAkJICAgIGZvciAodmFyIGk9MDsgaTxhcnIubGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgdGhpcy53cml0ZVVpbnQxNihhcnJbaV0sIGUpOwogICAgCQkgICAgfQogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIFVpbnQ4QXJyYXkgdG8gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7T2JqZWN0fSBhcnIgVGhlIGFycmF5IHRvIHdyaXRlLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVVaW50OEFycmF5ID0gZnVuY3Rpb24oYXJyKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyhhcnIubGVuZ3RoICogMSk7CiAgICAJCSAgaWYgKGFyciBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgJiYKICAgIAkJICAgICAgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24gJSBhcnIuQllURVNfUEVSX0VMRU1FTlQgPT09IDApIHsKICAgIAkJICAgIERhdGFTdHJlYW0ubWVtY3B5KHRoaXMuX2J1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sCiAgICAJCSAgICAgICAgICAgICAgICAgICAgICBhcnIuYnVmZmVyLCAwLAogICAgCQkgICAgICAgICAgICAgICAgICAgICAgYXJyLmJ5dGVMZW5ndGgpOwogICAgCQkgICAgdGhpcy5tYXBVaW50OEFycmF5KGFyci5sZW5ndGgpOwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICBmb3IgKHZhciBpPTA7IGk8YXJyLmxlbmd0aDsgaSsrKSB7CiAgICAJCSAgICAgIHRoaXMud3JpdGVVaW50OChhcnJbaV0pOwogICAgCQkgICAgfQogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIEZsb2F0NjRBcnJheSBvZiBzcGVjaWZpZWQgZW5kaWFubmVzcyB0byB0aGUgRGF0YVN0cmVhbS4KCiAgICAJCSAgQHBhcmFtIHtPYmplY3R9IGFyciBUaGUgYXJyYXkgdG8gd3JpdGUuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBkYXRhIHRvIHdyaXRlLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVGbG9hdDY0QXJyYXkgPSBmdW5jdGlvbihhcnIsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKGFyci5sZW5ndGggKiA4KTsKICAgIAkJICBpZiAoYXJyIGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5ICYmCiAgICAJCSAgICAgIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uICUgYXJyLkJZVEVTX1BFUl9FTEVNRU5UID09PSAwKSB7CiAgICAJCSAgICBEYXRhU3RyZWFtLm1lbWNweSh0aGlzLl9idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLAogICAgCQkgICAgICAgICAgICAgICAgICAgICAgYXJyLmJ1ZmZlciwgMCwKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIGFyci5ieXRlTGVuZ3RoKTsKICAgIAkJICAgIHRoaXMubWFwRmxvYXQ2NEFycmF5KGFyci5sZW5ndGgsIGUpOwogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICBmb3IgKHZhciBpPTA7IGk8YXJyLmxlbmd0aDsgaSsrKSB7CiAgICAJCSAgICAgIHRoaXMud3JpdGVGbG9hdDY0KGFycltpXSwgZSk7CiAgICAJCSAgICB9CiAgICAJCSAgfQogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgV3JpdGVzIGEgRmxvYXQzMkFycmF5IG9mIHNwZWNpZmllZCBlbmRpYW5uZXNzIHRvIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gYXJyIFRoZSBhcnJheSB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gd3JpdGUuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS53cml0ZUZsb2F0MzJBcnJheSA9IGZ1bmN0aW9uKGFyciwgZSkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MoYXJyLmxlbmd0aCAqIDQpOwogICAgCQkgIGlmIChhcnIgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgJiYKICAgIAkJICAgICAgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24gJSBhcnIuQllURVNfUEVSX0VMRU1FTlQgPT09IDApIHsKICAgIAkJICAgIERhdGFTdHJlYW0ubWVtY3B5KHRoaXMuX2J1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sCiAgICAJCSAgICAgICAgICAgICAgICAgICAgICBhcnIuYnVmZmVyLCAwLAogICAgCQkgICAgICAgICAgICAgICAgICAgICAgYXJyLmJ5dGVMZW5ndGgpOwogICAgCQkgICAgdGhpcy5tYXBGbG9hdDMyQXJyYXkoYXJyLmxlbmd0aCwgZSk7CiAgICAJCSAgfSBlbHNlIHsKICAgIAkJICAgIGZvciAodmFyIGk9MDsgaTxhcnIubGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgdGhpcy53cml0ZUZsb2F0MzIoYXJyW2ldLCBlKTsKICAgIAkJICAgIH0KICAgIAkJICB9CiAgICAJCX07CgoKICAgIAkJLyoqCiAgICAJCSAgV3JpdGVzIGEgMzItYml0IGludCB0byB0aGUgRGF0YVN0cmVhbSB3aXRoIHRoZSBkZXNpcmVkIGVuZGlhbm5lc3MuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSB2IE51bWJlciB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlSW50MzIgPSBmdW5jdGlvbih2LCBlKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyg0KTsKICAgIAkJICB0aGlzLl9kYXRhVmlldy5zZXRJbnQzMih0aGlzLnBvc2l0aW9uLCB2LCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IDQ7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBXcml0ZXMgYSAxNi1iaXQgaW50IHRvIHRoZSBEYXRhU3RyZWFtIHdpdGggdGhlIGRlc2lyZWQgZW5kaWFubmVzcy4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IHYgTnVtYmVyIHRvIHdyaXRlLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgbnVtYmVyLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVJbnQxNiA9IGZ1bmN0aW9uKHYsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKDIpOwogICAgCQkgIHRoaXMuX2RhdGFWaWV3LnNldEludDE2KHRoaXMucG9zaXRpb24sIHYsIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gMjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhbiA4LWJpdCBpbnQgdG8gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSB2IE51bWJlciB0byB3cml0ZS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uKHYpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKDEpOwogICAgCQkgIHRoaXMuX2RhdGFWaWV3LnNldEludDgodGhpcy5wb3NpdGlvbiwgdik7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSAxOwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgV3JpdGVzIGEgMzItYml0IHVuc2lnbmVkIGludCB0byB0aGUgRGF0YVN0cmVhbSB3aXRoIHRoZSBkZXNpcmVkIGVuZGlhbm5lc3MuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSB2IE51bWJlciB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlVWludDMyID0gZnVuY3Rpb24odiwgZSkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MoNCk7CiAgICAJCSAgdGhpcy5fZGF0YVZpZXcuc2V0VWludDMyKHRoaXMucG9zaXRpb24sIHYsIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gNDsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIDE2LWJpdCB1bnNpZ25lZCBpbnQgdG8gdGhlIERhdGFTdHJlYW0gd2l0aCB0aGUgZGVzaXJlZCBlbmRpYW5uZXNzLgoKICAgIAkJICBAcGFyYW0ge251bWJlcn0gdiBOdW1iZXIgdG8gd3JpdGUuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBudW1iZXIuCiAgICAJCSAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS53cml0ZVVpbnQxNiA9IGZ1bmN0aW9uKHYsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKDIpOwogICAgCQkgIHRoaXMuX2RhdGFWaWV3LnNldFVpbnQxNih0aGlzLnBvc2l0aW9uLCB2LCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IDI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBXcml0ZXMgYW4gOC1iaXQgdW5zaWduZWQgIGludCB0byB0aGUgRGF0YVN0cmVhbS4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IHYgTnVtYmVyIHRvIHdyaXRlLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVVaW50OCA9IGZ1bmN0aW9uKHYpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKDEpOwogICAgCQkgIHRoaXMuX2RhdGFWaWV3LnNldFVpbnQ4KHRoaXMucG9zaXRpb24sIHYpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gMTsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIDMyLWJpdCBmbG9hdCB0byB0aGUgRGF0YVN0cmVhbSB3aXRoIHRoZSBkZXNpcmVkIGVuZGlhbm5lc3MuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSB2IE51bWJlciB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIG51bWJlci4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlRmxvYXQzMiA9IGZ1bmN0aW9uKHYsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKDQpOwogICAgCQkgIHRoaXMuX2RhdGFWaWV3LnNldEZsb2F0MzIodGhpcy5wb3NpdGlvbiwgdiwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSA0OwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgV3JpdGVzIGEgNjQtYml0IGZsb2F0IHRvIHRoZSBEYXRhU3RyZWFtIHdpdGggdGhlIGRlc2lyZWQgZW5kaWFubmVzcy4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IHYgTnVtYmVyIHRvIHdyaXRlLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgbnVtYmVyLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVGbG9hdDY0ID0gZnVuY3Rpb24odiwgZSkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MoOCk7CiAgICAJCSAgdGhpcy5fZGF0YVZpZXcuc2V0RmxvYXQ2NCh0aGlzLnBvc2l0aW9uLCB2LCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IDg7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBXcml0ZSBhIFVDUy0yIHN0cmluZyBvZiBkZXNpcmVkIGVuZGlhbm5lc3MgdG8gdGhlIERhdGFTdHJlYW0uIFRoZQogICAgCQkgIGxlbmd0aE92ZXJyaWRlIGFyZ3VtZW50IGxldHMgeW91IGRlZmluZSB0aGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgdG8gd3JpdGUuCiAgICAJCSAgSWYgdGhlIHN0cmluZyBpcyBzaG9ydGVyIHRoYW4gbGVuZ3RoT3ZlcnJpZGUsIHRoZSBleHRyYSBzcGFjZSBpcyBwYWRkZWQgd2l0aAogICAgCQkgIHplcm9lcy4KCiAgICAJCSAgQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIHdyaXRlLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGVuZGlhbm5lc3MgVGhlIGVuZGlhbm5lc3MgdG8gdXNlIGZvciB0aGUgd3JpdHRlbiBzdHJpbmcgZGF0YS4KICAgIAkJICBAcGFyYW0gez9udW1iZXJ9IGxlbmd0aE92ZXJyaWRlIFRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyB0byB3cml0ZS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlVUNTMlN0cmluZyA9IGZ1bmN0aW9uKHN0ciwgZW5kaWFubmVzcywgbGVuZ3RoT3ZlcnJpZGUpIHsKICAgIAkJICBpZiAobGVuZ3RoT3ZlcnJpZGUgPT0gbnVsbCkgewogICAgCQkgICAgbGVuZ3RoT3ZlcnJpZGUgPSBzdHIubGVuZ3RoOwogICAgCQkgIH0KICAgIAkJICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGggJiYgaSA8IGxlbmd0aE92ZXJyaWRlOyBpKyspIHsKICAgIAkJICAgIHRoaXMud3JpdGVVaW50MTYoc3RyLmNoYXJDb2RlQXQoaSksIGVuZGlhbm5lc3MpOwogICAgCQkgIH0KICAgIAkJICBmb3IgKDsgaTxsZW5ndGhPdmVycmlkZTsgaSsrKSB7CiAgICAJCSAgICB0aGlzLndyaXRlVWludDE2KDApOwogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIHN0cmluZyBvZiBkZXNpcmVkIGxlbmd0aCBhbmQgZW5jb2RpbmcgdG8gdGhlIERhdGFTdHJlYW0uCgogICAgCQkgIEBwYXJhbSB7c3RyaW5nfSBzIFRoZSBzdHJpbmcgdG8gd3JpdGUuCiAgICAJCSAgQHBhcmFtIHs/c3RyaW5nfSBlbmNvZGluZyBUaGUgZW5jb2RpbmcgZm9yIHRoZSB3cml0dGVuIHN0cmluZyBkYXRhLgogICAgCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdHMgdG8gQVNDSUkuCiAgICAJCSAgQHBhcmFtIHs/bnVtYmVyfSBsZW5ndGggVGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRvIHdyaXRlLgogICAgCQkgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVTdHJpbmcgPSBmdW5jdGlvbihzLCBlbmNvZGluZywgbGVuZ3RoKSB7CiAgICAJCSAgdmFyIGkgPSAwOwogICAgCQkgIGlmIChlbmNvZGluZyA9PSBudWxsIHx8IGVuY29kaW5nID09ICJBU0NJSSIpIHsKICAgIAkJICAgIGlmIChsZW5ndGggIT0gbnVsbCkgewogICAgCQkgICAgICB2YXIgbGVuID0gTWF0aC5taW4ocy5sZW5ndGgsIGxlbmd0aCk7CiAgICAJCSAgICAgIGZvciAoaT0wOyBpPGxlbjsgaSsrKSB7CiAgICAJCSAgICAgICAgdGhpcy53cml0ZVVpbnQ4KHMuY2hhckNvZGVBdChpKSk7CiAgICAJCSAgICAgIH0KICAgIAkJICAgICAgZm9yICg7IGk8bGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgICB0aGlzLndyaXRlVWludDgoMCk7CiAgICAJCSAgICAgIH0KICAgIAkJICAgIH0gZWxzZSB7CiAgICAJCSAgICAgIGZvciAoaT0wOyBpPHMubGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgICB0aGlzLndyaXRlVWludDgocy5jaGFyQ29kZUF0KGkpKTsKICAgIAkJICAgICAgfQogICAgCQkgICAgfQogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICB0aGlzLndyaXRlVWludDhBcnJheSgobmV3IFRleHRFbmNvZGVyKGVuY29kaW5nKSkuZW5jb2RlKHMuc3Vic3RyaW5nKDAsIGxlbmd0aCkpKTsKICAgIAkJICB9CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBXcml0ZXMgYSBudWxsLXRlcm1pbmF0ZWQgc3RyaW5nIHRvIERhdGFTdHJlYW0gYW5kIHplcm8tcGFkcyBpdCB0byBsZW5ndGgKICAgIAkJICBieXRlcy4gSWYgbGVuZ3RoIGlzIG5vdCBnaXZlbiwgd3JpdGVzIHRoZSBzdHJpbmcgZm9sbG93ZWQgYnkgYSB6ZXJvLgogICAgCQkgIElmIHN0cmluZyBpcyBsb25nZXIgdGhhbiBsZW5ndGgsIHRoZSB3cml0dGVuIHBhcnQgb2YgdGhlIHN0cmluZyBkb2VzIG5vdCBoYXZlCiAgICAJCSAgYSB0cmFpbGluZyB6ZXJvLgoKICAgIAkJICBAcGFyYW0ge3N0cmluZ30gcyBUaGUgc3RyaW5nIHRvIHdyaXRlLgogICAgCQkgIEBwYXJhbSB7P251bWJlcn0gbGVuZ3RoIFRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyB0byB3cml0ZS4KICAgIAkJICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlQ1N0cmluZyA9IGZ1bmN0aW9uKHMsIGxlbmd0aCkgewogICAgCQkgIHZhciBpID0gMDsKICAgIAkJICBpZiAobGVuZ3RoICE9IG51bGwpIHsKICAgIAkJICAgIHZhciBsZW4gPSBNYXRoLm1pbihzLmxlbmd0aCwgbGVuZ3RoKTsKICAgIAkJICAgIGZvciAoaT0wOyBpPGxlbjsgaSsrKSB7CiAgICAJCSAgICAgIHRoaXMud3JpdGVVaW50OChzLmNoYXJDb2RlQXQoaSkpOwogICAgCQkgICAgfQogICAgCQkgICAgZm9yICg7IGk8bGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgdGhpcy53cml0ZVVpbnQ4KDApOwogICAgCQkgICAgfQogICAgCQkgIH0gZWxzZSB7CiAgICAJCSAgICBmb3IgKGk9MDsgaTxzLmxlbmd0aDsgaSsrKSB7CiAgICAJCSAgICAgIHRoaXMud3JpdGVVaW50OChzLmNoYXJDb2RlQXQoaSkpOwogICAgCQkgICAgfQogICAgCQkgICAgdGhpcy53cml0ZVVpbnQ4KDApOwogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIFdyaXRlcyBhIHN0cnVjdCB0byB0aGUgRGF0YVN0cmVhbS4gVGFrZXMgYSBzdHJ1Y3REZWZpbml0aW9uIHRoYXQgZ2l2ZXMgdGhlCiAgICAJCSAgdHlwZXMgYW5kIGEgc3RydWN0IG9iamVjdCB0aGF0IGdpdmVzIHRoZSB2YWx1ZXMuIFJlZmVyIHRvIHJlYWRTdHJ1Y3QgZm9yIHRoZQogICAgCQkgIHN0cnVjdHVyZSBvZiBzdHJ1Y3REZWZpbml0aW9uLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gc3RydWN0RGVmaW5pdGlvbiBUeXBlIGRlZmluaXRpb24gb2YgdGhlIHN0cnVjdC4KICAgIAkJICBAcGFyYW0ge09iamVjdH0gc3RydWN0IFRoZSBzdHJ1Y3QgZGF0YSBvYmplY3QuCiAgICAJCSAgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVTdHJ1Y3QgPSBmdW5jdGlvbihzdHJ1Y3REZWZpbml0aW9uLCBzdHJ1Y3QpIHsKICAgIAkJICBmb3IgKHZhciBpID0gMDsgaSA8IHN0cnVjdERlZmluaXRpb24ubGVuZ3RoOyBpKz0yKSB7CiAgICAJCSAgICB2YXIgdCA9IHN0cnVjdERlZmluaXRpb25baSsxXTsKICAgIAkJICAgIHRoaXMud3JpdGVUeXBlKHQsIHN0cnVjdFtzdHJ1Y3REZWZpbml0aW9uW2ldXSwgc3RydWN0KTsKICAgIAkJICB9CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBXcml0ZXMgb2JqZWN0IHYgb2YgdHlwZSB0IHRvIHRoZSBEYXRhU3RyZWFtLgoKICAgIAkJICBAcGFyYW0ge09iamVjdH0gdCBUeXBlIG9mIGRhdGEgdG8gd3JpdGUuCiAgICAJCSAgQHBhcmFtIHtPYmplY3R9IHYgVmFsdWUgb2YgZGF0YSB0byB3cml0ZS4KICAgIAkJICBAcGFyYW0ge09iamVjdH0gc3RydWN0IFN0cnVjdCB0byBwYXNzIHRvIHdyaXRlIGNhbGxiYWNrIGZ1bmN0aW9ucy4KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS53cml0ZVR5cGUgPSBmdW5jdGlvbih0LCB2LCBzdHJ1Y3QpIHsKICAgIAkJICB2YXIgdHA7CiAgICAJCSAgaWYgKHR5cGVvZiB0ID09ICJmdW5jdGlvbiIpIHsKICAgIAkJICAgIHJldHVybiB0KHRoaXMsIHYpOwogICAgCQkgIH0gZWxzZSBpZiAodHlwZW9mIHQgPT0gIm9iamVjdCIgJiYgISh0IGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAJCSAgICByZXR1cm4gdC5zZXQodGhpcywgdiwgc3RydWN0KTsKICAgIAkJICB9CiAgICAJCSAgdmFyIGxlbmd0aE92ZXJyaWRlID0gbnVsbDsKICAgIAkJICB2YXIgY2hhcnNldCA9ICJBU0NJSSI7CiAgICAJCSAgdmFyIHBvcyA9IHRoaXMucG9zaXRpb247CiAgICAJCSAgaWYgKHR5cGVvZih0KSA9PSAnc3RyaW5nJyAmJiAvOi8udGVzdCh0KSkgewogICAgCQkgICAgdHAgPSB0LnNwbGl0KCI6Iik7CiAgICAJCSAgICB0ID0gdHBbMF07CiAgICAJCSAgICBsZW5ndGhPdmVycmlkZSA9IHBhcnNlSW50KHRwWzFdKTsKICAgIAkJICB9CiAgICAJCSAgaWYgKHR5cGVvZiB0ID09ICdzdHJpbmcnICYmIC8sLy50ZXN0KHQpKSB7CiAgICAJCSAgICB0cCA9IHQuc3BsaXQoIiwiKTsKICAgIAkJICAgIHQgPSB0cFswXTsKICAgIAkJICAgIGNoYXJzZXQgPSBwYXJzZUludCh0cFsxXSk7CiAgICAJCSAgfQoKICAgIAkJICBzd2l0Y2godCkgewogICAgCQkgICAgY2FzZSAndWludDgnOgogICAgCQkgICAgICB0aGlzLndyaXRlVWludDgodik7CiAgICAJCSAgICAgIGJyZWFrOwogICAgCQkgICAgY2FzZSAnaW50OCc6CiAgICAJCSAgICAgIHRoaXMud3JpdGVJbnQ4KHYpOwogICAgCQkgICAgICBicmVhazsKCiAgICAJCSAgICBjYXNlICd1aW50MTYnOgogICAgCQkgICAgICB0aGlzLndyaXRlVWludDE2KHYsIHRoaXMuZW5kaWFubmVzcyk7CiAgICAJCSAgICAgIGJyZWFrOwogICAgCQkgICAgY2FzZSAnaW50MTYnOgogICAgCQkgICAgICB0aGlzLndyaXRlSW50MTYodiwgdGhpcy5lbmRpYW5uZXNzKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICd1aW50MzInOgogICAgCQkgICAgICB0aGlzLndyaXRlVWludDMyKHYsIHRoaXMuZW5kaWFubmVzcyk7CiAgICAJCSAgICAgIGJyZWFrOwogICAgCQkgICAgY2FzZSAnaW50MzInOgogICAgCQkgICAgICB0aGlzLndyaXRlSW50MzIodiwgdGhpcy5lbmRpYW5uZXNzKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICdmbG9hdDMyJzoKICAgIAkJICAgICAgdGhpcy53cml0ZUZsb2F0MzIodiwgdGhpcy5lbmRpYW5uZXNzKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICdmbG9hdDY0JzoKICAgIAkJICAgICAgdGhpcy53cml0ZUZsb2F0NjQodiwgdGhpcy5lbmRpYW5uZXNzKTsKICAgIAkJICAgICAgYnJlYWs7CgogICAgCQkgICAgY2FzZSAndWludDE2YmUnOgogICAgCQkgICAgICB0aGlzLndyaXRlVWludDE2KHYsIERhdGFTdHJlYW0uQklHX0VORElBTik7CiAgICAJCSAgICAgIGJyZWFrOwogICAgCQkgICAgY2FzZSAnaW50MTZiZSc6CiAgICAJCSAgICAgIHRoaXMud3JpdGVJbnQxNih2LCBEYXRhU3RyZWFtLkJJR19FTkRJQU4pOwogICAgCQkgICAgICBicmVhazsKICAgIAkJICAgIGNhc2UgJ3VpbnQzMmJlJzoKICAgIAkJICAgICAgdGhpcy53cml0ZVVpbnQzMih2LCBEYXRhU3RyZWFtLkJJR19FTkRJQU4pOwogICAgCQkgICAgICBicmVhazsKICAgIAkJICAgIGNhc2UgJ2ludDMyYmUnOgogICAgCQkgICAgICB0aGlzLndyaXRlSW50MzIodiwgRGF0YVN0cmVhbS5CSUdfRU5ESUFOKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICdmbG9hdDMyYmUnOgogICAgCQkgICAgICB0aGlzLndyaXRlRmxvYXQzMih2LCBEYXRhU3RyZWFtLkJJR19FTkRJQU4pOwogICAgCQkgICAgICBicmVhazsKICAgIAkJICAgIGNhc2UgJ2Zsb2F0NjRiZSc6CiAgICAJCSAgICAgIHRoaXMud3JpdGVGbG9hdDY0KHYsIERhdGFTdHJlYW0uQklHX0VORElBTik7CiAgICAJCSAgICAgIGJyZWFrOwoKICAgIAkJICAgIGNhc2UgJ3VpbnQxNmxlJzoKICAgIAkJICAgICAgdGhpcy53cml0ZVVpbnQxNih2LCBEYXRhU3RyZWFtLkxJVFRMRV9FTkRJQU4pOwogICAgCQkgICAgICBicmVhazsKICAgIAkJICAgIGNhc2UgJ2ludDE2bGUnOgogICAgCQkgICAgICB0aGlzLndyaXRlSW50MTYodiwgRGF0YVN0cmVhbS5MSVRUTEVfRU5ESUFOKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICd1aW50MzJsZSc6CiAgICAJCSAgICAgIHRoaXMud3JpdGVVaW50MzIodiwgRGF0YVN0cmVhbS5MSVRUTEVfRU5ESUFOKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICdpbnQzMmxlJzoKICAgIAkJICAgICAgdGhpcy53cml0ZUludDMyKHYsIERhdGFTdHJlYW0uTElUVExFX0VORElBTik7CiAgICAJCSAgICAgIGJyZWFrOwogICAgCQkgICAgY2FzZSAnZmxvYXQzMmxlJzoKICAgIAkJICAgICAgdGhpcy53cml0ZUZsb2F0MzIodiwgRGF0YVN0cmVhbS5MSVRUTEVfRU5ESUFOKTsKICAgIAkJICAgICAgYnJlYWs7CiAgICAJCSAgICBjYXNlICdmbG9hdDY0bGUnOgogICAgCQkgICAgICB0aGlzLndyaXRlRmxvYXQ2NCh2LCBEYXRhU3RyZWFtLkxJVFRMRV9FTkRJQU4pOwogICAgCQkgICAgICBicmVhazsKCiAgICAJCSAgICBjYXNlICdjc3RyaW5nJzoKICAgIAkJICAgICAgdGhpcy53cml0ZUNTdHJpbmcodiwgbGVuZ3RoT3ZlcnJpZGUpOwogICAgCQkgICAgICBicmVhazsKCiAgICAJCSAgICBjYXNlICdzdHJpbmcnOgogICAgCQkgICAgICB0aGlzLndyaXRlU3RyaW5nKHYsIGNoYXJzZXQsIGxlbmd0aE92ZXJyaWRlKTsKICAgIAkJICAgICAgYnJlYWs7CgogICAgCQkgICAgY2FzZSAndTE2c3RyaW5nJzoKICAgIAkJICAgICAgdGhpcy53cml0ZVVDUzJTdHJpbmcodiwgdGhpcy5lbmRpYW5uZXNzLCBsZW5ndGhPdmVycmlkZSk7CiAgICAJCSAgICAgIGJyZWFrOwoKICAgIAkJICAgIGNhc2UgJ3UxNnN0cmluZ2xlJzoKICAgIAkJICAgICAgdGhpcy53cml0ZVVDUzJTdHJpbmcodiwgRGF0YVN0cmVhbS5MSVRUTEVfRU5ESUFOLCBsZW5ndGhPdmVycmlkZSk7CiAgICAJCSAgICAgIGJyZWFrOwoKICAgIAkJICAgIGNhc2UgJ3UxNnN0cmluZ2JlJzoKICAgIAkJICAgICAgdGhpcy53cml0ZVVDUzJTdHJpbmcodiwgRGF0YVN0cmVhbS5CSUdfRU5ESUFOLCBsZW5ndGhPdmVycmlkZSk7CiAgICAJCSAgICAgIGJyZWFrOwoKICAgIAkJICAgIGRlZmF1bHQ6CiAgICAJCSAgICAgIGlmICh0Lmxlbmd0aCA9PSAzKSB7CiAgICAJCSAgICAgICAgdmFyIHRhID0gdFsxXTsKICAgIAkJICAgICAgICBmb3IgKHZhciBpPTA7IGk8di5sZW5ndGg7IGkrKykgewogICAgCQkgICAgICAgICAgdGhpcy53cml0ZVR5cGUodGEsIHZbaV0pOwogICAgCQkgICAgICAgIH0KICAgIAkJICAgICAgICBicmVhazsKICAgIAkJICAgICAgfSBlbHNlIHsKICAgIAkJICAgICAgICB0aGlzLndyaXRlU3RydWN0KHQsIHYpOwogICAgCQkgICAgICAgIGJyZWFrOwogICAgCQkgICAgICB9CiAgICAJCSAgfQogICAgCQkgIGlmIChsZW5ndGhPdmVycmlkZSAhPSBudWxsKSB7CiAgICAJCSAgICB0aGlzLnBvc2l0aW9uID0gcG9zOwogICAgCQkgICAgdGhpcy5fcmVhbGxvYyhsZW5ndGhPdmVycmlkZSk7CiAgICAJCSAgICB0aGlzLnBvc2l0aW9uID0gcG9zICsgbGVuZ3RoT3ZlcnJpZGU7CiAgICAJCSAgfQogICAgCQl9OwoKCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLndyaXRlVWludDY0ID0gZnVuY3Rpb24gKHYpIHsKICAgIAkJCXZhciBoID0gTWF0aC5mbG9vcih2IC8gTUFYX1NJWkUpOwogICAgCQkJdGhpcy53cml0ZVVpbnQzMihoKTsKICAgIAkJCXRoaXMud3JpdGVVaW50MzIodiAmIDB4RkZGRkZGRkYpOwogICAgCQl9OwoKICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUud3JpdGVVaW50MjQgPSBmdW5jdGlvbiAodikgewogICAgCQkJdGhpcy53cml0ZVVpbnQ4KCh2ICYgMHgwMEZGMDAwMCk+PjE2KTsKICAgIAkJCXRoaXMud3JpdGVVaW50OCgodiAmIDB4MDAwMEZGMDApPj44KTsKICAgIAkJCXRoaXMud3JpdGVVaW50OCgodiAmIDB4MDAwMDAwRkYpKTsKICAgIAkJfTsKCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLmFkanVzdFVpbnQzMiA9IGZ1bmN0aW9uKHBvc2l0aW9uLCB2YWx1ZSkgewogICAgCQkJdmFyIHBvcyA9IHRoaXMucG9zaXRpb247CiAgICAJCQl0aGlzLnNlZWsocG9zaXRpb24pOwogICAgCQkJdGhpcy53cml0ZVVpbnQzMih2YWx1ZSk7CiAgICAJCQl0aGlzLnNlZWsocG9zKTsKICAgIAkJfTsKICAgIAkJLy8gZmlsZTpzcmMvRGF0YVN0cmVhbS1tYXAuanMKICAgIAkJLyoqCiAgICAJCSAgTWFwcyBhbiBJbnQzMkFycmF5IGludG8gdGhlIERhdGFTdHJlYW0gYnVmZmVyLCBzd2l6emxpbmcgaXQgdG8gbmF0aXZlCiAgICAJCSAgZW5kaWFubmVzcyBpbi1wbGFjZS4gVGhlIGN1cnJlbnQgb2Zmc2V0IGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBidWZmZXIgbmVlZHMgdG8KICAgIAkJICBiZSBhIG11bHRpcGxlIG9mIGVsZW1lbnQgc2l6ZSwganVzdCBsaWtlIHdpdGggdHlwZWQgYXJyYXkgdmlld3MuCgogICAgCQkgIE5pY2UgZm9yIHF1aWNrbHkgcmVhZGluZyBpbiBkYXRhLiBXYXJuaW5nOiBwb3RlbnRpYWxseSBtb2RpZmllcyB0aGUgYnVmZmVyCiAgICAJCSAgY29udGVudHMuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IEludDMyQXJyYXkgdG8gdGhlIERhdGFTdHJlYW0gYmFja2luZyBidWZmZXIuCiAgICAJCSAgKi8KICAgIAkJRGF0YVN0cmVhbS5wcm90b3R5cGUubWFwSW50MzJBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCwgZSkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MobGVuZ3RoICogNCk7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBJbnQzMkFycmF5KHRoaXMuX2J1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sIGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5hcnJheVRvTmF0aXZlKGFyciwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBsZW5ndGggKiA0OwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBNYXBzIGFuIEludDE2QXJyYXkgaW50byB0aGUgRGF0YVN0cmVhbSBidWZmZXIsIHN3aXp6bGluZyBpdCB0byBuYXRpdmUKICAgIAkJICBlbmRpYW5uZXNzIGluLXBsYWNlLiBUaGUgY3VycmVudCBvZmZzZXQgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIGJ1ZmZlciBuZWVkcyB0bwogICAgCQkgIGJlIGEgbXVsdGlwbGUgb2YgZWxlbWVudCBzaXplLCBqdXN0IGxpa2Ugd2l0aCB0eXBlZCBhcnJheSB2aWV3cy4KCiAgICAJCSAgTmljZSBmb3IgcXVpY2tseSByZWFkaW5nIGluIGRhdGEuIFdhcm5pbmc6IHBvdGVudGlhbGx5IG1vZGlmaWVzIHRoZSBidWZmZXIKICAgIAkJICBjb250ZW50cy4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gbWFwLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgZGF0YSB0byByZWFkLgogICAgCQkgIEByZXR1cm4ge09iamVjdH0gSW50MTZBcnJheSB0byB0aGUgRGF0YVN0cmVhbSBiYWNraW5nIGJ1ZmZlci4KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5tYXBJbnQxNkFycmF5ID0gZnVuY3Rpb24obGVuZ3RoLCBlKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyhsZW5ndGggKiAyKTsKICAgIAkJICB2YXIgYXJyID0gbmV3IEludDE2QXJyYXkodGhpcy5fYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwgbGVuZ3RoKTsKICAgIAkJICBEYXRhU3RyZWFtLmFycmF5VG9OYXRpdmUoYXJyLCBlID09IG51bGwgPyB0aGlzLmVuZGlhbm5lc3MgOiBlKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IGxlbmd0aCAqIDI7CiAgICAJCSAgcmV0dXJuIGFycjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIE1hcHMgYW4gSW50OEFycmF5IGludG8gdGhlIERhdGFTdHJlYW0gYnVmZmVyLgoKICAgIAkJICBOaWNlIGZvciBxdWlja2x5IHJlYWRpbmcgaW4gZGF0YS4KCiAgICAJCSAgQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gbWFwLgogICAgCQkgIEBwYXJhbSB7P2Jvb2xlYW59IGUgRW5kaWFubmVzcyBvZiB0aGUgZGF0YSB0byByZWFkLgogICAgCQkgIEByZXR1cm4ge09iamVjdH0gSW50OEFycmF5IHRvIHRoZSBEYXRhU3RyZWFtIGJhY2tpbmcgYnVmZmVyLgogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLm1hcEludDhBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MobGVuZ3RoICogMSk7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBJbnQ4QXJyYXkodGhpcy5fYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQrdGhpcy5wb3NpdGlvbiwgbGVuZ3RoKTsKICAgIAkJICB0aGlzLnBvc2l0aW9uICs9IGxlbmd0aCAqIDE7CiAgICAJCSAgcmV0dXJuIGFycjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgIE1hcHMgYSBVaW50MzJBcnJheSBpbnRvIHRoZSBEYXRhU3RyZWFtIGJ1ZmZlciwgc3dpenpsaW5nIGl0IHRvIG5hdGl2ZQogICAgCQkgIGVuZGlhbm5lc3MgaW4tcGxhY2UuIFRoZSBjdXJyZW50IG9mZnNldCBmcm9tIHRoZSBzdGFydCBvZiB0aGUgYnVmZmVyIG5lZWRzIHRvCiAgICAJCSAgYmUgYSBtdWx0aXBsZSBvZiBlbGVtZW50IHNpemUsIGp1c3QgbGlrZSB3aXRoIHR5cGVkIGFycmF5IHZpZXdzLgoKICAgIAkJICBOaWNlIGZvciBxdWlja2x5IHJlYWRpbmcgaW4gZGF0YS4gV2FybmluZzogcG90ZW50aWFsbHkgbW9kaWZpZXMgdGhlIGJ1ZmZlcgogICAgCQkgIGNvbnRlbnRzLgoKICAgIAkJICBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIE51bWJlciBvZiBlbGVtZW50cyB0byBtYXAuCiAgICAJCSAgQHBhcmFtIHs/Ym9vbGVhbn0gZSBFbmRpYW5uZXNzIG9mIHRoZSBkYXRhIHRvIHJlYWQuCiAgICAJCSAgQHJldHVybiB7T2JqZWN0fSBVaW50MzJBcnJheSB0byB0aGUgRGF0YVN0cmVhbSBiYWNraW5nIGJ1ZmZlci4KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5tYXBVaW50MzJBcnJheSA9IGZ1bmN0aW9uKGxlbmd0aCwgZSkgewogICAgCQkgIHRoaXMuX3JlYWxsb2MobGVuZ3RoICogNCk7CiAgICAJCSAgdmFyIGFyciA9IG5ldyBVaW50MzJBcnJheSh0aGlzLl9idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCt0aGlzLnBvc2l0aW9uLCBsZW5ndGgpOwogICAgCQkgIERhdGFTdHJlYW0uYXJyYXlUb05hdGl2ZShhcnIsIGUgPT0gbnVsbCA/IHRoaXMuZW5kaWFubmVzcyA6IGUpOwogICAgCQkgIHRoaXMucG9zaXRpb24gKz0gbGVuZ3RoICogNDsKICAgIAkJICByZXR1cm4gYXJyOwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAgTWFwcyBhIFVpbnQxNkFycmF5IGludG8gdGhlIERhdGFTdHJlYW0gYnVmZmVyLCBzd2l6emxpbmcgaXQgdG8gbmF0aXZlCiAgICAJCSAgZW5kaWFubmVzcyBpbi1wbGFjZS4gVGhlIGN1cnJlbnQgb2Zmc2V0IGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBidWZmZXIgbmVlZHMgdG8KICAgIAkJICBiZSBhIG11bHRpcGxlIG9mIGVsZW1lbnQgc2l6ZSwganVzdCBsaWtlIHdpdGggdHlwZWQgYXJyYXkgdmlld3MuCgogICAgCQkgIE5pY2UgZm9yIHF1aWNrbHkgcmVhZGluZyBpbiBkYXRhLiBXYXJuaW5nOiBwb3RlbnRpYWxseSBtb2RpZmllcyB0aGUgYnVmZmVyCiAgICAJCSAgY29udGVudHMuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IFVpbnQxNkFycmF5IHRvIHRoZSBEYXRhU3RyZWFtIGJhY2tpbmcgYnVmZmVyLgogICAgCQkgICovCiAgICAJCURhdGFTdHJlYW0ucHJvdG90eXBlLm1hcFVpbnQxNkFycmF5ID0gZnVuY3Rpb24obGVuZ3RoLCBlKSB7CiAgICAJCSAgdGhpcy5fcmVhbGxvYyhsZW5ndGggKiAyKTsKICAgIAkJICB2YXIgYXJyID0gbmV3IFVpbnQxNkFycmF5KHRoaXMuX2J1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sIGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5hcnJheVRvTmF0aXZlKGFyciwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBsZW5ndGggKiAyOwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBNYXBzIGEgRmxvYXQ2NEFycmF5IGludG8gdGhlIERhdGFTdHJlYW0gYnVmZmVyLCBzd2l6emxpbmcgaXQgdG8gbmF0aXZlCiAgICAJCSAgZW5kaWFubmVzcyBpbi1wbGFjZS4gVGhlIGN1cnJlbnQgb2Zmc2V0IGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBidWZmZXIgbmVlZHMgdG8KICAgIAkJICBiZSBhIG11bHRpcGxlIG9mIGVsZW1lbnQgc2l6ZSwganVzdCBsaWtlIHdpdGggdHlwZWQgYXJyYXkgdmlld3MuCgogICAgCQkgIE5pY2UgZm9yIHF1aWNrbHkgcmVhZGluZyBpbiBkYXRhLiBXYXJuaW5nOiBwb3RlbnRpYWxseSBtb2RpZmllcyB0aGUgYnVmZmVyCiAgICAJCSAgY29udGVudHMuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IEZsb2F0NjRBcnJheSB0byB0aGUgRGF0YVN0cmVhbSBiYWNraW5nIGJ1ZmZlci4KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5tYXBGbG9hdDY0QXJyYXkgPSBmdW5jdGlvbihsZW5ndGgsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKGxlbmd0aCAqIDgpOwogICAgCQkgIHZhciBhcnIgPSBuZXcgRmxvYXQ2NEFycmF5KHRoaXMuX2J1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sIGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5hcnJheVRvTmF0aXZlKGFyciwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBsZW5ndGggKiA4OwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICBNYXBzIGEgRmxvYXQzMkFycmF5IGludG8gdGhlIERhdGFTdHJlYW0gYnVmZmVyLCBzd2l6emxpbmcgaXQgdG8gbmF0aXZlCiAgICAJCSAgZW5kaWFubmVzcyBpbi1wbGFjZS4gVGhlIGN1cnJlbnQgb2Zmc2V0IGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBidWZmZXIgbmVlZHMgdG8KICAgIAkJICBiZSBhIG11bHRpcGxlIG9mIGVsZW1lbnQgc2l6ZSwganVzdCBsaWtlIHdpdGggdHlwZWQgYXJyYXkgdmlld3MuCgogICAgCQkgIE5pY2UgZm9yIHF1aWNrbHkgcmVhZGluZyBpbiBkYXRhLiBXYXJuaW5nOiBwb3RlbnRpYWxseSBtb2RpZmllcyB0aGUgYnVmZmVyCiAgICAJCSAgY29udGVudHMuCgogICAgCQkgIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGVsZW1lbnRzIHRvIG1hcC4KICAgIAkJICBAcGFyYW0gez9ib29sZWFufSBlIEVuZGlhbm5lc3Mgb2YgdGhlIGRhdGEgdG8gcmVhZC4KICAgIAkJICBAcmV0dXJuIHtPYmplY3R9IEZsb2F0MzJBcnJheSB0byB0aGUgRGF0YVN0cmVhbSBiYWNraW5nIGJ1ZmZlci4KICAgIAkJICAqLwogICAgCQlEYXRhU3RyZWFtLnByb3RvdHlwZS5tYXBGbG9hdDMyQXJyYXkgPSBmdW5jdGlvbihsZW5ndGgsIGUpIHsKICAgIAkJICB0aGlzLl9yZWFsbG9jKGxlbmd0aCAqIDQpOwogICAgCQkgIHZhciBhcnIgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuX2J1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0K3RoaXMucG9zaXRpb24sIGxlbmd0aCk7CiAgICAJCSAgRGF0YVN0cmVhbS5hcnJheVRvTmF0aXZlKGFyciwgZSA9PSBudWxsID8gdGhpcy5lbmRpYW5uZXNzIDogZSk7CiAgICAJCSAgdGhpcy5wb3NpdGlvbiArPSBsZW5ndGggKiA0OwogICAgCQkgIHJldHVybiBhcnI7CiAgICAJCX07CiAgICAJCS8vIGZpbGU6c3JjL2J1ZmZlci5qcwogICAgCQkvKioKICAgIAkJICogTXVsdGlCdWZmZXJTdHJlYW0gaXMgYSBjbGFzcyB0aGF0IGFjdHMgYXMgYSBTaW1wbGVTdHJlYW0gZm9yIHBhcnNpbmcgCiAgICAJCSAqIEl0IGhvbGRzIHNldmVyYWwsIHBvc3NpYmx5IG5vbi1jb250aWd1b3VzIEFycmF5QnVmZmVyIG9iamVjdHMsIGVhY2ggd2l0aCBhIGZpbGVTdGFydCBwcm9wZXJ0eSAKICAgIAkJICogY29udGFpbmluZyB0aGUgb2Zmc2V0IGZvciB0aGUgYnVmZmVyIGRhdGEgaW4gYW4gb3JpZ2luYWwvdmlydHVhbCBmaWxlIAogICAgCQkgKgogICAgCQkgKiBJdCBpbmhlcml0cyBhbHNvIGZyb20gRGF0YVN0cmVhbSBmb3IgYWxsIHJlYWQvd3JpdGUvYWxsb2Mgb3BlcmF0aW9ucwogICAgCQkgKi8KCiAgICAJCS8qKgogICAgCQkgKiBDb25zdHJ1Y3RvcgogICAgCQkgKi8KICAgIAkJdmFyIE11bHRpQnVmZmVyU3RyZWFtID0gZnVuY3Rpb24oYnVmZmVyKSB7CiAgICAJCQkvKiBMaXN0IG9mIEFycmF5QnVmZmVycywgd2l0aCBhIGZpbGVTdGFydCBwcm9wZXJ0eSwgc29ydGVkIGluIGZpbGVTdGFydCBvcmRlciBhbmQgbm9uIG92ZXJsYXBwaW5nICovCiAgICAJCQl0aGlzLmJ1ZmZlcnMgPSBbXTsJCiAgICAJCQl0aGlzLmJ1ZmZlckluZGV4ID0gLTE7CiAgICAJCQlpZiAoYnVmZmVyKSB7CiAgICAJCQkJdGhpcy5pbnNlcnRCdWZmZXIoYnVmZmVyKTsKICAgIAkJCQl0aGlzLmJ1ZmZlckluZGV4ID0gMDsKICAgIAkJCX0KICAgIAkJfTsKICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlID0gbmV3IERhdGFTdHJlYW0obmV3IEFycmF5QnVmZmVyKCksIDAsIERhdGFTdHJlYW0uQklHX0VORElBTik7CgogICAgCQkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAJCSAgTWV0aG9kcyBmb3IgdGhlIG1hbmFnbmVtZW50IG9mIHRoZSBidWZmZXJzIChpbnNlcnRpb24sIHJlbW92YWwsIGNvbmNhdGVuYXRpb24sIC4uLikKICAgIAkJICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLmluaXRpYWxpemVkID0gZnVuY3Rpb24oKSB7CiAgICAJCQl2YXIgZmlyc3RCdWZmZXI7CiAgICAJCQlpZiAodGhpcy5idWZmZXJJbmRleCA+IC0xKSB7CiAgICAJCQkJcmV0dXJuIHRydWU7CiAgICAJCQl9IGVsc2UgaWYgKHRoaXMuYnVmZmVycy5sZW5ndGggPiAwKSB7CiAgICAJCQkJZmlyc3RCdWZmZXIgPSB0aGlzLmJ1ZmZlcnNbMF07CiAgICAJCQkJaWYgKGZpcnN0QnVmZmVyLmZpbGVTdGFydCA9PT0gMCkgewogICAgCQkJCQl0aGlzLmJ1ZmZlciA9IGZpcnN0QnVmZmVyOwogICAgCQkJCQl0aGlzLmJ1ZmZlckluZGV4ID0gMDsKICAgIAkJCQkJTG9nLmRlYnVnKCJNdWx0aUJ1ZmZlclN0cmVhbSIsICJTdHJlYW0gcmVhZHkgZm9yIHBhcnNpbmciKTsKICAgIAkJCQkJcmV0dXJuIHRydWU7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJTG9nLndhcm4oIk11bHRpQnVmZmVyU3RyZWFtIiwgIlRoZSBmaXJzdCBidWZmZXIgc2hvdWxkIGhhdmUgYSBmaWxlU3RhcnQgb2YgMCIpOwogICAgCQkJCQl0aGlzLmxvZ0J1ZmZlckxldmVsKCk7CiAgICAJCQkJCXJldHVybiBmYWxzZTsKICAgIAkJCQl9CiAgICAJCQl9IGVsc2UgewogICAgCQkJCUxvZy53YXJuKCJNdWx0aUJ1ZmZlclN0cmVhbSIsICJObyBidWZmZXIgdG8gc3RhcnQgcGFyc2luZyBmcm9tIik7CiAgICAJCQkJdGhpcy5sb2dCdWZmZXJMZXZlbCgpOwogICAgCQkJCXJldHVybiBmYWxzZTsKICAgIAkJCX0JCQkKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBoZWxwZXIgZnVuY3Rpb25zIHRvIGNvbmNhdGVuYXRlIHR3byBBcnJheUJ1ZmZlciBvYmplY3RzCiAgICAJCSAqIEBwYXJhbSAge0FycmF5QnVmZmVyfSBidWZmZXIxIAogICAgCQkgKiBAcGFyYW0gIHtBcnJheUJ1ZmZlcn0gYnVmZmVyMiAKICAgIAkJICogQHJldHVybiB7QXJyYXlCdWZmZXJ9IHRoZSBjb25jYXRlbmF0aW9uIG9mIGJ1ZmZlcjEgYW5kIGJ1ZmZlcjIgaW4gdGhhdCBvcmRlcgogICAgCQkgKi8KICAgIAkJQXJyYXlCdWZmZXIuY29uY2F0ID0gZnVuY3Rpb24oYnVmZmVyMSwgYnVmZmVyMikgewogICAgCQkgIExvZy5kZWJ1ZygiQXJyYXlCdWZmZXIiLCAiVHJ5aW5nIHRvIGNyZWF0ZSBhIG5ldyBidWZmZXIgb2Ygc2l6ZTogIisoYnVmZmVyMS5ieXRlTGVuZ3RoICsgYnVmZmVyMi5ieXRlTGVuZ3RoKSk7CiAgICAJCSAgdmFyIHRtcCA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcjEuYnl0ZUxlbmd0aCArIGJ1ZmZlcjIuYnl0ZUxlbmd0aCk7CiAgICAJCSAgdG1wLnNldChuZXcgVWludDhBcnJheShidWZmZXIxKSwgMCk7CiAgICAJCSAgdG1wLnNldChuZXcgVWludDhBcnJheShidWZmZXIyKSwgYnVmZmVyMS5ieXRlTGVuZ3RoKTsKICAgIAkJICByZXR1cm4gdG1wLmJ1ZmZlcjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZWR1Y2VzIHRoZSBzaXplIG9mIGEgZ2l2ZW4gYnVmZmVyLCBidXQgdGFraW5nIHRoZSBwYXJ0IGJldHdlZW4gb2Zmc2V0IGFuZCBvZmZzZXQrbmV3bGVuZ3RoCiAgICAJCSAqIEBwYXJhbSAge0FycmF5QnVmZmVyfSBidWZmZXIgICAgCiAgICAJCSAqIEBwYXJhbSAge051bWJlcn0gICAgICBvZmZzZXQgICAgdGhlIHN0YXJ0IG9mIG5ldyBidWZmZXIKICAgIAkJICogQHBhcmFtICB7TnVtYmVyfSAgICAgIG5ld0xlbmd0aCB0aGUgbGVuZ3RoIG9mIHRoZSBuZXcgYnVmZmVyCiAgICAJCSAqIEByZXR1cm4ge0FycmF5QnVmZmVyfSAgICAgICAgICAgdGhlIG5ldyBidWZmZXIKICAgIAkJICovCiAgICAJCU11bHRpQnVmZmVyU3RyZWFtLnByb3RvdHlwZS5yZWR1Y2VCdWZmZXIgPSBmdW5jdGlvbihidWZmZXIsIG9mZnNldCwgbmV3TGVuZ3RoKSB7CiAgICAJCQl2YXIgc21hbGxCOwogICAgCQkJc21hbGxCID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKICAgIAkJCXNtYWxsQi5zZXQobmV3IFVpbnQ4QXJyYXkoYnVmZmVyLCBvZmZzZXQsIG5ld0xlbmd0aCkpOwogICAgCQkJc21hbGxCLmJ1ZmZlci5maWxlU3RhcnQgPSBidWZmZXIuZmlsZVN0YXJ0K29mZnNldDsKICAgIAkJCXNtYWxsQi5idWZmZXIudXNlZEJ5dGVzID0gMDsKICAgIAkJCXJldHVybiBzbWFsbEIuYnVmZmVyOwkKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBJbnNlcnRzIHRoZSBuZXcgYnVmZmVyIGluIHRoZSBzb3J0ZWQgbGlzdCBvZiBidWZmZXJzLAogICAgCQkgKiAgbWFraW5nIHN1cmUsIGl0IGlzIG5vdCBvdmVybGFwcGluZyB3aXRoIGV4aXN0aW5nIG9uZXMgKHBvc3NpYmx5IHJlZHVjaW5nIGl0cyBzaXplKS4KICAgIAkJICogIGlmIHRoZSBuZXcgYnVmZmVyIG92ZXJyaWRlcy9yZXBsYWNlcyB0aGUgMC10aCBidWZmZXIgKGZvciBpbnN0YW5jZSBiZWNhdXNlIGl0IGlzIGJpZ2dlciksIAogICAgCQkgKiAgdXBkYXRlcyB0aGUgRGF0YVN0cmVhbSBidWZmZXIgZm9yIHBhcnNpbmcgCiAgICAJCSovCiAgICAJCU11bHRpQnVmZmVyU3RyZWFtLnByb3RvdHlwZS5pbnNlcnRCdWZmZXIgPSBmdW5jdGlvbihhYikgewkKICAgIAkJCXZhciB0b19hZGQgPSB0cnVlOwogICAgCQkJLyogVE9ETzogaW1wcm92ZSBpbnNlcnRpb24gaWYgbWFueSBidWZmZXJzICovCiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYnVmZmVycy5sZW5ndGg7IGkrKykgewogICAgCQkJCXZhciBiID0gdGhpcy5idWZmZXJzW2ldOwogICAgCQkJCWlmIChhYi5maWxlU3RhcnQgPD0gYi5maWxlU3RhcnQpIHsKICAgIAkJCQkJLyogdGhlIGluc2VydGlvbiBwb3NpdGlvbiBpcyBmb3VuZCAqLwogICAgCQkJCQlpZiAoYWIuZmlsZVN0YXJ0ID09PSBiLmZpbGVTdGFydCkgewogICAgCQkJCQkJLyogVGhlIG5ldyBidWZmZXIgb3ZlcmxhcHMgd2l0aCBhbiBleGlzdGluZyBidWZmZXIgKi8KICAgIAkJCQkJCWlmIChhYi5ieXRlTGVuZ3RoID4gIGIuYnl0ZUxlbmd0aCkgewogICAgCQkJCQkJCS8qIHRoZSBuZXcgYnVmZmVyIGlzIGJpZ2dlciB0aGFuIHRoZSBleGlzdGluZyBvbmUKICAgIAkJCQkJCQkgICByZW1vdmUgdGhlIGV4aXN0aW5nIGJ1ZmZlciBhbmQgdHJ5IGFnYWluIHRvIGluc2VydCAKICAgIAkJCQkJCQkgICB0aGUgbmV3IGJ1ZmZlciB0byBjaGVjayBvdmVybGFwIHdpdGggdGhlIG5leHQgb25lcyAqLwogICAgCQkJCQkJCXRoaXMuYnVmZmVycy5zcGxpY2UoaSwgMSk7CiAgICAJCQkJCQkJaS0tOyAKICAgIAkJCQkJCQljb250aW51ZTsKICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJLyogdGhlIG5ldyBidWZmZXIgaXMgc21hbGxlciB0aGFuIHRoZSBleGlzdGluZyBvbmUsIGp1c3QgZHJvcCBpdCAqLwogICAgCQkJCQkJCUxvZy53YXJuKCJNdWx0aUJ1ZmZlclN0cmVhbSIsICJCdWZmZXIgKGZpbGVTdGFydDogIithYi5maWxlU3RhcnQrIiAtIExlbmd0aDogIithYi5ieXRlTGVuZ3RoKyIpIGFscmVhZHkgYXBwZW5kZWQsIGlnbm9yaW5nIik7CiAgICAJCQkJCQl9CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkvKiBUaGUgYmVnaW5uaW5nIG9mIHRoZSBuZXcgYnVmZmVyIGlzIG5vdCBvdmVybGFwcGluZyB3aXRoIGFuIGV4aXN0aW5nIGJ1ZmZlcgogICAgCQkJCQkJICAgbGV0J3MgY2hlY2sgdGhlIGVuZCBvZiBpdCAqLwogICAgCQkJCQkJaWYgKGFiLmZpbGVTdGFydCArIGFiLmJ5dGVMZW5ndGggPD0gYi5maWxlU3RhcnQpIDsgZWxzZSB7CiAgICAJCQkJCQkJLyogVGhlcmUgaXMgc29tZSBvdmVybGFwLCBjdXQgdGhlIG5ldyBidWZmZXIgc2hvcnQsIGFuZCBhZGQgaXQqLwogICAgCQkJCQkJCWFiID0gdGhpcy5yZWR1Y2VCdWZmZXIoYWIsIDAsIGIuZmlsZVN0YXJ0IC0gYWIuZmlsZVN0YXJ0KTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCUxvZy5kZWJ1ZygiTXVsdGlCdWZmZXJTdHJlYW0iLCAiQXBwZW5kaW5nIG5ldyBidWZmZXIgKGZpbGVTdGFydDogIithYi5maWxlU3RhcnQrIiAtIExlbmd0aDogIithYi5ieXRlTGVuZ3RoKyIpIik7CiAgICAJCQkJCQl0aGlzLmJ1ZmZlcnMuc3BsaWNlKGksIDAsIGFiKTsKICAgIAkJCQkJCS8qIGlmIHRoaXMgbmV3IGJ1ZmZlciBpcyBpbnNlcnRlZCBpbiB0aGUgZmlyc3QgcGxhY2UgaW4gdGhlIGxpc3Qgb2YgdGhlIGJ1ZmZlciwgCiAgICAJCQkJCQkgICBhbmQgdGhlIERhdGFTdHJlYW0gaXMgaW5pdGlhbGl6ZWQsIG1ha2UgaXQgdGhlIGJ1ZmZlciB1c2VkIGZvciBwYXJzaW5nICovCiAgICAJCQkJCQlpZiAoaSA9PT0gMCkgewogICAgCQkJCQkJCXRoaXMuYnVmZmVyID0gYWI7CiAgICAJCQkJCQl9CiAgICAJCQkJCX0KICAgIAkJCQkJdG9fYWRkID0gZmFsc2U7CiAgICAJCQkJCWJyZWFrOwogICAgCQkJCX0gZWxzZSBpZiAoYWIuZmlsZVN0YXJ0IDwgYi5maWxlU3RhcnQgKyBiLmJ5dGVMZW5ndGgpIHsKICAgIAkJCQkJLyogdGhlIG5ldyBidWZmZXIgb3ZlcmxhcHMgaXRzIGJlZ2lubmluZyB3aXRoIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgYnVmZmVyICovCiAgICAJCQkJCXZhciBvZmZzZXQgPSBiLmZpbGVTdGFydCArIGIuYnl0ZUxlbmd0aCAtIGFiLmZpbGVTdGFydDsKICAgIAkJCQkJdmFyIG5ld0xlbmd0aCA9IGFiLmJ5dGVMZW5ndGggLSBvZmZzZXQ7CiAgICAJCQkJCWlmIChuZXdMZW5ndGggPiAwKSB7CiAgICAJCQkJCQkvKiB0aGUgbmV3IGJ1ZmZlciBpcyBiaWdnZXIgdGhhbiB0aGUgY3VycmVudCBvdmVybGFwLCBkcm9wIHRoZSBvdmVybGFwcGluZyBwYXJ0IGFuZCB0cnkgYWdhaW4gaW5zZXJ0aW5nIHRoZSByZW1haW5pbmcgYnVmZmVyICovCiAgICAJCQkJCQlhYiA9IHRoaXMucmVkdWNlQnVmZmVyKGFiLCBvZmZzZXQsIG5ld0xlbmd0aCk7CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkvKiB0aGUgY29udGVudCBvZiB0aGUgbmV3IGJ1ZmZlciBpcyBlbnRpcmVseSBjb250YWluZWQgaW4gdGhlIGV4aXN0aW5nIGJ1ZmZlciwgZHJvcCBpdCBlbnRpcmVseSAqLwogICAgCQkJCQkJdG9fYWRkID0gZmFsc2U7CiAgICAJCQkJCQlicmVhazsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJCS8qIGlmIHRoZSBidWZmZXIgaGFzIG5vdCBiZWVuIGFkZGVkLCB3ZSBjYW4gYWRkIGl0IGF0IHRoZSBlbmQgKi8KICAgIAkJCWlmICh0b19hZGQpIHsKICAgIAkJCQlMb2cuZGVidWcoIk11bHRpQnVmZmVyU3RyZWFtIiwgIkFwcGVuZGluZyBuZXcgYnVmZmVyIChmaWxlU3RhcnQ6ICIrYWIuZmlsZVN0YXJ0KyIgLSBMZW5ndGg6ICIrYWIuYnl0ZUxlbmd0aCsiKSIpOwogICAgCQkJCXRoaXMuYnVmZmVycy5wdXNoKGFiKTsKICAgIAkJCQkvKiBpZiB0aGlzIG5ldyBidWZmZXIgaXMgaW5zZXJ0ZWQgaW4gdGhlIGZpcnN0IHBsYWNlIGluIHRoZSBsaXN0IG9mIHRoZSBidWZmZXIsIAogICAgCQkJCSAgIGFuZCB0aGUgRGF0YVN0cmVhbSBpcyBpbml0aWFsaXplZCwgbWFrZSBpdCB0aGUgYnVmZmVyIHVzZWQgZm9yIHBhcnNpbmcgKi8KICAgIAkJCQlpZiAoaSA9PT0gMCkgewogICAgCQkJCQl0aGlzLmJ1ZmZlciA9IGFiOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBEaXNwbGF5cyB0aGUgc3RhdHVzIG9mIHRoZSBidWZmZXJzIChudW1iZXIgYW5kIHVzZWQgYnl0ZXMpCiAgICAJCSAqIEBwYXJhbSAge09iamVjdH0gaW5mbyBjYWxsYmFjayBtZXRob2QgZm9yIGRpc3BsYXkKICAgIAkJICovCiAgICAJCU11bHRpQnVmZmVyU3RyZWFtLnByb3RvdHlwZS5sb2dCdWZmZXJMZXZlbCA9IGZ1bmN0aW9uKGluZm8pIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIGJ1ZmZlcjsKICAgIAkJCXZhciB1c2VkLCB0b3RhbDsKICAgIAkJCXZhciByYW5nZXMgPSBbXTsKICAgIAkJCXZhciByYW5nZTsKICAgIAkJCXZhciBidWZmZXJlZFN0cmluZyA9ICIiOwogICAgCQkJdXNlZCA9IDA7CiAgICAJCQl0b3RhbCA9IDA7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5idWZmZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJYnVmZmVyID0gdGhpcy5idWZmZXJzW2ldOwogICAgCQkJCWlmIChpID09PSAwKSB7CiAgICAJCQkJCXJhbmdlID0ge307CiAgICAJCQkJCXJhbmdlcy5wdXNoKHJhbmdlKTsKICAgIAkJCQkJcmFuZ2Uuc3RhcnQgPSBidWZmZXIuZmlsZVN0YXJ0OwogICAgCQkJCQlyYW5nZS5lbmQgPSBidWZmZXIuZmlsZVN0YXJ0K2J1ZmZlci5ieXRlTGVuZ3RoOwogICAgCQkJCQlidWZmZXJlZFN0cmluZyArPSAiWyIrcmFuZ2Uuc3RhcnQrIi0iOwogICAgCQkJCX0gZWxzZSBpZiAocmFuZ2UuZW5kID09PSBidWZmZXIuZmlsZVN0YXJ0KSB7CiAgICAJCQkJCXJhbmdlLmVuZCA9IGJ1ZmZlci5maWxlU3RhcnQrYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJcmFuZ2UgPSB7fTsKICAgIAkJCQkJcmFuZ2Uuc3RhcnQgPSBidWZmZXIuZmlsZVN0YXJ0OwogICAgCQkJCQlidWZmZXJlZFN0cmluZyArPSAocmFuZ2VzW3Jhbmdlcy5sZW5ndGgtMV0uZW5kLTEpKyJdLCBbIityYW5nZS5zdGFydCsiLSI7CiAgICAJCQkJCXJhbmdlLmVuZCA9IGJ1ZmZlci5maWxlU3RhcnQrYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAJCQkJCXJhbmdlcy5wdXNoKHJhbmdlKTsKICAgIAkJCQl9CiAgICAJCQkJdXNlZCArPSBidWZmZXIudXNlZEJ5dGVzOwogICAgCQkJCXRvdGFsICs9IGJ1ZmZlci5ieXRlTGVuZ3RoOwogICAgCQkJfQogICAgCQkJaWYgKHJhbmdlcy5sZW5ndGggPiAwKSB7CiAgICAJCQkJYnVmZmVyZWRTdHJpbmcgKz0gKHJhbmdlLmVuZC0xKSsiXSI7CiAgICAJCQl9CiAgICAJCQl2YXIgbG9nID0gKGluZm8gPyBMb2cuaW5mbyA6IExvZy5kZWJ1Zyk7CiAgICAJCQlpZiAodGhpcy5idWZmZXJzLmxlbmd0aCA9PT0gMCkgewogICAgCQkJCWxvZygiTXVsdGlCdWZmZXJTdHJlYW0iLCAiTm8gbW9yZSBidWZmZXIgaW4gbWVtb3J5Iik7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCWxvZygiTXVsdGlCdWZmZXJTdHJlYW0iLCAiIit0aGlzLmJ1ZmZlcnMubGVuZ3RoKyIgc3RvcmVkIGJ1ZmZlcihzKSAoIit1c2VkKyIvIit0b3RhbCsiIGJ5dGVzKSwgY29udGludW91cyByYW5nZXM6ICIrYnVmZmVyZWRTdHJpbmcpOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLmNsZWFuQnVmZmVycyA9IGZ1bmN0aW9uICgpIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIGJ1ZmZlcjsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLmJ1ZmZlcnMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlidWZmZXIgPSB0aGlzLmJ1ZmZlcnNbaV07CiAgICAJCQkJaWYgKGJ1ZmZlci51c2VkQnl0ZXMgPT09IGJ1ZmZlci5ieXRlTGVuZ3RoKSB7CiAgICAJCQkJCUxvZy5kZWJ1ZygiTXVsdGlCdWZmZXJTdHJlYW0iLCAiUmVtb3ZpbmcgYnVmZmVyICMiK2kpOwogICAgCQkJCQl0aGlzLmJ1ZmZlcnMuc3BsaWNlKGksIDEpOwogICAgCQkJCQlpLS07CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLm1lcmdlTmV4dEJ1ZmZlciA9IGZ1bmN0aW9uKCkgewogICAgCQkJdmFyIG5leHRfYnVmZmVyOwogICAgCQkJaWYgKHRoaXMuYnVmZmVySW5kZXgrMSA8IHRoaXMuYnVmZmVycy5sZW5ndGgpIHsKICAgIAkJCQluZXh0X2J1ZmZlciA9IHRoaXMuYnVmZmVyc1t0aGlzLmJ1ZmZlckluZGV4KzFdOwogICAgCQkJCWlmIChuZXh0X2J1ZmZlci5maWxlU3RhcnQgPT09IHRoaXMuYnVmZmVyLmZpbGVTdGFydCArIHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGgpIHsKICAgIAkJCQkJdmFyIG9sZExlbmd0aCA9IHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAJCQkJCXZhciBvbGRVc2VkQnl0ZXMgPSB0aGlzLmJ1ZmZlci51c2VkQnl0ZXM7CiAgICAJCQkJCXZhciBvbGRGaWxlU3RhcnQgPSB0aGlzLmJ1ZmZlci5maWxlU3RhcnQ7CiAgICAJCQkJCXRoaXMuYnVmZmVyc1t0aGlzLmJ1ZmZlckluZGV4XSA9IEFycmF5QnVmZmVyLmNvbmNhdCh0aGlzLmJ1ZmZlciwgbmV4dF9idWZmZXIpOwogICAgCQkJCQl0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyc1t0aGlzLmJ1ZmZlckluZGV4XTsKICAgIAkJCQkJdGhpcy5idWZmZXJzLnNwbGljZSh0aGlzLmJ1ZmZlckluZGV4KzEsIDEpOwogICAgCQkJCQl0aGlzLmJ1ZmZlci51c2VkQnl0ZXMgPSBvbGRVc2VkQnl0ZXM7IC8qIFRPRE86IHNob3VsZCBpdCBiZSArPSA/ICovCiAgICAJCQkJCXRoaXMuYnVmZmVyLmZpbGVTdGFydCA9IG9sZEZpbGVTdGFydDsKICAgIAkJCQkJTG9nLmRlYnVnKCJJU09GaWxlIiwgIkNvbmNhdGVuYXRpbmcgYnVmZmVyIGZvciBib3ggcGFyc2luZyAobGVuZ3RoOiAiK29sZExlbmd0aCsiLT4iK3RoaXMuYnVmZmVyLmJ5dGVMZW5ndGgrIikiKTsKICAgIAkJCQkJcmV0dXJuIHRydWU7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJcmV0dXJuIGZhbHNlOwogICAgCQkJCX0KICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIGZhbHNlOwogICAgCQkJfQogICAgCQl9OwoKCiAgICAJCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAJCSAgU2Vlay1yZWxhdGVkIGZ1bmN0aW9ucwogICAgCQkgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAJCS8qKgogICAgCQkgKiBGaW5kcyB0aGUgYnVmZmVyIHRoYXQgaG9sZHMgdGhlIGdpdmVuIGZpbGUgcG9zaXRpb24KICAgIAkJICogQHBhcmFtICB7Qm9vbGVhbn0gZnJvbVN0YXJ0ICAgIGluZGljYXRlcyBpZiB0aGUgc2VhcmNoIHNob3VsZCBzdGFydCBmcm9tIHRoZSBjdXJyZW50IGJ1ZmZlciAoZmFsc2UpIAogICAgCQkgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgZnJvbSB0aGUgZmlyc3QgYnVmZmVyICh0cnVlKQogICAgCQkgKiBAcGFyYW0gIHtOdW1iZXJ9ICBmaWxlUG9zaXRpb24gcG9zaXRpb24gaW4gdGhlIGZpbGUgdG8gc2VlayB0bwogICAgCQkgKiBAcGFyYW0gIHtCb29sZWFufSBtYXJrQXNVc2VkICAgaW5kaWNhdGVzIGlmIHRoZSBieXRlcyBpbiBiZXR3ZWVuIHRoZSBjdXJyZW50IHBvc2l0aW9uIGFuZCB0aGUgc2VlayBwb3NpdGlvbiAKICAgIAkJICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZCBiZSBtYXJrZWQgYXMgdXNlZCBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uCiAgICAJCSAqIEByZXR1cm4ge051bWJlcn0gICAgICAgICAgICAgICB0aGUgaW5kZXggb2YgdGhlIGJ1ZmZlciBob2xkaW5nIHRoZSBzZWVrZWQgZmlsZSBwb3NpdGlvbiwgLTEgaWYgbm90IGZvdW5kLgogICAgCQkgKi8KICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLmZpbmRQb3NpdGlvbiA9IGZ1bmN0aW9uKGZyb21TdGFydCwgZmlsZVBvc2l0aW9uLCBtYXJrQXNVc2VkKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXZhciBhYnVmZmVyID0gbnVsbDsKICAgIAkJCXZhciBpbmRleCA9IC0xOwoKICAgIAkJCS8qIGZpbmQgdGhlIGJ1ZmZlciB3aXRoIHRoZSBsYXJnZXN0IHBvc2l0aW9uIHNtYWxsZXIgdGhhbiB0aGUgZ2l2ZW4gcG9zaXRpb24gKi8KICAgIAkJCWlmIChmcm9tU3RhcnQgPT09IHRydWUpIHsKICAgIAkJCSAgIC8qIHRoZSByZXBvc2l0aW9uIGNhbiBiZSBpbiB0aGUgcGFzdCwgd2UgbmVlZCB0byBjaGVjayBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGxpc3Qgb2YgYnVmZmVycyAqLwogICAgCQkJCWkgPSAwOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlpID0gdGhpcy5idWZmZXJJbmRleDsKICAgIAkJCX0KCiAgICAJCQl3aGlsZSAoaSA8IHRoaXMuYnVmZmVycy5sZW5ndGgpIHsKICAgIAkJCQlhYnVmZmVyID0gdGhpcy5idWZmZXJzW2ldOwogICAgCQkJCWlmIChhYnVmZmVyLmZpbGVTdGFydCA8PSBmaWxlUG9zaXRpb24pIHsKICAgIAkJCQkJaW5kZXggPSBpOwogICAgCQkJCQlpZiAobWFya0FzVXNlZCkgewogICAgCQkJCQkJaWYgKGFidWZmZXIuZmlsZVN0YXJ0ICsgYWJ1ZmZlci5ieXRlTGVuZ3RoIDw9IGZpbGVQb3NpdGlvbikgewogICAgCQkJCQkJCWFidWZmZXIudXNlZEJ5dGVzID0gYWJ1ZmZlci5ieXRlTGVuZ3RoOwkKICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJYWJ1ZmZlci51c2VkQnl0ZXMgPSBmaWxlUG9zaXRpb24gLSBhYnVmZmVyLmZpbGVTdGFydDsKICAgIAkJCQkJCX0JCQogICAgCQkJCQkJdGhpcy5sb2dCdWZmZXJMZXZlbCgpOwkKICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCWJyZWFrOwogICAgCQkJCX0KICAgIAkJCQlpKys7CiAgICAJCQl9CgogICAgCQkJaWYgKGluZGV4ICE9PSAtMSkgewogICAgCQkJCWFidWZmZXIgPSB0aGlzLmJ1ZmZlcnNbaW5kZXhdOwogICAgCQkJCWlmIChhYnVmZmVyLmZpbGVTdGFydCArIGFidWZmZXIuYnl0ZUxlbmd0aCA+PSBmaWxlUG9zaXRpb24pIHsJCQkKICAgIAkJCQkJTG9nLmRlYnVnKCJNdWx0aUJ1ZmZlclN0cmVhbSIsICJGb3VuZCBwb3NpdGlvbiBpbiBleGlzdGluZyBidWZmZXIgIyIraW5kZXgpOwogICAgCQkJCQlyZXR1cm4gaW5kZXg7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJcmV0dXJuIC0xOwogICAgCQkJCX0KICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIC0xOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIEZpbmRzIHRoZSBsYXJnZXN0IGZpbGUgcG9zaXRpb24gY29udGFpbmVkIGluIGEgYnVmZmVyIG9yIGluIHRoZSBuZXh0IGJ1ZmZlcnMgaWYgdGhleSBhcmUgY29udGlndW91cyAobm8gZ2FwKQogICAgCQkgKiBzdGFydGluZyBmcm9tIHRoZSBnaXZlbiBidWZmZXIgaW5kZXggb3IgZnJvbSB0aGUgY3VycmVudCBidWZmZXIgaWYgdGhlIGluZGV4IGlzIG5vdCBnaXZlbgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0gIHtOdW1iZXJ9IGlucHV0aW5kZXggSW5kZXggb2YgdGhlIGJ1ZmZlciB0byBzdGFydCBmcm9tCiAgICAJCSAqIEByZXR1cm4ge051bWJlcn0gICAgICAgICAgICBUaGUgbGFyZ2VzdCBmaWxlIHBvc2l0aW9uIGZvdW5kIGluIHRoZSBidWZmZXJzCiAgICAJCSAqLwogICAgCQlNdWx0aUJ1ZmZlclN0cmVhbS5wcm90b3R5cGUuZmluZEVuZENvbnRpZ3VvdXNCdWYgPSBmdW5jdGlvbihpbnB1dGluZGV4KSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXZhciBjdXJyZW50QnVmOwogICAgCQkJdmFyIG5leHRCdWY7CiAgICAJCQl2YXIgaW5kZXggPSAoaW5wdXRpbmRleCAhPT0gdW5kZWZpbmVkID8gaW5wdXRpbmRleCA6IHRoaXMuYnVmZmVySW5kZXgpOwogICAgCQkJY3VycmVudEJ1ZiA9IHRoaXMuYnVmZmVyc1tpbmRleF07CiAgICAJCQkvKiBmaW5kIHRoZSBlbmQgb2YgdGhlIGNvbnRpZ3VvdXMgcmFuZ2Ugb2YgZGF0YSAqLwogICAgCQkJaWYgKHRoaXMuYnVmZmVycy5sZW5ndGggPiBpbmRleCsxKSB7CiAgICAJCQkJZm9yIChpID0gaW5kZXgrMTsgaSA8IHRoaXMuYnVmZmVycy5sZW5ndGg7IGkrKykgewogICAgCQkJCQluZXh0QnVmID0gdGhpcy5idWZmZXJzW2ldOwogICAgCQkJCQlpZiAobmV4dEJ1Zi5maWxlU3RhcnQgPT09IGN1cnJlbnRCdWYuZmlsZVN0YXJ0ICsgY3VycmVudEJ1Zi5ieXRlTGVuZ3RoKSB7CiAgICAJCQkJCQljdXJyZW50QnVmID0gbmV4dEJ1ZjsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJLyogcmV0dXJuIHRoZSBwb3NpdGlvbiBvZiBsYXN0IGJ5dGUgaW4gdGhlIGZpbGUgdGhhdCB3ZSBoYXZlICovCiAgICAJCQlyZXR1cm4gY3VycmVudEJ1Zi5maWxlU3RhcnQgKyBjdXJyZW50QnVmLmJ5dGVMZW5ndGg7CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgbGFyZ2VzdCBmaWxlIHBvc2l0aW9uIGNvbnRhaW5lZCBpbiB0aGUgYnVmZmVycywgbGFyZ2VyIHRoYW4gdGhlIGdpdmVuIHBvc2l0aW9uCiAgICAJCSAqIEBwYXJhbSAge051bWJlcn0gcG9zIHRoZSBmaWxlIHBvc2l0aW9uIHRvIHN0YXJ0IGZyb20KICAgIAkJICogQHJldHVybiB7TnVtYmVyfSAgICAgdGhlIGxhcmdlc3QgcG9zaXRpb24gaW4gdGhlIGN1cnJlbnQgYnVmZmVyIG9yIGluIHRoZSBidWZmZXIgYW5kIHRoZSBuZXh0IGNvbnRpZ3VvdXMgCiAgICAJCSAqICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciB0aGF0IGhvbGRzIHRoZSBnaXZlbiBwb3NpdGlvbgogICAgCQkgKi8KICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLmdldEVuZEZpbGVQb3NpdGlvbkFmdGVyID0gZnVuY3Rpb24ocG9zKSB7CiAgICAJCQl2YXIgaW5kZXggPSB0aGlzLmZpbmRQb3NpdGlvbih0cnVlLCBwb3MsIGZhbHNlKTsKICAgIAkJCWlmIChpbmRleCAhPT0gLTEpIHsKICAgIAkJCQlyZXR1cm4gdGhpcy5maW5kRW5kQ29udGlndW91c0J1ZihpbmRleCk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXJldHVybiBwb3M7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgCQkgIEdhcmJhZ2UgY29sbGVjdGlvbiByZWxhdGVkIGZ1bmN0aW9ucwogICAgCQkgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAJCS8qKgogICAgCQkgKiBNYXJrcyBhIGdpdmVuIG51bWJlciBvZiBieXRlcyBhcyB1c2VkIGluIHRoZSBjdXJyZW50IGJ1ZmZlciBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uCiAgICAJCSAqIEBwYXJhbSB7TnVtYmVyfSBuYkJ5dGVzIAogICAgCQkgKi8KICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLmFkZFVzZWRCeXRlcyA9IGZ1bmN0aW9uKG5iQnl0ZXMpIHsKICAgIAkJCXRoaXMuYnVmZmVyLnVzZWRCeXRlcyArPSBuYkJ5dGVzOwogICAgCQkJdGhpcy5sb2dCdWZmZXJMZXZlbCgpOwogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIE1hcmtzIHRoZSBlbnRpcmUgY3VycmVudCBidWZmZXIgYXMgdXNlZCwgcmVhZHkgZm9yIGdhcmJhZ2UgY29sbGVjdGlvbgogICAgCQkgKi8KICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLnNldEFsbFVzZWRCeXRlcyA9IGZ1bmN0aW9uKCkgewogICAgCQkJdGhpcy5idWZmZXIudXNlZEJ5dGVzID0gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aDsKICAgIAkJCXRoaXMubG9nQnVmZmVyTGV2ZWwoKTsKICAgIAkJfTsKCiAgICAJCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAJCSAgQ29tbW9uIEFQSSBiZXR3ZWVuIE11bHRpQnVmZmVyU3RyZWFtIGFuZCBTaW1wbGVTdHJlYW0KICAgIAkJICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgCQkvKioKICAgIAkJICogVHJpZXMgdG8gc2VlayB0byBhIGdpdmVuIGZpbGUgcG9zaXRpb24KICAgIAkJICogaWYgcG9zc2libGUsIHJlcG9zaXRpb25zIHRoZSBwYXJzaW5nIGZyb20gdGhlcmUgYW5kIHJldHVybnMgdHJ1ZSAKICAgIAkJICogaWYgbm90IHBvc3NpYmxlLCBkb2VzIG5vdCBjaGFuZ2UgYW55dGhpbmcgYW5kIHJldHVybnMgZmFsc2UgCiAgICAJCSAqIEBwYXJhbSAge051bWJlcn0gIGZpbGVQb3NpdGlvbiBwb3NpdGlvbiBpbiB0aGUgZmlsZSB0byBzZWVrIHRvCiAgICAJCSAqIEBwYXJhbSAge0Jvb2xlYW59IGZyb21TdGFydCAgICBpbmRpY2F0ZXMgaWYgdGhlIHNlYXJjaCBzaG91bGQgc3RhcnQgZnJvbSB0aGUgY3VycmVudCBidWZmZXIgKGZhbHNlKSAKICAgIAkJICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGZyb20gdGhlIGZpcnN0IGJ1ZmZlciAodHJ1ZSkKICAgIAkJICogQHBhcmFtICB7Qm9vbGVhbn0gbWFya0FzVXNlZCAgIGluZGljYXRlcyBpZiB0aGUgYnl0ZXMgaW4gYmV0d2VlbiB0aGUgY3VycmVudCBwb3NpdGlvbiBhbmQgdGhlIHNlZWsgcG9zaXRpb24gCiAgICAJCSAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91bGQgYmUgbWFya2VkIGFzIHVzZWQgZm9yIGdhcmJhZ2UgY29sbGVjdGlvbgogICAgCQkgKiBAcmV0dXJuIHtCb29sZWFufSAgICAgICAgICAgICAgdHJ1ZSBpZiB0aGUgc2VlayBzdWNjZWVkZWQsIGZhbHNlIG90aGVyd2lzZQogICAgCQkgKi8KICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLnNlZWsgPSBmdW5jdGlvbihmaWxlUG9zaXRpb24sIGZyb21TdGFydCwgbWFya0FzVXNlZCkgewogICAgCQkJdmFyIGluZGV4OwogICAgCQkJaW5kZXggPSB0aGlzLmZpbmRQb3NpdGlvbihmcm9tU3RhcnQsIGZpbGVQb3NpdGlvbiwgbWFya0FzVXNlZCk7CiAgICAJCQlpZiAoaW5kZXggIT09IC0xKSB7CiAgICAJCQkJdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlcnNbaW5kZXhdOwogICAgCQkJCXRoaXMuYnVmZmVySW5kZXggPSBpbmRleDsKICAgIAkJCQl0aGlzLnBvc2l0aW9uID0gZmlsZVBvc2l0aW9uIC0gdGhpcy5idWZmZXIuZmlsZVN0YXJ0OwogICAgCQkJCUxvZy5kZWJ1ZygiTXVsdGlCdWZmZXJTdHJlYW0iLCAiUmVwb3NpdGlvbmluZyBwYXJzZXIgYXQgYnVmZmVyIHBvc2l0aW9uOiAiK3RoaXMucG9zaXRpb24pOwogICAgCQkJCXJldHVybiB0cnVlOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlMb2cuZGVidWcoIk11bHRpQnVmZmVyU3RyZWFtIiwgIlBvc2l0aW9uICIrZmlsZVBvc2l0aW9uKyIgbm90IGZvdW5kIGluIGJ1ZmZlcmVkIGRhdGEiKTsKICAgIAkJCQlyZXR1cm4gZmFsc2U7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgY3VycmVudCBwb3NpdGlvbiBpbiB0aGUgZmlsZQogICAgCQkgKiBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwb3NpdGlvbiBpbiB0aGUgZmlsZQogICAgCQkgKi8KICAgIAkJTXVsdGlCdWZmZXJTdHJlYW0ucHJvdG90eXBlLmdldFBvc2l0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAJCQlpZiAodGhpcy5idWZmZXJJbmRleCA9PT0gLTEgfHwgdGhpcy5idWZmZXJzW3RoaXMuYnVmZmVySW5kZXhdID09PSBudWxsKSB7CiAgICAJCQkJdGhyb3cgIkVycm9yIGFjY2Vzc2luZyBwb3NpdGlvbiBpbiB0aGUgTXVsdGlCdWZmZXJTdHJlYW0iOwogICAgCQkJfQogICAgCQkJcmV0dXJuIHRoaXMuYnVmZmVyc1t0aGlzLmJ1ZmZlckluZGV4XS5maWxlU3RhcnQrdGhpcy5wb3NpdGlvbjsKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhlIGN1cnJlbnQgYnVmZmVyCiAgICAJCSAqIEByZXR1cm4ge051bWJlcn0gdGhlIGxlbmd0aCBvZiB0aGUgY3VycmVudCBidWZmZXIKICAgIAkJICovCiAgICAJCU11bHRpQnVmZmVyU3RyZWFtLnByb3RvdHlwZS5nZXRMZW5ndGggPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0aGlzLmJ5dGVMZW5ndGg7CiAgICAJCX07CgogICAgCQlNdWx0aUJ1ZmZlclN0cmVhbS5wcm90b3R5cGUuZ2V0RW5kUG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIAkJCWlmICh0aGlzLmJ1ZmZlckluZGV4ID09PSAtMSB8fCB0aGlzLmJ1ZmZlcnNbdGhpcy5idWZmZXJJbmRleF0gPT09IG51bGwpIHsKICAgIAkJCQl0aHJvdyAiRXJyb3IgYWNjZXNzaW5nIHBvc2l0aW9uIGluIHRoZSBNdWx0aUJ1ZmZlclN0cmVhbSI7CiAgICAJCQl9CiAgICAJCQlyZXR1cm4gdGhpcy5idWZmZXJzW3RoaXMuYnVmZmVySW5kZXhdLmZpbGVTdGFydCt0aGlzLmJ5dGVMZW5ndGg7CiAgICAJCX07CgogICAgCQl7CiAgICAJCQlleHBvcnRzLk11bHRpQnVmZmVyU3RyZWFtID0gTXVsdGlCdWZmZXJTdHJlYW07CiAgICAJCX0vLyBmaWxlOnNyYy9kZXNjcmlwdG9yLmpzCiAgICAJCS8qCiAgICAJCSAqIENvcHlyaWdodCAoYykgMjAxMi0yMDEzLiBUZWxlY29tIFBhcmlzVGVjaC9UU0kvTU0vR1BBQyBDeXJpbCBDb25jb2xhdG8KICAgIAkJICogTGljZW5zZTogQlNELTMtQ2xhdXNlIChzZWUgTElDRU5TRSBmaWxlKQogICAgCQkgKi8KICAgIAkJdmFyIE1QRUc0RGVzY3JpcHRvclBhcnNlciA9IGZ1bmN0aW9uICgpIHsKICAgIAkJCXZhciBFU19EZXNjclRhZyAJCQk9IDB4MDM7CiAgICAJCQl2YXIgRGVjb2RlckNvbmZpZ0Rlc2NyVGFnIAk9IDB4MDQ7CiAgICAJCQl2YXIgRGVjU3BlY2lmaWNJbmZvVGFnIAkJPSAweDA1OwogICAgCQkJdmFyIFNMQ29uZmlnRGVzY3JUYWcgCQk9IDB4MDY7CgogICAgCQkJdmFyIGRlc2NUYWdUb05hbWUgPSBbXTsKICAgIAkJCWRlc2NUYWdUb05hbWVbRVNfRGVzY3JUYWddIAkJCQk9ICJFU19EZXNjcmlwdG9yIjsKICAgIAkJCWRlc2NUYWdUb05hbWVbRGVjb2RlckNvbmZpZ0Rlc2NyVGFnXSAJPSAiRGVjb2RlckNvbmZpZ0Rlc2NyaXB0b3IiOwogICAgCQkJZGVzY1RhZ1RvTmFtZVtEZWNTcGVjaWZpY0luZm9UYWddIAkJPSAiRGVjb2RlclNwZWNpZmljSW5mbyI7CiAgICAJCQlkZXNjVGFnVG9OYW1lW1NMQ29uZmlnRGVzY3JUYWddIAkJPSAiU0xDb25maWdEZXNjcmlwdG9yIjsKCiAgICAJCQl0aGlzLmdldERlc2NyaXB0b3JOYW1lID0gZnVuY3Rpb24odGFnKSB7CiAgICAJCQkJcmV0dXJuIGRlc2NUYWdUb05hbWVbdGFnXTsKICAgIAkJCX07CgogICAgCQkJdmFyIHRoYXQgPSB0aGlzOwogICAgCQkJdmFyIGNsYXNzZXMgPSB7fTsKCiAgICAJCQl0aGlzLnBhcnNlT25lRGVzY3JpcHRvciA9IGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgIAkJCQl2YXIgc2l6ZSA9IDA7CiAgICAJCQkJdmFyIHRhZzsKICAgIAkJCQl2YXIgZGVzYzsKICAgIAkJCQl2YXIgYnl0ZVJlYWQ7CiAgICAJCQkJdGFnID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCWJ5dGVSZWFkID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXdoaWxlIChieXRlUmVhZCAmIDB4ODApIHsKICAgIAkJCQkJc2l6ZSA9IChzaXplIDw8IDcpICsgKGJ5dGVSZWFkICYgMHg3Rik7CiAgICAJCQkJCWJ5dGVSZWFkID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCX0KICAgIAkJCQlzaXplID0gKHNpemUgPDwgNykgKyAoYnl0ZVJlYWQgJiAweDdGKTsKICAgIAkJCQlMb2cuZGVidWcoIk1QRUc0RGVzY3JpcHRvclBhcnNlciIsICJGb3VuZCAiKyhkZXNjVGFnVG9OYW1lW3RhZ10gfHwgIkRlc2NyaXB0b3IgIit0YWcpKyIsIHNpemUgIitzaXplKyIgYXQgcG9zaXRpb24gIitzdHJlYW0uZ2V0UG9zaXRpb24oKSk7CiAgICAJCQkJaWYgKGRlc2NUYWdUb05hbWVbdGFnXSkgewogICAgCQkJCQlkZXNjID0gbmV3IGNsYXNzZXNbZGVzY1RhZ1RvTmFtZVt0YWddXShzaXplKTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlkZXNjID0gbmV3IGNsYXNzZXMuRGVzY3JpcHRvcihzaXplKTsKICAgIAkJCQl9CiAgICAJCQkJZGVzYy5wYXJzZShzdHJlYW0pOwogICAgCQkJCXJldHVybiBkZXNjOwogICAgCQkJfTsKCiAgICAJCQljbGFzc2VzLkRlc2NyaXB0b3IgPSBmdW5jdGlvbihfdGFnLCBfc2l6ZSkgewogICAgCQkJCXRoaXMudGFnID0gX3RhZzsKICAgIAkJCQl0aGlzLnNpemUgPSBfc2l6ZTsKICAgIAkJCQl0aGlzLmRlc2NzID0gW107CiAgICAJCQl9OwoKICAgIAkJCWNsYXNzZXMuRGVzY3JpcHRvci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCQkJdGhpcy5kYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRoaXMuc2l6ZSk7CiAgICAJCQl9OwoKICAgIAkJCWNsYXNzZXMuRGVzY3JpcHRvci5wcm90b3R5cGUuZmluZERlc2NyaXB0b3IgPSBmdW5jdGlvbiAodGFnKSB7CiAgICAJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRlc2NzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJCWlmICh0aGlzLmRlc2NzW2ldLnRhZyA9PSB0YWcpIHsKICAgIAkJCQkJCXJldHVybiB0aGlzLmRlc2NzW2ldOwogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJCXJldHVybiBudWxsOwogICAgCQkJfTsKCiAgICAJCQljbGFzc2VzLkRlc2NyaXB0b3IucHJvdG90eXBlLnBhcnNlUmVtYWluaW5nRGVzY3JpcHRvcnMgPSBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCQkJdmFyIHN0YXJ0ID0gc3RyZWFtLnBvc2l0aW9uOwogICAgCQkJCXdoaWxlIChzdHJlYW0ucG9zaXRpb24gPCBzdGFydCt0aGlzLnNpemUpIHsKICAgIAkJCQkJdmFyIGRlc2MgPSB0aGF0LnBhcnNlT25lRGVzY3JpcHRvcihzdHJlYW0pOwogICAgCQkJCQl0aGlzLmRlc2NzLnB1c2goZGVzYyk7CiAgICAJCQkJfQogICAgCQkJfTsKCiAgICAJCQljbGFzc2VzLkVTX0Rlc2NyaXB0b3IgPSBmdW5jdGlvbiAoc2l6ZSkgewogICAgCQkJCWNsYXNzZXMuRGVzY3JpcHRvci5jYWxsKHRoaXMsIEVTX0Rlc2NyVGFnLCBzaXplKTsKICAgIAkJCX07CgogICAgCQkJY2xhc3Nlcy5FU19EZXNjcmlwdG9yLnByb3RvdHlwZSA9IG5ldyBjbGFzc2VzLkRlc2NyaXB0b3IoKTsKCiAgICAJCQljbGFzc2VzLkVTX0Rlc2NyaXB0b3IucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQkJdGhpcy5FU19JRCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJdGhpcy5mbGFncyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLnNpemUgLT0gMzsKICAgIAkJCQlpZiAodGhpcy5mbGFncyAmIDB4ODApIHsKICAgIAkJCQkJdGhpcy5kZXBlbmRzT25fRVNfSUQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCQl0aGlzLnNpemUgLT0gMjsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQl0aGlzLmRlcGVuZHNPbl9FU19JRCA9IDA7CiAgICAJCQkJfQogICAgCQkJCWlmICh0aGlzLmZsYWdzICYgMHg0MCkgewogICAgCQkJCQl2YXIgbCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQkJdGhpcy5VUkwgPSBzdHJlYW0ucmVhZFN0cmluZyhsKTsKICAgIAkJCQkJdGhpcy5zaXplIC09IGwrMTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQl0aGlzLlVSTCA9ICIiOwogICAgCQkJCX0KICAgIAkJCQlpZiAodGhpcy5mbGFncyAmIDB4MjApIHsKICAgIAkJCQkJdGhpcy5PQ1JfRVNfSUQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCQl0aGlzLnNpemUgLT0gMjsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQl0aGlzLk9DUl9FU19JRCA9IDA7CiAgICAJCQkJfQogICAgCQkJCXRoaXMucGFyc2VSZW1haW5pbmdEZXNjcmlwdG9ycyhzdHJlYW0pOwogICAgCQkJfTsKCiAgICAJCQljbGFzc2VzLkVTX0Rlc2NyaXB0b3IucHJvdG90eXBlLmdldE9USSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJCXZhciBkY2QgPSB0aGlzLmZpbmREZXNjcmlwdG9yKERlY29kZXJDb25maWdEZXNjclRhZyk7CiAgICAJCQkJaWYgKGRjZCkgewogICAgCQkJCQlyZXR1cm4gZGNkLm90aTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlyZXR1cm4gMDsKICAgIAkJCQl9CiAgICAJCQl9OwoKICAgIAkJCWNsYXNzZXMuRVNfRGVzY3JpcHRvci5wcm90b3R5cGUuZ2V0QXVkaW9Db25maWcgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCQl2YXIgZGNkID0gdGhpcy5maW5kRGVzY3JpcHRvcihEZWNvZGVyQ29uZmlnRGVzY3JUYWcpOwogICAgCQkJCWlmICghZGNkKSByZXR1cm4gbnVsbDsKICAgIAkJCQl2YXIgZHNpID0gZGNkLmZpbmREZXNjcmlwdG9yKERlY1NwZWNpZmljSW5mb1RhZyk7CiAgICAJCQkJaWYgKGRzaSAmJiBkc2kuZGF0YSkgewogICAgCQkJCQl2YXIgYXVkaW9PYmplY3RUeXBlID0gKGRzaS5kYXRhWzBdJiAweEY4KSA+PiAzOwogICAgCQkJCQlpZiAoYXVkaW9PYmplY3RUeXBlID09PSAzMSAmJiBkc2kuZGF0YS5sZW5ndGggPj0gMikgewogICAgCQkJCQkJYXVkaW9PYmplY3RUeXBlID0gMzIgKyAoKGRzaS5kYXRhWzBdICYgMHg3KSA8PCAzKSArICgoZHNpLmRhdGFbMV0gJiAweEUwKSA+PiA1KTsKICAgIAkJCQkJfQogICAgCQkJCQlyZXR1cm4gYXVkaW9PYmplY3RUeXBlOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXJldHVybiBudWxsOwogICAgCQkJCX0KICAgIAkJCX07CgogICAgCQkJY2xhc3Nlcy5EZWNvZGVyQ29uZmlnRGVzY3JpcHRvciA9IGZ1bmN0aW9uIChzaXplKSB7CiAgICAJCQkJY2xhc3Nlcy5EZXNjcmlwdG9yLmNhbGwodGhpcywgRGVjb2RlckNvbmZpZ0Rlc2NyVGFnLCBzaXplKTsKICAgIAkJCX07CiAgICAJCQljbGFzc2VzLkRlY29kZXJDb25maWdEZXNjcmlwdG9yLnByb3RvdHlwZSA9IG5ldyBjbGFzc2VzLkRlc2NyaXB0b3IoKTsKCiAgICAJCQljbGFzc2VzLkRlY29kZXJDb25maWdEZXNjcmlwdG9yLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJCXRoaXMub3RpID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuc3RyZWFtVHlwZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLnVwU3RyZWFtID0gKCh0aGlzLnN0cmVhbVR5cGUgPj4gMSkgJiAxKSAhPT0gMDsKICAgIAkJCQl0aGlzLnN0cmVhbVR5cGUgPSB0aGlzLnN0cmVhbVR5cGUgPj4+IDI7CiAgICAJCQkJdGhpcy5idWZmZXJTaXplID0gc3RyZWFtLnJlYWRVaW50MjQoKTsKICAgIAkJCQl0aGlzLm1heEJpdHJhdGUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXRoaXMuYXZnQml0cmF0ZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5zaXplIC09IDEzOwogICAgCQkJCXRoaXMucGFyc2VSZW1haW5pbmdEZXNjcmlwdG9ycyhzdHJlYW0pOwogICAgCQkJfTsKCiAgICAJCQljbGFzc2VzLkRlY29kZXJTcGVjaWZpY0luZm8gPSBmdW5jdGlvbiAoc2l6ZSkgewogICAgCQkJCWNsYXNzZXMuRGVzY3JpcHRvci5jYWxsKHRoaXMsIERlY1NwZWNpZmljSW5mb1RhZywgc2l6ZSk7CiAgICAJCQl9OwogICAgCQkJY2xhc3Nlcy5EZWNvZGVyU3BlY2lmaWNJbmZvLnByb3RvdHlwZSA9IG5ldyBjbGFzc2VzLkRlc2NyaXB0b3IoKTsKCiAgICAJCQljbGFzc2VzLlNMQ29uZmlnRGVzY3JpcHRvciA9IGZ1bmN0aW9uIChzaXplKSB7CiAgICAJCQkJY2xhc3Nlcy5EZXNjcmlwdG9yLmNhbGwodGhpcywgU0xDb25maWdEZXNjclRhZywgc2l6ZSk7CiAgICAJCQl9OwogICAgCQkJY2xhc3Nlcy5TTENvbmZpZ0Rlc2NyaXB0b3IucHJvdG90eXBlID0gbmV3IGNsYXNzZXMuRGVzY3JpcHRvcigpOwoKICAgIAkJCXJldHVybiB0aGlzOwogICAgCQl9OwoKICAgIAkJewogICAgCQkJZXhwb3J0cy5NUEVHNERlc2NyaXB0b3JQYXJzZXIgPSBNUEVHNERlc2NyaXB0b3JQYXJzZXI7CiAgICAJCX0KICAgIAkJLy8gZmlsZTpzcmMvYm94LmpzCiAgICAJCS8qCiAgICAJCSAqIENvcHlyaWdodCAoYykgMjAxMi0yMDEzLiBUZWxlY29tIFBhcmlzVGVjaC9UU0kvTU0vR1BBQyBDeXJpbCBDb25jb2xhdG8KICAgIAkJICogTGljZW5zZTogQlNELTMtQ2xhdXNlIChzZWUgTElDRU5TRSBmaWxlKQogICAgCQkgKi8KICAgIAkJdmFyIEJveFBhcnNlciA9IHsKICAgIAkJCUVSUl9JTlZBTElEX0RBVEEgOiAtMSwKICAgIAkJCUVSUl9OT1RfRU5PVUdIX0RBVEEgOiAwLAogICAgCQkJT0sgOiAxLAoKICAgIAkJCS8vIEJveGVzIHRvIGJlIGNyZWF0ZWQgd2l0aCBkZWZhdWx0IHBhcnNpbmcKICAgIAkJCUJBU0lDX0JPWEVTOiBbICJtZGF0IiwgImlkYXQiLCAiZnJlZSIsICJza2lwIiwgIm1lY28iLCAic3RyayIgXSwKICAgIAkJCUZVTExfQk9YRVM6IFsgImhtaGQiLCAibm1oZCIsICJpb2RzIiwgInhtbCAiLCAiYnhtbCIsICJpcHJvIiwgIm1lcmUiIF0sCiAgICAJCQlDT05UQUlORVJfQk9YRVM6IFsKICAgIAkJCQlbICJtb292IiwgWyAidHJhayIsICJwc3NoIiBdIF0sCiAgICAJCQkJWyAidHJhayIgXSwKICAgIAkJCQlbICJlZHRzIiBdLAogICAgCQkJCVsgIm1kaWEiIF0sCiAgICAJCQkJWyAibWluZiIgXSwKICAgIAkJCQlbICJkaW5mIiBdLAogICAgCQkJCVsgInN0YmwiLCBbICJzZ3BkIiwgInNiZ3AiIF0gXSwKICAgIAkJCQlbICJtdmV4IiwgWyAidHJleCIgXSBdLAogICAgCQkJCVsgIm1vb2YiLCBbICJ0cmFmIiBdIF0sCiAgICAJCQkJWyAidHJhZiIsIFsgInRydW4iLCAic2dwZCIsICJzYmdwIiBdIF0sCiAgICAJCQkJWyAidnR0YyIgXSwKICAgIAkJCQlbICJ0cmVmIiBdLAogICAgCQkJCVsgImlyZWYiIF0sCiAgICAJCQkJWyAibWZyYSIsIFsgInRmcmEiIF0gXSwKICAgIAkJCQlbICJtZWNvIiBdLAogICAgCQkJCVsgImhudGkiIF0sCiAgICAJCQkJWyAiaGluZiIgXSwKICAgIAkJCQlbICJzdHJrIiBdLAogICAgCQkJCVsgInN0cmQiIF0sCiAgICAJCQkJWyAic2luZiIgXSwKICAgIAkJCQlbICJyaW5mIiBdLAogICAgCQkJCVsgInNjaGkiIF0sCiAgICAJCQkJWyAidHJnciIgXSwKICAgIAkJCQlbICJ1ZHRhIiwgWyJraW5kIl0gXSwKICAgIAkJCQlbICJpcHJwIiwgWyJpcG1hIl0gXSwKICAgIAkJCQlbICJpcGNvIiBdLAogICAgCQkJCVsgImdycGwiIF0sCiAgICAJCQkJWyAiajJrSCIgXSwKICAgIAkJCQlbICJldHlwIiwgWyAidHljbyJdIF0KICAgIAkJCV0sCiAgICAJCQkvLyBCb3hlcyBlZmZlY3RpdmVseSBjcmVhdGVkCiAgICAJCQlib3hDb2RlcyA6IFtdLAogICAgCQkJZnVsbEJveENvZGVzIDogW10sCiAgICAJCQljb250YWluZXJCb3hDb2RlcyA6IFtdLAogICAgCQkJc2FtcGxlRW50cnlDb2RlcyA6IHt9LAogICAgCQkJc2FtcGxlR3JvdXBFbnRyeUNvZGVzOiBbXSwKICAgIAkJCXRyYWNrR3JvdXBUeXBlczogW10sCiAgICAJCQlVVUlEQm94ZXM6IHt9LAogICAgCQkJVVVJRHM6IFtdLAogICAgCQkJaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAJCQkJQm94UGFyc2VyLkZ1bGxCb3gucHJvdG90eXBlID0gbmV3IEJveFBhcnNlci5Cb3goKTsKICAgIAkJCQlCb3hQYXJzZXIuQ29udGFpbmVyQm94LnByb3RvdHlwZSA9IG5ldyBCb3hQYXJzZXIuQm94KCk7CiAgICAJCQkJQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZSA9IG5ldyBCb3hQYXJzZXIuQm94KCk7CiAgICAJCQkJQm94UGFyc2VyLlRyYWNrR3JvdXBUeXBlQm94LnByb3RvdHlwZSA9IG5ldyBCb3hQYXJzZXIuRnVsbEJveCgpOwoKICAgIAkJCQkvKiBjcmVhdGluZyBjb25zdHJ1Y3RvcnMgZm9yIHNpbXBsZSBib3hlcyAqLwogICAgCQkJCUJveFBhcnNlci5CQVNJQ19CT1hFUy5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHsKICAgIAkJCQkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IodHlwZSk7CiAgICAJCQkJfSk7CiAgICAJCQkJQm94UGFyc2VyLkZVTExfQk9YRVMuZm9yRWFjaChmdW5jdGlvbih0eXBlKSB7CiAgICAJCQkJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcih0eXBlKTsKICAgIAkJCQl9KTsKICAgIAkJCQlCb3hQYXJzZXIuQ09OVEFJTkVSX0JPWEVTLmZvckVhY2goZnVuY3Rpb24odHlwZXMpIHsKICAgIAkJCQkJQm94UGFyc2VyLmNyZWF0ZUNvbnRhaW5lckJveEN0b3IodHlwZXNbMF0sIG51bGwsIHR5cGVzWzFdKTsKICAgIAkJCQl9KTsKICAgIAkJCX0sCiAgICAJCQlCb3g6IGZ1bmN0aW9uKF90eXBlLCBfc2l6ZSwgX3V1aWQpIHsKICAgIAkJCQl0aGlzLnR5cGUgPSBfdHlwZTsKICAgIAkJCQl0aGlzLnNpemUgPSBfc2l6ZTsKICAgIAkJCQl0aGlzLnV1aWQgPSBfdXVpZDsKICAgIAkJCX0sCiAgICAJCQlGdWxsQm94OiBmdW5jdGlvbih0eXBlLCBzaXplLCB1dWlkKSB7CiAgICAJCQkJQm94UGFyc2VyLkJveC5jYWxsKHRoaXMsIHR5cGUsIHNpemUsIHV1aWQpOwogICAgCQkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl9LAogICAgCQkJQ29udGFpbmVyQm94OiBmdW5jdGlvbih0eXBlLCBzaXplLCB1dWlkKSB7CiAgICAJCQkJQm94UGFyc2VyLkJveC5jYWxsKHRoaXMsIHR5cGUsIHNpemUsIHV1aWQpOwogICAgCQkJCXRoaXMuYm94ZXMgPSBbXTsKICAgIAkJCX0sCiAgICAJCQlTYW1wbGVFbnRyeTogZnVuY3Rpb24odHlwZSwgc2l6ZSwgaGRyX3NpemUsIHN0YXJ0KSB7CiAgICAJCQkJQm94UGFyc2VyLkNvbnRhaW5lckJveC5jYWxsKHRoaXMsIHR5cGUsIHNpemUpOwogICAgCQkJCXRoaXMuaGRyX3NpemUgPSBoZHJfc2l6ZTsKICAgIAkJCQl0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICAJCQl9LAogICAgCQkJU2FtcGxlR3JvdXBFbnRyeTogZnVuY3Rpb24odHlwZSkgewogICAgCQkJCXRoaXMuZ3JvdXBpbmdfdHlwZSA9IHR5cGU7CiAgICAJCQl9LAogICAgCQkJVHJhY2tHcm91cFR5cGVCb3g6IGZ1bmN0aW9uKHR5cGUsIHNpemUpIHsKICAgIAkJCQlCb3hQYXJzZXIuRnVsbEJveC5jYWxsKHRoaXMsIHR5cGUsIHNpemUpOwogICAgCQkJfSwKICAgIAkJCWNyZWF0ZUJveEN0b3I6IGZ1bmN0aW9uKHR5cGUsIHBhcnNlTWV0aG9kKXsKICAgIAkJCQlCb3hQYXJzZXIuYm94Q29kZXMucHVzaCh0eXBlKTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiQm94Il0gPSBmdW5jdGlvbihzaXplKSB7CiAgICAJCQkJCUJveFBhcnNlci5Cb3guY2FsbCh0aGlzLCB0eXBlLCBzaXplKTsKICAgIAkJCQl9OwogICAgCQkJCUJveFBhcnNlclt0eXBlKyJCb3giXS5wcm90b3R5cGUgPSBuZXcgQm94UGFyc2VyLkJveCgpOwogICAgCQkJCWlmIChwYXJzZU1ldGhvZCkgQm94UGFyc2VyW3R5cGUrIkJveCJdLnByb3RvdHlwZS5wYXJzZSA9IHBhcnNlTWV0aG9kOwogICAgCQkJfSwKICAgIAkJCWNyZWF0ZUZ1bGxCb3hDdG9yOiBmdW5jdGlvbih0eXBlLCBwYXJzZU1ldGhvZCkgewogICAgCQkJCS8vQm94UGFyc2VyLmZ1bGxCb3hDb2Rlcy5wdXNoKHR5cGUpOwogICAgCQkJCUJveFBhcnNlclt0eXBlKyJCb3giXSA9IGZ1bmN0aW9uKHNpemUpIHsKICAgIAkJCQkJQm94UGFyc2VyLkZ1bGxCb3guY2FsbCh0aGlzLCB0eXBlLCBzaXplKTsKICAgIAkJCQl9OwogICAgCQkJCUJveFBhcnNlclt0eXBlKyJCb3giXS5wcm90b3R5cGUgPSBuZXcgQm94UGFyc2VyLkZ1bGxCb3goKTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiQm94Il0ucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQkJCXRoaXMucGFyc2VGdWxsSGVhZGVyKHN0cmVhbSk7CiAgICAJCQkJCWlmIChwYXJzZU1ldGhvZCkgewogICAgCQkJCQkJcGFyc2VNZXRob2QuY2FsbCh0aGlzLCBzdHJlYW0pOwogICAgCQkJCQl9CiAgICAJCQkJfTsKICAgIAkJCX0sCiAgICAJCQlhZGRTdWJCb3hBcnJheXM6IGZ1bmN0aW9uKHN1YkJveE5hbWVzKSB7CiAgICAJCQkJaWYgKHN1YkJveE5hbWVzKSB7CiAgICAJCQkJCXRoaXMuc3ViQm94TmFtZXMgPSBzdWJCb3hOYW1lczsKICAgIAkJCQkJdmFyIG5iU3ViQm94ZXMgPSBzdWJCb3hOYW1lcy5sZW5ndGg7CiAgICAJCQkJCWZvciAodmFyIGsgPSAwOyBrPG5iU3ViQm94ZXM7IGsrKykgewogICAgCQkJCQkJdGhpc1tzdWJCb3hOYW1lc1trXSsicyJdID0gW107CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9LAogICAgCQkJY3JlYXRlQ29udGFpbmVyQm94Q3RvcjogZnVuY3Rpb24odHlwZSwgcGFyc2VNZXRob2QsIHN1YkJveE5hbWVzKSB7CiAgICAJCQkJLy9Cb3hQYXJzZXIuY29udGFpbmVyQm94Q29kZXMucHVzaCh0eXBlKTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiQm94Il0gPSBmdW5jdGlvbihzaXplKSB7CiAgICAJCQkJCUJveFBhcnNlci5Db250YWluZXJCb3guY2FsbCh0aGlzLCB0eXBlLCBzaXplKTsKICAgIAkJCQkJQm94UGFyc2VyLmFkZFN1YkJveEFycmF5cy5jYWxsKHRoaXMsIHN1YkJveE5hbWVzKTsKICAgIAkJCQl9OwogICAgCQkJCUJveFBhcnNlclt0eXBlKyJCb3giXS5wcm90b3R5cGUgPSBuZXcgQm94UGFyc2VyLkNvbnRhaW5lckJveCgpOwogICAgCQkJCWlmIChwYXJzZU1ldGhvZCkgQm94UGFyc2VyW3R5cGUrIkJveCJdLnByb3RvdHlwZS5wYXJzZSA9IHBhcnNlTWV0aG9kOwogICAgCQkJfSwKICAgIAkJCWNyZWF0ZU1lZGlhU2FtcGxlRW50cnlDdG9yOiBmdW5jdGlvbihtZWRpYVR5cGUsIHBhcnNlTWV0aG9kLCBzdWJCb3hOYW1lcykgewogICAgCQkJCUJveFBhcnNlci5zYW1wbGVFbnRyeUNvZGVzW21lZGlhVHlwZV0gPSBbXTsKICAgIAkJCQlCb3hQYXJzZXJbbWVkaWFUeXBlKyJTYW1wbGVFbnRyeSJdID0gZnVuY3Rpb24odHlwZSwgc2l6ZSkgewogICAgCQkJCQlCb3hQYXJzZXIuU2FtcGxlRW50cnkuY2FsbCh0aGlzLCB0eXBlLCBzaXplKTsKICAgIAkJCQkJQm94UGFyc2VyLmFkZFN1YkJveEFycmF5cy5jYWxsKHRoaXMsIHN1YkJveE5hbWVzKTsKICAgIAkJCQl9OwogICAgCQkJCUJveFBhcnNlclttZWRpYVR5cGUrIlNhbXBsZUVudHJ5Il0ucHJvdG90eXBlID0gbmV3IEJveFBhcnNlci5TYW1wbGVFbnRyeSgpOwogICAgCQkJCWlmIChwYXJzZU1ldGhvZCkgQm94UGFyc2VyW21lZGlhVHlwZSsiU2FtcGxlRW50cnkiXS5wcm90b3R5cGUgLnBhcnNlID0gcGFyc2VNZXRob2Q7CiAgICAJCQl9LAogICAgCQkJY3JlYXRlU2FtcGxlRW50cnlDdG9yOiBmdW5jdGlvbihtZWRpYVR5cGUsIHR5cGUsIHBhcnNlTWV0aG9kLCBzdWJCb3hOYW1lcykgewogICAgCQkJCUJveFBhcnNlci5zYW1wbGVFbnRyeUNvZGVzW21lZGlhVHlwZV0ucHVzaCh0eXBlKTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiU2FtcGxlRW50cnkiXSA9IGZ1bmN0aW9uKHNpemUpIHsKICAgIAkJCQkJQm94UGFyc2VyW21lZGlhVHlwZSsiU2FtcGxlRW50cnkiXS5jYWxsKHRoaXMsIHR5cGUsIHNpemUpOwogICAgCQkJCQlCb3hQYXJzZXIuYWRkU3ViQm94QXJyYXlzLmNhbGwodGhpcywgc3ViQm94TmFtZXMpOwogICAgCQkJCX07CiAgICAJCQkJQm94UGFyc2VyW3R5cGUrIlNhbXBsZUVudHJ5Il0ucHJvdG90eXBlID0gbmV3IEJveFBhcnNlclttZWRpYVR5cGUrIlNhbXBsZUVudHJ5Il0oKTsKICAgIAkJCQlpZiAocGFyc2VNZXRob2QpIEJveFBhcnNlclt0eXBlKyJTYW1wbGVFbnRyeSJdLnByb3RvdHlwZS5wYXJzZSA9IHBhcnNlTWV0aG9kOwogICAgCQkJfSwKICAgIAkJCWNyZWF0ZUVuY3J5cHRlZFNhbXBsZUVudHJ5Q3RvcjogZnVuY3Rpb24obWVkaWFUeXBlLCB0eXBlLCBwYXJzZU1ldGhvZCkgewogICAgCQkJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IuY2FsbCh0aGlzLCBtZWRpYVR5cGUsIHR5cGUsIHBhcnNlTWV0aG9kLCBbInNpbmYiXSk7CiAgICAJCQl9LAogICAgCQkJY3JlYXRlU2FtcGxlR3JvdXBDdG9yOiBmdW5jdGlvbih0eXBlLCBwYXJzZU1ldGhvZCkgewogICAgCQkJCS8vQm94UGFyc2VyLnNhbXBsZUdyb3VwRW50cnlDb2Rlcy5wdXNoKHR5cGUpOwogICAgCQkJCUJveFBhcnNlclt0eXBlKyJTYW1wbGVHcm91cEVudHJ5Il0gPSBmdW5jdGlvbihzaXplKSB7CiAgICAJCQkJCUJveFBhcnNlci5TYW1wbGVHcm91cEVudHJ5LmNhbGwodGhpcywgdHlwZSwgc2l6ZSk7CiAgICAJCQkJfTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiU2FtcGxlR3JvdXBFbnRyeSJdLnByb3RvdHlwZSA9IG5ldyBCb3hQYXJzZXIuU2FtcGxlR3JvdXBFbnRyeSgpOwogICAgCQkJCWlmIChwYXJzZU1ldGhvZCkgQm94UGFyc2VyW3R5cGUrIlNhbXBsZUdyb3VwRW50cnkiXS5wcm90b3R5cGUucGFyc2UgPSBwYXJzZU1ldGhvZDsKICAgIAkJCX0sCiAgICAJCQljcmVhdGVUcmFja0dyb3VwQ3RvcjogZnVuY3Rpb24odHlwZSwgcGFyc2VNZXRob2QpIHsKICAgIAkJCQkvL0JveFBhcnNlci50cmFja0dyb3VwVHlwZXMucHVzaCh0eXBlKTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiVHJhY2tHcm91cFR5cGVCb3giXSA9IGZ1bmN0aW9uKHNpemUpIHsKICAgIAkJCQkJQm94UGFyc2VyLlRyYWNrR3JvdXBUeXBlQm94LmNhbGwodGhpcywgdHlwZSwgc2l6ZSk7CiAgICAJCQkJfTsKICAgIAkJCQlCb3hQYXJzZXJbdHlwZSsiVHJhY2tHcm91cFR5cGVCb3giXS5wcm90b3R5cGUgPSBuZXcgQm94UGFyc2VyLlRyYWNrR3JvdXBUeXBlQm94KCk7CiAgICAJCQkJaWYgKHBhcnNlTWV0aG9kKSBCb3hQYXJzZXJbdHlwZSsiVHJhY2tHcm91cFR5cGVCb3giXS5wcm90b3R5cGUucGFyc2UgPSBwYXJzZU1ldGhvZDsKICAgIAkJCX0sCiAgICAJCQljcmVhdGVVVUlEQm94OiBmdW5jdGlvbih1dWlkLCBpc0Z1bGxCb3gsIGlzQ29udGFpbmVyQm94LCBwYXJzZU1ldGhvZCkgewogICAgCQkJCUJveFBhcnNlci5VVUlEcy5wdXNoKHV1aWQpOwogICAgCQkJCUJveFBhcnNlci5VVUlEQm94ZXNbdXVpZF0gPSBmdW5jdGlvbihzaXplKSB7CiAgICAJCQkJCWlmIChpc0Z1bGxCb3gpIHsKICAgIAkJCQkJCUJveFBhcnNlci5GdWxsQm94LmNhbGwodGhpcywgInV1aWQiLCBzaXplLCB1dWlkKTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCWlmIChpc0NvbnRhaW5lckJveCkgewogICAgCQkJCQkJCUJveFBhcnNlci5Db250YWluZXJCb3guY2FsbCh0aGlzLCAidXVpZCIsIHNpemUsIHV1aWQpOwogICAgCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQlCb3hQYXJzZXIuQm94LmNhbGwodGhpcywgInV1aWQiLCBzaXplLCB1dWlkKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX07CiAgICAJCQkJQm94UGFyc2VyLlVVSURCb3hlc1t1dWlkXS5wcm90b3R5cGUgPSAoaXNGdWxsQm94ID8gbmV3IEJveFBhcnNlci5GdWxsQm94KCkgOiAoaXNDb250YWluZXJCb3ggPyBuZXcgQm94UGFyc2VyLkNvbnRhaW5lckJveCgpIDogbmV3IEJveFBhcnNlci5Cb3goKSkpOwogICAgCQkJCWlmIChwYXJzZU1ldGhvZCkgewogICAgCQkJCQlpZiAoaXNGdWxsQm94KSB7CiAgICAJCQkJCQlCb3hQYXJzZXIuVVVJREJveGVzW3V1aWRdLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJCQkJCXRoaXMucGFyc2VGdWxsSGVhZGVyKHN0cmVhbSk7CiAgICAJCQkJCQkJaWYgKHBhcnNlTWV0aG9kKSB7CiAgICAJCQkJCQkJCXBhcnNlTWV0aG9kLmNhbGwodGhpcywgc3RyZWFtKTsKICAgIAkJCQkJCQl9CiAgICAJCQkJCQl9OwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJQm94UGFyc2VyLlVVSURCb3hlc1t1dWlkXS5wcm90b3R5cGUucGFyc2UgPSBwYXJzZU1ldGhvZDsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5pbml0aWFsaXplKCk7CgogICAgCQlCb3hQYXJzZXIuVEtIRF9GTEFHX0VOQUJMRUQgICAgPSAweDAwMDAwMTsKICAgIAkJQm94UGFyc2VyLlRLSERfRkxBR19JTl9NT1ZJRSAgID0gMHgwMDAwMDI7CiAgICAJCUJveFBhcnNlci5US0hEX0ZMQUdfSU5fUFJFVklFVyA9IDB4MDAwMDA0OwoKICAgIAkJQm94UGFyc2VyLlRGSERfRkxBR19CQVNFX0RBVEFfT0ZGU0VUCT0gMHgwMTsKICAgIAkJQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfREVTQwkJCT0gMHgwMjsKICAgIAkJQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfRFVSCQkJPSAweDA4OwogICAgCQlCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9TSVpFCQkJPSAweDEwOwogICAgCQlCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9GTEFHUwkJPSAweDIwOwogICAgCQlCb3hQYXJzZXIuVEZIRF9GTEFHX0RVUl9FTVBUWQkJCT0gMHgxMDAwMDsKICAgIAkJQm94UGFyc2VyLlRGSERfRkxBR19ERUZBVUxUX0JBU0VfSVNfTU9PRj0gMHgyMDAwMDsKCiAgICAJCUJveFBhcnNlci5UUlVOX0ZMQUdTX0RBVEFfT0ZGU0VUPSAweDAxOwogICAgCQlCb3hQYXJzZXIuVFJVTl9GTEFHU19GSVJTVF9GTEFHCT0gMHgwNDsKICAgIAkJQm94UGFyc2VyLlRSVU5fRkxBR1NfRFVSQVRJT04JPSAweDEwMDsKICAgIAkJQm94UGFyc2VyLlRSVU5fRkxBR1NfU0laRQkJPSAweDIwMDsKICAgIAkJQm94UGFyc2VyLlRSVU5fRkxBR1NfRkxBR1MJCT0gMHg0MDA7CiAgICAJCUJveFBhcnNlci5UUlVOX0ZMQUdTX0NUU19PRkZTRVQJPSAweDgwMDsKCiAgICAJCUJveFBhcnNlci5Cb3gucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIAkJCXJldHVybiB0aGlzLmFkZEJveChuZXcgQm94UGFyc2VyW25hbWUrIkJveCJdKCkpOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLkJveC5wcm90b3R5cGUuYWRkQm94ID0gZnVuY3Rpb24oYm94KSB7CiAgICAJCQl0aGlzLmJveGVzLnB1c2goYm94KTsKICAgIAkJCWlmICh0aGlzW2JveC50eXBlKyJzIl0pIHsKICAgIAkJCQl0aGlzW2JveC50eXBlKyJzIl0ucHVzaChib3gpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aGlzW2JveC50eXBlXSA9IGJveDsKICAgIAkJCX0KICAgIAkJCXJldHVybiBib3g7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuQm94LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihwcm9wLCB2YWx1ZSkgewogICAgCQkJdGhpc1twcm9wXSA9IHZhbHVlOwogICAgCQkJcmV0dXJuIHRoaXM7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuQm94LnByb3RvdHlwZS5hZGRFbnRyeSA9IGZ1bmN0aW9uKHZhbHVlLCBfcHJvcCkgewogICAgCQkJdmFyIHByb3AgPSBfcHJvcCB8fCAiZW50cmllcyI7CiAgICAJCQlpZiAoIXRoaXNbcHJvcF0pIHsKICAgIAkJCQl0aGlzW3Byb3BdID0gW107CiAgICAJCQl9CiAgICAJCQl0aGlzW3Byb3BdLnB1c2godmFsdWUpOwogICAgCQkJcmV0dXJuIHRoaXM7CiAgICAJCX07CgogICAgCQl7CiAgICAJCQlleHBvcnRzLkJveFBhcnNlciA9IEJveFBhcnNlcjsKICAgIAkJfQogICAgCQkvLyBmaWxlOnNyYy9ib3gtcGFyc2UuanMKICAgIAkJLyogCiAgICAJCSAqIENvcHlyaWdodCAoYykgVGVsZWNvbSBQYXJpc1RlY2gvVFNJL01NL0dQQUMgQ3lyaWwgQ29uY29sYXRvCiAgICAJCSAqIExpY2Vuc2U6IEJTRC0zLUNsYXVzZSAoc2VlIExJQ0VOU0UgZmlsZSkKICAgIAkJICovCiAgICAJCUJveFBhcnNlci5wYXJzZVVVSUQgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXJldHVybiBCb3hQYXJzZXIucGFyc2VIZXgxNihzdHJlYW0pOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLnBhcnNlSGV4MTYgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBoZXgxNiA9ICIiOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPDE2OyBpKyspIHsKICAgIAkJCQl2YXIgaGV4ID0gc3RyZWFtLnJlYWRVaW50OCgpLnRvU3RyaW5nKDE2KTsKICAgIAkJCQloZXgxNiArPSAoaGV4Lmxlbmd0aCA9PT0gMSA/ICIwIitoZXggOiBoZXgpOwogICAgCQkJfQogICAgCQkJcmV0dXJuIGhleDE2OwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLnBhcnNlT25lQm94ID0gZnVuY3Rpb24oc3RyZWFtLCBoZWFkZXJPbmx5LCBwYXJlbnRTaXplKSB7CiAgICAJCQl2YXIgYm94OwogICAgCQkJdmFyIHN0YXJ0ID0gc3RyZWFtLmdldFBvc2l0aW9uKCk7CiAgICAJCQl2YXIgaGRyX3NpemUgPSAwOwogICAgCQkJdmFyIGRpZmY7CiAgICAJCQl2YXIgdXVpZDsKICAgIAkJCWlmIChzdHJlYW0uZ2V0RW5kUG9zaXRpb24oKSAtIHN0YXJ0IDwgOCkgewogICAgCQkJCUxvZy5kZWJ1ZygiQm94UGFyc2VyIiwgIk5vdCBlbm91Z2ggZGF0YSBpbiBzdHJlYW0gdG8gcGFyc2UgdGhlIHR5cGUgYW5kIHNpemUgb2YgdGhlIGJveCIpOwogICAgCQkJCXJldHVybiB7IGNvZGU6IEJveFBhcnNlci5FUlJfTk9UX0VOT1VHSF9EQVRBIH07CiAgICAJCQl9CiAgICAJCQlpZiAocGFyZW50U2l6ZSAmJiBwYXJlbnRTaXplIDwgOCkgewogICAgCQkJCUxvZy5kZWJ1ZygiQm94UGFyc2VyIiwgIk5vdCBlbm91Z2ggYnl0ZXMgbGVmdCBpbiB0aGUgcGFyZW50IGJveCB0byBwYXJzZSBhIG5ldyBib3giKTsKICAgIAkJCQlyZXR1cm4geyBjb2RlOiBCb3hQYXJzZXIuRVJSX05PVF9FTk9VR0hfREFUQSB9OwogICAgCQkJfQogICAgCQkJdmFyIHNpemUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdmFyIHR5cGUgPSBzdHJlYW0ucmVhZFN0cmluZyg0KTsKICAgIAkJCXZhciBib3hfdHlwZSA9IHR5cGU7CiAgICAJCQlMb2cuZGVidWcoIkJveFBhcnNlciIsICJGb3VuZCBib3ggb2YgdHlwZSAnIit0eXBlKyInIGFuZCBzaXplICIrc2l6ZSsiIGF0IHBvc2l0aW9uICIrc3RhcnQpOwogICAgCQkJaGRyX3NpemUgPSA4OwogICAgCQkJaWYgKHR5cGUgPT0gInV1aWQiKSB7CiAgICAJCQkJaWYgKChzdHJlYW0uZ2V0RW5kUG9zaXRpb24oKSAtIHN0cmVhbS5nZXRQb3NpdGlvbigpIDwgMTYpIHx8IChwYXJlbnRTaXplIC1oZHJfc2l6ZSA8IDE2KSkgewogICAgCQkJCQlzdHJlYW0uc2VlayhzdGFydCk7CiAgICAJCQkJCUxvZy5kZWJ1ZygiQm94UGFyc2VyIiwgIk5vdCBlbm91Z2ggYnl0ZXMgbGVmdCBpbiB0aGUgcGFyZW50IGJveCB0byBwYXJzZSBhIFVVSUQgYm94Iik7CiAgICAJCQkJCXJldHVybiB7IGNvZGU6IEJveFBhcnNlci5FUlJfTk9UX0VOT1VHSF9EQVRBIH07CiAgICAJCQkJfQogICAgCQkJCXV1aWQgPSBCb3hQYXJzZXIucGFyc2VVVUlEKHN0cmVhbSk7CiAgICAJCQkJaGRyX3NpemUgKz0gMTY7CiAgICAJCQkJYm94X3R5cGUgPSB1dWlkOwogICAgCQkJfQogICAgCQkJaWYgKHNpemUgPT0gMSkgewogICAgCQkJCWlmICgoc3RyZWFtLmdldEVuZFBvc2l0aW9uKCkgLSBzdHJlYW0uZ2V0UG9zaXRpb24oKSA8IDgpIHx8IChwYXJlbnRTaXplICYmIChwYXJlbnRTaXplIC0gaGRyX3NpemUpIDwgOCkpIHsKICAgIAkJCQkJc3RyZWFtLnNlZWsoc3RhcnQpOwogICAgCQkJCQlMb2cud2FybigiQm94UGFyc2VyIiwgIk5vdCBlbm91Z2ggZGF0YSBpbiBzdHJlYW0gdG8gcGFyc2UgdGhlIGV4dGVuZGVkIHNpemUgb2YgdGhlIFwiIit0eXBlKyJcIiBib3giKTsKICAgIAkJCQkJcmV0dXJuIHsgY29kZTogQm94UGFyc2VyLkVSUl9OT1RfRU5PVUdIX0RBVEEgfTsKICAgIAkJCQl9CiAgICAJCQkJc2l6ZSA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCQkJaGRyX3NpemUgKz0gODsKICAgIAkJCX0gZWxzZSBpZiAoc2l6ZSA9PT0gMCkgewogICAgCQkJCS8qIGJveCBleHRlbmRzIHRpbGwgdGhlIGVuZCBvZiBmaWxlIG9yIGludmFsaWQgZmlsZSAqLwogICAgCQkJCWlmIChwYXJlbnRTaXplKSB7CiAgICAJCQkJCXNpemUgPSBwYXJlbnRTaXplOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCS8qIGJveCBleHRlbmRzIHRpbGwgdGhlIGVuZCBvZiBmaWxlICovCiAgICAJCQkJCWlmICh0eXBlICE9PSAibWRhdCIpIHsKICAgIAkJCQkJCUxvZy5lcnJvcigiQm94UGFyc2VyIiwgIlVubGltaXRlZCBib3ggc2l6ZSBub3Qgc3VwcG9ydGVkIGZvciB0eXBlOiAnIit0eXBlKyInIik7CiAgICAJCQkJCQlib3ggPSBuZXcgQm94UGFyc2VyLkJveCh0eXBlLCBzaXplKTsKICAgIAkJCQkJCXJldHVybiB7IGNvZGU6IEJveFBhcnNlci5PSywgYm94OiBib3gsIHNpemU6IGJveC5zaXplIH07CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAoc2l6ZSAhPT0gMCAmJiBzaXplIDwgaGRyX3NpemUpIHsKICAgIAkJCQlMb2cuZXJyb3IoIkJveFBhcnNlciIsICJCb3ggb2YgdHlwZSAiK3R5cGUrIiBoYXMgYW4gaW52YWxpZCBzaXplICIrc2l6ZSsiICh0b28gc21hbGwgdG8gYmUgYSBib3gpIik7CiAgICAJCQkJcmV0dXJuIHsgY29kZTogQm94UGFyc2VyLkVSUl9OT1RfRU5PVUdIX0RBVEEsIHR5cGU6IHR5cGUsIHNpemU6IHNpemUsIGhkcl9zaXplOiBoZHJfc2l6ZSwgc3RhcnQ6IHN0YXJ0IH07CiAgICAJCQl9CiAgICAJCQlpZiAoc2l6ZSAhPT0gMCAmJiBwYXJlbnRTaXplICYmIHNpemUgPiBwYXJlbnRTaXplKSB7CiAgICAJCQkJTG9nLmVycm9yKCJCb3hQYXJzZXIiLCAiQm94IG9mIHR5cGUgJyIrdHlwZSsiJyBoYXMgYSBzaXplICIrc2l6ZSsiIGdyZWF0ZXIgdGhhbiBpdHMgY29udGFpbmVyIHNpemUgIitwYXJlbnRTaXplKTsKICAgIAkJCQlyZXR1cm4geyBjb2RlOiBCb3hQYXJzZXIuRVJSX05PVF9FTk9VR0hfREFUQSwgdHlwZTogdHlwZSwgc2l6ZTogc2l6ZSwgaGRyX3NpemU6IGhkcl9zaXplLCBzdGFydDogc3RhcnQgfTsKICAgIAkJCX0KICAgIAkJCWlmIChzaXplICE9PSAwICYmIHN0YXJ0ICsgc2l6ZSA+IHN0cmVhbS5nZXRFbmRQb3NpdGlvbigpKSB7CiAgICAJCQkJc3RyZWFtLnNlZWsoc3RhcnQpOwogICAgCQkJCUxvZy5pbmZvKCJCb3hQYXJzZXIiLCAiTm90IGVub3VnaCBkYXRhIGluIHN0cmVhbSB0byBwYXJzZSB0aGUgZW50aXJlICciK3R5cGUrIicgYm94Iik7CiAgICAJCQkJcmV0dXJuIHsgY29kZTogQm94UGFyc2VyLkVSUl9OT1RfRU5PVUdIX0RBVEEsIHR5cGU6IHR5cGUsIHNpemU6IHNpemUsIGhkcl9zaXplOiBoZHJfc2l6ZSwgc3RhcnQ6IHN0YXJ0IH07CiAgICAJCQl9CiAgICAJCQlpZiAoaGVhZGVyT25seSkgewogICAgCQkJCXJldHVybiB7IGNvZGU6IEJveFBhcnNlci5PSywgdHlwZTogdHlwZSwgc2l6ZTogc2l6ZSwgaGRyX3NpemU6IGhkcl9zaXplLCBzdGFydDogc3RhcnQgfTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJaWYgKEJveFBhcnNlclt0eXBlKyJCb3giXSkgewogICAgCQkJCQlib3ggPSBuZXcgQm94UGFyc2VyW3R5cGUrIkJveCJdKHNpemUpOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCWlmICh0eXBlICE9PSAidXVpZCIpIHsKICAgIAkJCQkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiVW5rbm93biBib3ggdHlwZTogJyIrdHlwZSsiJyIpOwogICAgCQkJCQkJYm94ID0gbmV3IEJveFBhcnNlci5Cb3godHlwZSwgc2l6ZSk7CiAgICAJCQkJCQlib3guaGFzX3VucGFyc2VkX2RhdGEgPSB0cnVlOwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJaWYgKEJveFBhcnNlci5VVUlEQm94ZXNbdXVpZF0pIHsKICAgIAkJCQkJCQlib3ggPSBuZXcgQm94UGFyc2VyLlVVSURCb3hlc1t1dWlkXShzaXplKTsKICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJTG9nLndhcm4oIkJveFBhcnNlciIsICJVbmtub3duIHV1aWQgdHlwZTogJyIrdXVpZCsiJyIpOwogICAgCQkJCQkJCWJveCA9IG5ldyBCb3hQYXJzZXIuQm94KHR5cGUsIHNpemUpOwogICAgCQkJCQkJCWJveC51dWlkID0gdXVpZDsKICAgIAkJCQkJCQlib3guaGFzX3VucGFyc2VkX2RhdGEgPSB0cnVlOwogICAgCQkJCQkJfQogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJYm94Lmhkcl9zaXplID0gaGRyX3NpemU7CiAgICAJCQkvKiByZWNvcmRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib3ggaW4gdGhlIGlucHV0IHN0cmVhbSAqLwogICAgCQkJYm94LnN0YXJ0ID0gc3RhcnQ7CiAgICAJCQlpZiAoYm94LndyaXRlID09PSBCb3hQYXJzZXIuQm94LnByb3RvdHlwZS53cml0ZSAmJiBib3gudHlwZSAhPT0gIm1kYXQiKSB7CiAgICAJCQkJTG9nLmluZm8oIkJveFBhcnNlciIsICInIitib3hfdHlwZSsiJyBib3ggd3JpdGluZyBub3QgeWV0IGltcGxlbWVudGVkLCBrZWVwaW5nIHVucGFyc2VkIGRhdGEgaW4gbWVtb3J5IGZvciBsYXRlciB3cml0ZSIpOwogICAgCQkJCWJveC5wYXJzZURhdGFBbmRSZXdpbmQoc3RyZWFtKTsKICAgIAkJCX0KICAgIAkJCWJveC5wYXJzZShzdHJlYW0pOwogICAgCQkJZGlmZiA9IHN0cmVhbS5nZXRQb3NpdGlvbigpIC0gKGJveC5zdGFydCtib3guc2l6ZSk7CiAgICAJCQlpZiAoZGlmZiA8IDApIHsKICAgIAkJCQlMb2cud2FybigiQm94UGFyc2VyIiwgIlBhcnNpbmcgb2YgYm94ICciK2JveF90eXBlKyInIGRpZCBub3QgcmVhZCB0aGUgZW50aXJlIGluZGljYXRlZCBib3ggZGF0YSBzaXplIChtaXNzaW5nICIrKC1kaWZmKSsiIGJ5dGVzKSwgc2Vla2luZyBmb3J3YXJkIik7CiAgICAJCQkJc3RyZWFtLnNlZWsoYm94LnN0YXJ0K2JveC5zaXplKTsKICAgIAkJCX0gZWxzZSBpZiAoZGlmZiA+IDApIHsKICAgIAkJCQlMb2cuZXJyb3IoIkJveFBhcnNlciIsICJQYXJzaW5nIG9mIGJveCAnIitib3hfdHlwZSsiJyByZWFkICIrZGlmZisiIG1vcmUgYnl0ZXMgdGhhbiB0aGUgaW5kaWNhdGVkIGJveCBkYXRhIHNpemUsIHNlZWtpbmcgYmFja3dhcmRzIik7CiAgICAJCQkJaWYgKGJveC5zaXplICE9PSAwKSBzdHJlYW0uc2Vlayhib3guc3RhcnQrYm94LnNpemUpOwogICAgCQkJfQogICAgCQkJcmV0dXJuIHsgY29kZTogQm94UGFyc2VyLk9LLCBib3g6IGJveCwgc2l6ZTogYm94LnNpemUgfTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5Cb3gucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy50eXBlICE9ICJtZGF0IikgewogICAgCQkJCXRoaXMuZGF0YSA9IHN0cmVhbS5yZWFkVWludDhBcnJheSh0aGlzLnNpemUtdGhpcy5oZHJfc2l6ZSk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCWlmICh0aGlzLnNpemUgPT09IDApIHsKICAgIAkJCQkJc3RyZWFtLnNlZWsoc3RyZWFtLmdldEVuZFBvc2l0aW9uKCkpOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXN0cmVhbS5zZWVrKHRoaXMuc3RhcnQrdGhpcy5zaXplKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvKiBVc2VkIHRvIHBhcnNlIGEgYm94IHdpdGhvdXQgY29uc3VtaW5nIGl0cyBkYXRhLCB0byBhbGxvdyBkZXRhaWxsZWQgcGFyc2luZwogICAgCQkgICBVc2VmdWwgZm9yIGJveGVzIGZvciB3aGljaCBhIHdyaXRlIG1ldGhvZCBpcyBub3QgeWV0IGltcGxlbWVudGVkICovCiAgICAJCUJveFBhcnNlci5Cb3gucHJvdG90eXBlLnBhcnNlRGF0YUFuZFJld2luZCA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5kYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRoaXMuc2l6ZS10aGlzLmhkcl9zaXplKTsKICAgIAkJCS8vIHJld2luZGluZwogICAgCQkJc3RyZWFtLnBvc2l0aW9uIC09IHRoaXMuc2l6ZS10aGlzLmhkcl9zaXplOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLkZ1bGxCb3gucHJvdG90eXBlLnBhcnNlRGF0YUFuZFJld2luZCA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYXJzZUZ1bGxIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXRoaXMuZGF0YSA9IHN0cmVhbS5yZWFkVWludDhBcnJheSh0aGlzLnNpemUtdGhpcy5oZHJfc2l6ZSk7CiAgICAJCQkvLyByZXN0b3JlIHRoZSBoZWFkZXIgc2l6ZSBhcyBpZiB0aGUgZnVsbCBoZWFkZXIgaGFkIG5vdCBiZWVuIHBhcnNlZAogICAgCQkJdGhpcy5oZHJfc2l6ZSAtPSA0OwogICAgCQkJLy8gcmV3aW5kaW5nCiAgICAJCQlzdHJlYW0ucG9zaXRpb24gLT0gdGhpcy5zaXplLXRoaXMuaGRyX3NpemU7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuRnVsbEJveC5wcm90b3R5cGUucGFyc2VGdWxsSGVhZGVyID0gZnVuY3Rpb24gKHN0cmVhbSkgewogICAgCQkJdGhpcy52ZXJzaW9uID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5mbGFncyA9IHN0cmVhbS5yZWFkVWludDI0KCk7CiAgICAJCQl0aGlzLmhkcl9zaXplICs9IDQ7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuRnVsbEJveC5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhcnNlRnVsbEhlYWRlcihzdHJlYW0pOwogICAgCQkJdGhpcy5kYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRoaXMuc2l6ZS10aGlzLmhkcl9zaXplKTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5Db250YWluZXJCb3gucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgcmV0OwogICAgCQkJdmFyIGJveDsKICAgIAkJCXdoaWxlIChzdHJlYW0uZ2V0UG9zaXRpb24oKSA8IHRoaXMuc3RhcnQrdGhpcy5zaXplKSB7CiAgICAJCQkJcmV0ID0gQm94UGFyc2VyLnBhcnNlT25lQm94KHN0cmVhbSwgZmFsc2UsIHRoaXMuc2l6ZSAtIChzdHJlYW0uZ2V0UG9zaXRpb24oKSAtIHRoaXMuc3RhcnQpKTsKICAgIAkJCQlpZiAocmV0LmNvZGUgPT09IEJveFBhcnNlci5PSykgewogICAgCQkJCQlib3ggPSByZXQuYm94OwogICAgCQkJCQkvKiBzdG9yZSB0aGUgYm94IGluIHRoZSAnYm94ZXMnIGFycmF5IHRvIHByZXNlcnZlIGJveCBvcmRlciAoZm9yIG9mZnNldCkgYnV0IGFsc28gc3RvcmUgYm94IGluIGEgcHJvcGVydHkgZm9yIG1vcmUgZGlyZWN0IGFjY2VzcyAqLwogICAgCQkJCQl0aGlzLmJveGVzLnB1c2goYm94KTsKICAgIAkJCQkJaWYgKHRoaXMuc3ViQm94TmFtZXMgJiYgdGhpcy5zdWJCb3hOYW1lcy5pbmRleE9mKGJveC50eXBlKSAhPSAtMSkgewogICAgCQkJCQkJdGhpc1t0aGlzLnN1YkJveE5hbWVzW3RoaXMuc3ViQm94TmFtZXMuaW5kZXhPZihib3gudHlwZSldKyJzIl0ucHVzaChib3gpOwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJdmFyIGJveF90eXBlID0gYm94LnR5cGUgIT09ICJ1dWlkIiA/IGJveC50eXBlIDogYm94LnV1aWQ7CiAgICAJCQkJCQlpZiAodGhpc1tib3hfdHlwZV0pIHsKICAgIAkJCQkJCQlMb2cud2FybigiQm94IG9mIHR5cGUgIitib3hfdHlwZSsiIGFscmVhZHkgc3RvcmVkIGluIGZpZWxkIG9mIHRoaXMgdHlwZSIpOwogICAgCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQl0aGlzW2JveF90eXBlXSA9IGJveDsKICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXJldHVybjsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuQm94LnByb3RvdHlwZS5wYXJzZUxhbmd1YWdlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmxhbmd1YWdlID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXZhciBjaGFycyA9IFtdOwogICAgCQkJY2hhcnNbMF0gPSAodGhpcy5sYW5ndWFnZT4+MTApJjB4MUY7CiAgICAJCQljaGFyc1sxXSA9ICh0aGlzLmxhbmd1YWdlPj41KSYweDFGOwogICAgCQkJY2hhcnNbMl0gPSAodGhpcy5sYW5ndWFnZSkmMHgxRjsKICAgIAkJCXRoaXMubGFuZ3VhZ2VTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXJzWzBdKzB4NjAsIGNoYXJzWzFdKzB4NjAsIGNoYXJzWzJdKzB4NjApOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVlbnRyaWVzL3NhbXBsZWVudHJ5LmpzCiAgICAJCUJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwgCQk9ICJWaXN1YWwiOwogICAgCQlCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfQVVESU8gCQk9ICJBdWRpbyI7CiAgICAJCUJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9ISU5UIAkJPSAiSGludCI7CiAgICAJCUJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9NRVRBREFUQSAJPSAiTWV0YWRhdGEiOwogICAgCQlCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfU1VCVElUTEUgCT0gIlN1YnRpdGxlIjsKICAgIAkJQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1NZU1RFTSAJCT0gIlN5c3RlbSI7CiAgICAJCUJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9URVhUIAkJPSAiVGV4dCI7CgogICAgCQlCb3hQYXJzZXIuU2FtcGxlRW50cnkucHJvdG90eXBlLnBhcnNlSGVhZGVyID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlzdHJlYW0ucmVhZFVpbnQ4QXJyYXkoNik7CiAgICAJCQl0aGlzLmRhdGFfcmVmZXJlbmNlX2luZGV4ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXRoaXMuaGRyX3NpemUgKz0gODsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMucGFyc2VIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXRoaXMuZGF0YSA9IHN0cmVhbS5yZWFkVWludDhBcnJheSh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplKTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUucGFyc2VEYXRhQW5kUmV3aW5kID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhcnNlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQl0aGlzLmRhdGEgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSk7CiAgICAJCQkvLyByZXN0b3JlIHRoZSBoZWFkZXIgc2l6ZSBhcyBpZiB0aGUgc2FtcGxlIGVudHJ5IGhlYWRlciBoYWQgbm90IGJlZW4gcGFyc2VkCiAgICAJCQl0aGlzLmhkcl9zaXplIC09IDg7CiAgICAJCQkvLyByZXdpbmRpbmcKICAgIAkJCXN0cmVhbS5wb3NpdGlvbiAtPSB0aGlzLnNpemUtdGhpcy5oZHJfc2l6ZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUucGFyc2VGb290ZXIgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCUJveFBhcnNlci5Db250YWluZXJCb3gucHJvdG90eXBlLnBhcnNlLmNhbGwodGhpcywgc3RyZWFtKTsKICAgIAkJfTsKCiAgICAJCS8vIEJhc2UgU2FtcGxlRW50cnkgdHlwZXMgd2l0aCBkZWZhdWx0IHBhcnNpbmcKICAgIAkJQm94UGFyc2VyLmNyZWF0ZU1lZGlhU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9ISU5UKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZU1lZGlhU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9NRVRBREFUQSk7CiAgICAJCUJveFBhcnNlci5jcmVhdGVNZWRpYVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfU1VCVElUTEUpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlTWVkaWFTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1NZU1RFTSk7CiAgICAJCUJveFBhcnNlci5jcmVhdGVNZWRpYVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVEVYVCk7CgogICAgCQkvL0Jhc2UgU2FtcGxlRW50cnkgdHlwZXMgZm9yIEF1ZGlvIGFuZCBWaWRlbyB3aXRoIHNwZWNpZmljIHBhcnNpbmcKICAgIAkJQm94UGFyc2VyLmNyZWF0ZU1lZGlhU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGNvbXByZXNzb3JuYW1lX2xlbmd0aDsKICAgIAkJCXRoaXMucGFyc2VIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQlzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJc3RyZWFtLnJlYWRVaW50MzJBcnJheSgzKTsKICAgIAkJCXRoaXMud2lkdGggPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5oZWlnaHQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5ob3JpenJlc29sdXRpb24gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy52ZXJ0cmVzb2x1dGlvbiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQlzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5mcmFtZV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQljb21wcmVzc29ybmFtZV9sZW5ndGggPSBNYXRoLm1pbigzMSwgc3RyZWFtLnJlYWRVaW50OCgpKTsKICAgIAkJCXRoaXMuY29tcHJlc3Nvcm5hbWUgPSBzdHJlYW0ucmVhZFN0cmluZyhjb21wcmVzc29ybmFtZV9sZW5ndGgpOwogICAgCQkJaWYgKGNvbXByZXNzb3JuYW1lX2xlbmd0aCA8IDMxKSB7CiAgICAJCQkJc3RyZWFtLnJlYWRTdHJpbmcoMzEgLSBjb21wcmVzc29ybmFtZV9sZW5ndGgpOwogICAgCQkJfQogICAgCQkJdGhpcy5kZXB0aCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQlzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5wYXJzZUZvb3RlcihzdHJlYW0pOwogICAgCQl9KTsKCiAgICAJCUJveFBhcnNlci5jcmVhdGVNZWRpYVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfQVVESU8sIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYXJzZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLnJlYWRVaW50MzJBcnJheSgyKTsKICAgIAkJCXRoaXMuY2hhbm5lbF9jb3VudCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLnNhbXBsZXNpemUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLnNhbXBsZXJhdGUgPSAoc3RyZWFtLnJlYWRVaW50MzIoKS8oMTw8MTYpKTsKICAgIAkJCXRoaXMucGFyc2VGb290ZXIoc3RyZWFtKTsKICAgIAkJfSk7CgogICAgCQkvLyBTYW1wbGUgZW50cmllcyBpbmhlcml0aW5nIGZyb20gQXVkaW8gYW5kIFZpZGVvCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgImF2YzEiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAiYXZjMiIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJhdmMzIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgImF2YzQiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAiYXYwMSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJkYXYxIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgImh2YzEiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAiaGV2MSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJodnQxIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgImxoZTEiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAiZHZoMSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJkdmhlIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgInZ2YzEiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAidnZpMSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJ2dnMxIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgInZ2Y04iKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAidnAwOCIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJ2cDA5Iik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgImF2czMiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAiajJraSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9WSVNVQUwsICJtanAyIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1ZJU1VBTCwgIm1qcGciKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLAkidW5jdiIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9BVURJTywgCSJtcDRhIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX0FVRElPLCAJImFjLTMiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfQVVESU8sIAkiYWMtNCIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9BVURJTywgCSJlYy0zIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX0FVRElPLCAJIk9wdXMiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfQVVESU8sIAkibWhhMSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9BVURJTywgCSJtaGEyIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX0FVRElPLCAJIm1obTEiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfQVVESU8sIAkibWhtMiIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9BVURJTywgCSJmTGFDIik7CgogICAgCQkvLyBFbmNyeXB0ZWQgc2FtcGxlIGVudHJpZXMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVuY3J5cHRlZFNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfVklTVUFMLCAJImVuY3YiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVuY3J5cHRlZFNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfQVVESU8sIAkiZW5jYSIpOwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW5jcnlwdGVkU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9TVUJUSVRMRSwgCSJlbmN1Iik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVFbmNyeXB0ZWRTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1NZU1RFTSwgCSJlbmNzIik7CiAgICAJCUJveFBhcnNlci5jcmVhdGVFbmNyeXB0ZWRTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1RFWFQsIAkJImVuY3QiKTsKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVuY3J5cHRlZFNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfTUVUQURBVEEsIAkiZW5jbSIpOwogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2ExbHguanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImExbHgiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBsYXJnZV9zaXplID0gc3RyZWFtLnJlYWRVaW50OCgpICYgMTsKICAgIAkJCXZhciBGaWVsZExlbmd0aCA9ICgobGFyZ2Vfc2l6ZSAmIDEpICsgMSkgKiAxNjsKICAgIAkJCXRoaXMubGF5ZXJfc2l6ZSA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgIAkJCQlpZiAoRmllbGRMZW5ndGggPT0gMTYpIHsKICAgIAkJCQkJdGhpcy5sYXllcl9zaXplW2ldID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQl0aGlzLmxheWVyX3NpemVbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy9hMW9wLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJhMW9wIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLm9wX2luZGV4ID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL2F1eEMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJhdXhDIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmF1eF90eXBlID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl2YXIgYXV4X3N1YnR5cGVfbGVuZ3RoID0gdGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSAtICh0aGlzLmF1eF90eXBlLmxlbmd0aCArIDEpOwogICAgCQkJdGhpcy5hdXhfc3VidHlwZSA9IHN0cmVhbS5yZWFkVWludDhBcnJheShhdXhfc3VidHlwZV9sZW5ndGgpOwogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL2F2MUMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImF2MUMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciB0bXAgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQlpZiAoKHRtcCA+PiA3KSAmIDB4MSAhPT0gMSkgewogICAgCQkJCUxvZy5lcnJvcigiYXYxQyBtYXJrZXIgcHJvYmxlbSIpOwogICAgCQkJCXJldHVybjsKICAgIAkJCX0KICAgIAkJCXRoaXMudmVyc2lvbiA9IHRtcCAmIDB4N0Y7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uICE9PSAxKSB7CiAgICAJCQkJTG9nLmVycm9yKCJhdjFDIHZlcnNpb24gIit0aGlzLnZlcnNpb24rIiBub3Qgc3VwcG9ydGVkIik7CiAgICAJCQkJcmV0dXJuOwogICAgCQkJfQogICAgCQkJdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5zZXFfcHJvZmlsZSA9ICh0bXAgPj4gNSkgJiAweDc7CiAgICAJCQl0aGlzLnNlcV9sZXZlbF9pZHhfMCA9IHRtcCAmIDB4MUY7CiAgICAJCQl0bXAgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLnNlcV90aWVyXzAgPSAodG1wID4+IDcpICYgMHgxOwogICAgCQkJdGhpcy5oaWdoX2JpdGRlcHRoID0gKHRtcCA+PiA2KSAmIDB4MTsKICAgIAkJCXRoaXMudHdlbHZlX2JpdCA9ICh0bXAgPj4gNSkgJiAweDE7CiAgICAJCQl0aGlzLm1vbm9jaHJvbWUgPSAodG1wID4+IDQpICYgMHgxOwogICAgCQkJdGhpcy5jaHJvbWFfc3Vic2FtcGxpbmdfeCA9ICh0bXAgPj4gMykgJiAweDE7CiAgICAJCQl0aGlzLmNocm9tYV9zdWJzYW1wbGluZ195ID0gKHRtcCA+PiAyKSAmIDB4MTsKICAgIAkJCXRoaXMuY2hyb21hX3NhbXBsZV9wb3NpdGlvbiA9ICh0bXAgJiAweDMpOwogICAgCQkJdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5yZXNlcnZlZF8xID0gKHRtcCA+PiA1KSAmIDB4NzsKICAgIAkJCWlmICh0aGlzLnJlc2VydmVkXzEgIT09IDApIHsKICAgIAkJCQlMb2cuZXJyb3IoImF2MUMgcmVzZXJ2ZWRfMSBwYXJzaW5nIHByb2JsZW0iKTsKICAgIAkJCQlyZXR1cm47CiAgICAJCQl9CiAgICAJCQl0aGlzLmluaXRpYWxfcHJlc2VudGF0aW9uX2RlbGF5X3ByZXNlbnQgPSAodG1wID4+IDQpICYgMHgxOwogICAgCQkJaWYgKHRoaXMuaW5pdGlhbF9wcmVzZW50YXRpb25fZGVsYXlfcHJlc2VudCA9PT0gMSkgewogICAgCQkJCXRoaXMuaW5pdGlhbF9wcmVzZW50YXRpb25fZGVsYXlfbWludXNfb25lID0gKHRtcCAmIDB4Rik7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMucmVzZXJ2ZWRfMiA9ICh0bXAgJiAweEYpOwogICAgCQkJCWlmICh0aGlzLnJlc2VydmVkXzIgIT09IDApIHsKICAgIAkJCQkJTG9nLmVycm9yKCJhdjFDIHJlc2VydmVkXzIgcGFyc2luZyBwcm9ibGVtIik7CiAgICAJCQkJCXJldHVybjsKICAgIAkJCQl9CiAgICAJCQl9CgogICAgCQkJdmFyIGNvbmZpZ09CVXNfbGVuZ3RoID0gdGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSAtIDQ7CiAgICAJCQl0aGlzLmNvbmZpZ09CVXMgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkoY29uZmlnT0JVc19sZW5ndGgpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvYXZjQy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiYXZjQyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGk7CiAgICAJCQl2YXIgdG9wYXJzZTsKICAgIAkJCXRoaXMuY29uZmlndXJhdGlvblZlcnNpb24gPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLkFWQ1Byb2ZpbGVJbmRpY2F0aW9uID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5wcm9maWxlX2NvbXBhdGliaWxpdHkgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLkFWQ0xldmVsSW5kaWNhdGlvbiA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMubGVuZ3RoU2l6ZU1pbnVzT25lID0gKHN0cmVhbS5yZWFkVWludDgoKSAmIDB4Myk7CiAgICAJCQl0aGlzLm5iX1NQU19uYWx1cyA9IChzdHJlYW0ucmVhZFVpbnQ4KCkgJiAweDFGKTsKICAgIAkJCXRvcGFyc2UgPSB0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplIC0gNjsKICAgIAkJCXRoaXMuU1BTID0gW107CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5uYl9TUFNfbmFsdXM7IGkrKykgewogICAgCQkJCXRoaXMuU1BTW2ldID0ge307CiAgICAJCQkJdGhpcy5TUFNbaV0ubGVuZ3RoID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl0aGlzLlNQU1tpXS5uYWx1ID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRoaXMuU1BTW2ldLmxlbmd0aCk7CiAgICAJCQkJdG9wYXJzZSAtPSAyK3RoaXMuU1BTW2ldLmxlbmd0aDsKICAgIAkJCX0KICAgIAkJCXRoaXMubmJfUFBTX25hbHVzID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdG9wYXJzZS0tOwogICAgCQkJdGhpcy5QUFMgPSBbXTsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLm5iX1BQU19uYWx1czsgaSsrKSB7CiAgICAJCQkJdGhpcy5QUFNbaV0gPSB7fTsKICAgIAkJCQl0aGlzLlBQU1tpXS5sZW5ndGggPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCXRoaXMuUFBTW2ldLm5hbHUgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5QUFNbaV0ubGVuZ3RoKTsKICAgIAkJCQl0b3BhcnNlIC09IDIrdGhpcy5QUFNbaV0ubGVuZ3RoOwogICAgCQkJfQogICAgCQkJaWYgKHRvcGFyc2U+MCkgewogICAgCQkJCXRoaXMuZXh0ID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRvcGFyc2UpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvYnRydC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiYnRydCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5idWZmZXJTaXplREIgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5tYXhCaXRyYXRlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuYXZnQml0cmF0ZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9jY3N0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiY2NzdCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGZsYWdzID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5hbGxfcmVmX3BpY3NfaW50cmEgPSAoKGZsYWdzICYgMHg4MCkgPT0gMHg4MCk7CiAgICAJCQl0aGlzLmludHJhX3ByZWRfdXNlZCA9ICgoZmxhZ3MgJiAweDQwKSA9PSAweDQwKTsKICAgIAkJCXRoaXMubWF4X3JlZl9wZXJfcGljID0gKChmbGFncyAmIDB4M2YpID4+IDIpOwogICAgCQkJc3RyZWFtLnJlYWRVaW50MjQoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2NkZWYuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImNkZWYiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJICAgIHZhciBpOwogICAgCQkgICAgdGhpcy5jaGFubmVsX2NvdW50ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMuY2hhbm5lbF9pbmRleGVzID0gW107CiAgICAJCSAgICB0aGlzLmNoYW5uZWxfdHlwZXMgPSBbXTsKICAgIAkJICAgIHRoaXMuY2hhbm5lbF9hc3NvY2lhdGlvbnMgPSBbXTsKICAgIAkJICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmNoYW5uZWxfY291bnQ7IGkrKykgewogICAgCQkgICAgICAgIHRoaXMuY2hhbm5lbF9pbmRleGVzLnB1c2goc3RyZWFtLnJlYWRVaW50MTYoKSk7CiAgICAJCSAgICAgICAgdGhpcy5jaGFubmVsX3R5cGVzLnB1c2goc3RyZWFtLnJlYWRVaW50MTYoKSk7CiAgICAJCSAgICAgICAgdGhpcy5jaGFubmVsX2Fzc29jaWF0aW9ucy5wdXNoKHN0cmVhbS5yZWFkVWludDE2KCkpOwogICAgCQkgICAgfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvY2xhcC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiY2xhcCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5jbGVhbkFwZXJ0dXJlV2lkdGhOID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuY2xlYW5BcGVydHVyZVdpZHRoRCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmNsZWFuQXBlcnR1cmVIZWlnaHROID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuY2xlYW5BcGVydHVyZUhlaWdodEQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5ob3Jpek9mZk4gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5ob3Jpek9mZkQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy52ZXJ0T2ZmTiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLnZlcnRPZmZEID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy9jbGxpLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJjbGxpIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLm1heF9jb250ZW50X2xpZ2h0X2xldmVsID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMubWF4X3BpY19hdmVyYWdlX2xpZ2h0X2xldmVsID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2NtZXguanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJjbWV4IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIDB4MSkgewogICAgCQkJCXRoaXMucG9zX3ggPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIDB4MikgewogICAgCQkJCXRoaXMucG9zX3kgPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIDB4NCkgewogICAgCQkJCXRoaXMucG9zX3ogPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIDB4OCkgewogICAgCQkJCWlmICh0aGlzLnZlcnNpb24gPT0gMCkgewogICAgCQkJCQlpZiAodGhpcy5mbGFncyAmIDB4MTApIHsKICAgIAkJCQkJCXRoaXMucXVhdF94ID0gc3RyZWFtLnJlYWRJbnQzMigpOwogICAgCQkJCQkJdGhpcy5xdWF0X3kgPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQkJCQl0aGlzLnF1YXRfeiA9IHN0cmVhbS5yZWFkSW50MzIoKTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCXRoaXMucXVhdF94ID0gc3RyZWFtLnJlYWRJbnQxNigpOwogICAgCQkJCQkJdGhpcy5xdWF0X3kgPSBzdHJlYW0ucmVhZEludDE2KCk7CiAgICAJCQkJCQl0aGlzLnF1YXRfeiA9IHN0cmVhbS5yZWFkSW50MTYoKTsKICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSBpZiAodGhpcy52ZXJzaW9uID09IDEpIDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgMHgyMCkgewogICAgCQkJCXRoaXMuaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQl9KTsKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9jbWluLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiY21pbiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5mb2NhbF9sZW5ndGhfeCA9IHN0cmVhbS5yZWFkSW50MzIoKTsKICAgIAkJCXRoaXMucHJpbmNpcGFsX3BvaW50X3ggPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQl0aGlzLnByaW5jaXBhbF9wb2ludF95ID0gc3RyZWFtLnJlYWRJbnQzMigpOwogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiAweDEpIHsKICAgIAkJCQl0aGlzLmZvY2FsX2xlbmd0aF95ID0gc3RyZWFtLnJlYWRJbnQzMigpOwogICAgCQkJCXRoaXMuc2tld19mYWN0b3IgPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQl9CiAgICAJCX0pOy8vIGZpbGU6c3JjL3BhcnNpbmcvY21wZC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiY21wZCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5jb21wb25lbnRfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5jb21wb25lbnRfdHlwZXMgPSBbXTsKICAgIAkJCXRoaXMuY29tcG9uZW50X3R5cGVfdXJscyA9IFtdOwogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMuY29tcG9uZW50X2NvdW50OyBpKyspIHsKICAgIAkJCQl2YXIgY29tcG9uZW50X3R5cGUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCXRoaXMuY29tcG9uZW50X3R5cGVzLnB1c2goY29tcG9uZW50X3R5cGUpOwogICAgCQkJCWlmIChjb21wb25lbnRfdHlwZSA+PSAweDgwMDApIHsKICAgIAkJCQkJdGhpcy5jb21wb25lbnRfdHlwZV91cmxzLnB1c2goc3RyZWFtLnJlYWRDU3RyaW5nKCkpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy9jbzY0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiY282NCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGVudHJ5X2NvdW50OwogICAgCQkJdmFyIGk7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmNodW5rX29mZnNldHMgPSBbXTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQlmb3IoaT0wOyBpPGVudHJ5X2NvdW50OyBpKyspIHsKICAgIAkJCQkJdGhpcy5jaHVua19vZmZzZXRzLnB1c2goc3RyZWFtLnJlYWRVaW50NjQoKSk7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvQ29MTC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoIkNvTEwiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMubWF4Q0xMID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMubWF4RkFMTCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9jb2xyLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJjb2xyIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmNvbG91cl90eXBlID0gc3RyZWFtLnJlYWRTdHJpbmcoNCk7CiAgICAJCQlpZiAodGhpcy5jb2xvdXJfdHlwZSA9PT0gJ25jbHgnKSB7CiAgICAJCQkJdGhpcy5jb2xvdXJfcHJpbWFyaWVzID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl0aGlzLnRyYW5zZmVyX2NoYXJhY3RlcmlzdGljcyA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJdGhpcy5tYXRyaXhfY29lZmZpY2llbnRzID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl2YXIgdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuZnVsbF9yYW5nZV9mbGFnID0gdG1wID4+IDc7CiAgICAJCQl9IGVsc2UgaWYgKHRoaXMuY29sb3VyX3R5cGUgPT09ICdySUNDJykgewogICAgCQkJCXRoaXMuSUNDX3Byb2ZpbGUgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5zaXplIC0gNCk7CiAgICAJCQl9IGVsc2UgaWYgKHRoaXMuY29sb3VyX3R5cGUgPT09ICdwcm9mJykgewogICAgCQkJCXRoaXMuSUNDX3Byb2ZpbGUgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5zaXplIC0gNCk7CiAgICAJCQl9CiAgICAJCX0pOy8vIGZpbGU6c3JjL3BhcnNpbmcvY3BydC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImNwcnQiLCBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhcnNlTGFuZ3VhZ2Uoc3RyZWFtKTsKICAgIAkJCXRoaXMubm90aWNlID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9jc2xnLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiY3NsZyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMCkgewogICAgCQkJCXRoaXMuY29tcG9zaXRpb25Ub0RUU1NoaWZ0ID0gc3RyZWFtLnJlYWRJbnQzMigpOyAvKiBzaWduZWQgKi8KICAgIAkJCQl0aGlzLmxlYXN0RGVjb2RlVG9EaXNwbGF5RGVsdGEgPSBzdHJlYW0ucmVhZEludDMyKCk7IC8qIHNpZ25lZCAqLwogICAgCQkJCXRoaXMuZ3JlYXRlc3REZWNvZGVUb0Rpc3BsYXlEZWx0YSA9IHN0cmVhbS5yZWFkSW50MzIoKTsgLyogc2lnbmVkICovCiAgICAJCQkJdGhpcy5jb21wb3NpdGlvblN0YXJ0VGltZSA9IHN0cmVhbS5yZWFkSW50MzIoKTsgLyogc2lnbmVkICovCiAgICAJCQkJdGhpcy5jb21wb3NpdGlvbkVuZFRpbWUgPSBzdHJlYW0ucmVhZEludDMyKCk7IC8qIHNpZ25lZCAqLwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvY3R0cy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImN0dHMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBlbnRyeV9jb3VudDsKICAgIAkJCXZhciBpOwogICAgCQkJZW50cnlfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5zYW1wbGVfY291bnRzID0gW107CiAgICAJCQl0aGlzLnNhbXBsZV9vZmZzZXRzID0gW107CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwKSB7CiAgICAJCQkJZm9yKGk9MDsgaTxlbnRyeV9jb3VudDsgaSsrKSB7CiAgICAJCQkJCXRoaXMuc2FtcGxlX2NvdW50cy5wdXNoKHN0cmVhbS5yZWFkVWludDMyKCkpOwogICAgCQkJCQkvKiBzb21lIGZpbGVzIGFyZSBidWdneSBhbmQgZGVjbGFyZSB2ZXJzaW9uPTAgd2hpbGUgdXNpbmcgc2lnbmVkIG9mZnNldHMuCiAgICAJCQkJCSAgIFRoZSBsaWtlbHlob29kIG9mIHVzaW5nIHRoZSBtb3N0IHNpZ25pZmljYW50IGJpdCBpbiBhIDMyLWJpdHMgdGltZSBvZmZzZXQgaXMgdmVyeSBsb3csCiAgICAJCQkJCSAgIHNvIHVzaW5nIHNpZ25lZCB2YWx1ZSBoZXJlIGFzIHdlbGwgKi8KICAgIAkJCQkJICAgdmFyIHZhbHVlID0gc3RyZWFtLnJlYWRJbnQzMigpOwogICAgCQkJCQkgICBpZiAodmFsdWUgPCAwKSB7CiAgICAJCQkJCSAgIAkJTG9nLndhcm4oIkJveFBhcnNlciIsICJjdHRzIGJveCB1c2VzIG5lZ2F0aXZlIHZhbHVlcyB3aXRob3V0IHVzaW5nIHZlcnNpb24gMSIpOwogICAgCQkJCQkgICB9CiAgICAJCQkJCXRoaXMuc2FtcGxlX29mZnNldHMucHVzaCh2YWx1ZSk7CiAgICAJCQkJfQogICAgCQkJfSBlbHNlIGlmICh0aGlzLnZlcnNpb24gPT0gMSkgewogICAgCQkJCWZvcihpPTA7IGk8ZW50cnlfY291bnQ7IGkrKykgewogICAgCQkJCQl0aGlzLnNhbXBsZV9jb3VudHMucHVzaChzdHJlYW0ucmVhZFVpbnQzMigpKTsKICAgIAkJCQkJdGhpcy5zYW1wbGVfb2Zmc2V0cy5wdXNoKHN0cmVhbS5yZWFkSW50MzIoKSk7IC8qIHNpZ25lZCAqLwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2RhYzMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImRhYzMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciB0bXBfYnl0ZTEgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl2YXIgdG1wX2J5dGUyID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdmFyIHRtcF9ieXRlMyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMuZnNjb2QgPSB0bXBfYnl0ZTEgPj4gNjsKICAgIAkJCXRoaXMuYnNpZCAgPSAoKHRtcF9ieXRlMSA+PiAxKSAmIDB4MUYpOwogICAgCQkJdGhpcy5ic21vZCA9ICgodG1wX2J5dGUxICYgMHgxKSA8PCAgMikgfCAoKHRtcF9ieXRlMiA+PiA2KSAmIDB4Myk7CiAgICAJCQl0aGlzLmFjbW9kID0gKCh0bXBfYnl0ZTIgPj4gMykgJiAweDcpOwogICAgCQkJdGhpcy5sZmVvbiA9ICgodG1wX2J5dGUyID4+IDIpICYgMHgxKTsKICAgIAkJCXRoaXMuYml0X3JhdGVfY29kZSA9ICh0bXBfYnl0ZTIgJiAweDMpIHwgKCh0bXBfYnl0ZTMgPj4gNSkgJiAweDcpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZGVjMy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZGVjMyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIHRtcF8xNiA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLmRhdGFfcmF0ZSA9IHRtcF8xNiA+PiAzOwogICAgCQkJdGhpcy5udW1faW5kX3N1YiA9IHRtcF8xNiAmIDB4NzsKICAgIAkJCXRoaXMuaW5kX3N1YnMgPSBbXTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5udW1faW5kX3N1YisxOyBpKyspIHsKICAgIAkJCQl2YXIgaW5kX3N1YiA9IHt9OwogICAgCQkJCXRoaXMuaW5kX3N1YnMucHVzaChpbmRfc3ViKTsKICAgIAkJCQl2YXIgdG1wX2J5dGUxID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXZhciB0bXBfYnl0ZTIgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJdmFyIHRtcF9ieXRlMyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQlpbmRfc3ViLmZzY29kID0gdG1wX2J5dGUxID4+IDY7CiAgICAJCQkJaW5kX3N1Yi5ic2lkICA9ICgodG1wX2J5dGUxID4+IDEpICYgMHgxRik7CiAgICAJCQkJaW5kX3N1Yi5ic21vZCA9ICgodG1wX2J5dGUxICYgMHgxKSA8PCA0KSB8ICgodG1wX2J5dGUyID4+IDQpICYgMHhGKTsKICAgIAkJCQlpbmRfc3ViLmFjbW9kID0gKCh0bXBfYnl0ZTIgPj4gMSkgJiAweDcpOwogICAgCQkJCWluZF9zdWIubGZlb24gPSAodG1wX2J5dGUyICYgMHgxKTsKICAgIAkJCQlpbmRfc3ViLm51bV9kZXBfc3ViID0gKCh0bXBfYnl0ZTMgPj4gMSkgJiAweEYpOwogICAgCQkJCWlmIChpbmRfc3ViLm51bV9kZXBfc3ViID4gMCkgewogICAgCQkJCQlpbmRfc3ViLmNoYW5fbG9jID0gKCh0bXBfYnl0ZTMgJiAweDEpIDw8IDgpIHwgc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2RmTGEuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJkZkxhIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCSAgICB2YXIgQkxPQ0tUWVBFX01BU0sgPSAweDdGOwogICAgCQkgICAgdmFyIExBU1RNRVRBREFUQUJMT0NLRkxBR19NQVNLID0gMHg4MDsKCiAgICAJCSAgICB2YXIgYm94ZXNGb3VuZCA9IFtdOwogICAgCQkgICAgdmFyIGtub3duQmxvY2tUeXBlcyA9IFsKICAgIAkJICAgICAgICAiU1RSRUFNSU5GTyIsCiAgICAJCSAgICAgICAgIlBBRERJTkciLAogICAgCQkgICAgICAgICJBUFBMSUNBVElPTiIsCiAgICAJCSAgICAgICAgIlNFRUtUQUJMRSIsCiAgICAJCSAgICAgICAgIlZPUkJJU19DT01NRU5UIiwKICAgIAkJICAgICAgICAiQ1VFU0hFRVQiLAogICAgCQkgICAgICAgICJQSUNUVVJFIiwKICAgIAkJICAgICAgICAiUkVTRVJWRUQiCiAgICAJCSAgICBdOwoKICAgIAkJICAgIC8vIGZvciAoaT0wOyA7IGkrKykgeyAvLyB0byBlbmQgb2YgYm94CiAgICAJCSAgICBkbyB7CiAgICAJCSAgICAgICAgdmFyIGZsYWdBbmRUeXBlID0gc3RyZWFtLnJlYWRVaW50OCgpOwoKICAgIAkJICAgICAgICB2YXIgdHlwZSA9IE1hdGgubWluKAogICAgCQkgICAgICAgICAgICAoZmxhZ0FuZFR5cGUgJiBCTE9DS1RZUEVfTUFTSyksCiAgICAJCSAgICAgICAgICAgIChrbm93bkJsb2NrVHlwZXMubGVuZ3RoIC0gMSkKICAgIAkJICAgICAgICApOwoKICAgIAkJICAgICAgICAvLyBpZiB0aGlzIGlzIGEgU1RSRUFNSU5GTyBibG9jaywgcmVhZCB0aGUgdHJ1ZSBzYW1wbGVyYXRlIHNpbmNlIHRoaXMKICAgIAkJICAgICAgICAvLyBjYW4gYmUgZGlmZmVyZW50IHRvIHRoZSBBdWRpb1NhbXBsZUVudHJ5IHNhbXBsZXJhdGUuCiAgICAJCSAgICAgICAgaWYgKCEodHlwZSkpIHsKICAgIAkJICAgICAgICAgICAgLy8gcmVhZCBwYXN0IGFsbCB0aGUgb3RoZXIgc3R1ZmYKICAgIAkJICAgICAgICAgICAgc3RyZWFtLnJlYWRVaW50OEFycmF5KDEzKTsKCiAgICAJCSAgICAgICAgICAgIC8vIGV4dHJhY3Qgc2FtcGxlcmF0ZQogICAgCQkgICAgICAgICAgICB0aGlzLnNhbXBsZXJhdGUgPSAoc3RyZWFtLnJlYWRVaW50MzIoKSA+PiAxMik7CgogICAgCQkgICAgICAgICAgICAvLyByZWFkIHRvIGVuZCBvZiBTVFJFQU1JTkZPCiAgICAJCSAgICAgICAgICAgIHN0cmVhbS5yZWFkVWludDhBcnJheSgyMCk7CiAgICAJCSAgICAgICAgfSBlbHNlIHsKICAgIAkJICAgICAgICAgICAgLy8gbm90IGludGVyZXN0ZWQgaW4gb3RoZXIgYmxvY2sgdHlwZXMgc28ganVzdCBkaXNjYXJkIGxlbmd0aCBieXRlcwogICAgCQkgICAgICAgICAgICBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkoc3RyZWFtLnJlYWRVaW50MjQoKSk7CiAgICAJCSAgICAgICAgfQoKICAgIAkJICAgICAgICBib3hlc0ZvdW5kLnB1c2goa25vd25CbG9ja1R5cGVzW3R5cGVdKTsKCiAgICAJCSAgICAgICAgaWYgKCEhKGZsYWdBbmRUeXBlICYgTEFTVE1FVEFEQVRBQkxPQ0tGTEFHX01BU0spKSB7CiAgICAJCSAgICAgICAgICAgIGJyZWFrOwogICAgCQkgICAgICAgIH0KICAgIAkJICAgIH0gd2hpbGUgKHRydWUpOwoKICAgIAkJICAgIHRoaXMubnVtTWV0YWRhdGFCbG9ja3MgPQogICAgCQkgICAgICAgIGJveGVzRm91bmQubGVuZ3RoICsgIiAoIiArIGJveGVzRm91bmQuam9pbigiLCAiKSArICIpIjsKICAgIAkJfSk7CiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZGltbS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZGltbSIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5ieXRlc3NlbnQgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZG1heC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZG1heCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy50aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2RtZWQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImRtZWQiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuYnl0ZXNzZW50ID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2RPcHMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImRPcHMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuVmVyc2lvbiA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMuT3V0cHV0Q2hhbm5lbENvdW50ID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5QcmVTa2lwID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXRoaXMuSW5wdXRTYW1wbGVSYXRlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuT3V0cHV0R2FpbiA9IHN0cmVhbS5yZWFkSW50MTYoKTsKICAgIAkJCXRoaXMuQ2hhbm5lbE1hcHBpbmdGYW1pbHkgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQlpZiAodGhpcy5DaGFubmVsTWFwcGluZ0ZhbWlseSAhPT0gMCkgewogICAgCQkJCXRoaXMuU3RyZWFtQ291bnQgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJdGhpcy5Db3VwbGVkQ291bnQgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJdGhpcy5DaGFubmVsTWFwcGluZyA9IFtdOwogICAgCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5PdXRwdXRDaGFubmVsQ291bnQ7IGkrKykgewogICAgCQkJCQl0aGlzLkNoYW5uZWxNYXBwaW5nW2ldID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2RyZWYuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJkcmVmIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgcmV0OwogICAgCQkJdmFyIGJveDsKICAgIAkJCXRoaXMuZW50cmllcyA9IFtdOwogICAgCQkJdmFyIGVudHJ5X2NvdW50ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgZW50cnlfY291bnQ7IGkrKykgewogICAgCQkJCXJldCA9IEJveFBhcnNlci5wYXJzZU9uZUJveChzdHJlYW0sIGZhbHNlLCB0aGlzLnNpemUgLSAoc3RyZWFtLmdldFBvc2l0aW9uKCkgLSB0aGlzLnN0YXJ0KSk7CiAgICAJCQkJaWYgKHJldC5jb2RlID09PSBCb3hQYXJzZXIuT0spIHsKICAgIAkJCQkJYm94ID0gcmV0LmJveDsKICAgIAkJCQkJdGhpcy5lbnRyaWVzLnB1c2goYm94KTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlyZXR1cm47CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZHJlcC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZHJlcCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5ieXRlc3NlbnQgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZWxuZy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImVsbmciLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuZXh0ZW5kZWRfbGFuZ3VhZ2UgPSBzdHJlYW0ucmVhZFN0cmluZyh0aGlzLnNpemUtdGhpcy5oZHJfc2l6ZSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9lbHN0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiZWxzdCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5lbnRyaWVzID0gW107CiAgICAJCQl2YXIgZW50cnlfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRyeV9jb3VudDsgaSsrKSB7CiAgICAJCQkJdmFyIGVudHJ5ID0ge307CiAgICAJCQkJdGhpcy5lbnRyaWVzLnB1c2goZW50cnkpOwogICAgCQkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQkJZW50cnkuc2VnbWVudF9kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCQkJCWVudHJ5Lm1lZGlhX3RpbWUgPSBzdHJlYW0ucmVhZEludDY0KCk7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJZW50cnkuc2VnbWVudF9kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJCWVudHJ5Lm1lZGlhX3RpbWUgPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQkJfQogICAgCQkJCWVudHJ5Lm1lZGlhX3JhdGVfaW50ZWdlciA9IHN0cmVhbS5yZWFkSW50MTYoKTsKICAgIAkJCQllbnRyeS5tZWRpYV9yYXRlX2ZyYWN0aW9uID0gc3RyZWFtLnJlYWRJbnQxNigpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZW1zZy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImVtc2ciLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT0gMSkgewogICAgCQkJCXRoaXMudGltZXNjYWxlIAkJCQkJPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXRoaXMucHJlc2VudGF0aW9uX3RpbWUgCQkJPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMuZXZlbnRfZHVyYXRpb24JCQkgCT0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmlkIAkJCQkJCT0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLnNjaGVtZV9pZF91cmkgCQkJCT0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQkJdGhpcy52YWx1ZSAJCQkJCQk9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aGlzLnNjaGVtZV9pZF91cmkgCQkJCT0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQkJdGhpcy52YWx1ZSAJCQkJCQk9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJCXRoaXMudGltZXNjYWxlIAkJCQkJPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXRoaXMucHJlc2VudGF0aW9uX3RpbWVfZGVsdGEgCT0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmV2ZW50X2R1cmF0aW9uCQkJIAk9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5pZCAJCQkJCQk9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCQl2YXIgbWVzc2FnZV9zaXplID0gdGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSAtICg0KjQgKyAodGhpcy5zY2hlbWVfaWRfdXJpLmxlbmd0aCsxKSArICh0aGlzLnZhbHVlLmxlbmd0aCsxKSk7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09IDEpIHsKICAgIAkJCQltZXNzYWdlX3NpemUgLT0gNDsKICAgIAkJCX0KICAgIAkJCXRoaXMubWVzc2FnZV9kYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KG1lc3NhZ2Vfc2l6ZSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9FbnRpdHlUb0dyb3VwLmpzCiAgICAJCS8vIElTTy9JRUMgMTQ0OTYtMTI6MjAyMiBTZWN0aW9uIDguMTguMyBFbnRpdHkgdG8gZ3JvdXAgYm94CiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3RvciA9IGZ1bmN0aW9uKHR5cGUsIHBhcnNlTWV0aG9kKSB7CiAgICAJCSAgICBCb3hQYXJzZXJbdHlwZSsiQm94Il0gPSBmdW5jdGlvbihzaXplKSB7CiAgICAJCSAgICAgICAgQm94UGFyc2VyLkZ1bGxCb3guY2FsbCh0aGlzLCB0eXBlLCBzaXplKTsKICAgIAkJICAgIH07CiAgICAJCSAgICBCb3hQYXJzZXJbdHlwZSsiQm94Il0ucHJvdG90eXBlID0gbmV3IEJveFBhcnNlci5GdWxsQm94KCk7CiAgICAJCSAgICBCb3hQYXJzZXJbdHlwZSsiQm94Il0ucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCSAgICAgICAgdGhpcy5wYXJzZUZ1bGxIZWFkZXIoc3RyZWFtKTsKICAgIAkJICAgICAgICBpZiAocGFyc2VNZXRob2QpIHsKICAgIAkJICAgICAgICAgICAgcGFyc2VNZXRob2QuY2FsbCh0aGlzLCBzdHJlYW0pOwogICAgCQkgICAgICAgIH0gZWxzZSB7CiAgICAJCSAgICAgICAgICAgIHRoaXMuZ3JvdXBfaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgICAgICAgICB0aGlzLm51bV9lbnRpdGllc19pbl9ncm91cCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCSAgICAgICAgICAgIHRoaXMuZW50aXR5X2lkcyA9IFtdOwogICAgCQkgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5udW1fZW50aXRpZXNfaW5fZ3JvdXA7IGkrKykgewogICAgCQkgICAgICAgICAgICAgICAgdmFyIGVudGl0eV9pZCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCSAgICAgICAgICAgICAgICB0aGlzLmVudGl0eV9pZHMucHVzaChlbnRpdHlfaWQpOwogICAgCQkgICAgICAgICAgICB9CiAgICAJCSAgICAgICAgfQogICAgCQkgICAgfTsKICAgIAkJfTsKCiAgICAJCS8vIEF1dG8gZXhwb3N1cmUgYnJhY2tldGluZyAoSVNPL0lFQyAyMzAwOC0xMjoyMDIyIFNlY3Rpb24gNi44LjYuMi4xKQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW50aXR5VG9Hcm91cEN0b3IoImFlYnIiKTsKCiAgICAJCS8vIEZsYXNoIGV4cG9zdXJlIGJyYWNrZXRpbmcgKElTTy9JRUMgMjMwMDgtMTI6MjAyMiBTZWN0aW9uIDYuOC42LjUuMSkKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVudGl0eVRvR3JvdXBDdG9yKCJhZmJyIik7CgogICAgCQkvLyBBbGJ1bSBjb2xsZWN0aW9uIChJU08vSUVDIDIzMDA4LTEyOjIwMjIgU2VjdGlvbiA2LjguNy4xKQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW50aXR5VG9Hcm91cEN0b3IoImFsYmMiKTsKCiAgICAJCS8vIEFsdGVybmF0aXZlIGVudGl0eSAoSVNPL0lFQyAxNDQ5Ni0xMjoyMDIyIFNlY3Rpb24gOC4xOC4zLjEpCiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3RvcigiYWx0ciIpOwoKICAgIAkJLy8gQnVyc3QgaW1hZ2UgZW50aXR5IGdyb3VwIChJU08vSUVDIDIzMDA4LTEyOjIwMjIgU2VjdGlvbiA2LjguMi4yKQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW50aXR5VG9Hcm91cEN0b3IoImJyc3QiKTsKCiAgICAJCS8vIERlcHRoIG9mIGZpZWxkIGJyYWNrZXRpbmcgKElTTy9JRUMgMjMwMDgtMTI6MjAyMiBTZWN0aW9uIDYuOC42LjYuMSkKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVudGl0eVRvR3JvdXBDdG9yKCJkb2JyIik7CgogICAgCQkvLyBFcXVpdmFsZW50IGVudGl0eSAoSVNPL0lFQyAyMzAwOC0xMjoyMDIyIFNlY3Rpb24gNi44LjEuMSkKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVudGl0eVRvR3JvdXBDdG9yKCJlcWl2Iik7CgogICAgCQkvLyBGYXZvdXJpdGVzIGNvbGxlY3Rpb24gKElTTy9JRUMgMjMwMDgtMTI6MjAyMiBTZWN0aW9uIDYuOC43LjIpCiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3RvcigiZmF2YyIpOwoKICAgIAkJLy8gRm9jdXMgYnJhY2tldGluZyAoSVNPL0lFQyAyMzAwOC0xMjoyMDIyIFNlY3Rpb24gNi44LjYuNC4xKQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW50aXR5VG9Hcm91cEN0b3IoImZvYnIiKTsKCiAgICAJCS8vIEF1ZGlvIHRvIGltYWdlIGVudGl0eSBncm91cCAoSVNPL0lFQyAyMzAwOC0xMjoyMDIyIFNlY3Rpb24gNi44LjQpCiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3RvcigiaWF1ZyIpOwoKICAgIAkJLy8gUGFub3JhbWEgKElTTy9JRUMgMjMwMDgtMTI6MjAyMiBTZWN0aW9uIDYuOC44LjEpCiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3RvcigicGFubyIpOwoKICAgIAkJLy8gU2xpZGVzaG93IChJU08vSUVDIDIzMDA4LTEyOjIwMjIgU2VjdGlvbiA2LjguOS4xKQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW50aXR5VG9Hcm91cEN0b3IoInNsaWQiKTsKCiAgICAJCS8vIFN0ZXJlbyBwYWlyIChJU08vSUVDIDIzMDA4LTEyOjIwMjIgU2VjdGlvbiA2LjguNSkKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVudGl0eVRvR3JvdXBDdG9yKCJzdGVyIik7CgogICAgCQkvLyBUaW1lLXN5bmNocm9uaXNlZCBjYXB0dXJlIGVudGl0eSBncm91cCAoSVNPL0lFQyAyMzAwOC0xMjoyMDIyIFNlY3Rpb24gNi44LjMpCiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3RvcigidHN5biIpOwoKICAgIAkJLy8gV2hpdGUgYmFsYW5jZSBicmFja2V0aW5nIChJU08vSUVDIDIzMDA4LTEyOjIwMjIgU2VjdGlvbiA2LjguNi4zLjEpCiAgICAJCUJveFBhcnNlci5jcmVhdGVFbnRpdHlUb0dyb3VwQ3Rvcigid2JiciIpOwoKICAgIAkJLy8gQWx0ZXJuYXRpdmUgZW50aXR5IChJU08vSUVDIDIzMDA4LTEyOjIwMjIgQU1EMSBTZWN0aW9uIDYuOC4xMCkKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUVudGl0eVRvR3JvdXBDdG9yKCJwcmdyIik7CgogICAgCQkvLyBJbWFnZSBQeXJhbWlkIGVudGl0eSBncm91cCAoSVNPL0lFQyAyMzAwOC0xMjoyMHh4IFNlY3Rpb24gNi44LjExKQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRW50aXR5VG9Hcm91cEN0b3IoInB5bWQiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJICAgIHRoaXMuZ3JvdXBfaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgdGhpcy5udW1fZW50aXRpZXNfaW5fZ3JvdXAgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgdGhpcy5lbnRpdHlfaWRzID0gW107CiAgICAJCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubnVtX2VudGl0aWVzX2luX2dyb3VwOyBpKyspIHsKICAgIAkJICAgICAgICB2YXIgZW50aXR5X2lkID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJICAgICAgICB0aGlzLmVudGl0eV9pZHMucHVzaChlbnRpdHlfaWQpOwogICAgCQkgICAgfQogICAgCQkgICAgCiAgICAJCSAgICB0aGlzLnRpbGVfc2l6ZV94ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMudGlsZV9zaXplX3kgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkgICAgdGhpcy5sYXllcl9iaW5uaW5nID0gW107CiAgICAJCSAgICB0aGlzLnRpbGVzX2luX2xheWVyX2NvbHVtbl9taW51czEgPSBbXTsKICAgIAkJICAgIHRoaXMudGlsZXNfaW5fbGF5ZXJfcm93X21pbnVzMSA9IFtdOwogICAgCQkgICAgZm9yIChpID0gMDsgaSA8IHRoaXMubnVtX2VudGl0aWVzX2luX2dyb3VwOyBpKyspIHsKICAgIAkJICAgICAgICB0aGlzLmxheWVyX2Jpbm5pbmdbaV0gPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkgICAgICAgIHRoaXMudGlsZXNfaW5fbGF5ZXJfcm93X21pbnVzMVtpXSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICAgICAgdGhpcy50aWxlc19pbl9sYXllcl9jb2x1bW5fbWludXMxW2ldID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIH0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2VzZHMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJlc2RzIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgZXNkX2RhdGEgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5zaXplLXRoaXMuaGRyX3NpemUpOwogICAgCQkJaWYgKHR5cGVvZiBNUEVHNERlc2NyaXB0b3JQYXJzZXIgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAJCQkJdmFyIGVzZF9wYXJzZXIgPSBuZXcgTVBFRzREZXNjcmlwdG9yUGFyc2VyKCk7CiAgICAJCQkJdGhpcy5lc2QgPSBlc2RfcGFyc2VyLnBhcnNlT25lRGVzY3JpcHRvcihuZXcgRGF0YVN0cmVhbShlc2RfZGF0YS5idWZmZXIsIDAsIERhdGFTdHJlYW0uQklHX0VORElBTikpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZmllbC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZmllbCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5maWVsZENvdW50ID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5maWVsZE9yZGVyaW5nID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZnJtYS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZnJtYSIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5kYXRhX2Zvcm1hdCA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvZnR5cC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiZnR5cCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIHRvcGFyc2UgPSB0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplOwogICAgCQkJdGhpcy5tYWpvcl9icmFuZCA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJdGhpcy5taW5vcl92ZXJzaW9uID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRvcGFyc2UgLT0gODsKICAgIAkJCXRoaXMuY29tcGF0aWJsZV9icmFuZHMgPSBbXTsKICAgIAkJCXZhciBpID0gMDsKICAgIAkJCXdoaWxlICh0b3BhcnNlPj00KSB7CiAgICAJCQkJdGhpcy5jb21wYXRpYmxlX2JyYW5kc1tpXSA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJCXRvcGFyc2UgLT0gNDsKICAgIAkJCQlpKys7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9oZGxyLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiaGRsciIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMCkgewogICAgCQkJCXN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5oYW5kbGVyID0gc3RyZWFtLnJlYWRTdHJpbmcoNCk7CiAgICAJCQkJc3RyZWFtLnJlYWRVaW50MzJBcnJheSgzKTsKICAgIAkJCQl0aGlzLm5hbWUgPSBzdHJlYW0ucmVhZFN0cmluZyh0aGlzLnNpemUtdGhpcy5oZHJfc2l6ZS0yMCk7CiAgICAJCQkJaWYgKHRoaXMubmFtZVt0aGlzLm5hbWUubGVuZ3RoLTFdPT09J1wwJykgewogICAgCQkJCQl0aGlzLm5hbWUgPSB0aGlzLm5hbWUuc2xpY2UoMCwtMSk7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvaHZjQy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiaHZjQyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGksIGo7CiAgICAJCQl2YXIgbGVuZ3RoOwogICAgCQkJdmFyIHRtcF9ieXRlOwogICAgCQkJdGhpcy5jb25maWd1cmF0aW9uVmVyc2lvbiA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRtcF9ieXRlID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5nZW5lcmFsX3Byb2ZpbGVfc3BhY2UgPSB0bXBfYnl0ZSA+PiA2OwogICAgCQkJdGhpcy5nZW5lcmFsX3RpZXJfZmxhZyA9ICh0bXBfYnl0ZSAmIDB4MjApID4+IDU7CiAgICAJCQl0aGlzLmdlbmVyYWxfcHJvZmlsZV9pZGMgPSAodG1wX2J5dGUgJiAweDFGKTsKICAgIAkJCXRoaXMuZ2VuZXJhbF9wcm9maWxlX2NvbXBhdGliaWxpdHkgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5nZW5lcmFsX2NvbnN0cmFpbnRfaW5kaWNhdG9yID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KDYpOwogICAgCQkJdGhpcy5nZW5lcmFsX2xldmVsX2lkYyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMubWluX3NwYXRpYWxfc2VnbWVudGF0aW9uX2lkYyA9IHN0cmVhbS5yZWFkVWludDE2KCkgJiAweEZGRjsKICAgIAkJCXRoaXMucGFyYWxsZWxpc21UeXBlID0gKHN0cmVhbS5yZWFkVWludDgoKSAmIDB4Myk7CiAgICAJCQl0aGlzLmNocm9tYV9mb3JtYXRfaWRjID0gKHN0cmVhbS5yZWFkVWludDgoKSAmIDB4Myk7CiAgICAJCQl0aGlzLmJpdF9kZXB0aF9sdW1hX21pbnVzOCA9IChzdHJlYW0ucmVhZFVpbnQ4KCkgJiAweDcpOwogICAgCQkJdGhpcy5iaXRfZGVwdGhfY2hyb21hX21pbnVzOCA9IChzdHJlYW0ucmVhZFVpbnQ4KCkgJiAweDcpOwogICAgCQkJdGhpcy5hdmdGcmFtZVJhdGUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdG1wX2J5dGUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmNvbnN0YW50RnJhbWVSYXRlID0gKHRtcF9ieXRlID4+IDYpOwogICAgCQkJdGhpcy5udW1UZW1wb3JhbExheWVycyA9ICh0bXBfYnl0ZSAmIDBYRCkgPj4gMzsKICAgIAkJCXRoaXMudGVtcG9yYWxJZE5lc3RlZCA9ICh0bXBfYnl0ZSAmIDBYNCkgPj4gMjsKICAgIAkJCXRoaXMubGVuZ3RoU2l6ZU1pbnVzT25lID0gKHRtcF9ieXRlICYgMFgzKTsKCiAgICAJCQl0aGlzLm5hbHVfYXJyYXlzID0gW107CiAgICAJCQl2YXIgbnVtT2ZBcnJheXMgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgbnVtT2ZBcnJheXM7IGkrKykgewogICAgCQkJCXZhciBuYWx1X2FycmF5ID0gW107CiAgICAJCQkJdGhpcy5uYWx1X2FycmF5cy5wdXNoKG5hbHVfYXJyYXkpOwogICAgCQkJCXRtcF9ieXRlID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCW5hbHVfYXJyYXkuY29tcGxldGVuZXNzID0gKHRtcF9ieXRlICYgMHg4MCkgPj4gNzsKICAgIAkJCQluYWx1X2FycmF5Lm5hbHVfdHlwZSA9IHRtcF9ieXRlICYgMHgzRjsKICAgIAkJCQl2YXIgbnVtTmFsdXMgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCWZvciAoaiA9IDA7IGogPCBudW1OYWx1czsgaisrKSB7CiAgICAJCQkJCXZhciBuYWx1ID0ge307CiAgICAJCQkJCW5hbHVfYXJyYXkucHVzaChuYWx1KTsKICAgIAkJCQkJbGVuZ3RoID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQkJbmFsdS5kYXRhICAgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9paW5mLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiaWluZiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIHJldDsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQl0aGlzLmVudHJ5X2NvdW50ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5lbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCQl0aGlzLml0ZW1faW5mb3MgPSBbXTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbnRyeV9jb3VudDsgaSsrKSB7CiAgICAJCQkJcmV0ID0gQm94UGFyc2VyLnBhcnNlT25lQm94KHN0cmVhbSwgZmFsc2UsIHRoaXMuc2l6ZSAtIChzdHJlYW0uZ2V0UG9zaXRpb24oKSAtIHRoaXMuc3RhcnQpKTsKICAgIAkJCQlpZiAocmV0LmNvZGUgPT09IEJveFBhcnNlci5PSykgewogICAgCQkJCQlpZiAocmV0LmJveC50eXBlICE9PSAiaW5mZSIpIHsKICAgIAkJCQkJCUxvZy5lcnJvcigiQm94UGFyc2VyIiwgIkV4cGVjdGVkICdpbmZlJyBib3gsIGdvdCAiK3JldC5ib3gudHlwZSk7CiAgICAJCQkJCX0KICAgIAkJCQkJdGhpcy5pdGVtX2luZm9zW2ldID0gcmV0LmJveDsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlyZXR1cm47CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvaWxvYy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImlsb2MiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBieXRlOwogICAgCQkJYnl0ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMub2Zmc2V0X3NpemUgPSAoYnl0ZSA+PiA0KSAmIDB4RjsKICAgIAkJCXRoaXMubGVuZ3RoX3NpemUgPSBieXRlICYgMHhGOwogICAgCQkJYnl0ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMuYmFzZV9vZmZzZXRfc2l6ZSA9IChieXRlID4+IDQpICYgMHhGOwogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMSB8fCB0aGlzLnZlcnNpb24gPT09IDIpIHsKICAgIAkJCQl0aGlzLmluZGV4X3NpemUgPSBieXRlICYgMHhGOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aGlzLmluZGV4X3NpemUgPSAwOwogICAgCQkJCS8vIHJlc2VydmVkID0gYnl0ZSAmIDB4RjsKICAgIAkJCX0KICAgIAkJCXRoaXMuaXRlbXMgPSBbXTsKICAgIAkJCXZhciBpdGVtX2NvdW50ID0gMDsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPCAyKSB7CiAgICAJCQkJaXRlbV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl9IGVsc2UgaWYgKHRoaXMudmVyc2lvbiA9PT0gMikgewogICAgCQkJCWl0ZW1fY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aHJvdyAidmVyc2lvbiBvZiBpbG9jIGJveCBub3Qgc3VwcG9ydGVkIjsKICAgIAkJCX0KICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgaXRlbV9jb3VudDsgaSsrKSB7CiAgICAJCQkJdmFyIGl0ZW0gPSB7fTsKICAgIAkJCQl0aGlzLml0ZW1zLnB1c2goaXRlbSk7CiAgICAJCQkJaWYgKHRoaXMudmVyc2lvbiA8IDIpIHsKICAgIAkJCQkJaXRlbS5pdGVtX0lEID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl9IGVsc2UgaWYgKHRoaXMudmVyc2lvbiA9PT0gMikgewogICAgCQkJCQlpdGVtLml0ZW1fSUQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXRocm93ICJ2ZXJzaW9uIG9mIGlsb2MgYm94IG5vdCBzdXBwb3J0ZWQiOwogICAgCQkJCX0KICAgIAkJCQlpZiAodGhpcy52ZXJzaW9uID09PSAxIHx8IHRoaXMudmVyc2lvbiA9PT0gMikgewogICAgCQkJCQlpdGVtLmNvbnN0cnVjdGlvbl9tZXRob2QgPSAoc3RyZWFtLnJlYWRVaW50MTYoKSAmIDB4Rik7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJaXRlbS5jb25zdHJ1Y3Rpb25fbWV0aG9kID0gMDsKICAgIAkJCQl9CiAgICAJCQkJaXRlbS5kYXRhX3JlZmVyZW5jZV9pbmRleCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJc3dpdGNoKHRoaXMuYmFzZV9vZmZzZXRfc2l6ZSkgewogICAgCQkJCQljYXNlIDA6CiAgICAJCQkJCQlpdGVtLmJhc2Vfb2Zmc2V0ID0gMDsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQljYXNlIDQ6CiAgICAJCQkJCQlpdGVtLmJhc2Vfb2Zmc2V0ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQljYXNlIDg6CiAgICAJCQkJCQlpdGVtLmJhc2Vfb2Zmc2V0ID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQlkZWZhdWx0OgogICAgCQkJCQkJdGhyb3cgIkVycm9yIHJlYWRpbmcgYmFzZSBvZmZzZXQgc2l6ZSI7CiAgICAJCQkJfQogICAgCQkJCXZhciBleHRlbnRfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCWl0ZW0uZXh0ZW50cyA9IFtdOwogICAgCQkJCWZvciAodmFyIGo9MDsgaiA8IGV4dGVudF9jb3VudDsgaisrKSB7CiAgICAJCQkJCXZhciBleHRlbnQgPSB7fTsKICAgIAkJCQkJaXRlbS5leHRlbnRzLnB1c2goZXh0ZW50KTsKICAgIAkJCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMSB8fCB0aGlzLnZlcnNpb24gPT09IDIpIHsKICAgIAkJCQkJCXN3aXRjaCh0aGlzLmluZGV4X3NpemUpIHsKICAgIAkJCQkJCQljYXNlIDA6CiAgICAJCQkJCQkJCWV4dGVudC5leHRlbnRfaW5kZXggPSAwOwogICAgCQkJCQkJCQlicmVhazsKICAgIAkJCQkJCQljYXNlIDQ6CiAgICAJCQkJCQkJCWV4dGVudC5leHRlbnRfaW5kZXggPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCQkJCQlicmVhazsKICAgIAkJCQkJCQljYXNlIDg6CiAgICAJCQkJCQkJCWV4dGVudC5leHRlbnRfaW5kZXggPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCQkJCQlicmVhazsKICAgIAkJCQkJCQlkZWZhdWx0OgogICAgCQkJCQkJCQl0aHJvdyAiRXJyb3IgcmVhZGluZyBleHRlbnQgaW5kZXgiOwogICAgCQkJCQkJfQogICAgCQkJCQl9CiAgICAJCQkJCXN3aXRjaCh0aGlzLm9mZnNldF9zaXplKSB7CiAgICAJCQkJCQljYXNlIDA6CiAgICAJCQkJCQkJZXh0ZW50LmV4dGVudF9vZmZzZXQgPSAwOwogICAgCQkJCQkJCWJyZWFrOwogICAgCQkJCQkJY2FzZSA0OgogICAgCQkJCQkJCWV4dGVudC5leHRlbnRfb2Zmc2V0ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJCQlicmVhazsKICAgIAkJCQkJCWNhc2UgODoKICAgIAkJCQkJCQlleHRlbnQuZXh0ZW50X29mZnNldCA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCQkJCQkJYnJlYWs7CiAgICAJCQkJCQlkZWZhdWx0OgogICAgCQkJCQkJCXRocm93ICJFcnJvciByZWFkaW5nIGV4dGVudCBpbmRleCI7CiAgICAJCQkJCX0KICAgIAkJCQkJc3dpdGNoKHRoaXMubGVuZ3RoX3NpemUpIHsKICAgIAkJCQkJCWNhc2UgMDoKICAgIAkJCQkJCQlleHRlbnQuZXh0ZW50X2xlbmd0aCA9IDA7CiAgICAJCQkJCQkJYnJlYWs7CiAgICAJCQkJCQljYXNlIDQ6CiAgICAJCQkJCQkJZXh0ZW50LmV4dGVudF9sZW5ndGggPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCQkJCWJyZWFrOwogICAgCQkJCQkJY2FzZSA4OgogICAgCQkJCQkJCWV4dGVudC5leHRlbnRfbGVuZ3RoID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCQkJCQlicmVhazsKICAgIAkJCQkJCWRlZmF1bHQ6CiAgICAJCQkJCQkJdGhyb3cgIkVycm9yIHJlYWRpbmcgZXh0ZW50IGluZGV4IjsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2ltaXIuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImltaXIiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciB0bXAgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLnJlc2VydmVkID0gdG1wID4+IDc7CiAgICAJCQl0aGlzLmF4aXMgPSB0bXAgJiAxOwogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL2luZmUuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJpbmZlIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwIHx8IHRoaXMudmVyc2lvbiA9PT0gMSkgewogICAgCQkJCXRoaXMuaXRlbV9JRCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJdGhpcy5pdGVtX3Byb3RlY3Rpb25faW5kZXggPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCXRoaXMuaXRlbV9uYW1lID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQkJdGhpcy5jb250ZW50X3R5cGUgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCQl0aGlzLmNvbnRlbnRfZW5jb2RpbmcgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQl0aGlzLmV4dGVuc2lvbl90eXBlID0gc3RyZWFtLnJlYWRTdHJpbmcoNCk7CiAgICAJCQkJTG9nLndhcm4oIkJveFBhcnNlciIsICJDYW5ub3QgcGFyc2UgZXh0ZW5zaW9uIHR5cGUiKTsKICAgIAkJCQlzdHJlYW0uc2Vlayh0aGlzLnN0YXJ0K3RoaXMuc2l6ZSk7CiAgICAJCQkJcmV0dXJuOwogICAgCQkJfQogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA+PSAyKSB7CiAgICAJCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMikgewogICAgCQkJCQl0aGlzLml0ZW1fSUQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCX0gZWxzZSBpZiAodGhpcy52ZXJzaW9uID09PSAzKSB7CiAgICAJCQkJCXRoaXMuaXRlbV9JRCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJfQogICAgCQkJCXRoaXMuaXRlbV9wcm90ZWN0aW9uX2luZGV4ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl0aGlzLml0ZW1fdHlwZSA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJCXRoaXMuaXRlbV9uYW1lID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQkJaWYgKHRoaXMuaXRlbV90eXBlID09PSAibWltZSIpIHsKICAgIAkJCQkJdGhpcy5jb250ZW50X3R5cGUgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCQkJdGhpcy5jb250ZW50X2VuY29kaW5nID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQkJfSBlbHNlIGlmICh0aGlzLml0ZW1fdHlwZSA9PT0gInVyaSAiKSB7CiAgICAJCQkJCXRoaXMuaXRlbV91cmlfdHlwZSA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvaXBtYS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImlwbWEiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBpLCBqOwogICAgCQkJZW50cnlfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5hc3NvY2lhdGlvbnMgPSBbXTsKICAgIAkJCWZvcihpPTA7IGk8ZW50cnlfY291bnQ7IGkrKykgewogICAgCQkJCXZhciBpdGVtX2Fzc29jID0ge307CiAgICAJCQkJdGhpcy5hc3NvY2lhdGlvbnMucHVzaChpdGVtX2Fzc29jKTsKICAgIAkJCQlpZiAodGhpcy52ZXJzaW9uIDwgMSkgewogICAgCQkJCQlpdGVtX2Fzc29jLmlkID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlpdGVtX2Fzc29jLmlkID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl9CiAgICAJCQkJdmFyIGFzc29jaWF0aW9uX2NvdW50ID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCWl0ZW1fYXNzb2MucHJvcHMgPSBbXTsKICAgIAkJCQlmb3IgKGogPSAwOyBqIDwgYXNzb2NpYXRpb25fY291bnQ7IGorKykgewogICAgCQkJCQl2YXIgdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCQl2YXIgcCA9IHt9OwogICAgCQkJCQlpdGVtX2Fzc29jLnByb3BzLnB1c2gocCk7CiAgICAJCQkJCXAuZXNzZW50aWFsID0gKCh0bXAgJiAweDgwKSA+PiA3KSA9PT0gMTsKICAgIAkJCQkJaWYgKHRoaXMuZmxhZ3MgJiAweDEpIHsKICAgIAkJCQkJCXAucHJvcGVydHlfaW5kZXggPSAodG1wICYgMHg3RikgPDwgOCB8IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCXAucHJvcGVydHlfaW5kZXggPSAodG1wICYgMHg3Rik7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9pcmVmLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiaXJlZiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIHJldDsKICAgIAkJCXZhciBib3g7CiAgICAJCQl0aGlzLnJlZmVyZW5jZXMgPSBbXTsKCiAgICAJCQl3aGlsZSAoc3RyZWFtLmdldFBvc2l0aW9uKCkgPCB0aGlzLnN0YXJ0K3RoaXMuc2l6ZSkgewogICAgCQkJCXJldCA9IEJveFBhcnNlci5wYXJzZU9uZUJveChzdHJlYW0sIHRydWUsIHRoaXMuc2l6ZSAtIChzdHJlYW0uZ2V0UG9zaXRpb24oKSAtIHRoaXMuc3RhcnQpKTsKICAgIAkJCQlpZiAocmV0LmNvZGUgPT09IEJveFBhcnNlci5PSykgewogICAgCQkJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwKSB7CiAgICAJCQkJCQlib3ggPSBuZXcgQm94UGFyc2VyLlNpbmdsZUl0ZW1UeXBlUmVmZXJlbmNlQm94KHJldC50eXBlLCByZXQuc2l6ZSwgcmV0Lmhkcl9zaXplLCByZXQuc3RhcnQpOwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJYm94ID0gbmV3IEJveFBhcnNlci5TaW5nbGVJdGVtVHlwZVJlZmVyZW5jZUJveExhcmdlKHJldC50eXBlLCByZXQuc2l6ZSwgcmV0Lmhkcl9zaXplLCByZXQuc3RhcnQpOwogICAgCQkJCQl9CiAgICAJCQkJCWlmIChib3gud3JpdGUgPT09IEJveFBhcnNlci5Cb3gucHJvdG90eXBlLndyaXRlICYmIGJveC50eXBlICE9PSAibWRhdCIpIHsKICAgIAkJCQkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCBib3gudHlwZSsiIGJveCB3cml0aW5nIG5vdCB5ZXQgaW1wbGVtZW50ZWQsIGtlZXBpbmcgdW5wYXJzZWQgZGF0YSBpbiBtZW1vcnkgZm9yIGxhdGVyIHdyaXRlIik7CiAgICAJCQkJCQlib3gucGFyc2VEYXRhQW5kUmV3aW5kKHN0cmVhbSk7CiAgICAJCQkJCX0KICAgIAkJCQkJYm94LnBhcnNlKHN0cmVhbSk7CiAgICAJCQkJCXRoaXMucmVmZXJlbmNlcy5wdXNoKGJveCk7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJcmV0dXJuOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvaXJvdC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigiaXJvdCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5hbmdsZSA9IHN0cmVhbS5yZWFkVWludDgoKSAmIDB4MzsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2lzcGUuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJpc3BlIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmltYWdlX3dpZHRoID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuaW1hZ2VfaGVpZ2h0ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy9raW5kLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigia2luZCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zY2hlbWVVUkkgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCXRoaXMudmFsdWUgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJfSk7CiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvbGV2YS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoImxldmEiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBjb3VudCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMubGV2ZWxzID0gW107CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIAkJCQl2YXIgbGV2ZWwgPSB7fTsKICAgIAkJCQl0aGlzLmxldmVsc1tpXSA9IGxldmVsOwogICAgCQkJCWxldmVsLnRyYWNrX0lEID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl2YXIgdG1wX2J5dGUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJbGV2ZWwucGFkZGluZ19mbGFnID0gdG1wX2J5dGUgPj4gNzsKICAgIAkJCQlsZXZlbC5hc3NpZ25tZW50X3R5cGUgPSB0bXBfYnl0ZSAmIDB4N0Y7CiAgICAJCQkJc3dpdGNoIChsZXZlbC5hc3NpZ25tZW50X3R5cGUpIHsKICAgIAkJCQkJY2FzZSAwOgogICAgCQkJCQkJbGV2ZWwuZ3JvdXBpbmdfdHlwZSA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJCWNhc2UgMToKICAgIAkJCQkJCWxldmVsLmdyb3VwaW5nX3R5cGUgPSBzdHJlYW0ucmVhZFN0cmluZyg0KTsKICAgIAkJCQkJCWxldmVsLmdyb3VwaW5nX3R5cGVfcGFyYW1ldGVyID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQljYXNlIDI6CiAgICAJCQkJCQlicmVhazsKICAgIAkJCQkJY2FzZSAzOgogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJCWNhc2UgNDoKICAgIAkJCQkJCWxldmVsLnN1Yl90cmFja19pZCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJCQlicmVhazsKICAgIAkJCQkJZGVmYXVsdDoKICAgIAkJCQkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiVW5rbm93biBsZXZhIGFzc2lnbmVtZW50IHR5cGUiKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9saHZDLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJsaHZDIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaSwgajsKICAgIAkJCXZhciB0bXBfYnl0ZTsKICAgIAkJCXRoaXMuY29uZmlndXJhdGlvblZlcnNpb24gPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLm1pbl9zcGF0aWFsX3NlZ21lbnRhdGlvbl9pZGMgPSBzdHJlYW0ucmVhZFVpbnQxNigpICYgMHhGRkY7CiAgICAJCQl0aGlzLnBhcmFsbGVsaXNtVHlwZSA9IChzdHJlYW0ucmVhZFVpbnQ4KCkgJiAweDMpOwogICAgCQkJdG1wX2J5dGUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLm51bVRlbXBvcmFsTGF5ZXJzID0gKHRtcF9ieXRlICYgMFhEKSA+PiAzOwogICAgCQkJdGhpcy50ZW1wb3JhbElkTmVzdGVkID0gKHRtcF9ieXRlICYgMFg0KSA+PiAyOwogICAgCQkJdGhpcy5sZW5ndGhTaXplTWludXNPbmUgPSAodG1wX2J5dGUgJiAwWDMpOwoKICAgIAkJCXRoaXMubmFsdV9hcnJheXMgPSBbXTsKICAgIAkJCXZhciBudW1PZkFycmF5cyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCBudW1PZkFycmF5czsgaSsrKSB7CiAgICAJCQkJdmFyIG5hbHVfYXJyYXkgPSBbXTsKICAgIAkJCQl0aGlzLm5hbHVfYXJyYXlzLnB1c2gobmFsdV9hcnJheSk7CiAgICAJCQkJdG1wX2J5dGUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJbmFsdV9hcnJheS5jb21wbGV0ZW5lc3MgPSAodG1wX2J5dGUgJiAweDgwKSA+PiA3OwogICAgCQkJCW5hbHVfYXJyYXkubmFsdV90eXBlID0gdG1wX2J5dGUgJiAweDNGOwogICAgCQkJCXZhciBudW1OYWx1cyA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJZm9yIChqID0gMDsgaiA8IG51bU5hbHVzOyBqKyspIHsKICAgIAkJCQkJdmFyIG5hbHUgPSB7fTsKICAgIAkJCQkJbmFsdV9hcnJheS5wdXNoKG5hbHUpOwogICAgCQkJCQl2YXIgbGVuZ3RoID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQkJbmFsdS5kYXRhICA9IHN0cmVhbS5yZWFkVWludDhBcnJheShsZW5ndGgpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL2xzZWwuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoImxzZWwiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMubGF5ZXJfaWQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL21heHIuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoIm1heHIiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMucGVyaW9kID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuYnl0ZXMgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvbWRjdi5qcwogICAgCQlmdW5jdGlvbiBDb2xvclBvaW50KHgsIHkpIHsKICAgIAkJICAgIHRoaXMueCA9IHg7CiAgICAJCSAgICB0aGlzLnkgPSB5OwogICAgCQl9CgogICAgCQlDb2xvclBvaW50LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgCQkgICAgcmV0dXJuICIoIit0aGlzLngrIiwiK3RoaXMueSsiKSI7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigibWRjdiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkgICAgdGhpcy5kaXNwbGF5X3ByaW1hcmllcyA9IFtdOwogICAgCQkgICAgdGhpcy5kaXNwbGF5X3ByaW1hcmllc1swXSA9IG5ldyBDb2xvclBvaW50KHN0cmVhbS5yZWFkVWludDE2KCksc3RyZWFtLnJlYWRVaW50MTYoKSk7CiAgICAJCSAgICB0aGlzLmRpc3BsYXlfcHJpbWFyaWVzWzFdID0gbmV3IENvbG9yUG9pbnQoc3RyZWFtLnJlYWRVaW50MTYoKSxzdHJlYW0ucmVhZFVpbnQxNigpKTsKICAgIAkJICAgIHRoaXMuZGlzcGxheV9wcmltYXJpZXNbMl0gPSBuZXcgQ29sb3JQb2ludChzdHJlYW0ucmVhZFVpbnQxNigpLHN0cmVhbS5yZWFkVWludDE2KCkpOwogICAgCQkgICAgdGhpcy53aGl0ZV9wb2ludCA9IG5ldyBDb2xvclBvaW50KHN0cmVhbS5yZWFkVWludDE2KCksc3RyZWFtLnJlYWRVaW50MTYoKSk7CiAgICAJCSAgICB0aGlzLm1heF9kaXNwbGF5X21hc3RlcmluZ19sdW1pbmFuY2UgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgdGhpcy5taW5fZGlzcGxheV9tYXN0ZXJpbmdfbHVtaW5hbmNlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL21kaGQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJtZGhkIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09IDEpIHsKICAgIAkJCQl0aGlzLmNyZWF0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMubW9kaWZpY2F0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMudGltZXNjYWxlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmR1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5jcmVhdGlvbl90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLm1vZGlmaWNhdGlvbl90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLnRpbWVzY2FsZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCQl0aGlzLnBhcnNlTGFuZ3VhZ2Uoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9tZWhkLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigibWVoZCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiAweDEpIHsKICAgIAkJCQlMb2cud2FybigiQm94UGFyc2VyIiwgIm1laGQgYm94IGluY29ycmVjdGx5IHVzZXMgZmxhZ3Mgc2V0IHRvIDEsIGNvbnZlcnRpbmcgdmVyc2lvbiB0byAxIik7CiAgICAJCQkJdGhpcy52ZXJzaW9uID0gMTsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT0gMSkgewogICAgCQkJCXRoaXMuZnJhZ21lbnRfZHVyYXRpb24gPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aGlzLmZyYWdtZW50X2R1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL21ldGEuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJtZXRhIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmJveGVzID0gW107CiAgICAJCQlCb3hQYXJzZXIuQ29udGFpbmVyQm94LnByb3RvdHlwZS5wYXJzZS5jYWxsKHRoaXMsIHN0cmVhbSk7CiAgICAJCX0pOwogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL21maGQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJtZmhkIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnNlcXVlbmNlX251bWJlciA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9tZnJvLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigibWZybyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5fc2l6ZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9tc2tDLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigibXNrQyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkgICAgdGhpcy5iaXRzX3Blcl9waXhlbCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL212aGQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJtdmhkIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09IDEpIHsKICAgIAkJCQl0aGlzLmNyZWF0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMubW9kaWZpY2F0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMudGltZXNjYWxlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmR1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5jcmVhdGlvbl90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLm1vZGlmaWNhdGlvbl90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLnRpbWVzY2FsZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCQl0aGlzLnJhdGUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy52b2x1bWUgPSBzdHJlYW0ucmVhZFVpbnQxNigpPj44OwogICAgCQkJc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXN0cmVhbS5yZWFkVWludDMyQXJyYXkoMik7CiAgICAJCQl0aGlzLm1hdHJpeCA9IHN0cmVhbS5yZWFkVWludDMyQXJyYXkoOSk7CiAgICAJCQlzdHJlYW0ucmVhZFVpbnQzMkFycmF5KDYpOwogICAgCQkJdGhpcy5uZXh0X3RyYWNrX2lkID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvbnBjay5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigibnBjayIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYWNrZXRzc2VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9udW1wLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJudW1wIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhY2tldHNzZW50ID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3BhZGIuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJwYWRiIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgc2FtcGxlX2NvdW50ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMucGFkYml0cyA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBNYXRoLmZsb29yKChzYW1wbGVfY291bnQrMSkvMik7IGkrKykgewogICAgCQkJCXRoaXMucGFkYml0cyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3Bhc3AuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoInBhc3AiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuaFNwYWNpbmcgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy52U3BhY2luZyA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOy8vIGZpbGU6c3JjL3BhcnNpbmcvcGF5bC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigicGF5bCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy50ZXh0ID0gc3RyZWFtLnJlYWRTdHJpbmcodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9wYXl0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJwYXl0IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBheWxvYWRJRCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl2YXIgY291bnQgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLnJ0cG1hcF9zdHJpbmcgPSBzdHJlYW0ucmVhZFN0cmluZyhjb3VudCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9wZGluLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigicGRpbiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGNvdW50ID0gKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUpLzg7CiAgICAJCQl0aGlzLnJhdGUgPSBbXTsKICAgIAkJCXRoaXMuaW5pdGlhbF9kZWxheSA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAJCQkJdGhpcy5yYXRlW2ldID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmluaXRpYWxfZGVsYXlbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvcGl0bS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInBpdG0iLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQl0aGlzLml0ZW1faWQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aGlzLml0ZW1faWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvcGl4aS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInBpeGkiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBpOwogICAgCQkJdGhpcy5udW1fY2hhbm5lbHMgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmJpdHNfcGVyX2NoYW5uZWxzID0gW107CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5udW1fY2hhbm5lbHM7IGkrKykgewogICAgCQkJCXRoaXMuYml0c19wZXJfY2hhbm5lbHNbaV0gPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9wbWF4LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJwbWF4IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmJ5dGVzID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3ByZGkuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJwcmRpIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnN0ZXBfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5pdGVtX2NvdW50ID0gW107CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIDB4MikgewogICAgCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdGVwX2NvdW50OyBpKyspIHsKICAgIAkJCQkJdGhpcy5pdGVtX2NvdW50W2ldID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOy8vIGZpbGU6c3JjL3BhcnNpbmcvcHJmdC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInByZnQiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMucmVmX3RyYWNrX2lkID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMubnRwX3RpbWVzdGFtcCA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwKSB7CiAgICAJCQkJdGhpcy5tZWRpYV90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5tZWRpYV90aW1lID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3Bzc2guanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJwc3NoIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnN5c3RlbV9pZCA9IEJveFBhcnNlci5wYXJzZUhleDE2KHN0cmVhbSk7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID4gMCkgewogICAgCQkJCXZhciBjb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5raWQgPSBbXTsKICAgIAkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIAkJCQkJdGhpcy5raWRbaV0gPSBCb3hQYXJzZXIucGFyc2VIZXgxNihzdHJlYW0pOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJCXZhciBkYXRhc2l6ZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQlpZiAoZGF0YXNpemUgPiAwKSB7CiAgICAJCQkJdGhpcy5kYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KGRhdGFzaXplKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3F0L2NsZWYuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJjbGVmIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLndpZHRoID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuaGVpZ2h0ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy9xdC9lbm9mLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigiZW5vZiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy53aWR0aCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmhlaWdodCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOy8vIGZpbGU6c3JjL3BhcnNpbmcvcXQvcHJvZi5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInByb2YiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMud2lkdGggPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5oZWlnaHQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL3F0L3RhcHQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUNvbnRhaW5lckJveEN0b3IoInRhcHQiLCBudWxsLCBbICJjbGVmIiwgInByb2YiLCAiZW5vZiJdKTsvLyBmaWxlOnNyYy9wYXJzaW5nL3J0cC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigicnRwICIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5kZXNjcmlwdGlvbmZvcm1hdCA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJdGhpcy5zZHB0ZXh0ID0gc3RyZWFtLnJlYWRTdHJpbmcodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSAtIDQpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2Fpby5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInNhaW8iLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCWlmICh0aGlzLmZsYWdzICYgMHgxKSB7CiAgICAJCQkJdGhpcy5hdXhfaW5mb190eXBlID0gc3RyZWFtLnJlYWRTdHJpbmcoNCk7CiAgICAJCQkJdGhpcy5hdXhfaW5mb190eXBlX3BhcmFtZXRlciA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCQl2YXIgY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5vZmZzZXQgPSBbXTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgCQkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQkJdGhpcy5vZmZzZXRbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXRoaXMub2Zmc2V0W2ldID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NhaXouanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJzYWl6IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIDB4MSkgewogICAgCQkJCXRoaXMuYXV4X2luZm9fdHlwZSA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJCXRoaXMuYXV4X2luZm9fdHlwZV9wYXJhbWV0ZXIgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9pbmZvX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLnNhbXBsZV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLnNhbXBsZV9pbmZvX3NpemUgPSBbXTsKICAgIAkJCWlmICh0aGlzLmRlZmF1bHRfc2FtcGxlX2luZm9fc2l6ZSA9PT0gMCkgewogICAgCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zYW1wbGVfY291bnQ7IGkrKykgewogICAgCQkJCQl0aGlzLnNhbXBsZV9pbmZvX3NpemVbaV0gPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZW50cmllcy9tZXR0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX01FVEFEQVRBLCAibWV0dCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYXJzZUhlYWRlcihzdHJlYW0pOwogICAgCQkJdGhpcy5jb250ZW50X2VuY29kaW5nID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLm1pbWVfZm9ybWF0ID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLnBhcnNlRm9vdGVyKHN0cmVhbSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVlbnRyaWVzL21ldHguanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfTUVUQURBVEEsICJtZXR4IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhcnNlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQl0aGlzLmNvbnRlbnRfZW5jb2RpbmcgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCXRoaXMubmFtZXNwYWNlID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLnNjaGVtYV9sb2NhdGlvbiA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJdGhpcy5wYXJzZUZvb3RlcihzdHJlYW0pOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZW50cmllcy9zYnR0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1NVQlRJVExFLCAic2J0dCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYXJzZUhlYWRlcihzdHJlYW0pOwogICAgCQkJdGhpcy5jb250ZW50X2VuY29kaW5nID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLm1pbWVfZm9ybWF0ID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLnBhcnNlRm9vdGVyKHN0cmVhbSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVlbnRyaWVzL3N0cHAuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfU1VCVElUTEUsICJzdHBwIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhcnNlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQl0aGlzLm5hbWVzcGFjZSA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJdGhpcy5zY2hlbWFfbG9jYXRpb24gPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCXRoaXMuYXV4aWxpYXJ5X21pbWVfdHlwZXMgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCXRoaXMucGFyc2VGb290ZXIoc3RyZWFtKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NhbXBsZWVudHJpZXMvc3R4dC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlRW50cnlDdG9yKEJveFBhcnNlci5TQU1QTEVfRU5UUllfVFlQRV9TVUJUSVRMRSwgInN0eHQiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMucGFyc2VIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXRoaXMuY29udGVudF9lbmNvZGluZyA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJdGhpcy5taW1lX2Zvcm1hdCA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJdGhpcy5wYXJzZUZvb3RlcihzdHJlYW0pOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZW50cmllcy90eDNnLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVFbnRyeUN0b3IoQm94UGFyc2VyLlNBTVBMRV9FTlRSWV9UWVBFX1NVQlRJVExFLCAidHgzZyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYXJzZUhlYWRlcihzdHJlYW0pOwogICAgCQkJdGhpcy5kaXNwbGF5RmxhZ3MgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5ob3Jpem9udGFsX2p1c3RpZmljYXRpb24gPSBzdHJlYW0ucmVhZEludDgoKTsKICAgIAkJCXRoaXMudmVydGljYWxfanVzdGlmaWNhdGlvbiA9IHN0cmVhbS5yZWFkSW50OCgpOwogICAgCQkJdGhpcy5iZ19jb2xvcl9yZ2JhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KDQpOwogICAgCQkJdGhpcy5ib3hfcmVjb3JkID0gc3RyZWFtLnJlYWRJbnQxNkFycmF5KDQpOwogICAgCQkJdGhpcy5zdHlsZV9yZWNvcmQgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkoMTIpOwogICAgCQkJdGhpcy5wYXJzZUZvb3RlcihzdHJlYW0pOwogICAgCQl9KTsKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVlbnRyaWVzL3d2dHQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUVudHJ5Q3RvcihCb3hQYXJzZXIuU0FNUExFX0VOVFJZX1RZUEVfTUVUQURBVEEsICJ3dnR0IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnBhcnNlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQl0aGlzLnBhcnNlRm9vdGVyKHN0cmVhbSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvYWxzdC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJhbHN0IiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXZhciByb2xsX2NvdW50ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXRoaXMuZmlyc3Rfb3V0cHV0X3NhbXBsZSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLnNhbXBsZV9vZmZzZXQgPSBbXTsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCByb2xsX2NvdW50OyBpKyspIHsKICAgIAkJCQl0aGlzLnNhbXBsZV9vZmZzZXRbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQkJdmFyIHJlbWFpbmluZyA9IHRoaXMuZGVzY3JpcHRpb25fbGVuZ3RoIC0gNCAtIDQqcm9sbF9jb3VudDsKICAgIAkJCXRoaXMubnVtX291dHB1dF9zYW1wbGVzID0gW107CiAgICAJCQl0aGlzLm51bV90b3RhbF9zYW1wbGVzID0gW107CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgcmVtYWluaW5nLzQ7IGkrKykgewogICAgCQkJCXRoaXMubnVtX291dHB1dF9zYW1wbGVzW2ldID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl0aGlzLm51bV90b3RhbF9zYW1wbGVzW2ldID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NhbXBsZWdyb3Vwcy9hdmxsLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVHcm91cEN0b3IoImF2bGwiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMubGF5ZXJOdW1iZXIgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmFjY3VyYXRlU3RhdGlzdGljc0ZsYWcgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmF2Z0JpdFJhdGUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5hdmdGcmFtZVJhdGUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZ3JvdXBzL2F2c3MuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUdyb3VwQ3RvcigiYXZzcyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zdWJTZXF1ZW5jZUlkZW50aWZpZXIgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5sYXllck51bWJlciA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXZhciB0bXBfYnl0ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMuZHVyYXRpb25GbGFnID0gdG1wX2J5dGUgPj4gNzsKICAgIAkJCXRoaXMuYXZnUmF0ZUZsYWcgPSAodG1wX2J5dGUgPj4gNikgJiAweDE7CiAgICAJCQlpZiAodGhpcy5kdXJhdGlvbkZsYWcpIHsKICAgIAkJCQl0aGlzLmR1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmF2Z1JhdGVGbGFnKSB7CiAgICAJCQkJdGhpcy5hY2N1cmF0ZVN0YXRpc3RpY3NGbGFnID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuYXZnQml0UmF0ZSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJdGhpcy5hdmdGcmFtZVJhdGUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJfQogICAgCQkJdGhpcy5kZXBlbmRlbmN5ID0gW107CiAgICAJCQl2YXIgbnVtUmVmZXJlbmNlcyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgbnVtUmVmZXJlbmNlczsgaSsrKSB7CiAgICAJCQkJdmFyIGRlcGVuZGVuY3lJbmZvID0ge307CiAgICAJCQkJdGhpcy5kZXBlbmRlbmN5LnB1c2goZGVwZW5kZW5jeUluZm8pOwogICAgCQkJCWRlcGVuZGVuY3lJbmZvLnN1YlNlcURpcmVjdGlvbkZsYWcgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJZGVwZW5kZW5jeUluZm8ubGF5ZXJOdW1iZXIgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJZGVwZW5kZW5jeUluZm8uc3ViU2VxdWVuY2VJZGVudGlmaWVyID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NhbXBsZWdyb3Vwcy9kdHJ0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVHcm91cEN0b3IoImR0cnQiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiU2FtcGxlIEdyb3VwIHR5cGU6ICIrdGhpcy5ncm91cGluZ190eXBlKyIgbm90IGZ1bGx5IHBhcnNlZCIpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZ3JvdXBzL212aWYuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUdyb3VwQ3RvcigibXZpZiIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJTG9nLndhcm4oIkJveFBhcnNlciIsICJTYW1wbGUgR3JvdXAgdHlwZTogIit0aGlzLmdyb3VwaW5nX3R5cGUrIiBub3QgZnVsbHkgcGFyc2VkIik7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvcHJvbC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJwcm9sIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnJvbGxfZGlzdGFuY2UgPSBzdHJlYW0ucmVhZEludDE2KCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvcmFwLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVHcm91cEN0b3IoInJhcCAiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciB0bXBfYnl0ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMubnVtX2xlYWRpbmdfc2FtcGxlc19rbm93biA9IHRtcF9ieXRlID4+IDc7CiAgICAJCQl0aGlzLm51bV9sZWFkaW5nX3NhbXBsZXMgPSB0bXBfYnl0ZSAmIDB4N0Y7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvcmFzaC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJyYXNoIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLm9wZXJhdGlvbl9wb2ludF9jb3VudCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQlpZiAodGhpcy5kZXNjcmlwdGlvbl9sZW5ndGggIT09IDIrKHRoaXMub3BlcmF0aW9uX3BvaW50X2NvdW50ID09PSAxPzI6dGhpcy5vcGVyYXRpb25fcG9pbnRfY291bnQqNikrOSkgewogICAgCQkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiTWlzbWF0Y2ggaW4gIit0aGlzLmdyb3VwaW5nX3R5cGUrIiBzYW1wbGUgZ3JvdXAgbGVuZ3RoIik7CiAgICAJCQkJdGhpcy5kYXRhID0gIHN0cmVhbS5yZWFkVWludDhBcnJheSh0aGlzLmRlc2NyaXB0aW9uX2xlbmd0aC0yKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJaWYgKHRoaXMub3BlcmF0aW9uX3BvaW50X2NvdW50ID09PSAxKSB7CiAgICAJCQkJCXRoaXMudGFyZ2V0X3JhdGVfc2hhcmUgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXRoaXMudGFyZ2V0X3JhdGVfc2hhcmUgPSBbXTsKICAgIAkJCQkJdGhpcy5hdmFpbGFibGVfYml0cmF0ZSA9IFtdOwogICAgCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub3BlcmF0aW9uX3BvaW50X2NvdW50OyBpKyspIHsKICAgIAkJCQkJCXRoaXMuYXZhaWxhYmxlX2JpdHJhdGVbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCQkJdGhpcy50YXJnZXRfcmF0ZV9zaGFyZVtpXSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQkJdGhpcy5tYXhpbXVtX2JpdHJhdGUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXRoaXMubWluaW11bV9iaXRyYXRlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmRpc2NhcmRfcHJpb3JpdHkgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvcm9sbC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJyb2xsIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnJvbGxfZGlzdGFuY2UgPSBzdHJlYW0ucmVhZEludDE2KCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvc2FtcGxlZ3JvdXAuanMKICAgIAkJQm94UGFyc2VyLlNhbXBsZUdyb3VwRW50cnkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlMb2cud2FybigiQm94UGFyc2VyIiwgIlVua25vd24gU2FtcGxlIEdyb3VwIHR5cGU6ICIrdGhpcy5ncm91cGluZ190eXBlKTsKICAgIAkJCXRoaXMuZGF0YSA9ICBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5kZXNjcmlwdGlvbl9sZW5ndGgpOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvc2NpZi5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJzY2lmIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlMb2cud2FybigiQm94UGFyc2VyIiwgIlNhbXBsZSBHcm91cCB0eXBlOiAiK3RoaXMuZ3JvdXBpbmdfdHlwZSsiIG5vdCBmdWxseSBwYXJzZWQiKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NhbXBsZWdyb3Vwcy9zY25tLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVHcm91cEN0b3IoInNjbm0iLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiU2FtcGxlIEdyb3VwIHR5cGU6ICIrdGhpcy5ncm91cGluZ190eXBlKyIgbm90IGZ1bGx5IHBhcnNlZCIpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZ3JvdXBzL3NlaWcuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUdyb3VwQ3Rvcigic2VpZyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5yZXNlcnZlZCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXZhciB0bXAgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmNyeXB0X2J5dGVfYmxvY2sgPSB0bXAgPj4gNDsKICAgIAkJCXRoaXMuc2tpcF9ieXRlX2Jsb2NrID0gdG1wICYgMHhGOwogICAgCQkJdGhpcy5pc1Byb3RlY3RlZCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMuUGVyX1NhbXBsZV9JVl9TaXplID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5LSUQgPSBCb3hQYXJzZXIucGFyc2VIZXgxNihzdHJlYW0pOwogICAgCQkJdGhpcy5jb25zdGFudF9JVl9zaXplID0gMDsKICAgIAkJCXRoaXMuY29uc3RhbnRfSVYgPSAwOwogICAgCQkJaWYgKHRoaXMuaXNQcm90ZWN0ZWQgPT09IDEgJiYgdGhpcy5QZXJfU2FtcGxlX0lWX1NpemUgPT09IDApIHsKICAgIAkJCQl0aGlzLmNvbnN0YW50X0lWX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJdGhpcy5jb25zdGFudF9JViA9IHN0cmVhbS5yZWFkVWludDhBcnJheSh0aGlzLmNvbnN0YW50X0lWX3NpemUpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZ3JvdXBzL3N0c2EuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUdyb3VwQ3Rvcigic3RzYSIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJTG9nLndhcm4oIkJveFBhcnNlciIsICJTYW1wbGUgR3JvdXAgdHlwZTogIit0aGlzLmdyb3VwaW5nX3R5cGUrIiBub3QgZnVsbHkgcGFyc2VkIik7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvc3luYy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJzeW5jIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgdG1wX2J5dGUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLk5BTF91bml0X3R5cGUgPSB0bXBfYnl0ZSAmIDB4M0Y7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvdGVsZS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJ0ZWxlIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgdG1wX2J5dGUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmxldmVsX2luZGVwZW5kZW50bHlfZGVjb2RhYmxlID0gdG1wX2J5dGUgPj4gNzsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NhbXBsZWdyb3Vwcy90c2FzLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVTYW1wbGVHcm91cEN0b3IoInRzYXMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiU2FtcGxlIEdyb3VwIHR5cGU6ICIrdGhpcy5ncm91cGluZ190eXBlKyIgbm90IGZ1bGx5IHBhcnNlZCIpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2FtcGxlZ3JvdXBzL3RzY2wuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVNhbXBsZUdyb3VwQ3RvcigidHNjbCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJTG9nLndhcm4oIkJveFBhcnNlciIsICJTYW1wbGUgR3JvdXAgdHlwZTogIit0aGlzLmdyb3VwaW5nX3R5cGUrIiBub3QgZnVsbHkgcGFyc2VkIik7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zYW1wbGVncm91cHMvdmlwci5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlU2FtcGxlR3JvdXBDdG9yKCJ2aXByIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlMb2cud2FybigiQm94UGFyc2VyIiwgIlNhbXBsZSBHcm91cCB0eXBlOiAiK3RoaXMuZ3JvdXBpbmdfdHlwZSsiIG5vdCBmdWxseSBwYXJzZWQiKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NiZ3AuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJzYmdwIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmdyb3VwaW5nX3R5cGUgPSBzdHJlYW0ucmVhZFN0cmluZyg0KTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQl0aGlzLmdyb3VwaW5nX3R5cGVfcGFyYW1ldGVyID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5ncm91cGluZ190eXBlX3BhcmFtZXRlciA9IDA7CiAgICAJCQl9CiAgICAJCQl0aGlzLmVudHJpZXMgPSBbXTsKICAgIAkJCXZhciBlbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IGVudHJ5X2NvdW50OyBpKyspIHsKICAgIAkJCQl2YXIgZW50cnkgPSB7fTsKICAgIAkJCQl0aGlzLmVudHJpZXMucHVzaChlbnRyeSk7CiAgICAJCQkJZW50cnkuc2FtcGxlX2NvdW50ID0gc3RyZWFtLnJlYWRJbnQzMigpOwogICAgCQkJCWVudHJ5Lmdyb3VwX2Rlc2NyaXB0aW9uX2luZGV4ID0gc3RyZWFtLnJlYWRJbnQzMigpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2JwbS5qcwogICAgCQlmdW5jdGlvbiBQaXhlbChyb3csIGNvbCkgewogICAgCQkJdGhpcy5iYWRfcGl4ZWxfcm93ID0gcm93OwogICAgCQkJdGhpcy5iYWRfcGl4ZWxfY29sdW1uID0gY29sOwogICAgCQl9CgogICAgCQlQaXhlbC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiBwaXhlbFRvU3RyaW5nKCkgewogICAgCQkJcmV0dXJuICJbcm93OiAiICsgdGhpcy5iYWRfcGl4ZWxfcm93ICsgIiwgY29sdW1uOiAiICsgdGhpcy5iYWRfcGl4ZWxfY29sdW1uICsgIl0iOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJzYnBtIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXRoaXMuY29tcG9uZW50X2NvdW50ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMuY29tcG9uZW50X2luZGV4ID0gW107CiAgICAJCSAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5jb21wb25lbnRfY291bnQ7IGkrKykgewogICAgCQkgICAgICAgIHRoaXMuY29tcG9uZW50X2luZGV4LnB1c2goc3RyZWFtLnJlYWRVaW50MTYoKSk7CiAgICAJCSAgICB9CiAgICAJCQl2YXIgZmxhZ3MgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmNvcnJlY3Rpb25fYXBwbGllZCA9ICgweDgwID09IChmbGFncyAmIDB4ODApKTsKICAgIAkJCXRoaXMubnVtX2JhZF9yb3dzID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMubnVtX2JhZF9jb2xzID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMubnVtX2JhZF9waXhlbHMgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5iYWRfcm93cyA9IFtdOwogICAgCQkJdGhpcy5iYWRfY29sdW1ucyA9IFtdOwogICAgCQkJdGhpcy5iYWRfcGl4ZWxzID0gW107CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5udW1fYmFkX3Jvd3M7IGkrKykgewogICAgCQkJCXRoaXMuYmFkX3Jvd3MucHVzaChzdHJlYW0ucmVhZFVpbnQzMigpKTsKICAgIAkJCX0KICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLm51bV9iYWRfY29sczsgaSsrKSB7CiAgICAJCQkJdGhpcy5iYWRfY29sdW1ucy5wdXNoKHN0cmVhbS5yZWFkVWludDMyKCkpOwogICAgCQkJfQogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMubnVtX2JhZF9waXhlbHM7IGkrKykgewogICAgCQkJCXZhciByb3cgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXZhciBjb2wgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXRoaXMuYmFkX3BpeGVscy5wdXNoKG5ldyBQaXhlbChyb3csIGNvbCkpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2NobS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInNjaG0iLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuc2NoZW1lX3R5cGUgPSBzdHJlYW0ucmVhZFN0cmluZyg0KTsKICAgIAkJCXRoaXMuc2NoZW1lX3ZlcnNpb24gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiAweDAwMDAwMSkgewogICAgCQkJCXRoaXMuc2NoZW1lX3VyaSA9IHN0cmVhbS5yZWFkU3RyaW5nKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUgLSA4KTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NkcC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3Rvcigic2RwICIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zZHB0ZXh0ID0gc3RyZWFtLnJlYWRTdHJpbmcodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zZHRwLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic2R0cCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIHRtcF9ieXRlOwogICAgCQkJdmFyIGNvdW50ID0gKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUpOwogICAgCQkJdGhpcy5pc19sZWFkaW5nID0gW107CiAgICAJCQl0aGlzLnNhbXBsZV9kZXBlbmRzX29uID0gW107CiAgICAJCQl0aGlzLnNhbXBsZV9pc19kZXBlbmRlZF9vbiA9IFtdOwogICAgCQkJdGhpcy5zYW1wbGVfaGFzX3JlZHVuZGFuY3kgPSBbXTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgCQkJCXRtcF9ieXRlID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuaXNfbGVhZGluZ1tpXSA9IHRtcF9ieXRlID4+IDY7CiAgICAJCQkJdGhpcy5zYW1wbGVfZGVwZW5kc19vbltpXSA9ICh0bXBfYnl0ZSA+PiA0KSAmIDB4MzsKICAgIAkJCQl0aGlzLnNhbXBsZV9pc19kZXBlbmRlZF9vbltpXSA9ICh0bXBfYnl0ZSA+PiAyKSAmIDB4MzsKICAgIAkJCQl0aGlzLnNhbXBsZV9oYXNfcmVkdW5kYW5jeVtpXSA9IHRtcF9ieXRlICYgMHgzOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2VuYy5qcwogICAgCQkvLyBDYW5ub3QgYmUgZnVsbHkgcGFyc2VkIGJlY2F1c2UgUGVyX1NhbXBsZV9JVl9TaXplIG5lZWRzIHRvIGJlIGtub3duDQogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInNlbmMiIC8qLCBmdW5jdGlvbihzdHJlYW0pIHsNCiAgICAJCQl0aGlzLnBhcnNlRnVsbEhlYWRlcihzdHJlYW0pOw0KICAgIAkJCXZhciBzYW1wbGVfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOw0KICAgIAkJCXRoaXMuc2FtcGxlcyA9IFtdOw0KICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgc2FtcGxlX2NvdW50OyBpKyspIHsNCiAgICAJCQkJdmFyIHNhbXBsZSA9IHt9Ow0KICAgIAkJCQkvLyB0ZW5jLmRlZmF1bHRfUGVyX1NhbXBsZV9JVl9TaXplIG9yIHNlaWcuUGVyX1NhbXBsZV9JVl9TaXplDQogICAgCQkJCXNhbXBsZS5Jbml0aWFsaXphdGlvblZlY3RvciA9IHRoaXMucmVhZFVpbnQ4QXJyYXkoUGVyX1NhbXBsZV9JVl9TaXplKjgpOw0KICAgIAkJCQlpZiAodGhpcy5mbGFncyAmIDB4Mikgew0KICAgIAkJCQkJc2FtcGxlLnN1YnNhbXBsZXMgPSBbXTsNCiAgICAJCQkJCXN1YnNhbXBsZV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDE2KCk7DQogICAgCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IHN1YnNhbXBsZV9jb3VudDsgaisrKSB7DQogICAgCQkJCQkJdmFyIHN1YnNhbXBsZSA9IHt9Ow0KICAgIAkJCQkJCXN1YnNhbXBsZS5CeXRlc09mQ2xlYXJEYXRhID0gc3RyZWFtLnJlYWRVaW50MTYoKTsNCiAgICAJCQkJCQlzdWJzYW1wbGUuQnl0ZXNPZlByb3RlY3RlZERhdGEgPSBzdHJlYW0ucmVhZFVpbnQzMigpOw0KICAgIAkJCQkJCXNhbXBsZS5zdWJzYW1wbGVzLnB1c2goc3Vic2FtcGxlKTsNCiAgICAJCQkJCX0NCiAgICAJCQkJfQ0KICAgIAkJCQkvLyBUT0RPDQogICAgCQkJCXRoaXMuc2FtcGxlcy5wdXNoKHNhbXBsZSk7DQogICAgCQkJfQ0KICAgIAkJfSovKTsNCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2dwZC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInNncGQiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuZ3JvdXBpbmdfdHlwZSA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJTG9nLmRlYnVnKCJCb3hQYXJzZXIiLCAiRm91bmQgU2FtcGxlIEdyb3VwcyBvZiB0eXBlICIrdGhpcy5ncm91cGluZ190eXBlKTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQl0aGlzLmRlZmF1bHRfbGVuZ3RoID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X2xlbmd0aCA9IDA7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID49IDIpIHsKICAgIAkJCQl0aGlzLmRlZmF1bHRfZ3JvdXBfZGVzY3JpcHRpb25faW5kZXggPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQkJdGhpcy5lbnRyaWVzID0gW107CiAgICAJCQl2YXIgZW50cnlfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRyeV9jb3VudDsgaSsrKSB7CiAgICAJCQkJdmFyIGVudHJ5OwogICAgCQkJCWlmIChCb3hQYXJzZXJbdGhpcy5ncm91cGluZ190eXBlKyJTYW1wbGVHcm91cEVudHJ5Il0pIHsKICAgIAkJCQkJZW50cnkgPSBuZXcgQm94UGFyc2VyW3RoaXMuZ3JvdXBpbmdfdHlwZSsiU2FtcGxlR3JvdXBFbnRyeSJdKHRoaXMuZ3JvdXBpbmdfdHlwZSk7CiAgICAJCQkJfSAgZWxzZSB7CiAgICAJCQkJCWVudHJ5ID0gbmV3IEJveFBhcnNlci5TYW1wbGVHcm91cEVudHJ5KHRoaXMuZ3JvdXBpbmdfdHlwZSk7CiAgICAJCQkJfQogICAgCQkJCXRoaXMuZW50cmllcy5wdXNoKGVudHJ5KTsKICAgIAkJCQlpZiAodGhpcy52ZXJzaW9uID09PSAxKSB7CiAgICAJCQkJCWlmICh0aGlzLmRlZmF1bHRfbGVuZ3RoID09PSAwKSB7CiAgICAJCQkJCQllbnRyeS5kZXNjcmlwdGlvbl9sZW5ndGggPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJZW50cnkuZGVzY3JpcHRpb25fbGVuZ3RoID0gdGhpcy5kZWZhdWx0X2xlbmd0aDsKICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCWVudHJ5LmRlc2NyaXB0aW9uX2xlbmd0aCA9IHRoaXMuZGVmYXVsdF9sZW5ndGg7CiAgICAJCQkJfQogICAgCQkJCWlmIChlbnRyeS53cml0ZSA9PT0gQm94UGFyc2VyLlNhbXBsZUdyb3VwRW50cnkucHJvdG90eXBlLndyaXRlKSB7CiAgICAJCQkJCUxvZy5pbmZvKCJCb3hQYXJzZXIiLCAiU2FtcGxlR3JvdXAgZm9yIHR5cGUgIit0aGlzLmdyb3VwaW5nX3R5cGUrIiB3cml0aW5nIG5vdCB5ZXQgaW1wbGVtZW50ZWQsIGtlZXBpbmcgdW5wYXJzZWQgZGF0YSBpbiBtZW1vcnkgZm9yIGxhdGVyIHdyaXRlIik7CiAgICAJCQkJCS8vIHN0b3JpbmcgZGF0YQogICAgCQkJCQllbnRyeS5kYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KGVudHJ5LmRlc2NyaXB0aW9uX2xlbmd0aCk7CiAgICAJCQkJCS8vIHJld2luZGluZwogICAgCQkJCQlzdHJlYW0ucG9zaXRpb24gLT0gZW50cnkuZGVzY3JpcHRpb25fbGVuZ3RoOwogICAgCQkJCX0KICAgIAkJCQllbnRyeS5wYXJzZShzdHJlYW0pOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2lkeC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInNpZHgiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMucmVmZXJlbmNlX0lEID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMudGltZXNjYWxlID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQl0aGlzLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmZpcnN0X29mZnNldCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMuZWFybGllc3RfcHJlc2VudGF0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMuZmlyc3Rfb2Zmc2V0ID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCX0KICAgIAkJCXN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLnJlZmVyZW5jZXMgPSBbXTsKICAgIAkJCXZhciBjb3VudCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIAkJCQl2YXIgcmVmID0ge307CiAgICAJCQkJdGhpcy5yZWZlcmVuY2VzLnB1c2gocmVmKTsKICAgIAkJCQl2YXIgdG1wXzMyID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQlyZWYucmVmZXJlbmNlX3R5cGUgPSAodG1wXzMyID4+IDMxKSAmIDB4MTsKICAgIAkJCQlyZWYucmVmZXJlbmNlZF9zaXplID0gdG1wXzMyICYgMHg3RkZGRkZGRjsKICAgIAkJCQlyZWYuc3Vic2VnbWVudF9kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdG1wXzMyID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQlyZWYuc3RhcnRzX3dpdGhfU0FQID0gKHRtcF8zMiA+PiAzMSkgJiAweDE7CiAgICAJCQkJcmVmLlNBUF90eXBlID0gKHRtcF8zMiA+PiAyOCkgJiAweDc7CiAgICAJCQkJcmVmLlNBUF9kZWx0YV90aW1lID0gdG1wXzMyICYgMHhGRkZGRkZGOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc2luZ2xlaXRlbXR5cGVyZWZlcmVuY2UuanMKICAgIAkJQm94UGFyc2VyLlNpbmdsZUl0ZW1UeXBlUmVmZXJlbmNlQm94ID0gZnVuY3Rpb24odHlwZSwgc2l6ZSwgaGRyX3NpemUsIHN0YXJ0KSB7CiAgICAJCQlCb3hQYXJzZXIuQm94LmNhbGwodGhpcywgdHlwZSwgc2l6ZSk7CiAgICAJCQl0aGlzLmhkcl9zaXplID0gaGRyX3NpemU7CiAgICAJCQl0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICAJCX07CiAgICAJCUJveFBhcnNlci5TaW5nbGVJdGVtVHlwZVJlZmVyZW5jZUJveC5wcm90b3R5cGUgPSBuZXcgQm94UGFyc2VyLkJveCgpOwogICAgCQlCb3hQYXJzZXIuU2luZ2xlSXRlbVR5cGVSZWZlcmVuY2VCb3gucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmZyb21faXRlbV9JRCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl2YXIgY291bnQgPSAgc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXRoaXMucmVmZXJlbmNlcyA9IFtdOwogICAgCQkJZm9yKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIAkJCQl0aGlzLnJlZmVyZW5jZXNbaV0gPSB7fTsKICAgIAkJCQl0aGlzLnJlZmVyZW5jZXNbaV0udG9faXRlbV9JRCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3NpbmdsZWl0ZW10eXBlcmVmZXJlbmNlbGFyZ2UuanMKICAgIAkJQm94UGFyc2VyLlNpbmdsZUl0ZW1UeXBlUmVmZXJlbmNlQm94TGFyZ2UgPSBmdW5jdGlvbih0eXBlLCBzaXplLCBoZHJfc2l6ZSwgc3RhcnQpIHsKICAgIAkJCUJveFBhcnNlci5Cb3guY2FsbCh0aGlzLCB0eXBlLCBzaXplKTsKICAgIAkJCXRoaXMuaGRyX3NpemUgPSBoZHJfc2l6ZTsKICAgIAkJCXRoaXMuc3RhcnQgPSBzdGFydDsKICAgIAkJfTsKICAgIAkJQm94UGFyc2VyLlNpbmdsZUl0ZW1UeXBlUmVmZXJlbmNlQm94TGFyZ2UucHJvdG90eXBlID0gbmV3IEJveFBhcnNlci5Cb3goKTsKICAgIAkJQm94UGFyc2VyLlNpbmdsZUl0ZW1UeXBlUmVmZXJlbmNlQm94TGFyZ2UucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmZyb21faXRlbV9JRCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl2YXIgY291bnQgPSAgc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXRoaXMucmVmZXJlbmNlcyA9IFtdOwogICAgCQkJZm9yKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIAkJCQl0aGlzLnJlZmVyZW5jZXNbaV0gPSB7fTsKICAgIAkJCQl0aGlzLnJlZmVyZW5jZXNbaV0udG9faXRlbV9JRCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL1NtRG0uanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJTbURtIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnByaW1hcnlSQ2hyb21hdGljaXR5X3ggPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkgICAgdGhpcy5wcmltYXJ5UkNocm9tYXRpY2l0eV95ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMucHJpbWFyeUdDaHJvbWF0aWNpdHlfeCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICB0aGlzLnByaW1hcnlHQ2hyb21hdGljaXR5X3kgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkgICAgdGhpcy5wcmltYXJ5QkNocm9tYXRpY2l0eV94ID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgIHRoaXMucHJpbWFyeUJDaHJvbWF0aWNpdHlfeSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICB0aGlzLndoaXRlUG9pbnRDaHJvbWF0aWNpdHlfeCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICB0aGlzLndoaXRlUG9pbnRDaHJvbWF0aWNpdHlfeSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICB0aGlzLmx1bWluYW5jZU1heCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCSAgICB0aGlzLmx1bWluYW5jZU1pbiA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zbWhkLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic21oZCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5iYWxhbmNlID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCXN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zc2l4LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3NpeCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zdWJzZWdtZW50cyA9IFtdOwogICAgCQkJdmFyIHN1YnNlZ21lbnRfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzZWdtZW50X2NvdW50OyBpKyspIHsKICAgIAkJCQl2YXIgc3Vic2VnbWVudCA9IHt9OwogICAgCQkJCXRoaXMuc3Vic2VnbWVudHMucHVzaChzdWJzZWdtZW50KTsKICAgIAkJCQlzdWJzZWdtZW50LnJhbmdlcyA9IFtdOwogICAgCQkJCXZhciByYW5nZV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJZm9yICh2YXIgaiA9IDA7IGogPCByYW5nZV9jb3VudDsgaisrKSB7CiAgICAJCQkJCXZhciByYW5nZSA9IHt9OwogICAgCQkJCQlzdWJzZWdtZW50LnJhbmdlcy5wdXNoKHJhbmdlKTsKICAgIAkJCQkJcmFuZ2UubGV2ZWwgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJCXJhbmdlLnJhbmdlX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQyNCgpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3N0Y28uanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJzdGNvIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgZW50cnlfY291bnQ7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmNodW5rX29mZnNldHMgPSBbXTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGVudHJ5X2NvdW50OyBpKyspIHsKICAgIAkJCQkJdGhpcy5jaHVua19vZmZzZXRzLnB1c2goc3RyZWFtLnJlYWRVaW50MzIoKSk7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc3RkcC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInN0ZHAiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBjb3VudCA9ICh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplKS8yOwogICAgCQkJdGhpcy5wcmlvcml0eSA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAJCQkJdGhpcy5wcmlvcml0eVtpXSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdGhkLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3RoZCIpOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHJpLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3RyaSIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zd2l0Y2hfZ3JvdXAgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5hbHRlcm5hdGVfZ3JvdXAgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5zdWJfdHJhY2tfaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdmFyIGNvdW50ID0gKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUgLSA4KS80OwogICAgCQkJdGhpcy5hdHRyaWJ1dGVfbGlzdCA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAJCQkJdGhpcy5hdHRyaWJ1dGVfbGlzdFtpXSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHNjLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3RzYyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGVudHJ5X2NvdW50OwogICAgCQkJdmFyIGk7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmZpcnN0X2NodW5rID0gW107CiAgICAJCQl0aGlzLnNhbXBsZXNfcGVyX2NodW5rID0gW107CiAgICAJCQl0aGlzLnNhbXBsZV9kZXNjcmlwdGlvbl9pbmRleCA9IFtdOwogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMCkgewogICAgCQkJCWZvcihpPTA7IGk8ZW50cnlfY291bnQ7IGkrKykgewogICAgCQkJCQl0aGlzLmZpcnN0X2NodW5rLnB1c2goc3RyZWFtLnJlYWRVaW50MzIoKSk7CiAgICAJCQkJCXRoaXMuc2FtcGxlc19wZXJfY2h1bmsucHVzaChzdHJlYW0ucmVhZFVpbnQzMigpKTsKICAgIAkJCQkJdGhpcy5zYW1wbGVfZGVzY3JpcHRpb25faW5kZXgucHVzaChzdHJlYW0ucmVhZFVpbnQzMigpKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHNkLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3RzZCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGk7CiAgICAJCQl2YXIgcmV0OwogICAgCQkJdmFyIGVudHJ5Q291bnQ7CiAgICAJCQl2YXIgYm94OwogICAgCQkJdGhpcy5lbnRyaWVzID0gW107CiAgICAJCQllbnRyeUNvdW50ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCWZvciAoaSA9IDE7IGkgPD0gZW50cnlDb3VudDsgaSsrKSB7CiAgICAJCQkJcmV0ID0gQm94UGFyc2VyLnBhcnNlT25lQm94KHN0cmVhbSwgdHJ1ZSwgdGhpcy5zaXplIC0gKHN0cmVhbS5nZXRQb3NpdGlvbigpIC0gdGhpcy5zdGFydCkpOwogICAgCQkJCWlmIChyZXQuY29kZSA9PT0gQm94UGFyc2VyLk9LKSB7CiAgICAJCQkJCWlmIChCb3hQYXJzZXJbcmV0LnR5cGUrIlNhbXBsZUVudHJ5Il0pIHsKICAgIAkJCQkJCWJveCA9IG5ldyBCb3hQYXJzZXJbcmV0LnR5cGUrIlNhbXBsZUVudHJ5Il0ocmV0LnNpemUpOwogICAgCQkJCQkJYm94Lmhkcl9zaXplID0gcmV0Lmhkcl9zaXplOwogICAgCQkJCQkJYm94LnN0YXJ0ID0gcmV0LnN0YXJ0OwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJTG9nLndhcm4oIkJveFBhcnNlciIsICJVbmtub3duIHNhbXBsZSBlbnRyeSB0eXBlOiAiK3JldC50eXBlKTsKICAgIAkJCQkJCWJveCA9IG5ldyBCb3hQYXJzZXIuU2FtcGxlRW50cnkocmV0LnR5cGUsIHJldC5zaXplLCByZXQuaGRyX3NpemUsIHJldC5zdGFydCk7CiAgICAJCQkJCX0KICAgIAkJCQkJaWYgKGJveC53cml0ZSA9PT0gQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS53cml0ZSkgewogICAgCQkJCQkJTG9nLmluZm8oIkJveFBhcnNlciIsICJTYW1wbGVFbnRyeSAiK2JveC50eXBlKyIgYm94IHdyaXRpbmcgbm90IHlldCBpbXBsZW1lbnRlZCwga2VlcGluZyB1bnBhcnNlZCBkYXRhIGluIG1lbW9yeSBmb3IgbGF0ZXIgd3JpdGUiKTsKICAgIAkJCQkJCWJveC5wYXJzZURhdGFBbmRSZXdpbmQoc3RyZWFtKTsKICAgIAkJCQkJfQogICAgCQkJCQlib3gucGFyc2Uoc3RyZWFtKTsKICAgIAkJCQkJdGhpcy5lbnRyaWVzLnB1c2goYm94KTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlyZXR1cm47CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc3RzZy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInN0c2ciLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuZ3JvdXBpbmdfdHlwZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl2YXIgY291bnQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJdGhpcy5ncm91cF9kZXNjcmlwdGlvbl9pbmRleCA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAJCQkJdGhpcy5ncm91cF9kZXNjcmlwdGlvbl9pbmRleFtpXSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHNoLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3RzaCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGVudHJ5X2NvdW50OwogICAgCQkJdmFyIGk7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLnNoYWRvd2VkX3NhbXBsZV9udW1iZXJzID0gW107CiAgICAJCQl0aGlzLnN5bmNfc2FtcGxlX251bWJlcnMgPSBbXTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQlmb3IoaT0wOyBpPGVudHJ5X2NvdW50OyBpKyspIHsKICAgIAkJCQkJdGhpcy5zaGFkb3dlZF9zYW1wbGVfbnVtYmVycy5wdXNoKHN0cmVhbS5yZWFkVWludDMyKCkpOwogICAgCQkJCQl0aGlzLnN5bmNfc2FtcGxlX251bWJlcnMucHVzaChzdHJlYW0ucmVhZFVpbnQzMigpKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHNzLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3RzcyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGk7CiAgICAJCQl2YXIgZW50cnlfY291bnQ7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwKSB7CiAgICAJCQkJdGhpcy5zYW1wbGVfbnVtYmVycyA9IFtdOwogICAgCQkJCWZvcihpPTA7IGk8ZW50cnlfY291bnQ7IGkrKykgewogICAgCQkJCQl0aGlzLnNhbXBsZV9udW1iZXJzLnB1c2goc3RyZWFtLnJlYWRVaW50MzIoKSk7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc3Rzei5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInN0c3oiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBpOwogICAgCQkJdGhpcy5zYW1wbGVfc2l6ZXMgPSBbXTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQl0aGlzLnNhbXBsZV9zaXplID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLnNhbXBsZV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJZm9yIChpID0gMDsgaSA8IHRoaXMuc2FtcGxlX2NvdW50OyBpKyspIHsKICAgIAkJCQkJaWYgKHRoaXMuc2FtcGxlX3NpemUgPT09IDApIHsKICAgIAkJCQkJCXRoaXMuc2FtcGxlX3NpemVzLnB1c2goc3RyZWFtLnJlYWRVaW50MzIoKSk7CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQl0aGlzLnNhbXBsZV9zaXplc1tpXSA9IHRoaXMuc2FtcGxlX3NpemU7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHRzLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3R0cyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGVudHJ5X2NvdW50OwogICAgCQkJdmFyIGk7CiAgICAJCQl2YXIgZGVsdGE7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLnNhbXBsZV9jb3VudHMgPSBbXTsKICAgIAkJCXRoaXMuc2FtcGxlX2RlbHRhcyA9IFtdOwogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMCkgewogICAgCQkJCWZvcihpPTA7IGk8ZW50cnlfY291bnQ7IGkrKykgewogICAgCQkJCQl0aGlzLnNhbXBsZV9jb3VudHMucHVzaChzdHJlYW0ucmVhZFVpbnQzMigpKTsKICAgIAkJCQkJZGVsdGEgPSBzdHJlYW0ucmVhZEludDMyKCk7CiAgICAJCQkJCWlmIChkZWx0YSA8IDApIHsKICAgIAkJCQkJCUxvZy53YXJuKCJCb3hQYXJzZXIiLCAiRmlsZSB1c2VzIG5lZ2F0aXZlIHN0dHMgc2FtcGxlIGRlbHRhLCB1c2luZyB2YWx1ZSAxIGluc3RlYWQsIHN5bmMgbWF5IGJlIGxvc3QhIik7CiAgICAJCQkJCQlkZWx0YSA9IDE7CiAgICAJCQkJCX0KICAgIAkJCQkJdGhpcy5zYW1wbGVfZGVsdGFzLnB1c2goZGVsdGEpOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3N0dmkuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJzdHZpIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgdG1wMzIgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5zaW5nbGVfdmlld19hbGxvd2VkID0gdG1wMzIgJiAweDM7CiAgICAJCQl0aGlzLnN0ZXJlb19zY2hlbWUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdmFyIGxlbmd0aCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLnN0ZXJlb19pbmRpY2F0aW9uX3R5cGUgPSBzdHJlYW0ucmVhZFN0cmluZyhsZW5ndGgpOwogICAgCQkJdmFyIHJldDsKICAgIAkJCXZhciBib3g7CiAgICAJCQl0aGlzLmJveGVzID0gW107CiAgICAJCQl3aGlsZSAoc3RyZWFtLmdldFBvc2l0aW9uKCkgPCB0aGlzLnN0YXJ0K3RoaXMuc2l6ZSkgewogICAgCQkJCXJldCA9IEJveFBhcnNlci5wYXJzZU9uZUJveChzdHJlYW0sIGZhbHNlLCB0aGlzLnNpemUgLSAoc3RyZWFtLmdldFBvc2l0aW9uKCkgLSB0aGlzLnN0YXJ0KSk7CiAgICAJCQkJaWYgKHJldC5jb2RlID09PSBCb3hQYXJzZXIuT0spIHsKICAgIAkJCQkJYm94ID0gcmV0LmJveDsKICAgIAkJCQkJdGhpcy5ib3hlcy5wdXNoKGJveCk7CiAgICAJCQkJCXRoaXNbYm94LnR5cGVdID0gYm94OwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXJldHVybjsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdHlwLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJzdHlwIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlCb3hQYXJzZXIuZnR5cEJveC5wcm90b3R5cGUucGFyc2UuY2FsbCh0aGlzLCBzdHJlYW0pOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvc3R6Mi5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInN0ejIiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIHNhbXBsZV9jb3VudDsKICAgIAkJCXRoaXMuc2FtcGxlX3NpemVzID0gW107CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwKSB7CiAgICAJCQkJdGhpcy5yZXNlcnZlZCA9IHN0cmVhbS5yZWFkVWludDI0KCk7CiAgICAJCQkJdGhpcy5maWVsZF9zaXplID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXNhbXBsZV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJaWYgKHRoaXMuZmllbGRfc2l6ZSA9PT0gNCkgewogICAgCQkJCQlmb3IgKGkgPSAwOyBpIDwgc2FtcGxlX2NvdW50OyBpKz0yKSB7CiAgICAJCQkJCQl2YXIgdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCQkJdGhpcy5zYW1wbGVfc2l6ZXNbaV0gPSAodG1wID4+IDQpICYgMHhGOwogICAgCQkJCQkJdGhpcy5zYW1wbGVfc2l6ZXNbaSsxXSA9IHRtcCAmIDB4RjsKICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSBpZiAodGhpcy5maWVsZF9zaXplID09PSA4KSB7CiAgICAJCQkJCWZvciAoaSA9IDA7IGkgPCBzYW1wbGVfY291bnQ7IGkrKykgewogICAgCQkJCQkJdGhpcy5zYW1wbGVfc2l6ZXNbaV0gPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJCX0KICAgIAkJCQl9IGVsc2UgaWYgKHRoaXMuZmllbGRfc2l6ZSA9PT0gMTYpIHsKICAgIAkJCQkJZm9yIChpID0gMDsgaSA8IHNhbXBsZV9jb3VudDsgaSsrKSB7CiAgICAJCQkJCQl0aGlzLnNhbXBsZV9zaXplc1tpXSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJCX0KICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlMb2cuZXJyb3IoIkJveFBhcnNlciIsICJFcnJvciBpbiBsZW5ndGggZmllbGQgaW4gc3R6MiBib3giKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy9zdWJzLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3Rvcigic3VicyIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGksajsKICAgIAkJCXZhciBlbnRyeV9jb3VudDsKICAgIAkJCXZhciBzdWJzYW1wbGVfY291bnQ7CiAgICAJCQllbnRyeV9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmVudHJpZXMgPSBbXTsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCBlbnRyeV9jb3VudDsgaSsrKSB7CiAgICAJCQkJdmFyIHNhbXBsZUluZm8gPSB7fTsKICAgIAkJCQl0aGlzLmVudHJpZXNbaV0gPSBzYW1wbGVJbmZvOwogICAgCQkJCXNhbXBsZUluZm8uc2FtcGxlX2RlbHRhID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQlzYW1wbGVJbmZvLnN1YnNhbXBsZXMgPSBbXTsKICAgIAkJCQlzdWJzYW1wbGVfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCWlmIChzdWJzYW1wbGVfY291bnQ+MCkgewogICAgCQkJCQlmb3IgKGogPSAwOyBqIDwgc3Vic2FtcGxlX2NvdW50OyBqKyspIHsKICAgIAkJCQkJCXZhciBzdWJzYW1wbGUgPSB7fTsKICAgIAkJCQkJCXNhbXBsZUluZm8uc3Vic2FtcGxlcy5wdXNoKHN1YnNhbXBsZSk7CiAgICAJCQkJCQlpZiAodGhpcy52ZXJzaW9uID09IDEpIHsKICAgIAkJCQkJCQlzdWJzYW1wbGUuc2l6ZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCXN1YnNhbXBsZS5zaXplID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCXN1YnNhbXBsZS5wcmlvcml0eSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQkJCXN1YnNhbXBsZS5kaXNjYXJkYWJsZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQkJCXN1YnNhbXBsZS5jb2RlY19zcGVjaWZpY19wYXJhbWV0ZXJzID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3RlbmMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJ0ZW5jIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlzdHJlYW0ucmVhZFVpbnQ4KCk7IC8vIHJlc2VydmVkCiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09PSAwKSB7CiAgICAJCQkJc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl2YXIgdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuZGVmYXVsdF9jcnlwdF9ieXRlX2Jsb2NrID0gKHRtcCA+PiA0KSAmIDB4RjsKICAgIAkJCQl0aGlzLmRlZmF1bHRfc2tpcF9ieXRlX2Jsb2NrID0gdG1wICYgMHhGOwogICAgCQkJfQogICAgCQkJdGhpcy5kZWZhdWx0X2lzUHJvdGVjdGVkID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJdGhpcy5kZWZhdWx0X1Blcl9TYW1wbGVfSVZfU2l6ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMuZGVmYXVsdF9LSUQgPSBCb3hQYXJzZXIucGFyc2VIZXgxNihzdHJlYW0pOwogICAgCQkJaWYgKHRoaXMuZGVmYXVsdF9pc1Byb3RlY3RlZCA9PT0gMSAmJiB0aGlzLmRlZmF1bHRfUGVyX1NhbXBsZV9JVl9TaXplID09PSAwKSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X2NvbnN0YW50X0lWX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJdGhpcy5kZWZhdWx0X2NvbnN0YW50X0lWID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRoaXMuZGVmYXVsdF9jb25zdGFudF9JVl9zaXplKTsKICAgIAkJCX0KICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy90ZmR0LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigidGZkdCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PSAxKSB7CiAgICAJCQkJdGhpcy5iYXNlTWVkaWFEZWNvZGVUaW1lID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5iYXNlTWVkaWFEZWNvZGVUaW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3RmaGQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJ0ZmhkIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgcmVhZEJ5dGVzID0gMDsKICAgIAkJCXRoaXMudHJhY2tfaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJaWYgKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUgPiByZWFkQnl0ZXMgJiYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVEZIRF9GTEFHX0JBU0VfREFUQV9PRkZTRVQpKSB7CiAgICAJCQkJdGhpcy5iYXNlX2RhdGFfb2Zmc2V0ID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCQlyZWFkQnl0ZXMgKz0gODsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5iYXNlX2RhdGFfb2Zmc2V0ID0gMDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplID4gcmVhZEJ5dGVzICYmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfREVTQykpIHsKICAgIAkJCQl0aGlzLmRlZmF1bHRfc2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQlyZWFkQnl0ZXMgKz0gNDsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9kZXNjcmlwdGlvbl9pbmRleCA9IDA7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSA+IHJlYWRCeXRlcyAmJiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5URkhEX0ZMQUdfU0FNUExFX0RVUikpIHsKICAgIAkJCQl0aGlzLmRlZmF1bHRfc2FtcGxlX2R1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQlyZWFkQnl0ZXMgKz0gNDsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9kdXJhdGlvbiA9IDA7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSA+IHJlYWRCeXRlcyAmJiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5URkhEX0ZMQUdfU0FNUExFX1NJWkUpKSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9zaXplID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQlyZWFkQnl0ZXMgKz0gNDsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9zaXplID0gMDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplID4gcmVhZEJ5dGVzICYmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfRkxBR1MpKSB7CiAgICAJCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9mbGFncyA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJcmVhZEJ5dGVzICs9IDQ7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMuZGVmYXVsdF9zYW1wbGVfZmxhZ3MgPSAwOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdGZyYS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInRmcmEiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudHJhY2tfSUQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJc3RyZWFtLnJlYWRVaW50MjQoKTsKICAgIAkJCXZhciB0bXBfYnl0ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCXRoaXMubGVuZ3RoX3NpemVfb2ZfdHJhZl9udW0gPSAodG1wX2J5dGUgPj4gNCkgJiAweDM7CiAgICAJCQl0aGlzLmxlbmd0aF9zaXplX29mX3RydW5fbnVtID0gKHRtcF9ieXRlID4+IDIpICYgMHgzOwogICAgCQkJdGhpcy5sZW5ndGhfc2l6ZV9vZl9zYW1wbGVfbnVtID0gKHRtcF9ieXRlKSAmIDB4MzsKICAgIAkJCXRoaXMuZW50cmllcyA9IFtdOwogICAgCQkJdmFyIG51bWJlcl9vZl9lbnRyaWVzID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyX29mX2VudHJpZXM7IGkrKykgewogICAgCQkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQkJdGhpcy50aW1lID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJCQkJdGhpcy5tb29mX29mZnNldCA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJdGhpcy50aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJdGhpcy5tb29mX29mZnNldCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJfQogICAgCQkJCXRoaXMudHJhZl9udW1iZXIgPSBzdHJlYW1bInJlYWRVaW50IisoOCoodGhpcy5sZW5ndGhfc2l6ZV9vZl90cmFmX251bSsxKSldKCk7CiAgICAJCQkJdGhpcy50cnVuX251bWJlciA9IHN0cmVhbVsicmVhZFVpbnQiKyg4Kih0aGlzLmxlbmd0aF9zaXplX29mX3RydW5fbnVtKzEpKV0oKTsKICAgIAkJCQl0aGlzLnNhbXBsZV9udW1iZXIgPSBzdHJlYW1bInJlYWRVaW50IisoOCoodGhpcy5sZW5ndGhfc2l6ZV9vZl9zYW1wbGVfbnVtKzEpKV0oKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3RraGQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJ0a2hkIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy52ZXJzaW9uID09IDEpIHsKICAgIAkJCQl0aGlzLmNyZWF0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMubW9kaWZpY2F0aW9uX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkJCXRoaXMudHJhY2tfaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCXN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMuY3JlYXRpb25fdGltZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy5tb2RpZmljYXRpb25fdGltZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJdGhpcy50cmFja19pZCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQl0aGlzLmR1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCX0KICAgIAkJCXN0cmVhbS5yZWFkVWludDMyQXJyYXkoMik7CiAgICAJCQl0aGlzLmxheWVyID0gc3RyZWFtLnJlYWRJbnQxNigpOwogICAgCQkJdGhpcy5hbHRlcm5hdGVfZ3JvdXAgPSBzdHJlYW0ucmVhZEludDE2KCk7CiAgICAJCQl0aGlzLnZvbHVtZSA9IHN0cmVhbS5yZWFkSW50MTYoKT4+ODsKICAgIAkJCXN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLm1hdHJpeCA9IHN0cmVhbS5yZWFkSW50MzJBcnJheSg5KTsKICAgIAkJCXRoaXMud2lkdGggPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5oZWlnaHQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdG1heC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigidG1heCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy50aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3RtaW4uanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoInRtaW4iLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudGltZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy90b3RsLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJ0b3RsIixmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuYnl0ZXNzZW50ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3RwYXkuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoInRwYXkiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuYnl0ZXNzZW50ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3RweWwuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoInRweWwiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuYnl0ZXNzZW50ID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL1RyYWNrR3JvdXAuanMKICAgIAkJQm94UGFyc2VyLlRyYWNrR3JvdXBUeXBlQm94LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5wYXJzZUZ1bGxIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXRoaXMudHJhY2tfZ3JvdXBfaWQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy90cmFja2dyb3Vwcy9tc3JjLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVUcmFja0dyb3VwQ3RvcigibXNyYyIpOy8vIGZpbGU6c3JjL3BhcnNpbmcvVHJha1JlZmVyZW5jZS5qcwogICAgCQlCb3hQYXJzZXIuVHJhY2tSZWZlcmVuY2VUeXBlQm94ID0gZnVuY3Rpb24odHlwZSwgc2l6ZSwgaGRyX3NpemUsIHN0YXJ0KSB7CiAgICAJCQlCb3hQYXJzZXIuQm94LmNhbGwodGhpcywgdHlwZSwgc2l6ZSk7CiAgICAJCQl0aGlzLmhkcl9zaXplID0gaGRyX3NpemU7CiAgICAJCQl0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICAJCX07CiAgICAJCUJveFBhcnNlci5UcmFja1JlZmVyZW5jZVR5cGVCb3gucHJvdG90eXBlID0gbmV3IEJveFBhcnNlci5Cb3goKTsKICAgIAkJQm94UGFyc2VyLlRyYWNrUmVmZXJlbmNlVHlwZUJveC5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudHJhY2tfaWRzID0gc3RyZWFtLnJlYWRVaW50MzJBcnJheSgodGhpcy5zaXplLXRoaXMuaGRyX3NpemUpLzQpOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy90cmVmLmpzCiAgICAJCUJveFBhcnNlci50cmVmQm94LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIHJldDsKICAgIAkJCXZhciBib3g7CiAgICAJCQl3aGlsZSAoc3RyZWFtLmdldFBvc2l0aW9uKCkgPCB0aGlzLnN0YXJ0K3RoaXMuc2l6ZSkgewogICAgCQkJCXJldCA9IEJveFBhcnNlci5wYXJzZU9uZUJveChzdHJlYW0sIHRydWUsIHRoaXMuc2l6ZSAtIChzdHJlYW0uZ2V0UG9zaXRpb24oKSAtIHRoaXMuc3RhcnQpKTsKICAgIAkJCQlpZiAocmV0LmNvZGUgPT09IEJveFBhcnNlci5PSykgewogICAgCQkJCQlib3ggPSBuZXcgQm94UGFyc2VyLlRyYWNrUmVmZXJlbmNlVHlwZUJveChyZXQudHlwZSwgcmV0LnNpemUsIHJldC5oZHJfc2l6ZSwgcmV0LnN0YXJ0KTsKICAgIAkJCQkJaWYgKGJveC53cml0ZSA9PT0gQm94UGFyc2VyLkJveC5wcm90b3R5cGUud3JpdGUgJiYgYm94LnR5cGUgIT09ICJtZGF0IikgewogICAgCQkJCQkJTG9nLmluZm8oIkJveFBhcnNlciIsICJUcmFja1JlZmVyZW5jZSAiK2JveC50eXBlKyIgYm94IHdyaXRpbmcgbm90IHlldCBpbXBsZW1lbnRlZCwga2VlcGluZyB1bnBhcnNlZCBkYXRhIGluIG1lbW9yeSBmb3IgbGF0ZXIgd3JpdGUiKTsKICAgIAkJCQkJCWJveC5wYXJzZURhdGFBbmRSZXdpbmQoc3RyZWFtKTsKICAgIAkJCQkJfQogICAgCQkJCQlib3gucGFyc2Uoc3RyZWFtKTsKICAgIAkJCQkJdGhpcy5ib3hlcy5wdXNoKGJveCk7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJcmV0dXJuOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdHJlcC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInRyZXAiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudHJhY2tfSUQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5ib3hlcyA9IFtdOwogICAgCQkJd2hpbGUgKHN0cmVhbS5nZXRQb3NpdGlvbigpIDwgdGhpcy5zdGFydCt0aGlzLnNpemUpIHsKICAgIAkJCQlyZXQgPSBCb3hQYXJzZXIucGFyc2VPbmVCb3goc3RyZWFtLCBmYWxzZSwgdGhpcy5zaXplIC0gKHN0cmVhbS5nZXRQb3NpdGlvbigpIC0gdGhpcy5zdGFydCkpOwogICAgCQkJCWlmIChyZXQuY29kZSA9PT0gQm94UGFyc2VyLk9LKSB7CiAgICAJCQkJCWJveCA9IHJldC5ib3g7CiAgICAJCQkJCXRoaXMuYm94ZXMucHVzaChib3gpOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXJldHVybjsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy90cmV4LmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVGdWxsQm94Q3RvcigidHJleCIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy50cmFja19pZCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQl0aGlzLmRlZmF1bHRfc2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4ID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuZGVmYXVsdF9zYW1wbGVfZHVyYXRpb24gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5kZWZhdWx0X3NhbXBsZV9zaXplID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXRoaXMuZGVmYXVsdF9zYW1wbGVfZmxhZ3MgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdHJweS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlQm94Q3RvcigidHJweSIsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5ieXRlc3NlbnQgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdHJ1bi5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInRydW4iLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciByZWFkQnl0ZXMgPSAwOwogICAgCQkJdGhpcy5zYW1wbGVfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJcmVhZEJ5dGVzKz0gNDsKICAgIAkJCWlmICh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplID4gcmVhZEJ5dGVzICYmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfREFUQV9PRkZTRVQpICkgewogICAgCQkJCXRoaXMuZGF0YV9vZmZzZXQgPSBzdHJlYW0ucmVhZEludDMyKCk7IC8vc2lnbmVkCiAgICAJCQkJcmVhZEJ5dGVzICs9IDQ7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMuZGF0YV9vZmZzZXQgPSAwOwogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUgPiByZWFkQnl0ZXMgJiYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19GSVJTVF9GTEFHKSApIHsKICAgIAkJCQl0aGlzLmZpcnN0X3NhbXBsZV9mbGFncyA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJcmVhZEJ5dGVzICs9IDQ7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMuZmlyc3Rfc2FtcGxlX2ZsYWdzID0gMDsKICAgIAkJCX0KICAgIAkJCXRoaXMuc2FtcGxlX2R1cmF0aW9uID0gW107CiAgICAJCQl0aGlzLnNhbXBsZV9zaXplID0gW107CiAgICAJCQl0aGlzLnNhbXBsZV9mbGFncyA9IFtdOwogICAgCQkJdGhpcy5zYW1wbGVfY29tcG9zaXRpb25fdGltZV9vZmZzZXQgPSBbXTsKICAgIAkJCWlmICh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplID4gcmVhZEJ5dGVzKSB7CiAgICAJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNhbXBsZV9jb3VudDsgaSsrKSB7CiAgICAJCQkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfRFVSQVRJT04pIHsKICAgIAkJCQkJCXRoaXMuc2FtcGxlX2R1cmF0aW9uW2ldID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJfQogICAgCQkJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX1NJWkUpIHsKICAgIAkJCQkJCXRoaXMuc2FtcGxlX3NpemVbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJCQl9CiAgICAJCQkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfRkxBR1MpIHsKICAgIAkJCQkJCXRoaXMuc2FtcGxlX2ZsYWdzW2ldID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJfQogICAgCQkJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX0NUU19PRkZTRVQpIHsKICAgIAkJCQkJCWlmICh0aGlzLnZlcnNpb24gPT09IDApIHsKICAgIAkJCQkJCQl0aGlzLnNhbXBsZV9jb21wb3NpdGlvbl90aW1lX29mZnNldFtpXSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCXRoaXMuc2FtcGxlX2NvbXBvc2l0aW9uX3RpbWVfb2Zmc2V0W2ldID0gc3RyZWFtLnJlYWRJbnQzMigpOyAvL3NpZ25lZAogICAgCQkJCQkJfQogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdHNlbC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInRzZWwiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuc3dpdGNoX2dyb3VwID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCXZhciBjb3VudCA9ICh0aGlzLnNpemUgLSB0aGlzLmhkcl9zaXplIC0gNCkvNDsKICAgIAkJCXRoaXMuYXR0cmlidXRlX2xpc3QgPSBbXTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgCQkJCXRoaXMuYXR0cmlidXRlX2xpc3RbaV0gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdHh0Qy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInR4dEMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMuY29uZmlnID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy90eWNvLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVCb3hDdG9yKCJ0eWNvIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgY291bnQgPSAodGhpcy5zaXplIC0gdGhpcy5oZHJfc2l6ZSkgLyA0OwogICAgCQkJdGhpcy5jb21wYXRpYmxlX2JyYW5kcyA9IFtdOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAJCQkJdGhpcy5jb21wYXRpYmxlX2JyYW5kc1tpXSA9IHN0cmVhbS5yZWFkU3RyaW5nKDQpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdWRlcy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInVkZXMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMubGFuZyA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJdGhpcy5uYW1lID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLmRlc2NyaXB0aW9uID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl0aGlzLnRhZ3MgPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3VuY0MuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJ1bmNDIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCSAgICB2YXIgaTsKICAgIAkJICAgIHRoaXMucHJvZmlsZSA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCSAgICBpZiAodGhpcy52ZXJzaW9uID09IDEpIDsgZWxzZSBpZiAodGhpcy52ZXJzaW9uID09IDApIHsKICAgIAkJICAgICAgICB0aGlzLmNvbXBvbmVudF9jb3VudCA9IHN0cmVhbS5yZWFkVWludDMyKCk7CiAgICAJCSAgICAgICAgdGhpcy5jb21wb25lbnRfaW5kZXggPSBbXTsKICAgIAkJICAgICAgICB0aGlzLmNvbXBvbmVudF9iaXRfZGVwdGhfbWludXNfb25lID0gW107CiAgICAJCSAgICAgICAgdGhpcy5jb21wb25lbnRfZm9ybWF0ID0gW107CiAgICAJCSAgICAgICAgdGhpcy5jb21wb25lbnRfYWxpZ25fc2l6ZSA9IFtdOwogICAgCQkgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmNvbXBvbmVudF9jb3VudDsgaSsrKSB7CiAgICAJCSAgICAgICAgICAgIHRoaXMuY29tcG9uZW50X2luZGV4LnB1c2goc3RyZWFtLnJlYWRVaW50MTYoKSk7CiAgICAJCSAgICAgICAgICAgIHRoaXMuY29tcG9uZW50X2JpdF9kZXB0aF9taW51c19vbmUucHVzaChzdHJlYW0ucmVhZFVpbnQ4KCkpOwogICAgCQkgICAgICAgICAgICB0aGlzLmNvbXBvbmVudF9mb3JtYXQucHVzaChzdHJlYW0ucmVhZFVpbnQ4KCkpOwogICAgCQkgICAgICAgICAgICB0aGlzLmNvbXBvbmVudF9hbGlnbl9zaXplLnB1c2goc3RyZWFtLnJlYWRVaW50OCgpKTsKICAgIAkJICAgICAgICB9CiAgICAJCSAgICAgICAgdGhpcy5zYW1wbGluZ190eXBlID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkgICAgICAgIHRoaXMuaW50ZXJsZWF2ZV90eXBlID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkgICAgICAgIHRoaXMuYmxvY2tfc2l6ZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJICAgICAgICB2YXIgZmxhZ3MgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCSAgICAgICAgdGhpcy5jb21wb25lbnRfbGl0dGxlX2VuZGlhbiA9IChmbGFncyA+PiA3KSAmIDB4MTsKICAgIAkJICAgICAgICB0aGlzLmJsb2NrX3BhZF9sc2IgPSAoZmxhZ3MgPj4gNikgJiAweDE7CiAgICAJCSAgICAgICAgdGhpcy5ibG9ja19saXR0bGVfZW5kaWFuID0gKGZsYWdzID4+IDUpICYgMHgxOwogICAgCQkgICAgICAgIHRoaXMuYmxvY2tfcmV2ZXJzZWQgPSAoZmxhZ3MgPj4gNCkgJiAweDE7CiAgICAJCSAgICAgICAgdGhpcy5wYWRfdW5rbm93biA9IChmbGFncyA+PiAzKSAmIDB4MTsKICAgIAkJICAgICAgICB0aGlzLnBpeGVsX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgICAgIHRoaXMucm93X2FsaWduX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgICAgIHRoaXMudGlsZV9hbGlnbl9zaXplID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJICAgICAgICB0aGlzLm51bV90aWxlX2NvbHNfbWludXNfb25lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJICAgICAgICB0aGlzLm51bV90aWxlX3Jvd3NfbWludXNfb25lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJICAgIH0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3VybC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInVybCAiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCWlmICh0aGlzLmZsYWdzICE9PSAweDAwMDAwMSkgewogICAgCQkJCXRoaXMubG9jYXRpb24gPSBzdHJlYW0ucmVhZENTdHJpbmcoKTsKICAgIAkJCX0KICAgIAkJfSk7CgogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3Vybi5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInVybiAiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMubmFtZSA9IHN0cmVhbS5yZWFkQ1N0cmluZygpOwogICAgCQkJaWYgKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUgLSB0aGlzLm5hbWUubGVuZ3RoIC0gMSA+IDApIHsKICAgIAkJCQl0aGlzLmxvY2F0aW9uID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQl9CiAgICAJCX0pOwoKICAgIAkJLy8gZmlsZTpzcmMvcGFyc2luZy91dWlkL3BpZmYvcGlmZkxzbS5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlVVVJREJveCgiYTVkNDBiMzBlODE0MTFkZGJhMmYwODAwMjAwYzlhNjYiLCB0cnVlLCBmYWxzZSwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCSAgICB0aGlzLkxpdmVTZXJ2ZXJNYW5pZmVzdCA9IHN0cmVhbS5yZWFkU3RyaW5nKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUpCiAgICAJCSAgICAgICAgLnJlcGxhY2UoLyYvZywgIiZhbXA7IikKICAgIAkJICAgICAgICAucmVwbGFjZSgvPC9nLCAiJmx0OyIpCiAgICAJCSAgICAgICAgLnJlcGxhY2UoLz4vZywgIiZndDsiKQogICAgCQkgICAgICAgIC5yZXBsYWNlKC8iL2csICImcXVvdDsiKQogICAgCQkgICAgICAgIC5yZXBsYWNlKC8nL2csICImIzAzOTsiKTsKICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy91dWlkL3BpZmYvcGlmZlBzc2guanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVVVSURCb3goImQwOGE0ZjE4MTBmMzRhODJiNmM4MzJkOGFiYTE4M2QzIiwgdHJ1ZSwgZmFsc2UsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zeXN0ZW1faWQgPSBCb3hQYXJzZXIucGFyc2VIZXgxNihzdHJlYW0pOwogICAgCQkJdmFyIGRhdGFzaXplID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCWlmIChkYXRhc2l6ZSA+IDApIHsKICAgIAkJCQl0aGlzLmRhdGEgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkoZGF0YXNpemUpOwogICAgCQkJfQogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdXVpZC9waWZmL3BpZmZTZW5jLmpzCiAgICAJCUJveFBhcnNlci5jcmVhdGVVVUlEQm94KCJhMjM5NGY1MjVhOWI0ZjE0YTI0NDZjNDI3YzY0OGRmNCIsIHRydWUsIGZhbHNlIC8qLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCWlmICh0aGlzLmZsYWdzICYgMHgxKSB7CiAgICAJCQkJdGhpcy5BbGdvcml0aG1JRCA9IHN0cmVhbS5yZWFkVWludDI0KCk7CiAgICAJCQkJdGhpcy5JVl9zaXplID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuS0lEID0gQm94UGFyc2VyLnBhcnNlSGV4MTYoc3RyZWFtKTsKICAgIAkJCX0KICAgIAkJCXZhciBzYW1wbGVfY291bnQgPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkJdGhpcy5zYW1wbGVzID0gW107CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNhbXBsZV9jb3VudDsgaSsrKSB7CiAgICAJCQkJdmFyIHNhbXBsZSA9IHt9OwogICAgCQkJCXNhbXBsZS5Jbml0aWFsaXphdGlvblZlY3RvciA9IHRoaXMucmVhZFVpbnQ4QXJyYXkodGhpcy5JVl9zaXplKjgpOwogICAgCQkJCWlmICh0aGlzLmZsYWdzICYgMHgyKSB7CiAgICAJCQkJCXNhbXBsZS5zdWJzYW1wbGVzID0gW107CiAgICAJCQkJCXNhbXBsZS5OdW1iZXJPZkVudHJpZXMgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IHNhbXBsZS5OdW1iZXJPZkVudHJpZXM7IGorKykgewogICAgCQkJCQkJdmFyIHN1YnNhbXBsZSA9IHt9OwogICAgCQkJCQkJc3Vic2FtcGxlLkJ5dGVzT2ZDbGVhckRhdGEgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkJCQkJc3Vic2FtcGxlLkJ5dGVzT2ZQcm90ZWN0ZWREYXRhID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJCQkJCXNhbXBsZS5zdWJzYW1wbGVzLnB1c2goc3Vic2FtcGxlKTsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCQl0aGlzLnNhbXBsZXMucHVzaChzYW1wbGUpOwogICAgCQkJfQogICAgCQl9Ki8pOwogICAgCQkvLyBmaWxlOnNyYy9wYXJzaW5nL3V1aWQvcGlmZi9waWZmVGVuYy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlVVVJREJveCgiODk3NGRiY2U3YmU3NGM1MTg0Zjk3MTQ4Zjk4ODI1NTQiLCB0cnVlLCBmYWxzZSwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmRlZmF1bHRfQWxnb3JpdGhtSUQgPSBzdHJlYW0ucmVhZFVpbnQyNCgpOwogICAgCQkJdGhpcy5kZWZhdWx0X0lWX3NpemUgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQl0aGlzLmRlZmF1bHRfS0lEID0gQm94UGFyc2VyLnBhcnNlSGV4MTYoc3RyZWFtKTsKICAgIAkJfSk7Ly8gZmlsZTpzcmMvcGFyc2luZy91dWlkL3BpZmYvcGlmZlRmcmYuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZVVVSURCb3goImQ0ODA3ZWYyY2EzOTQ2OTU4ZTU0MjZjYjllNDZhNzlmIiwgdHJ1ZSwgZmFsc2UsIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkgICAgdGhpcy5mcmFnbWVudF9jb3VudCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJICAgIHRoaXMuZW50cmllcyA9IFtdOwoKICAgIAkJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5mcmFnbWVudF9jb3VudDsgaSsrKSB7CiAgICAJCSAgICAgICAgdmFyIGVudHJ5ID0ge307CiAgICAJCSAgICAgICAgdmFyIGFic29sdXRlX3RpbWUgPSAwOwogICAgCQkgICAgICAgIHZhciBhYnNvbHV0ZV9kdXJhdGlvbiA9IDA7CgogICAgCQkgICAgICAgIGlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJICAgICAgICAgICAgYWJzb2x1dGVfdGltZSA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCSAgICAgICAgICAgIGFic29sdXRlX2R1cmF0aW9uID0gc3RyZWFtLnJlYWRVaW50NjQoKTsKICAgIAkJICAgICAgICB9IGVsc2UgewogICAgCQkgICAgICAgICAgICBhYnNvbHV0ZV90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJICAgICAgICAgICAgYWJzb2x1dGVfZHVyYXRpb24gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgICAgIH0KCiAgICAJCSAgICAgICAgZW50cnkuYWJzb2x1dGVfdGltZSA9IGFic29sdXRlX3RpbWU7CiAgICAJCSAgICAgICAgZW50cnkuYWJzb2x1dGVfZHVyYXRpb24gPSBhYnNvbHV0ZV9kdXJhdGlvbjsKCiAgICAJCSAgICAgICAgdGhpcy5lbnRyaWVzLnB1c2goZW50cnkpOwogICAgCQkgICAgfQogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL3V1aWQvcGlmZi9waWZmVGZ4ZC5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlVVVJREJveCgiNmQxZDliMDU0MmQ1NDRlNjgwZTIxNDFkYWZmNzU3YjIiLCB0cnVlLCBmYWxzZSwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCSAgICBpZiAodGhpcy52ZXJzaW9uID09PSAxKSB7CiAgICAJCSAgICAgICB0aGlzLmFic29sdXRlX3RpbWUgPSBzdHJlYW0ucmVhZFVpbnQ2NCgpOwogICAgCQkgICAgICAgdGhpcy5kdXJhdGlvbiA9IHN0cmVhbS5yZWFkVWludDY0KCk7CiAgICAJCSAgICB9IGVsc2UgewogICAgCQkgICAgICAgdGhpcy5hYnNvbHV0ZV90aW1lID0gc3RyZWFtLnJlYWRVaW50MzIoKTsKICAgIAkJICAgICAgIHRoaXMuZHVyYXRpb24gPSBzdHJlYW0ucmVhZFVpbnQzMigpOwogICAgCQkgICAgfQogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL3ZtaGQuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUZ1bGxCb3hDdG9yKCJ2bWhkIiwgZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLmdyYXBoaWNzbW9kZSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQl0aGlzLm9wY29sb3IgPSBzdHJlYW0ucmVhZFVpbnQxNkFycmF5KDMpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdnBjQy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInZwY0MiLCBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCQl2YXIgdG1wOwogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMSkgewogICAgCQkJCXRoaXMucHJvZmlsZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLmxldmVsID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRtcCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLmJpdERlcHRoID0gdG1wID4+IDQ7CiAgICAJCQkJdGhpcy5jaHJvbWFTdWJzYW1wbGluZyA9ICh0bXAgPj4gMSkgJiAweDc7CiAgICAJCQkJdGhpcy52aWRlb0Z1bGxSYW5nZUZsYWcgPSB0bXAgJiAweDE7CiAgICAJCQkJdGhpcy5jb2xvdXJQcmltYXJpZXMgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCQkJdGhpcy50cmFuc2ZlckNoYXJhY3RlcmlzdGljcyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLm1hdHJpeENvZWZmaWNpZW50cyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLmNvZGVjSW50aWFsaXphdGlvbkRhdGFTaXplID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJCQl0aGlzLmNvZGVjSW50aWFsaXphdGlvbkRhdGEgPSBzdHJlYW0ucmVhZFVpbnQ4QXJyYXkodGhpcy5jb2RlY0ludGlhbGl6YXRpb25EYXRhU2l6ZSk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMucHJvZmlsZSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLmxldmVsID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRtcCA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJCQl0aGlzLmJpdERlcHRoID0gKHRtcCA+PiA0KSAmIDB4RjsKICAgIAkJCQl0aGlzLmNvbG9yU3BhY2UgPSB0bXAgJiAweEY7CiAgICAJCQkJdG1wID0gc3RyZWFtLnJlYWRVaW50OCgpOwogICAgCQkJCXRoaXMuY2hyb21hU3Vic2FtcGxpbmcgPSAodG1wID4+IDQpICYgMHhGOwogICAgCQkJCXRoaXMudHJhbnNmZXJGdW5jdGlvbiA9ICh0bXAgPj4gMSkgJiAweDc7CiAgICAJCQkJdGhpcy52aWRlb0Z1bGxSYW5nZUZsYWcgPSB0bXAgJiAweDE7CiAgICAJCQkJdGhpcy5jb2RlY0ludGlhbGl6YXRpb25EYXRhU2l6ZSA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCQkJdGhpcy5jb2RlY0ludGlhbGl6YXRpb25EYXRhID0gc3RyZWFtLnJlYWRVaW50OEFycmF5KHRoaXMuY29kZWNJbnRpYWxpemF0aW9uRGF0YVNpemUpOwogICAgCQkJfQogICAgCQl9KTsvLyBmaWxlOnNyYy9wYXJzaW5nL3Z0dEMuanMKICAgIAkJQm94UGFyc2VyLmNyZWF0ZUJveEN0b3IoInZ0dEMiLCBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudGV4dCA9IHN0cmVhbS5yZWFkU3RyaW5nKHRoaXMuc2l6ZSAtIHRoaXMuaGRyX3NpemUpOwogICAgCQl9KTsKCiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdnZjQy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInZ2Y0MiLCBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCSAgdmFyIGksIGo7CgogICAgCQkgIC8vIGhlbHBlciBvYmplY3QgdG8gc2ltcGxpZnkgZXh0cmFjdGluZyBpbmRpdmlkdWFsIGJpdHMKICAgIAkJICB2YXIgYml0UmVhZGVyID0gewogICAgCQkgICAgaGVsZF9iaXRzOiB1bmRlZmluZWQsCiAgICAJCSAgICBudW1faGVsZF9iaXRzOiAwLAoKICAgIAkJICAgIHN0cmVhbV9yZWFkXzFfYnl0ZXM6IGZ1bmN0aW9uIChzdHJtKSB7CiAgICAJCSAgICAgIHRoaXMuaGVsZF9iaXRzID0gc3RybS5yZWFkVWludDgoKTsKICAgIAkJICAgICAgdGhpcy5udW1faGVsZF9iaXRzID0gMSAqIDg7CiAgICAJCSAgICB9LAogICAgCQkgICAgc3RyZWFtX3JlYWRfMl9ieXRlczogZnVuY3Rpb24gKHN0cm0pIHsKICAgIAkJICAgICAgdGhpcy5oZWxkX2JpdHMgPSBzdHJtLnJlYWRVaW50MTYoKTsKICAgIAkJICAgICAgdGhpcy5udW1faGVsZF9iaXRzID0gMiAqIDg7CiAgICAJCSAgICB9LAoKICAgIAkJICAgIGV4dHJhY3RfYml0czogZnVuY3Rpb24gKG51bV9iaXRzKSB7CiAgICAJCSAgICAgIHZhciByZXQgPSAodGhpcy5oZWxkX2JpdHMgPj4gKHRoaXMubnVtX2hlbGRfYml0cyAtIG51bV9iaXRzKSkgJiAoKDEgPDwgbnVtX2JpdHMpIC0gMSk7CiAgICAJCSAgICAgIHRoaXMubnVtX2hlbGRfYml0cyAtPSBudW1fYml0czsKICAgIAkJICAgICAgcmV0dXJuIHJldDsKICAgIAkJICAgIH0KICAgIAkJICB9OwoKICAgIAkJICAvLyBWdmNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZAogICAgCQkgIGJpdFJlYWRlci5zdHJlYW1fcmVhZF8xX2J5dGVzKHN0cmVhbSk7CiAgICAJCSAgYml0UmVhZGVyLmV4dHJhY3RfYml0cyg1KTsgIC8vIHJlc2VydmVkCiAgICAJCSAgdGhpcy5sZW5ndGhTaXplTWludXNPbmUgPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDIpOwogICAgCQkgIHRoaXMucHRsX3ByZXNlbnRfZmxhZyA9IGJpdFJlYWRlci5leHRyYWN0X2JpdHMoMSk7CgogICAgCQkgIGlmICh0aGlzLnB0bF9wcmVzZW50X2ZsYWcpIHsKICAgIAkJICAgIGJpdFJlYWRlci5zdHJlYW1fcmVhZF8yX2J5dGVzKHN0cmVhbSk7CiAgICAJCSAgICB0aGlzLm9sc19pZHggPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDkpOwogICAgCQkgICAgdGhpcy5udW1fc3VibGF5ZXJzID0gYml0UmVhZGVyLmV4dHJhY3RfYml0cygzKTsKICAgIAkJICAgIHRoaXMuY29uc3RhbnRfZnJhbWVfcmF0ZSA9IGJpdFJlYWRlci5leHRyYWN0X2JpdHMoMik7CiAgICAJCSAgICB0aGlzLmNocm9tYV9mb3JtYXRfaWRjID0gYml0UmVhZGVyLmV4dHJhY3RfYml0cygyKTsKCiAgICAJCSAgICBiaXRSZWFkZXIuc3RyZWFtX3JlYWRfMV9ieXRlcyhzdHJlYW0pOwogICAgCQkgICAgdGhpcy5iaXRfZGVwdGhfbWludXM4ID0gYml0UmVhZGVyLmV4dHJhY3RfYml0cygzKTsKICAgIAkJICAgIGJpdFJlYWRlci5leHRyYWN0X2JpdHMoNSk7ICAvLyByZXNlcnZlZAoKICAgIAkJICAgIC8vIFZ2Y1BUTFJlY29yZAogICAgCQkgICAgewogICAgCQkgICAgICBiaXRSZWFkZXIuc3RyZWFtX3JlYWRfMl9ieXRlcyhzdHJlYW0pOwogICAgCQkgICAgICBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDIpOyAgLy8gcmVzZXJ2ZWQKICAgIAkJICAgICAgdGhpcy5udW1fYnl0ZXNfY29uc3RyYWludF9pbmZvID0gYml0UmVhZGVyLmV4dHJhY3RfYml0cyg2KTsKICAgIAkJICAgICAgdGhpcy5nZW5lcmFsX3Byb2ZpbGVfaWRjID0gYml0UmVhZGVyLmV4dHJhY3RfYml0cyg3KTsKICAgIAkJICAgICAgdGhpcy5nZW5lcmFsX3RpZXJfZmxhZyA9IGJpdFJlYWRlci5leHRyYWN0X2JpdHMoMSk7CgogICAgCQkgICAgICB0aGlzLmdlbmVyYWxfbGV2ZWxfaWRjID0gc3RyZWFtLnJlYWRVaW50OCgpOwoKICAgIAkJICAgICAgYml0UmVhZGVyLnN0cmVhbV9yZWFkXzFfYnl0ZXMoc3RyZWFtKTsKICAgIAkJICAgICAgdGhpcy5wdGxfZnJhbWVfb25seV9jb25zdHJhaW50X2ZsYWcgPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDEpOwogICAgCQkgICAgICB0aGlzLnB0bF9tdWx0aWxheWVyX2VuYWJsZWRfZmxhZyA9IGJpdFJlYWRlci5leHRyYWN0X2JpdHMoMSk7CgogICAgCQkgICAgICB0aGlzLmdlbmVyYWxfY29uc3RyYWludF9pbmZvID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5udW1fYnl0ZXNfY29uc3RyYWludF9pbmZvKTsKICAgIAkJICAgICAgaWYgKHRoaXMubnVtX2J5dGVzX2NvbnN0cmFpbnRfaW5mbykgewogICAgCQkgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLm51bV9ieXRlc19jb25zdHJhaW50X2luZm8gLSAxOyBpKyspIHsKICAgIAkJICAgICAgICAgIHZhciBjbnN0cjEgPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDYpOwogICAgCQkgICAgICAgICAgYml0UmVhZGVyLnN0cmVhbV9yZWFkXzFfYnl0ZXMoc3RyZWFtKTsKICAgIAkJICAgICAgICAgIHZhciBjbnN0cjIgPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDIpOwoKICAgIAkJICAgICAgICAgIHRoaXMuZ2VuZXJhbF9jb25zdHJhaW50X2luZm9baV0gPSAoKGNuc3RyMSA8PCAyKSB8IGNuc3RyMik7CiAgICAJCSAgICAgICAgfQogICAgCQkgICAgICAgIHRoaXMuZ2VuZXJhbF9jb25zdHJhaW50X2luZm9bdGhpcy5udW1fYnl0ZXNfY29uc3RyYWludF9pbmZvIC0gMV0gPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDYpOwogICAgCQkgICAgICB9IGVsc2UgewogICAgCQkgICAgICAgIC8vZm9yYmlkZGVuIGluIHNwZWMhCiAgICAJCSAgICAgICAgYml0UmVhZGVyLmV4dHJhY3RfYml0cyg2KTsKICAgIAkJICAgICAgfQoKICAgIAkJICAgICAgaWYgKHRoaXMubnVtX3N1YmxheWVycyA+IDEpIHsKICAgIAkJICAgICAgICBiaXRSZWFkZXIuc3RyZWFtX3JlYWRfMV9ieXRlcyhzdHJlYW0pOwogICAgCQkgICAgICAgIHRoaXMucHRsX3N1YmxheWVyX3ByZXNlbnRfbWFzayA9IDA7CiAgICAJCSAgICAgICAgZm9yIChqID0gdGhpcy5udW1fc3VibGF5ZXJzIC0gMjsgaiA+PSAwOyAtLWopIHsKICAgIAkJICAgICAgICAgIHZhciB2YWwgPSBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDEpOwogICAgCQkgICAgICAgICAgdGhpcy5wdGxfc3VibGF5ZXJfcHJlc2VudF9tYXNrIHw9IHZhbCA8PCBqOwogICAgCQkgICAgICAgIH0KICAgIAkJICAgICAgICBmb3IgKGogPSB0aGlzLm51bV9zdWJsYXllcnM7IGogPD0gOCAmJiB0aGlzLm51bV9zdWJsYXllcnMgPiAxOyArK2opIHsKICAgIAkJICAgICAgICAgIGJpdFJlYWRlci5leHRyYWN0X2JpdHMoMSk7ICAvLyBwdGxfcmVzZXJ2ZWRfemVyb19iaXQKICAgIAkJICAgICAgICB9CgogICAgCQkgICAgICAgIHRoaXMuc3VibGF5ZXJfbGV2ZWxfaWRjID0gW107CiAgICAJCSAgICAgICAgZm9yIChqID0gdGhpcy5udW1fc3VibGF5ZXJzIC0gMjsgaiA+PSAwOyAtLWopIHsKICAgIAkJICAgICAgICAgIGlmICh0aGlzLnB0bF9zdWJsYXllcl9wcmVzZW50X21hc2sgJiAoMSA8PCBqKSkgewogICAgCQkgICAgICAgICAgICB0aGlzLnN1YmxheWVyX2xldmVsX2lkY1tqXSA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJICAgICAgICAgIH0KICAgIAkJICAgICAgICB9CiAgICAJCSAgICAgIH0KCiAgICAJCSAgICAgIHRoaXMucHRsX251bV9zdWJfcHJvZmlsZXMgPSBzdHJlYW0ucmVhZFVpbnQ4KCk7CiAgICAJCSAgICAgIHRoaXMuZ2VuZXJhbF9zdWJfcHJvZmlsZV9pZGMgPSBbXTsKICAgIAkJICAgICAgaWYgKHRoaXMucHRsX251bV9zdWJfcHJvZmlsZXMpIHsKICAgIAkJICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5wdGxfbnVtX3N1Yl9wcm9maWxlczsgaSsrKSB7CiAgICAJCSAgICAgICAgICB0aGlzLmdlbmVyYWxfc3ViX3Byb2ZpbGVfaWRjLnB1c2goc3RyZWFtLnJlYWRVaW50MzIoKSk7CiAgICAJCSAgICAgICAgfQogICAgCQkgICAgICB9CiAgICAJCSAgICB9ICAvLyBlbmQgVnZjUFRMUmVjb3JkCgogICAgCQkgICAgdGhpcy5tYXhfcGljdHVyZV93aWR0aCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICB0aGlzLm1heF9waWN0dXJlX2hlaWdodCA9IHN0cmVhbS5yZWFkVWludDE2KCk7CiAgICAJCSAgICB0aGlzLmF2Z19mcmFtZV9yYXRlID0gc3RyZWFtLnJlYWRVaW50MTYoKTsKICAgIAkJICB9CgogICAgCQkgIHZhciBWVkNfTkFMVV9PUEkgPSAxMjsKICAgIAkJICB2YXIgVlZDX05BTFVfREVDX1BBUkFNID0gMTM7CgogICAgCQkgIHRoaXMubmFsdV9hcnJheXMgPSBbXTsKICAgIAkJICB2YXIgbnVtX29mX2FycmF5cyA9IHN0cmVhbS5yZWFkVWludDgoKTsKICAgIAkJICBmb3IgKGkgPSAwOyBpIDwgbnVtX29mX2FycmF5czsgaSsrKSB7CiAgICAJCSAgICB2YXIgbmFsdV9hcnJheSA9IFtdOwogICAgCQkgICAgdGhpcy5uYWx1X2FycmF5cy5wdXNoKG5hbHVfYXJyYXkpOwoKICAgIAkJICAgIGJpdFJlYWRlci5zdHJlYW1fcmVhZF8xX2J5dGVzKHN0cmVhbSk7CiAgICAJCSAgICBuYWx1X2FycmF5LmNvbXBsZXRlbmVzcyA9IGJpdFJlYWRlci5leHRyYWN0X2JpdHMoMSk7CiAgICAJCSAgICBiaXRSZWFkZXIuZXh0cmFjdF9iaXRzKDIpOyAgLy8gcmVzZXJ2ZWQKICAgIAkJICAgIG5hbHVfYXJyYXkubmFsdV90eXBlID0gYml0UmVhZGVyLmV4dHJhY3RfYml0cyg1KTsKCiAgICAJCSAgICB2YXIgbnVtTmFsdXMgPSAxOwogICAgCQkgICAgaWYgKG5hbHVfYXJyYXkubmFsdV90eXBlICE9IFZWQ19OQUxVX0RFQ19QQVJBTSAmJiBuYWx1X2FycmF5Lm5hbHVfdHlwZSAhPSBWVkNfTkFMVV9PUEkpIHsKICAgIAkJICAgICAgbnVtTmFsdXMgPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkgICAgfQoKICAgIAkJICAgIGZvciAoaiA9IDA7IGogPCBudW1OYWx1czsgaisrKSB7CiAgICAJCSAgICAgIHZhciBsZW4gPSBzdHJlYW0ucmVhZFVpbnQxNigpOwogICAgCQkgICAgICBuYWx1X2FycmF5LnB1c2goewogICAgCQkgICAgICAgIGRhdGE6IHN0cmVhbS5yZWFkVWludDhBcnJheShsZW4pLAogICAgCQkgICAgICAgIGxlbmd0aDogbGVuCiAgICAJCSAgICAgIH0pOwogICAgCQkgICAgfQogICAgCQkgIH0KICAgIAkJfSk7CiAgICAJCS8vIGZpbGU6c3JjL3BhcnNpbmcvdnZuQy5qcwogICAgCQlCb3hQYXJzZXIuY3JlYXRlRnVsbEJveEN0b3IoInZ2bkMiLCBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCSAgLy8gVnZjTkFMVUNvbmZpZ0JveAogICAgCQkgIHZhciB0bXAgPSBzdHJtLnJlYWRVaW50OCgpOwogICAgCQkgIHRoaXMubGVuZ3RoU2l6ZU1pbnVzT25lID0gKHRtcCAmIDB4Myk7CiAgICAJCX0pOwogICAgCQkvLyBmaWxlOnNyYy9ib3gtY29kZWNzLmpzCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUuaXNWaWRlbyA9IGZ1bmN0aW9uKCkgewogICAgCQkJcmV0dXJuIGZhbHNlOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5pc0F1ZGlvID0gZnVuY3Rpb24oKSB7CiAgICAJCQlyZXR1cm4gZmFsc2U7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuU2FtcGxlRW50cnkucHJvdG90eXBlLmlzU3VidGl0bGUgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiBmYWxzZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUuaXNNZXRhZGF0YSA9IGZ1bmN0aW9uKCkgewogICAgCQkJcmV0dXJuIGZhbHNlOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5pc0hpbnQgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiBmYWxzZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0Q29kZWMgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0aGlzLnR5cGUucmVwbGFjZSgnLicsJycpOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uKCkgewogICAgCQkJcmV0dXJuICIiOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiAiIjsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0Q2hhbm5lbENvdW50ID0gZnVuY3Rpb24oKSB7CiAgICAJCQlyZXR1cm4gIiI7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuU2FtcGxlRW50cnkucHJvdG90eXBlLmdldFNhbXBsZVJhdGUgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiAiIjsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0U2FtcGxlU2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgCQkJcmV0dXJuICIiOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlZpc3VhbFNhbXBsZUVudHJ5LnByb3RvdHlwZS5pc1ZpZGVvID0gZnVuY3Rpb24oKSB7CiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5WaXN1YWxTYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0aGlzLndpZHRoOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlZpc3VhbFNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0aGlzLmhlaWdodDsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5BdWRpb1NhbXBsZUVudHJ5LnByb3RvdHlwZS5pc0F1ZGlvID0gZnVuY3Rpb24oKSB7CiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5BdWRpb1NhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDaGFubmVsQ291bnQgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0aGlzLmNoYW5uZWxfY291bnQ7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuQXVkaW9TYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0U2FtcGxlUmF0ZSA9IGZ1bmN0aW9uKCkgewogICAgCQkJcmV0dXJuIHRoaXMuc2FtcGxlcmF0ZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5BdWRpb1NhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRTYW1wbGVTaXplID0gZnVuY3Rpb24oKSB7CiAgICAJCQlyZXR1cm4gdGhpcy5zYW1wbGVzaXplOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLlN1YnRpdGxlU2FtcGxlRW50cnkucHJvdG90eXBlLmlzU3VidGl0bGUgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0cnVlOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLk1ldGFkYXRhU2FtcGxlRW50cnkucHJvdG90eXBlLmlzTWV0YWRhdGEgPSBmdW5jdGlvbigpIHsKICAgIAkJCXJldHVybiB0cnVlOwogICAgCQl9OwoKCiAgICAJCUJveFBhcnNlci5kZWNpbWFsVG9IZXggPSBmdW5jdGlvbihkLCBwYWRkaW5nKSB7CiAgICAJCQl2YXIgaGV4ID0gTnVtYmVyKGQpLnRvU3RyaW5nKDE2KTsKICAgIAkJCXBhZGRpbmcgPSB0eXBlb2YgKHBhZGRpbmcpID09PSAidW5kZWZpbmVkIiB8fCBwYWRkaW5nID09PSBudWxsID8gcGFkZGluZyA9IDIgOiBwYWRkaW5nOwogICAgCQkJd2hpbGUgKGhleC5sZW5ndGggPCBwYWRkaW5nKSB7CiAgICAJCQkJaGV4ID0gIjAiICsgaGV4OwogICAgCQkJfQogICAgCQkJcmV0dXJuIGhleDsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5hdmMxU2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjID0KICAgIAkJQm94UGFyc2VyLmF2YzJTYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0Q29kZWMgPQogICAgCQlCb3hQYXJzZXIuYXZjM1NhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYyA9CiAgICAJCUJveFBhcnNlci5hdmM0U2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjID0gZnVuY3Rpb24oKSB7CiAgICAJCQl2YXIgYmFzZUNvZGVjID0gQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYy5jYWxsKHRoaXMpOwogICAgCQkJaWYgKHRoaXMuYXZjQykgewogICAgCQkJCXJldHVybiBiYXNlQ29kZWMrIi4iK0JveFBhcnNlci5kZWNpbWFsVG9IZXgodGhpcy5hdmNDLkFWQ1Byb2ZpbGVJbmRpY2F0aW9uKSsKICAgIAkJCQkJCQkJICAiIitCb3hQYXJzZXIuZGVjaW1hbFRvSGV4KHRoaXMuYXZjQy5wcm9maWxlX2NvbXBhdGliaWxpdHkpKwogICAgCQkJCQkJCQkgICIiK0JveFBhcnNlci5kZWNpbWFsVG9IZXgodGhpcy5hdmNDLkFWQ0xldmVsSW5kaWNhdGlvbik7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXJldHVybiBiYXNlQ29kZWM7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuaGV2MVNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYyA9CiAgICAJCUJveFBhcnNlci5odmMxU2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjID0gZnVuY3Rpb24oKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXZhciBiYXNlQ29kZWMgPSBCb3hQYXJzZXIuU2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjLmNhbGwodGhpcyk7CiAgICAJCQlpZiAodGhpcy5odmNDKSB7CiAgICAJCQkJYmFzZUNvZGVjICs9ICcuJzsKICAgIAkJCQlzd2l0Y2ggKHRoaXMuaHZjQy5nZW5lcmFsX3Byb2ZpbGVfc3BhY2UpIHsKICAgIAkJCQkJY2FzZSAwOgogICAgCQkJCQkJYmFzZUNvZGVjICs9ICcnOwogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJCWNhc2UgMToKICAgIAkJCQkJCWJhc2VDb2RlYyArPSAnQSc7CiAgICAJCQkJCQlicmVhazsKICAgIAkJCQkJY2FzZSAyOgogICAgCQkJCQkJYmFzZUNvZGVjICs9ICdCJzsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQljYXNlIDM6CiAgICAJCQkJCQliYXNlQ29kZWMgKz0gJ0MnOwogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJfQogICAgCQkJCWJhc2VDb2RlYyArPSB0aGlzLmh2Y0MuZ2VuZXJhbF9wcm9maWxlX2lkYzsKICAgIAkJCQliYXNlQ29kZWMgKz0gJy4nOwogICAgCQkJCXZhciB2YWwgPSB0aGlzLmh2Y0MuZ2VuZXJhbF9wcm9maWxlX2NvbXBhdGliaWxpdHk7CiAgICAJCQkJdmFyIHJldmVyc2VkID0gMDsKICAgIAkJCQlmb3IgKGk9MDsgaTwzMjsgaSsrKSB7CiAgICAJCQkJCXJldmVyc2VkIHw9IHZhbCAmIDE7CiAgICAJCQkJCWlmIChpPT0zMSkgYnJlYWs7CiAgICAJCQkJCXJldmVyc2VkIDw8PSAxOwogICAgCQkJCQl2YWwgPj49MTsKICAgIAkJCQl9CiAgICAJCQkJYmFzZUNvZGVjICs9IEJveFBhcnNlci5kZWNpbWFsVG9IZXgocmV2ZXJzZWQsIDApOwogICAgCQkJCWJhc2VDb2RlYyArPSAnLic7CiAgICAJCQkJaWYgKHRoaXMuaHZjQy5nZW5lcmFsX3RpZXJfZmxhZyA9PT0gMCkgewogICAgCQkJCQliYXNlQ29kZWMgKz0gJ0wnOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCWJhc2VDb2RlYyArPSAnSCc7CiAgICAJCQkJfQogICAgCQkJCWJhc2VDb2RlYyArPSB0aGlzLmh2Y0MuZ2VuZXJhbF9sZXZlbF9pZGM7CiAgICAJCQkJdmFyIGhhc0J5dGUgPSBmYWxzZTsKICAgIAkJCQl2YXIgY29uc3RyYWludF9zdHJpbmcgPSAiIjsKICAgIAkJCQlmb3IgKGkgPSA1OyBpID49IDA7IGktLSkgewogICAgCQkJCQlpZiAodGhpcy5odmNDLmdlbmVyYWxfY29uc3RyYWludF9pbmRpY2F0b3JbaV0gfHwgaGFzQnl0ZSkgewogICAgCQkJCQkJY29uc3RyYWludF9zdHJpbmcgPSAiLiIrQm94UGFyc2VyLmRlY2ltYWxUb0hleCh0aGlzLmh2Y0MuZ2VuZXJhbF9jb25zdHJhaW50X2luZGljYXRvcltpXSwgMCkrY29uc3RyYWludF9zdHJpbmc7CiAgICAJCQkJCQloYXNCeXRlID0gdHJ1ZTsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCQliYXNlQ29kZWMgKz0gY29uc3RyYWludF9zdHJpbmc7CiAgICAJCQl9CiAgICAJCQlyZXR1cm4gYmFzZUNvZGVjOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLnZ2YzFTYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0Q29kZWMgPQogICAgCQlCb3hQYXJzZXIudnZpMVNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYyA9IGZ1bmN0aW9uICgpIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIGJhc2VDb2RlYyA9IEJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0Q29kZWMuY2FsbCh0aGlzKTsKICAgIAkJCWlmICh0aGlzLnZ2Y0MpIHsKICAgIAkJCQliYXNlQ29kZWMgKz0gJy4nICsgdGhpcy52dmNDLmdlbmVyYWxfcHJvZmlsZV9pZGM7CiAgICAJCQkJaWYgKHRoaXMudnZjQy5nZW5lcmFsX3RpZXJfZmxhZykgewogICAgCQkJCQliYXNlQ29kZWMgKz0gJy5IJzsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQliYXNlQ29kZWMgKz0gJy5MJzsKICAgIAkJCQl9CiAgICAJCQkJYmFzZUNvZGVjICs9IHRoaXMudnZjQy5nZW5lcmFsX2xldmVsX2lkYzsKCiAgICAJCQkJdmFyIGNvbnN0cmFpbnRfc3RyaW5nID0gIiI7CiAgICAJCQkJaWYgKHRoaXMudnZjQy5nZW5lcmFsX2NvbnN0cmFpbnRfaW5mbykgewogICAgCQkJCQl2YXIgYnl0ZXMgPSBbXTsKICAgIAkJCQkJdmFyIGJ5dGUgPSAwOwogICAgCQkJCQlieXRlIHw9IHRoaXMudnZjQy5wdGxfZnJhbWVfb25seV9jb25zdHJhaW50IDw8IDc7CiAgICAJCQkJCWJ5dGUgfD0gdGhpcy52dmNDLnB0bF9tdWx0aWxheWVyX2VuYWJsZWQgPDwgNjsKICAgIAkJCQkJdmFyIGxhc3Rfbm9uemVybzsKICAgIAkJCQkJZm9yIChpID0gMDsgaSA8IHRoaXMudnZjQy5nZW5lcmFsX2NvbnN0cmFpbnRfaW5mby5sZW5ndGg7ICsraSkgewogICAgCQkJCQkJYnl0ZSB8PSAodGhpcy52dmNDLmdlbmVyYWxfY29uc3RyYWludF9pbmZvW2ldID4+IDIpICYgMHgzZjsKICAgIAkJCQkJCWJ5dGVzLnB1c2goYnl0ZSk7CiAgICAJCQkJCQlpZiAoYnl0ZSkgewogICAgCQkJCQkJCWxhc3Rfbm9uemVybyA9IGk7CiAgICAJCQkJCQl9CgogICAgCQkJCQkJYnl0ZSA9ICh0aGlzLnZ2Y0MuZ2VuZXJhbF9jb25zdHJhaW50X2luZm9baV0gPj4gMikgJiAweDAzOwogICAgCQkJCQl9CgogICAgCQkJCQlpZiAobGFzdF9ub256ZXJvID09PSB1bmRlZmluZWQpIHsKICAgIAkJCQkJCWNvbnN0cmFpbnRfc3RyaW5nID0gIi5DQSI7CiAgICAJCQkJCX0KICAgIAkJCQkJZWxzZSB7CiAgICAJCQkJCQljb25zdHJhaW50X3N0cmluZyA9ICIuQyI7CiAgICAJCQkJCQl2YXIgYmFzZTMyX2NoYXJzID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMjM0NTY3IjsKICAgIAkJCQkJCXZhciBoZWxkX2JpdHMgPSAwOwogICAgCQkJCQkJdmFyIG51bV9oZWxkX2JpdHMgPSAwOwogICAgCQkJCQkJZm9yIChpID0gMDsgaSA8PSBsYXN0X25vbnplcm87ICsraSkgewogICAgCQkJCQkJCWhlbGRfYml0cyA9IChoZWxkX2JpdHMgPDwgOCkgfCBieXRlc1tpXTsKICAgIAkJCQkJCQludW1faGVsZF9iaXRzICs9IDg7CgogICAgCQkJCQkJCXdoaWxlIChudW1faGVsZF9iaXRzID49IDUpIHsKICAgIAkJCQkJCQkJdmFyIHZhbCA9IChoZWxkX2JpdHMgPj4gKG51bV9oZWxkX2JpdHMgLSA1KSkgJiAweDFmOwogICAgCQkJCQkJCQljb25zdHJhaW50X3N0cmluZyArPSBiYXNlMzJfY2hhcnNbdmFsXTsKCiAgICAJCQkJCQkJCW51bV9oZWxkX2JpdHMgLT0gNTsKICAgIAkJCQkJCQkJaGVsZF9iaXRzICY9ICgxIDw8IG51bV9oZWxkX2JpdHMpIC0gMTsKICAgIAkJCQkJCQl9CiAgICAJCQkJCQl9CiAgICAJCQkJCQlpZiAobnVtX2hlbGRfYml0cykgewogICAgCQkJCQkJCWhlbGRfYml0cyA8PD0gKDUgLSBudW1faGVsZF9iaXRzKTsgIC8vIHJpZ2h0LXBhZCB3aXRoIHplcm9zIHRvIDUgYml0cyAoaXMgdGhpcyBjb3JyZWN0PykKICAgIAkJCQkJCQljb25zdHJhaW50X3N0cmluZyArPSBiYXNlMzJfY2hhcnNbaGVsZF9iaXRzICYgMHgxZl07CiAgICAJCQkJCQl9CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQkJYmFzZUNvZGVjICs9IGNvbnN0cmFpbnRfc3RyaW5nOwogICAgCQkJfQogICAgCQkJcmV0dXJuIGJhc2VDb2RlYzsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5tcDRhU2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjID0gZnVuY3Rpb24oKSB7CiAgICAJCQl2YXIgYmFzZUNvZGVjID0gQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYy5jYWxsKHRoaXMpOwogICAgCQkJaWYgKHRoaXMuZXNkcyAmJiB0aGlzLmVzZHMuZXNkKSB7CiAgICAJCQkJdmFyIG90aSA9IHRoaXMuZXNkcy5lc2QuZ2V0T1RJKCk7CiAgICAJCQkJdmFyIGRzaSA9IHRoaXMuZXNkcy5lc2QuZ2V0QXVkaW9Db25maWcoKTsKICAgIAkJCQlyZXR1cm4gYmFzZUNvZGVjKyIuIitCb3hQYXJzZXIuZGVjaW1hbFRvSGV4KG90aSkrKGRzaSA/ICIuIitkc2k6ICIiKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIGJhc2VDb2RlYzsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5zdHh0U2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjID0gZnVuY3Rpb24oKSB7CiAgICAJCQl2YXIgYmFzZUNvZGVjID0gQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYy5jYWxsKHRoaXMpOwogICAgCQkJaWYodGhpcy5taW1lX2Zvcm1hdCkgewogICAgCQkJCXJldHVybiBiYXNlQ29kZWMgKyAiLiIgKyB0aGlzLm1pbWVfZm9ybWF0OwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlyZXR1cm4gYmFzZUNvZGVjCiAgICAJCQl9CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIudnAwOFNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYyA9CiAgICAJCUJveFBhcnNlci52cDA5U2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjID0gZnVuY3Rpb24oKSB7CiAgICAJCQl2YXIgYmFzZUNvZGVjID0gQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS5nZXRDb2RlYy5jYWxsKHRoaXMpOwogICAgCQkJdmFyIGxldmVsID0gdGhpcy52cGNDLmxldmVsOwogICAgCQkJaWYgKGxldmVsID09IDApIHsKICAgIAkJCQlsZXZlbCA9ICIwMCI7CiAgICAJCQl9CiAgICAJCQl2YXIgYml0RGVwdGggPSB0aGlzLnZwY0MuYml0RGVwdGg7CiAgICAJCQlpZiAoYml0RGVwdGggPT0gOCkgewogICAgCQkJCWJpdERlcHRoID0gIjA4IjsKICAgIAkJCX0KICAgIAkJCXJldHVybiBiYXNlQ29kZWMgKyAiLjAiICsgdGhpcy52cGNDLnByb2ZpbGUgKyAiLiIgKyBsZXZlbCArICIuIiArIGJpdERlcHRoOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLmF2MDFTYW1wbGVFbnRyeS5wcm90b3R5cGUuZ2V0Q29kZWMgPSBmdW5jdGlvbigpIHsKICAgIAkJCXZhciBiYXNlQ29kZWMgPSBCb3hQYXJzZXIuU2FtcGxlRW50cnkucHJvdG90eXBlLmdldENvZGVjLmNhbGwodGhpcyk7CiAgICAJCQl2YXIgbGV2ZWwgPSB0aGlzLmF2MUMuc2VxX2xldmVsX2lkeF8wOwogICAgCQkJaWYgKGxldmVsIDwgMTApIHsKICAgIAkJCQlsZXZlbCA9ICIwIiArIGxldmVsOwogICAgCQkJfQogICAgCQkJdmFyIGJpdGRlcHRoOwogICAgCQkJaWYgKHRoaXMuYXYxQy5zZXFfcHJvZmlsZSA9PT0gMiAmJiB0aGlzLmF2MUMuaGlnaF9iaXRkZXB0aCA9PT0gMSkgewogICAgCQkJCWJpdGRlcHRoID0gKHRoaXMuYXYxQy50d2VsdmVfYml0ID09PSAxKSA/ICIxMiIgOiAiMTAiOwogICAgCQkJfSBlbHNlIGlmICggdGhpcy5hdjFDLnNlcV9wcm9maWxlIDw9IDIgKSB7CiAgICAJCQkJYml0ZGVwdGggPSAodGhpcy5hdjFDLmhpZ2hfYml0ZGVwdGggPT09IDEpID8gIjEwIiA6ICIwOCI7CiAgICAJCQl9CiAgICAJCQkvLyBUT0RPIG5lZWQgdG8gcGFyc2UgdGhlIFNIIHRvIGZpbmQgY29sb3IgY29uZmlnCiAgICAJCQlyZXR1cm4gYmFzZUNvZGVjKyIuIit0aGlzLmF2MUMuc2VxX3Byb2ZpbGUrIi4iK2xldmVsKyh0aGlzLmF2MUMuc2VxX3RpZXJfMD8iSCI6Ik0iKSsiLiIrYml0ZGVwdGg7Ly8rIi4iK3RoaXMuYXYxQy5tb25vY2hyb21lKyIuIit0aGlzLmF2MUMuY2hyb21hX3N1YnNhbXBsaW5nX3grIiIrdGhpcy5hdjFDLmNocm9tYV9zdWJzYW1wbGluZ195KyIiK3RoaXMuYXYxQy5jaHJvbWFfc2FtcGxlX3Bvc2l0aW9uOwogICAgCQl9OwogICAgCQkvLyBmaWxlOnNyYy9ib3gtd3JpdGUuanMKICAgIAkJLyogCiAgICAJCSAqIENvcHlyaWdodCAoYykgVGVsZWNvbSBQYXJpc1RlY2gvVFNJL01NL0dQQUMgQ3lyaWwgQ29uY29sYXRvCiAgICAJCSAqIExpY2Vuc2U6IEJTRC0zLUNsYXVzZSAoc2VlIExJQ0VOU0UgZmlsZSkKICAgIAkJICovCiAgICAJCUJveFBhcnNlci5Cb3gucHJvdG90eXBlLndyaXRlSGVhZGVyID0gZnVuY3Rpb24oc3RyZWFtLCBtc2cpIHsKICAgIAkJCXRoaXMuc2l6ZSArPSA4OwogICAgCQkJaWYgKHRoaXMuc2l6ZSA+IE1BWF9TSVpFKSB7CiAgICAJCQkJdGhpcy5zaXplICs9IDg7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy50eXBlID09PSAidXVpZCIpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gMTY7CiAgICAJCQl9CiAgICAJCQlMb2cuZGVidWcoIkJveFdyaXRlciIsICJXcml0aW5nIGJveCAiK3RoaXMudHlwZSsiIG9mIHNpemU6ICIrdGhpcy5zaXplKyIgYXQgcG9zaXRpb24gIitzdHJlYW0uZ2V0UG9zaXRpb24oKSsobXNnIHx8ICIiKSk7CiAgICAJCQlpZiAodGhpcy5zaXplID4gTUFYX1NJWkUpIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzIoMSk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXRoaXMuc2l6ZVBvc2l0aW9uID0gc3RyZWFtLmdldFBvc2l0aW9uKCk7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2l6ZSk7CiAgICAJCQl9CiAgICAJCQlzdHJlYW0ud3JpdGVTdHJpbmcodGhpcy50eXBlLCBudWxsLCA0KTsKICAgIAkJCWlmICh0aGlzLnR5cGUgPT09ICJ1dWlkIikgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQ4QXJyYXkodGhpcy51dWlkKTsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLnNpemUgPiBNQVhfU0laRSkgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQ2NCh0aGlzLnNpemUpOwogICAgCQkJfSAKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5GdWxsQm94LnByb3RvdHlwZS53cml0ZUhlYWRlciA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zaXplICs9IDQ7CiAgICAJCQlCb3hQYXJzZXIuQm94LnByb3RvdHlwZS53cml0ZUhlYWRlci5jYWxsKHRoaXMsIHN0cmVhbSwgIiB2PSIrdGhpcy52ZXJzaW9uKyIgZj0iK3RoaXMuZmxhZ3MpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDgodGhpcy52ZXJzaW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQyNCh0aGlzLmZsYWdzKTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5Cb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQlpZiAodGhpcy50eXBlID09PSAibWRhdCIpIHsKICAgIAkJCQkvKiBUT0RPOiBmaXggdGhpcyAqLwogICAgCQkJCWlmICh0aGlzLmRhdGEpIHsKICAgIAkJCQkJdGhpcy5zaXplID0gdGhpcy5kYXRhLmxlbmd0aDsKICAgIAkJCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJCQlzdHJlYW0ud3JpdGVVaW50OEFycmF5KHRoaXMuZGF0YSk7CiAgICAJCQkJfQogICAgCQkJfSBlbHNlIHsKICAgIAkJCQl0aGlzLnNpemUgPSAodGhpcy5kYXRhID8gdGhpcy5kYXRhLmxlbmd0aCA6IDApOwogICAgCQkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCQlpZiAodGhpcy5kYXRhKSB7CiAgICAJCQkJCXN0cmVhbS53cml0ZVVpbnQ4QXJyYXkodGhpcy5kYXRhKTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuQ29udGFpbmVyQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zaXplID0gMDsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCWZvciAodmFyIGk9MDsgaTx0aGlzLmJveGVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJaWYgKHRoaXMuYm94ZXNbaV0pIHsKICAgIAkJCQkJdGhpcy5ib3hlc1tpXS53cml0ZShzdHJlYW0pOwogICAgCQkJCQl0aGlzLnNpemUgKz0gdGhpcy5ib3hlc1tpXS5zaXplOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJCS8qIGFkanVzdGluZyB0aGUgc2l6ZSwgbm93IHRoYXQgYWxsIHN1Yi1ib3hlcyBhcmUga25vd24gKi8KICAgIAkJCUxvZy5kZWJ1ZygiQm94V3JpdGVyIiwgIkFkanVzdGluZyBib3ggIit0aGlzLnR5cGUrIiB3aXRoIG5ldyBzaXplICIrdGhpcy5zaXplKTsKICAgIAkJCXN0cmVhbS5hZGp1c3RVaW50MzIodGhpcy5zaXplUG9zaXRpb24sIHRoaXMuc2l6ZSk7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuVHJhY2tSZWZlcmVuY2VUeXBlQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zaXplID0gdGhpcy50cmFja19pZHMubGVuZ3RoKjQ7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzJBcnJheSh0aGlzLnRyYWNrX2lkcyk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2F2Y0MuanMKICAgIAkJQm94UGFyc2VyLmF2Y0NCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXRoaXMuc2l6ZSA9IDc7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5TUFMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gMit0aGlzLlNQU1tpXS5sZW5ndGg7CiAgICAJCQl9CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5QUFMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gMit0aGlzLlBQU1tpXS5sZW5ndGg7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5leHQpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gdGhpcy5leHQubGVuZ3RoOwogICAgCQkJfQogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDgodGhpcy5jb25maWd1cmF0aW9uVmVyc2lvbik7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50OCh0aGlzLkFWQ1Byb2ZpbGVJbmRpY2F0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KHRoaXMucHJvZmlsZV9jb21wYXRpYmlsaXR5KTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KHRoaXMuQVZDTGV2ZWxJbmRpY2F0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KHRoaXMubGVuZ3RoU2l6ZU1pbnVzT25lICsgKDYzPDwyKSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50OCh0aGlzLlNQUy5sZW5ndGggKyAoNzw8NSkpOwogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMuU1BTLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDE2KHRoaXMuU1BTW2ldLmxlbmd0aCk7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDhBcnJheSh0aGlzLlNQU1tpXS5uYWx1KTsKICAgIAkJCX0KICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KHRoaXMuUFBTLmxlbmd0aCk7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5QUFMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MTYodGhpcy5QUFNbaV0ubGVuZ3RoKTsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50OEFycmF5KHRoaXMuUFBTW2ldLm5hbHUpOwogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuZXh0KSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDhBcnJheSh0aGlzLmV4dCk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2NvNjQuanMKICAgIAkJQm94UGFyc2VyLmNvNjRCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCXRoaXMuc2l6ZSA9IDQrOCp0aGlzLmNodW5rX29mZnNldHMubGVuZ3RoOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuY2h1bmtfb2Zmc2V0cy5sZW5ndGgpOwogICAgCQkJZm9yKGk9MDsgaTx0aGlzLmNodW5rX29mZnNldHMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50NjQodGhpcy5jaHVua19vZmZzZXRzW2ldKTsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvY3NsZy5qcwogICAgCQlCb3hQYXJzZXIuY3NsZ0JveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCXRoaXMuc2l6ZSA9IDQqNTsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZUludDMyKHRoaXMuY29tcG9zaXRpb25Ub0RUU1NoaWZ0KTsKICAgIAkJCXN0cmVhbS53cml0ZUludDMyKHRoaXMubGVhc3REZWNvZGVUb0Rpc3BsYXlEZWx0YSk7CiAgICAJCQlzdHJlYW0ud3JpdGVJbnQzMih0aGlzLmdyZWF0ZXN0RGVjb2RlVG9EaXNwbGF5RGVsdGEpOwogICAgCQkJc3RyZWFtLndyaXRlSW50MzIodGhpcy5jb21wb3NpdGlvblN0YXJ0VGltZSk7CiAgICAJCQlzdHJlYW0ud3JpdGVJbnQzMih0aGlzLmNvbXBvc2l0aW9uRW5kVGltZSk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2N0dHMuanMKICAgIAkJQm94UGFyc2VyLmN0dHNCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCXRoaXMuc2l6ZSA9IDQrOCp0aGlzLnNhbXBsZV9jb3VudHMubGVuZ3RoOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2FtcGxlX2NvdW50cy5sZW5ndGgpOwogICAgCQkJZm9yKGk9MDsgaTx0aGlzLnNhbXBsZV9jb3VudHMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zYW1wbGVfY291bnRzW2ldKTsKICAgIAkJCQlpZiAodGhpcy52ZXJzaW9uID09PSAxKSB7CiAgICAJCQkJCXN0cmVhbS53cml0ZUludDMyKHRoaXMuc2FtcGxlX29mZnNldHNbaV0pOyAvKiBzaWduZWQgKi8KICAgIAkJCQl9IGVsc2UgewkJCQogICAgCQkJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zYW1wbGVfb2Zmc2V0c1tpXSk7IC8qIHVuc2lnbmVkICovCiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9kcmVmLmpzCiAgICAJCUJveFBhcnNlci5kcmVmQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy52ZXJzaW9uID0gMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNDsgLy8KICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmVudHJpZXMubGVuZ3RoKTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbnRyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdGhpcy5lbnRyaWVzW2ldLndyaXRlKHN0cmVhbSk7CiAgICAJCQkJdGhpcy5zaXplICs9IHRoaXMuZW50cmllc1tpXS5zaXplOwogICAgCQkJfQkKICAgIAkJCS8qIGFkanVzdGluZyB0aGUgc2l6ZSwgbm93IHRoYXQgYWxsIHN1Yi1ib3hlcyBhcmUga25vd24gKi8KICAgIAkJCUxvZy5kZWJ1ZygiQm94V3JpdGVyIiwgIkFkanVzdGluZyBib3ggIit0aGlzLnR5cGUrIiB3aXRoIG5ldyBzaXplICIrdGhpcy5zaXplKTsKICAgIAkJCXN0cmVhbS5hZGp1c3RVaW50MzIodGhpcy5zaXplUG9zaXRpb24sIHRoaXMuc2l6ZSk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2VsbmcuanMKICAgIAkJQm94UGFyc2VyLmVsbmdCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwkKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gdGhpcy5leHRlbmRlZF9sYW5ndWFnZS5sZW5ndGg7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVTdHJpbmcodGhpcy5leHRlbmRlZF9sYW5ndWFnZSk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2Vsc3QuanMKICAgIAkJQm94UGFyc2VyLmVsc3RCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwkKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNCsxMip0aGlzLmVudHJpZXMubGVuZ3RoOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZW50cmllcy5sZW5ndGgpOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVudHJpZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQl2YXIgZW50cnkgPSB0aGlzLmVudHJpZXNbaV07CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKGVudHJ5LnNlZ21lbnRfZHVyYXRpb24pOwogICAgCQkJCXN0cmVhbS53cml0ZUludDMyKGVudHJ5Lm1lZGlhX3RpbWUpOwogICAgCQkJCXN0cmVhbS53cml0ZUludDE2KGVudHJ5Lm1lZGlhX3JhdGVfaW50ZWdlcik7CiAgICAJCQkJc3RyZWFtLndyaXRlSW50MTYoZW50cnkubWVkaWFfcmF0ZV9mcmFjdGlvbik7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2Vtc2cuanMKICAgIAkJQm94UGFyc2VyLmVtc2dCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwkKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNCo0K3RoaXMubWVzc2FnZV9kYXRhLmxlbmd0aCsodGhpcy5zY2hlbWVfaWRfdXJpLmxlbmd0aCsxKSsodGhpcy52YWx1ZS5sZW5ndGgrMSk7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVDU3RyaW5nKHRoaXMuc2NoZW1lX2lkX3VyaSk7CiAgICAJCQlzdHJlYW0ud3JpdGVDU3RyaW5nKHRoaXMudmFsdWUpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMudGltZXNjYWxlKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnByZXNlbnRhdGlvbl90aW1lX2RlbHRhKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmV2ZW50X2R1cmF0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmlkKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4QXJyYXkodGhpcy5tZXNzYWdlX2RhdGEpOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9mdHlwLmpzCiAgICAJCUJveFBhcnNlci5mdHlwQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zaXplID0gOCs0KnRoaXMuY29tcGF0aWJsZV9icmFuZHMubGVuZ3RoOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlU3RyaW5nKHRoaXMubWFqb3JfYnJhbmQsIG51bGwsIDQpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMubWlub3JfdmVyc2lvbik7CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29tcGF0aWJsZV9icmFuZHMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVTdHJpbmcodGhpcy5jb21wYXRpYmxlX2JyYW5kc1tpXSwgbnVsbCwgNCk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2hkbHIuanMKICAgIAkJQm94UGFyc2VyLmhkbHJCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnNpemUgPSA1KjQrdGhpcy5uYW1lLmxlbmd0aCsxOwogICAgCQkJdGhpcy52ZXJzaW9uID0gMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKDApOwogICAgCQkJc3RyZWFtLndyaXRlU3RyaW5nKHRoaXMuaGFuZGxlciwgbnVsbCwgNCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVDU3RyaW5nKHRoaXMubmFtZSk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2h2Y0MuanMKICAgIAkJQm94UGFyc2VyLmh2Y0NCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCSAgICB2YXIgaSxqOwogICAgCQkgICAgdGhpcy5zaXplID0gMjM7CgogICAgCQkgICAgZm9yIChpID0gMDsgaSA8IHRoaXMubmFsdV9hcnJheXMubGVuZ3RoOyBpKyspIHsKICAgIAkJICAgICAgdGhpcy5zaXplICs9IDM7CiAgICAJCSAgICAgIGZvciAoaiA9IDA7IGogPCB0aGlzLm5hbHVfYXJyYXlzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAJCSAgICAgICAgdGhpcy5zaXplICs9IDIgKyB0aGlzLm5hbHVfYXJyYXlzW2ldW2pdLmRhdGEubGVuZ3RoOwogICAgCQkgICAgICB9CiAgICAJCSAgICB9CgogICAgCQkgICAgdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwoKICAgIAkJICAgIHN0cmVhbS53cml0ZVVpbnQ4KHRoaXMuY29uZmlndXJhdGlvblZlcnNpb24pOwogICAgCQkgICAgc3RyZWFtLndyaXRlVWludDgoKHRoaXMuZ2VuZXJhbF9wcm9maWxlX3NwYWNlIDw8IDYpICsKICAgIAkJICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmdlbmVyYWxfdGllcl9mbGFnIDw8IDUpICsKICAgIAkJICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhbF9wcm9maWxlX2lkYyk7CiAgICAJCSAgICBzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5nZW5lcmFsX3Byb2ZpbGVfY29tcGF0aWJpbGl0eSk7CiAgICAJCSAgICBzdHJlYW0ud3JpdGVVaW50OEFycmF5KHRoaXMuZ2VuZXJhbF9jb25zdHJhaW50X2luZGljYXRvcik7CiAgICAJCSAgICBzdHJlYW0ud3JpdGVVaW50OCh0aGlzLmdlbmVyYWxfbGV2ZWxfaWRjKTsKICAgIAkJICAgIHN0cmVhbS53cml0ZVVpbnQxNih0aGlzLm1pbl9zcGF0aWFsX3NlZ21lbnRhdGlvbl9pZGMgKyAoMTU8PDI0KSk7CiAgICAJCSAgICBzdHJlYW0ud3JpdGVVaW50OCh0aGlzLnBhcmFsbGVsaXNtVHlwZSArICg2Mzw8MikpOwogICAgCQkgICAgc3RyZWFtLndyaXRlVWludDgodGhpcy5jaHJvbWFfZm9ybWF0X2lkYyArICg2Mzw8MikpOwogICAgCQkgICAgc3RyZWFtLndyaXRlVWludDgodGhpcy5iaXRfZGVwdGhfbHVtYV9taW51czggKyAoMzE8PDMpKTsKICAgIAkJICAgIHN0cmVhbS53cml0ZVVpbnQ4KHRoaXMuYml0X2RlcHRoX2Nocm9tYV9taW51czggKyAoMzE8PDMpKTsKICAgIAkJICAgIHN0cmVhbS53cml0ZVVpbnQxNih0aGlzLmF2Z0ZyYW1lUmF0ZSk7CiAgICAJCSAgICBzdHJlYW0ud3JpdGVVaW50OCgodGhpcy5jb25zdGFudEZyYW1lUmF0ZTw8NikgKwogICAgCQkgICAgICAgICAgICAgICAgICAgKHRoaXMubnVtVGVtcG9yYWxMYXllcnM8PDMpICsKICAgIAkJICAgICAgICAgICAgICAgICAgICh0aGlzLnRlbXBvcmFsSWROZXN0ZWQ8PDIpICsKICAgIAkJICAgICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoU2l6ZU1pbnVzT25lKTsKICAgIAkJICAgIHN0cmVhbS53cml0ZVVpbnQ4KHRoaXMubmFsdV9hcnJheXMubGVuZ3RoKTsKICAgIAkJICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLm5hbHVfYXJyYXlzLmxlbmd0aDsgaSsrKSB7CiAgICAJCSAgICAgIC8vIGJpdCgxKSBhcnJheV9jb21wbGV0ZW5lc3MgKyBiaXQoMSkgcmVzZXJ2ZWQgPSAwICsgYml0KDYpIG5hbF91bml0X3R5cGUKICAgIAkJICAgICAgc3RyZWFtLndyaXRlVWludDgoKHRoaXMubmFsdV9hcnJheXNbaV0uY29tcGxldGVuZXNzPDw3KSArCiAgICAJCSAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbHVfYXJyYXlzW2ldLm5hbHVfdHlwZSk7CiAgICAJCSAgICAgIHN0cmVhbS53cml0ZVVpbnQxNih0aGlzLm5hbHVfYXJyYXlzW2ldLmxlbmd0aCk7CiAgICAJCSAgICAgIGZvciAoaiA9IDA7IGogPCB0aGlzLm5hbHVfYXJyYXlzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAJCSAgICAgICAgc3RyZWFtLndyaXRlVWludDE2KHRoaXMubmFsdV9hcnJheXNbaV1bal0uZGF0YS5sZW5ndGgpOwogICAgCQkgICAgICAgIHN0cmVhbS53cml0ZVVpbnQ4QXJyYXkodGhpcy5uYWx1X2FycmF5c1tpXVtqXS5kYXRhKTsKICAgIAkJICAgICAgfQogICAgCQkgICAgfQogICAgCQl9OwogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL2tpbmQuanMKICAgIAkJQm94UGFyc2VyLmtpbmRCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwkKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gKHRoaXMuc2NoZW1lVVJJLmxlbmd0aCsxKSsodGhpcy52YWx1ZS5sZW5ndGgrMSk7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVDU3RyaW5nKHRoaXMuc2NoZW1lVVJJKTsKICAgIAkJCXN0cmVhbS53cml0ZUNTdHJpbmcodGhpcy52YWx1ZSk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL21kaGQuanMKICAgIAkJQm94UGFyc2VyLm1kaGRCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnNpemUgPSA0KjQrMioyOwogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuY3JlYXRpb25fdGltZSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5tb2RpZmljYXRpb25fdGltZSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy50aW1lc2NhbGUpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZHVyYXRpb24pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDE2KHRoaXMubGFuZ3VhZ2UpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDE2KDApOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9tZWhkLmpzCiAgICAJCUJveFBhcnNlci5tZWhkQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy52ZXJzaW9uID0gMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNDsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmZyYWdtZW50X2R1cmF0aW9uKTsKICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvbWZoZC5qcwogICAgCQlCb3hQYXJzZXIubWZoZEJveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCXRoaXMuc2l6ZSA9IDQ7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zZXF1ZW5jZV9udW1iZXIpOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9tdmhkLmpzCiAgICAJCUJveFBhcnNlci5tdmhkQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy52ZXJzaW9uID0gMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gMjMqNCsyKjI7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5jcmVhdGlvbl90aW1lKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLm1vZGlmaWNhdGlvbl90aW1lKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnRpbWVzY2FsZSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5kdXJhdGlvbik7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5yYXRlKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNih0aGlzLnZvbHVtZTw8OCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzJBcnJheSh0aGlzLm1hdHJpeCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5uZXh0X3RyYWNrX2lkKTsKICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvc2FtcGxlZW50cnkuanMKICAgIAkJQm94UGFyc2VyLlNhbXBsZUVudHJ5LnByb3RvdHlwZS53cml0ZUhlYWRlciA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy5zaXplID0gODsKICAgIAkJCUJveFBhcnNlci5Cb3gucHJvdG90eXBlLndyaXRlSGVhZGVyLmNhbGwodGhpcywgc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KDApOwogICAgCQkJc3RyZWFtLndyaXRlVWludDgoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50OCgwKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KDApOwogICAgCQkJc3RyZWFtLndyaXRlVWludDgoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50OCgwKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNih0aGlzLmRhdGFfcmVmZXJlbmNlX2luZGV4KTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUud3JpdGVGb290ZXIgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCWZvciAodmFyIGk9MDsgaTx0aGlzLmJveGVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdGhpcy5ib3hlc1tpXS53cml0ZShzdHJlYW0pOwogICAgCQkJCXRoaXMuc2l6ZSArPSB0aGlzLmJveGVzW2ldLnNpemU7CiAgICAJCQl9CiAgICAJCQlMb2cuZGVidWcoIkJveFdyaXRlciIsICJBZGp1c3RpbmcgYm94ICIrdGhpcy50eXBlKyIgd2l0aCBuZXcgc2l6ZSAiK3RoaXMuc2l6ZSk7CiAgICAJCQlzdHJlYW0uYWRqdXN0VWludDMyKHRoaXMuc2l6ZVBvc2l0aW9uLCB0aGlzLnNpemUpOwkKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5TYW1wbGVFbnRyeS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4QXJyYXkodGhpcy5kYXRhKTsKICAgIAkJCXRoaXMuc2l6ZSArPSB0aGlzLmRhdGEubGVuZ3RoOwogICAgCQkJTG9nLmRlYnVnKCJCb3hXcml0ZXIiLCAiQWRqdXN0aW5nIGJveCAiK3RoaXMudHlwZSsiIHdpdGggbmV3IHNpemUgIit0aGlzLnNpemUpOwogICAgCQkJc3RyZWFtLmFkanVzdFVpbnQzMih0aGlzLnNpemVQb3NpdGlvbiwgdGhpcy5zaXplKTsJCiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuVmlzdWFsU2FtcGxlRW50cnkucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQl0aGlzLnNpemUgKz0gMio3KzYqNCszMjsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNigwKTsgCiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYodGhpcy53aWR0aCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYodGhpcy5oZWlnaHQpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuaG9yaXpyZXNvbHV0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnZlcnRyZXNvbHV0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMigwKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNih0aGlzLmZyYW1lX2NvdW50KTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4KE1hdGgubWluKDMxLCB0aGlzLmNvbXByZXNzb3JuYW1lLmxlbmd0aCkpOwogICAgCQkJc3RyZWFtLndyaXRlU3RyaW5nKHRoaXMuY29tcHJlc3Nvcm5hbWUsIG51bGwsIDMxKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNih0aGlzLmRlcHRoKTsKICAgIAkJCXN0cmVhbS53cml0ZUludDE2KC0xKTsKICAgIAkJCXRoaXMud3JpdGVGb290ZXIoc3RyZWFtKTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5BdWRpb1NhbXBsZUVudHJ5LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJdGhpcy5zaXplICs9IDIqNCszKjQ7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYodGhpcy5jaGFubmVsX2NvdW50KTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNih0aGlzLnNhbXBsZXNpemUpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDE2KDApOwogICAgCQkJc3RyZWFtLndyaXRlVWludDE2KDApOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2FtcGxlcmF0ZTw8MTYpOwogICAgCQkJdGhpcy53cml0ZUZvb3RlcihzdHJlYW0pOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLnN0cHBTYW1wbGVFbnRyeS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXRoaXMuc2l6ZSArPSB0aGlzLm5hbWVzcGFjZS5sZW5ndGgrMSsKICAgIAkJCQkJCSB0aGlzLnNjaGVtYV9sb2NhdGlvbi5sZW5ndGgrMSsKICAgIAkJCQkJCSB0aGlzLmF1eGlsaWFyeV9taW1lX3R5cGVzLmxlbmd0aCsxOwogICAgCQkJc3RyZWFtLndyaXRlQ1N0cmluZyh0aGlzLm5hbWVzcGFjZSk7CiAgICAJCQlzdHJlYW0ud3JpdGVDU3RyaW5nKHRoaXMuc2NoZW1hX2xvY2F0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZUNTdHJpbmcodGhpcy5hdXhpbGlhcnlfbWltZV90eXBlcyk7CiAgICAJCQl0aGlzLndyaXRlRm9vdGVyKHN0cmVhbSk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3NhbXBsZWdyb3Vwcy9zYW1wbGVncm91cC5qcwogICAgCQlCb3hQYXJzZXIuU2FtcGxlR3JvdXBFbnRyeS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQ4QXJyYXkodGhpcy5kYXRhKTsKICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvc2JncC5qcwogICAgCQlCb3hQYXJzZXIuc2JncEJveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDE7CQogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnNpemUgPSAxMis4KnRoaXMuZW50cmllcy5sZW5ndGg7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVTdHJpbmcodGhpcy5ncm91cGluZ190eXBlLCBudWxsLCA0KTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmdyb3VwaW5nX3R5cGVfcGFyYW1ldGVyKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmVudHJpZXMubGVuZ3RoKTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbnRyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdmFyIGVudHJ5ID0gdGhpcy5lbnRyaWVzW2ldOwogICAgCQkJCXN0cmVhbS53cml0ZUludDMyKGVudHJ5LnNhbXBsZV9jb3VudCk7CiAgICAJCQkJc3RyZWFtLndyaXRlSW50MzIoZW50cnkuZ3JvdXBfZGVzY3JpcHRpb25faW5kZXgpOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9zZ3BkLmpzCiAgICAJCUJveFBhcnNlci5zZ3BkQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGk7CiAgICAJCQl2YXIgZW50cnk7CiAgICAJCQkvLyBsZWF2ZSB2ZXJzaW9uIGFzIHJlYWQKICAgIAkJCS8vIHRoaXMudmVyc2lvbjsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gMTI7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5lbnRyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJZW50cnkgPSB0aGlzLmVudHJpZXNbaV07CiAgICAJCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMSkgewogICAgCQkJCQlpZiAodGhpcy5kZWZhdWx0X2xlbmd0aCA9PT0gMCkgewogICAgCQkJCQkJdGhpcy5zaXplICs9IDQ7CiAgICAJCQkJCX0KICAgIAkJCQkJdGhpcy5zaXplICs9IGVudHJ5LmRhdGEubGVuZ3RoOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVN0cmluZyh0aGlzLmdyb3VwaW5nX3R5cGUsIG51bGwsIDQpOwogICAgCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMSkgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmRlZmF1bHRfbGVuZ3RoKTsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPj0gMikgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmRlZmF1bHRfc2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4KTsKICAgIAkJCX0KICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmVudHJpZXMubGVuZ3RoKTsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLmVudHJpZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQllbnRyeSA9IHRoaXMuZW50cmllc1tpXTsKICAgIAkJCQlpZiAodGhpcy52ZXJzaW9uID09PSAxKSB7CiAgICAJCQkJCWlmICh0aGlzLmRlZmF1bHRfbGVuZ3RoID09PSAwKSB7CiAgICAJCQkJCQlzdHJlYW0ud3JpdGVVaW50MzIoZW50cnkuZGVzY3JpcHRpb25fbGVuZ3RoKTsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCQllbnRyeS53cml0ZShzdHJlYW0pOwogICAgCQkJfQogICAgCQl9OwoKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvc2lkeC5qcwogICAgCQlCb3hQYXJzZXIuc2lkeEJveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CQogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnNpemUgPSA0KjQrMisyKzEyKnRoaXMucmVmZXJlbmNlcy5sZW5ndGg7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5yZWZlcmVuY2VfSUQpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMudGltZXNjYWxlKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmZpcnN0X29mZnNldCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYoMCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MTYodGhpcy5yZWZlcmVuY2VzLmxlbmd0aCk7CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmVmZXJlbmNlcy5sZW5ndGg7IGkrKykgewogICAgCQkJCXZhciByZWYgPSB0aGlzLnJlZmVyZW5jZXNbaV07CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHJlZi5yZWZlcmVuY2VfdHlwZSA8PCAzMSB8IHJlZi5yZWZlcmVuY2VkX3NpemUpOwogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMihyZWYuc3Vic2VnbWVudF9kdXJhdGlvbik7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHJlZi5zdGFydHNfd2l0aF9TQVAgPDwgMzEgfCByZWYuU0FQX3R5cGUgPDwgMjggfCByZWYuU0FQX2RlbHRhX3RpbWUpOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9zbWhkLmpzCiAgICAJCUJveFBhcnNlci5zbWhkQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkgIHRoaXMudmVyc2lvbiA9IDA7CiAgICAJCSAgdGhpcy5mbGFncyA9IDE7CiAgICAJCSAgdGhpcy5zaXplID0gNDsKICAgIAkJICB0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCSAgc3RyZWFtLndyaXRlVWludDE2KHRoaXMuYmFsYW5jZSk7CiAgICAJCSAgc3RyZWFtLndyaXRlVWludDE2KDApOwogICAgCQl9OwogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3N0Y28uanMKICAgIAkJQm94UGFyc2VyLnN0Y29Cb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnNpemUgPSA0KzQqdGhpcy5jaHVua19vZmZzZXRzLmxlbmd0aDsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmNodW5rX29mZnNldHMubGVuZ3RoKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMkFycmF5KHRoaXMuY2h1bmtfb2Zmc2V0cyk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3N0c2MuanMKICAgIAkJQm94UGFyc2VyLnN0c2NCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCXRoaXMuc2l6ZSA9IDQrMTIqdGhpcy5maXJzdF9jaHVuay5sZW5ndGg7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5maXJzdF9jaHVuay5sZW5ndGgpOwogICAgCQkJZm9yKGk9MDsgaTx0aGlzLmZpcnN0X2NodW5rLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZmlyc3RfY2h1bmtbaV0pOwogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNhbXBsZXNfcGVyX2NodW5rW2ldKTsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zYW1wbGVfZGVzY3JpcHRpb25faW5kZXhbaV0pOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9zdHNkLmpzCiAgICAJCUJveFBhcnNlci5zdHNkQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGk7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnNpemUgPSAwOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZW50cmllcy5sZW5ndGgpOwogICAgCQkJdGhpcy5zaXplICs9IDQ7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5lbnRyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdGhpcy5lbnRyaWVzW2ldLndyaXRlKHN0cmVhbSk7CiAgICAJCQkJdGhpcy5zaXplICs9IHRoaXMuZW50cmllc1tpXS5zaXplOwogICAgCQkJfQogICAgCQkJLyogYWRqdXN0aW5nIHRoZSBzaXplLCBub3cgdGhhdCBhbGwgc3ViLWJveGVzIGFyZSBrbm93biAqLwogICAgCQkJTG9nLmRlYnVnKCJCb3hXcml0ZXIiLCAiQWRqdXN0aW5nIGJveCAiK3RoaXMudHlwZSsiIHdpdGggbmV3IHNpemUgIit0aGlzLnNpemUpOwogICAgCQkJc3RyZWFtLmFkanVzdFVpbnQzMih0aGlzLnNpemVQb3NpdGlvbiwgdGhpcy5zaXplKTsKICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvc3RzaC5qcwogICAgCQlCb3hQYXJzZXIuc3RzaEJveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBpOwogICAgCQkJdGhpcy52ZXJzaW9uID0gMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNCs4KnRoaXMuc2hhZG93ZWRfc2FtcGxlX251bWJlcnMubGVuZ3RoOwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2hhZG93ZWRfc2FtcGxlX251bWJlcnMubGVuZ3RoKTsKICAgIAkJCWZvcihpPTA7IGk8dGhpcy5zaGFkb3dlZF9zYW1wbGVfbnVtYmVycy5sZW5ndGg7IGkrKykgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNoYWRvd2VkX3NhbXBsZV9udW1iZXJzW2ldKTsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zeW5jX3NhbXBsZV9udW1iZXJzW2ldKTsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvc3Rzcy5qcwogICAgCQlCb3hQYXJzZXIuc3Rzc0JveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCXRoaXMuc2l6ZSA9IDQrNCp0aGlzLnNhbXBsZV9udW1iZXJzLmxlbmd0aDsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNhbXBsZV9udW1iZXJzLmxlbmd0aCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzJBcnJheSh0aGlzLnNhbXBsZV9udW1iZXJzKTsKICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvc3Rzei5qcwogICAgCQlCb3hQYXJzZXIuc3RzekJveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIGNvbnN0YW50ID0gdHJ1ZTsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQl0aGlzLmZsYWdzID0gMDsKICAgIAkJCWlmICh0aGlzLnNhbXBsZV9zaXplcy5sZW5ndGggPiAwKSB7CiAgICAJCQkJaSA9IDA7CiAgICAJCQkJd2hpbGUgKGkrMSA8IHRoaXMuc2FtcGxlX3NpemVzLmxlbmd0aCkgewogICAgCQkJCQlpZiAodGhpcy5zYW1wbGVfc2l6ZXNbaSsxXSAhPT0gIHRoaXMuc2FtcGxlX3NpemVzWzBdKSB7CiAgICAJCQkJCQljb25zdGFudCA9IGZhbHNlOwogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQlpKys7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9IGVsc2UgewogICAgCQkJCWNvbnN0YW50ID0gZmFsc2U7CiAgICAJCQl9CiAgICAJCQl0aGlzLnNpemUgPSA4OwogICAgCQkJaWYgKCFjb25zdGFudCkgewogICAgCQkJCXRoaXMuc2l6ZSArPSA0KnRoaXMuc2FtcGxlX3NpemVzLmxlbmd0aDsKICAgIAkJCX0KICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCWlmICghY29uc3RhbnQpIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzIoMCk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNhbXBsZV9zaXplc1swXSk7CiAgICAJCQl9CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zYW1wbGVfc2l6ZXMubGVuZ3RoKTsKICAgIAkJCWlmICghY29uc3RhbnQpIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzJBcnJheSh0aGlzLnNhbXBsZV9zaXplcyk7CiAgICAJCQl9CQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy9zdHRzLmpzCiAgICAJCUJveFBhcnNlci5zdHRzQm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdmFyIGk7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnNpemUgPSA0KzgqdGhpcy5zYW1wbGVfY291bnRzLmxlbmd0aDsKICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNhbXBsZV9jb3VudHMubGVuZ3RoKTsKICAgIAkJCWZvcihpPTA7IGk8dGhpcy5zYW1wbGVfY291bnRzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2FtcGxlX2NvdW50c1tpXSk7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2FtcGxlX2RlbHRhc1tpXSk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3RmZHQuanMKICAgIAkJQm94UGFyc2VyLnRmZHRCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl2YXIgVUlOVDMyX01BWCA9IE1hdGgucG93KDIsIDMyKSAtIDE7CiAgICAJCQkvLyB1c2UgdmVyc2lvbiAxIGlmIGJhc2VNZWRpYURlY29kZVRpbWUgZG9lcyBub3QgZml0IDMyIGJpdHMKICAgIAkJCXRoaXMudmVyc2lvbiA9IHRoaXMuYmFzZU1lZGlhRGVjb2RlVGltZSA+IFVJTlQzMl9NQVggPyAxIDogMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNDsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gNDsKICAgIAkJCX0KICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCWlmICh0aGlzLnZlcnNpb24gPT09IDEpIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50NjQodGhpcy5iYXNlTWVkaWFEZWNvZGVUaW1lKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuYmFzZU1lZGlhRGVjb2RlVGltZSk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3RmaGQuanMKICAgIAkJQm94UGFyc2VyLnRmaGRCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy5zaXplID0gNDsKICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19CQVNFX0RBVEFfT0ZGU0VUKSB7CiAgICAJCQkJdGhpcy5zaXplICs9IDg7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5URkhEX0ZMQUdfU0FNUExFX0RFU0MpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gNDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfRFVSKSB7CiAgICAJCQkJdGhpcy5zaXplICs9IDQ7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5URkhEX0ZMQUdfU0FNUExFX1NJWkUpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gNDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfRkxBR1MpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gNDsKICAgIAkJCX0KICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnRyYWNrX2lkKTsKICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19CQVNFX0RBVEFfT0ZGU0VUKSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDY0KHRoaXMuYmFzZV9kYXRhX29mZnNldCk7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5URkhEX0ZMQUdfU0FNUExFX0RFU0MpIHsKICAgIAkJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5kZWZhdWx0X3NhbXBsZV9kZXNjcmlwdGlvbl9pbmRleCk7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5URkhEX0ZMQUdfU0FNUExFX0RVUikgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmRlZmF1bHRfc2FtcGxlX2R1cmF0aW9uKTsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19TQU1QTEVfU0laRSkgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmRlZmF1bHRfc2FtcGxlX3NpemUpOwogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9GTEFHUykgewogICAgCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmRlZmF1bHRfc2FtcGxlX2ZsYWdzKTsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL3dyaXRpbmcvdGtoZC5qcwogICAgCQlCb3hQYXJzZXIudGtoZEJveC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CiAgICAJCQkvL3RoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNCoxOCsyKjQ7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5jcmVhdGlvbl90aW1lKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLm1vZGlmaWNhdGlvbl90aW1lKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnRyYWNrX2lkKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMigwKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLmR1cmF0aW9uKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMigwKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMigwKTsKICAgIAkJCXN0cmVhbS53cml0ZUludDE2KHRoaXMubGF5ZXIpOwogICAgCQkJc3RyZWFtLndyaXRlSW50MTYodGhpcy5hbHRlcm5hdGVfZ3JvdXApOwogICAgCQkJc3RyZWFtLndyaXRlSW50MTYodGhpcy52b2x1bWU8PDgpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDE2KDApOwogICAgCQkJc3RyZWFtLndyaXRlSW50MzJBcnJheSh0aGlzLm1hdHJpeCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy53aWR0aCk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5oZWlnaHQpOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy90cmV4LmpzCiAgICAJCUJveFBhcnNlci50cmV4Qm94LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgCQkJdGhpcy52ZXJzaW9uID0gMDsKICAgIAkJCXRoaXMuZmxhZ3MgPSAwOwogICAgCQkJdGhpcy5zaXplID0gNCo1OwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMudHJhY2tfaWQpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZGVmYXVsdF9zYW1wbGVfZGVzY3JpcHRpb25faW5kZXgpOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZGVmYXVsdF9zYW1wbGVfZHVyYXRpb24pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZGVmYXVsdF9zYW1wbGVfc2l6ZSk7CiAgICAJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5kZWZhdWx0X3NhbXBsZV9mbGFncyk7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3RydW4uanMKICAgIAkJQm94UGFyc2VyLnRydW5Cb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy5zaXplID0gNDsKICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfREFUQV9PRkZTRVQpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gNDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfRklSU1RfRkxBRykgewogICAgCQkJCXRoaXMuc2l6ZSArPSA0OwogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19EVVJBVElPTikgewogICAgCQkJCXRoaXMuc2l6ZSArPSA0KnRoaXMuc2FtcGxlX2R1cmF0aW9uLmxlbmd0aDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfU0laRSkgewogICAgCQkJCXRoaXMuc2l6ZSArPSA0KnRoaXMuc2FtcGxlX3NpemUubGVuZ3RoOwogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19GTEFHUykgewogICAgCQkJCXRoaXMuc2l6ZSArPSA0KnRoaXMuc2FtcGxlX2ZsYWdzLmxlbmd0aDsKICAgIAkJCX0KICAgIAkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfQ1RTX09GRlNFVCkgewogICAgCQkJCXRoaXMuc2l6ZSArPSA0KnRoaXMuc2FtcGxlX2NvbXBvc2l0aW9uX3RpbWVfb2Zmc2V0Lmxlbmd0aDsKICAgIAkJCX0KICAgIAkJCXRoaXMud3JpdGVIZWFkZXIoc3RyZWFtKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNhbXBsZV9jb3VudCk7CiAgICAJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX0RBVEFfT0ZGU0VUKSB7CiAgICAJCQkJdGhpcy5kYXRhX29mZnNldF9wb3NpdGlvbiA9IHN0cmVhbS5nZXRQb3NpdGlvbigpOwogICAgCQkJCXN0cmVhbS53cml0ZUludDMyKHRoaXMuZGF0YV9vZmZzZXQpOyAvL3NpZ25lZAogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19GSVJTVF9GTEFHKSB7CiAgICAJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuZmlyc3Rfc2FtcGxlX2ZsYWdzKTsKICAgIAkJCX0KICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zYW1wbGVfY291bnQ7IGkrKykgewogICAgCQkJCWlmICh0aGlzLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfRFVSQVRJT04pIHsKICAgIAkJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2FtcGxlX2R1cmF0aW9uW2ldKTsKICAgIAkJCQl9CiAgICAJCQkJaWYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19TSVpFKSB7CiAgICAJCQkJCXN0cmVhbS53cml0ZVVpbnQzMih0aGlzLnNhbXBsZV9zaXplW2ldKTsKICAgIAkJCQl9CiAgICAJCQkJaWYgKHRoaXMuZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19GTEFHUykgewogICAgCQkJCQlzdHJlYW0ud3JpdGVVaW50MzIodGhpcy5zYW1wbGVfZmxhZ3NbaV0pOwogICAgCQkJCX0KICAgIAkJCQlpZiAodGhpcy5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX0NUU19PRkZTRVQpIHsKICAgIAkJCQkJaWYgKHRoaXMudmVyc2lvbiA9PT0gMCkgewogICAgCQkJCQkJc3RyZWFtLndyaXRlVWludDMyKHRoaXMuc2FtcGxlX2NvbXBvc2l0aW9uX3RpbWVfb2Zmc2V0W2ldKTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCXN0cmVhbS53cml0ZUludDMyKHRoaXMuc2FtcGxlX2NvbXBvc2l0aW9uX3RpbWVfb2Zmc2V0W2ldKTsgLy9zaWduZWQKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0JCQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvd3JpdGluZy91cmwuanMKICAgIAkJQm94UGFyc2VyWyJ1cmwgQm94Il0ucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwkKICAgIAkJCWlmICh0aGlzLmxvY2F0aW9uKSB7CiAgICAJCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQkJdGhpcy5zaXplID0gdGhpcy5sb2NhdGlvbi5sZW5ndGgrMTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5mbGFncyA9IDB4MDAwMDAxOwogICAgCQkJCXRoaXMuc2l6ZSA9IDA7CiAgICAJCQl9CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlpZiAodGhpcy5sb2NhdGlvbikgewogICAgCQkJCXN0cmVhbS53cml0ZUNTdHJpbmcodGhpcy5sb2NhdGlvbik7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3Vybi5qcwogICAgCQlCb3hQYXJzZXJbInVybiBCb3giXS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIAkJCXRoaXMudmVyc2lvbiA9IDA7CQogICAgCQkJdGhpcy5mbGFncyA9IDA7CiAgICAJCQl0aGlzLnNpemUgPSB0aGlzLm5hbWUubGVuZ3RoKzErKHRoaXMubG9jYXRpb24gPyB0aGlzLmxvY2F0aW9uLmxlbmd0aCsxIDogMCk7CiAgICAJCQl0aGlzLndyaXRlSGVhZGVyKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0ud3JpdGVDU3RyaW5nKHRoaXMubmFtZSk7CiAgICAJCQlpZiAodGhpcy5sb2NhdGlvbikgewogICAgCQkJCXN0cmVhbS53cml0ZUNTdHJpbmcodGhpcy5sb2NhdGlvbik7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy93cml0aW5nL3ZtaGQuanMKICAgIAkJQm94UGFyc2VyLnZtaGRCb3gucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAJCQl0aGlzLnZlcnNpb24gPSAwOwogICAgCQkJdGhpcy5mbGFncyA9IDE7CiAgICAJCQl0aGlzLnNpemUgPSA4OwogICAgCQkJdGhpcy53cml0ZUhlYWRlcihzdHJlYW0pOwogICAgCQkJc3RyZWFtLndyaXRlVWludDE2KHRoaXMuZ3JhcGhpY3Ntb2RlKTsKICAgIAkJCXN0cmVhbS53cml0ZVVpbnQxNkFycmF5KHRoaXMub3Bjb2xvcik7CiAgICAJCX07CgogICAgCQkvLyBmaWxlOnNyYy9ib3gtdW5wYWNrLmpzCiAgICAJCS8qIAogICAgCQkgKiBDb3B5cmlnaHQgKGMpIFRlbGVjb20gUGFyaXNUZWNoL1RTSS9NTS9HUEFDIEN5cmlsIENvbmNvbGF0bwogICAgCQkgKiBMaWNlbnNlOiBCU0QtMy1DbGF1c2UgKHNlZSBMSUNFTlNFIGZpbGUpCiAgICAJCSAqLwogICAgCQlCb3hQYXJzZXIuY3R0c0JveC5wcm90b3R5cGUudW5wYWNrID0gZnVuY3Rpb24oc2FtcGxlcykgewogICAgCQkJdmFyIGksIGosIGs7CiAgICAJCQlrID0gMDsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLnNhbXBsZV9jb3VudHMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlmb3IgKGogPSAwOyBqIDwgdGhpcy5zYW1wbGVfY291bnRzW2ldOyBqKyspIHsKICAgIAkJCQkJc2FtcGxlc1trXS5wdHMgPSBzYW1wbGVzW2tdLmR0cyArIHRoaXMuc2FtcGxlX29mZnNldHNbaV07CiAgICAJCQkJCWsrKzsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuc3R0c0JveC5wcm90b3R5cGUudW5wYWNrID0gZnVuY3Rpb24oc2FtcGxlcykgewogICAgCQkJdmFyIGksIGosIGs7CiAgICAJCQlrID0gMDsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLnNhbXBsZV9jb3VudHMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlmb3IgKGogPSAwOyBqIDwgdGhpcy5zYW1wbGVfY291bnRzW2ldOyBqKyspIHsKICAgIAkJCQkJaWYgKGsgPT09IDApIHsKICAgIAkJCQkJCXNhbXBsZXNba10uZHRzID0gMDsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCXNhbXBsZXNba10uZHRzID0gc2FtcGxlc1trLTFdLmR0cyArIHRoaXMuc2FtcGxlX2RlbHRhc1tpXTsKICAgIAkJCQkJfQogICAgCQkJCQlrKys7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLnN0Y29Cb3gucHJvdG90eXBlLnVucGFjayA9IGZ1bmN0aW9uKHNhbXBsZXMpIHsKICAgIAkJCXZhciBpOwogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMuY2h1bmtfb2Zmc2V0cy5sZW5ndGg7IGkrKykgewogICAgCQkJCXNhbXBsZXNbaV0ub2Zmc2V0ID0gdGhpcy5jaHVua19vZmZzZXRzW2ldOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLnN0c2NCb3gucHJvdG90eXBlLnVucGFjayA9IGZ1bmN0aW9uKHNhbXBsZXMpIHsKICAgIAkJCXZhciBpLCBqLCBrLCBsLCBtOwogICAgCQkJbCA9IDA7CiAgICAJCQltID0gMDsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLmZpcnN0X2NodW5rLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJZm9yIChqID0gMDsgaiA8IChpKzEgPCB0aGlzLmZpcnN0X2NodW5rLmxlbmd0aCA/IHRoaXMuZmlyc3RfY2h1bmtbaSsxXSA6IEluZmluaXR5KTsgaisrKSB7CiAgICAJCQkJCW0rKzsKICAgIAkJCQkJZm9yIChrID0gMDsgayA8IHRoaXMuc2FtcGxlc19wZXJfY2h1bmtbaV07IGsrKykgewogICAgCQkJCQkJaWYgKHNhbXBsZXNbbF0pIHsKICAgIAkJCQkJCQlzYW1wbGVzW2xdLmRlc2NyaXB0aW9uX2luZGV4ID0gdGhpcy5zYW1wbGVfZGVzY3JpcHRpb25faW5kZXhbaV07CiAgICAJCQkJCQkJc2FtcGxlc1tsXS5jaHVua19pbmRleCA9IG07CiAgICAJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCXJldHVybjsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWwrKzsKICAgIAkJCQkJfQkJCQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5zdHN6Qm94LnByb3RvdHlwZS51bnBhY2sgPSBmdW5jdGlvbihzYW1wbGVzKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLnNhbXBsZV9zaXplcy5sZW5ndGg7IGkrKykgewogICAgCQkJCXNhbXBsZXNbaV0uc2l6ZSA9IHRoaXMuc2FtcGxlX3NpemVzW2ldOwogICAgCQkJfQogICAgCQl9OwogICAgCQkvLyBmaWxlOnNyYy9ib3gtZGlmZi5qcwoKICAgIAkJQm94UGFyc2VyLkRJRkZfQk9YRVNfUFJPUF9OQU1FUyA9IFsgImJveGVzIiwgImVudHJpZXMiLCAicmVmZXJlbmNlcyIsICJzdWJzYW1wbGVzIiwKICAgIAkJCQkJCQkgCSAiaXRlbXMiLCAiaXRlbV9pbmZvcyIsICJleHRlbnRzIiwgImFzc29jaWF0aW9ucyIsCiAgICAJCQkJCQkJIAkgInN1YnNlZ21lbnRzIiwgInJhbmdlcyIsICJzZWVrTGlzdHMiLCAic2Vla1BvaW50cyIsCiAgICAJCQkJCQkJIAkgImVzZCIsICJsZXZlbHMiXTsKCiAgICAJCUJveFBhcnNlci5ESUZGX1BSSU1JVElWRV9BUlJBWV9QUk9QX05BTUVTID0gWyAiY29tcGF0aWJsZV9icmFuZHMiLCAibWF0cml4IiwgIm9wY29sb3IiLCAic2FtcGxlX2NvdW50cyIsICJzYW1wbGVfY291bnRzIiwgInNhbXBsZV9kZWx0YXMiLAogICAgCQkiZmlyc3RfY2h1bmsiLCAic2FtcGxlc19wZXJfY2h1bmsiLCAic2FtcGxlX3NpemVzIiwgImNodW5rX29mZnNldHMiLCAic2FtcGxlX29mZnNldHMiLCAic2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4IiwgInNhbXBsZV9kdXJhdGlvbiIgXTsKCiAgICAJCUJveFBhcnNlci5ib3hFcXVhbEZpZWxkcyA9IGZ1bmN0aW9uKGJveF9hLCBib3hfYikgewogICAgCQkJaWYgKGJveF9hICYmICFib3hfYikgcmV0dXJuIGZhbHNlOwogICAgCQkJdmFyIHByb3A7CiAgICAJCQlmb3IgKHByb3AgaW4gYm94X2EpIHsKICAgIAkJCQlpZiAoQm94UGFyc2VyLkRJRkZfQk9YRVNfUFJPUF9OQU1FUy5pbmRleE9mKHByb3ApID4gLTEpIHsKICAgIAkJCQkJY29udGludWU7CiAgICAJCQkJLy8gfSBlbHNlIGlmIChleGNsdWRlZF9maWVsZHMgJiYgZXhjbHVkZWRfZmllbGRzLmluZGV4T2YocHJvcCkgPiAtMSkgewogICAgCQkJCS8vIAljb250aW51ZTsKICAgIAkJCQl9IGVsc2UgaWYgKGJveF9hW3Byb3BdIGluc3RhbmNlb2YgQm94UGFyc2VyLkJveCB8fCBib3hfYltwcm9wXSBpbnN0YW5jZW9mIEJveFBhcnNlci5Cb3gpIHsKICAgIAkJCQkJY29udGludWU7CiAgICAJCQkJfSBlbHNlIGlmICh0eXBlb2YgYm94X2FbcHJvcF0gPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBib3hfYltwcm9wXSA9PT0gInVuZGVmaW5lZCIpIHsKICAgIAkJCQkJY29udGludWU7CiAgICAJCQkJfSBlbHNlIGlmICh0eXBlb2YgYm94X2FbcHJvcF0gPT09ICJmdW5jdGlvbiIgfHwgdHlwZW9mIGJveF9iW3Byb3BdID09PSAiZnVuY3Rpb24iKSB7CiAgICAJCQkJCWNvbnRpbnVlOwogICAgCQkJCX0gZWxzZSBpZiAoCiAgICAJCQkJCShib3hfYS5zdWJCb3hOYW1lcyAmJiBib3hfYS5zdWJCb3hOYW1lcy5pbmRleE9mKHByb3Auc2xpY2UoMCw0KSkgPiAtMSkgfHwKICAgIAkJCQkJKGJveF9iLnN1YkJveE5hbWVzICYmIGJveF9iLnN1YkJveE5hbWVzLmluZGV4T2YocHJvcC5zbGljZSgwLDQpKSA+IC0xKSkgIHsKICAgIAkJCQkJY29udGludWU7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJaWYgKHByb3AgPT09ICJkYXRhIiB8fCBwcm9wID09PSAic3RhcnQiIHx8IHByb3AgPT09ICJzaXplIiB8fCBwcm9wID09PSAiY3JlYXRpb25fdGltZSIgfHwgcHJvcCA9PT0gIm1vZGlmaWNhdGlvbl90aW1lIikgewogICAgCQkJCQkJY29udGludWU7CiAgICAJCQkJCX0gZWxzZSBpZiAoQm94UGFyc2VyLkRJRkZfUFJJTUlUSVZFX0FSUkFZX1BST1BfTkFNRVMuaW5kZXhPZihwcm9wKSA+IC0xKSB7CiAgICAJCQkJCQljb250aW51ZTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCWlmIChib3hfYVtwcm9wXSAhPT0gYm94X2JbcHJvcF0pIHsKICAgIAkJCQkJCQlyZXR1cm4gZmFsc2U7CiAgICAJCQkJCQl9CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5ib3hFcXVhbCA9IGZ1bmN0aW9uKGJveF9hLCBib3hfYikgewogICAgCQkJaWYgKCFCb3hQYXJzZXIuYm94RXF1YWxGaWVsZHMoYm94X2EsIGJveF9iKSkgewogICAgCQkJCXJldHVybiBmYWxzZTsKICAgIAkJCX0KICAgIAkJCWZvciAodmFyIGogPSAwOyBqIDwgQm94UGFyc2VyLkRJRkZfQk9YRVNfUFJPUF9OQU1FUy5sZW5ndGg7IGorKykgewogICAgCQkJCXZhciBuYW1lID0gQm94UGFyc2VyLkRJRkZfQk9YRVNfUFJPUF9OQU1FU1tqXTsKICAgIAkJCQlpZiAoYm94X2FbbmFtZV0gJiYgYm94X2JbbmFtZV0pIHsKICAgIAkJCQkJaWYgKCFCb3hQYXJzZXIuYm94RXF1YWwoYm94X2FbbmFtZV0sIGJveF9iW25hbWVdKSkgewogICAgCQkJCQkJcmV0dXJuIGZhbHNlOwogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJcmV0dXJuIHRydWU7CiAgICAJCX07Ly8gZmlsZTpzcmMvdGV4dC1tcDQuanMKICAgIAkJLyogCiAgICAJCSAqIENvcHlyaWdodCAoYykgMjAxMi0yMDEzLiBUZWxlY29tIFBhcmlzVGVjaC9UU0kvTU0vR1BBQyBDeXJpbCBDb25jb2xhdG8KICAgIAkJICogTGljZW5zZTogQlNELTMtQ2xhdXNlIChzZWUgTElDRU5TRSBmaWxlKQogICAgCQkgKi8KICAgIAkJdmFyIFZUVGluNFBhcnNlciA9IGZ1bmN0aW9uKCkgewkKICAgIAkJfTsKCiAgICAJCVZUVGluNFBhcnNlci5wcm90b3R5cGUucGFyc2VTYW1wbGUgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAJCQl2YXIgY3VlcywgY3VlOwogICAgCQkJdmFyIHN0cmVhbSA9IG5ldyBNUDRCb3hTdHJlYW0oZGF0YS5idWZmZXIpOwogICAgCQkJY3VlcyA9IFtdOwogICAgCQkJd2hpbGUgKCFzdHJlYW0uaXNFb3MoKSkgewogICAgCQkJCWN1ZSA9IEJveFBhcnNlci5wYXJzZU9uZUJveChzdHJlYW0sIGZhbHNlKTsKICAgIAkJCQlpZiAoY3VlLmNvZGUgPT09IEJveFBhcnNlci5PSyAmJiBjdWUuYm94LnR5cGUgPT09ICJ2dHRjIikgewogICAgCQkJCQljdWVzLnB1c2goY3VlLmJveCk7CiAgICAJCQkJfQkJCiAgICAJCQl9CiAgICAJCQlyZXR1cm4gY3VlczsKICAgIAkJfTsKCiAgICAJCVZUVGluNFBhcnNlci5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uIChzdGFydFRpbWUsIGVuZFRpbWUsIGRhdGEpIHsKICAgIAkJCWZ1bmN0aW9uIHBhZChuLCB3aWR0aCwgeikgewogICAgCQkJICB6ID0geiB8fCAnMCc7CiAgICAJCQkgIG4gPSBuICsgJyc7CiAgICAJCQkgIHJldHVybiBuLmxlbmd0aCA+PSB3aWR0aCA/IG4gOiBuZXcgQXJyYXkod2lkdGggLSBuLmxlbmd0aCArIDEpLmpvaW4oeikgKyBuOwogICAgCQkJfQogICAgCQkJZnVuY3Rpb24gc2VjVG9UaW1lc3RhbXAoaW5zZWMpIHsKICAgIAkJCQl2YXIgaCA9IE1hdGguZmxvb3IoaW5zZWMvMzYwMCk7CiAgICAJCQkJdmFyIG0gPSBNYXRoLmZsb29yKChpbnNlYyAtIGgqMzYwMCkvNjApOwogICAgCQkJCXZhciBzID0gTWF0aC5mbG9vcihpbnNlYyAtIGgqMzYwMCAtIG0qNjApOwogICAgCQkJCXZhciBtcyA9IE1hdGguZmxvb3IoKGluc2VjIC0gaCozNjAwIC0gbSo2MCAtIHMpKjEwMDApOwogICAgCQkJCXJldHVybiAiIitwYWQoaCwgMikrIjoiK3BhZChtLDIpKyI6IitwYWQocywgMikrIi4iK3BhZChtcywgMyk7CiAgICAJCQl9CiAgICAJCQl2YXIgY3VlcyA9IHRoaXMucGFyc2VTYW1wbGUoZGF0YSk7CiAgICAJCQl2YXIgc3RyaW5nID0gIiI7CiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IGN1ZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQl2YXIgY3VlSW40ID0gY3Vlc1tpXTsKICAgIAkJCQlzdHJpbmcgKz0gc2VjVG9UaW1lc3RhbXAoc3RhcnRUaW1lKSsiIC0tPiAiK3NlY1RvVGltZXN0YW1wKGVuZFRpbWUpKyJcclxuIjsKICAgIAkJCQlzdHJpbmcgKz0gY3VlSW40LnBheWwudGV4dDsKICAgIAkJCX0KICAgIAkJCXJldHVybiBzdHJpbmc7CiAgICAJCX07CgogICAgCQl2YXIgWE1MU3VidGl0bGVpbjRQYXJzZXIgPSBmdW5jdGlvbigpIHsJCiAgICAJCX07CgogICAgCQlYTUxTdWJ0aXRsZWluNFBhcnNlci5wcm90b3R5cGUucGFyc2VTYW1wbGUgPSBmdW5jdGlvbihzYW1wbGUpIHsKICAgIAkJCXZhciByZXMgPSB7fTsJCiAgICAJCQl2YXIgaTsKICAgIAkJCXJlcy5yZXNvdXJjZXMgPSBbXTsKICAgIAkJCXZhciBzdHJlYW0gPSBuZXcgTVA0Qm94U3RyZWFtKHNhbXBsZS5kYXRhLmJ1ZmZlcik7CiAgICAJCQlpZiAoIXNhbXBsZS5zdWJzYW1wbGVzIHx8IHNhbXBsZS5zdWJzYW1wbGVzLmxlbmd0aCA9PT0gMCkgewogICAgCQkJCXJlcy5kb2N1bWVudFN0cmluZyA9IHN0cmVhbS5yZWFkU3RyaW5nKHNhbXBsZS5kYXRhLmxlbmd0aCk7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXJlcy5kb2N1bWVudFN0cmluZyA9IHN0cmVhbS5yZWFkU3RyaW5nKHNhbXBsZS5zdWJzYW1wbGVzWzBdLnNpemUpOwogICAgCQkJCWlmIChzYW1wbGUuc3Vic2FtcGxlcy5sZW5ndGggPiAxKSB7CiAgICAJCQkJCWZvciAoaSA9IDE7IGkgPCBzYW1wbGUuc3Vic2FtcGxlcy5sZW5ndGg7IGkrKykgewogICAgCQkJCQkJcmVzLnJlc291cmNlc1tpXSA9IHN0cmVhbS5yZWFkVWludDhBcnJheShzYW1wbGUuc3Vic2FtcGxlc1tpXS5zaXplKTsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJCWlmICh0eXBlb2YgKERPTVBhcnNlcikgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAJCQkJcmVzLmRvY3VtZW50ID0gKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKHJlcy5kb2N1bWVudFN0cmluZywgImFwcGxpY2F0aW9uL3htbCIpOwogICAgCQkJfQogICAgCQkJcmV0dXJuIHJlczsKICAgIAkJfTsKCiAgICAJCXZhciBUZXh0aW40UGFyc2VyID0gZnVuY3Rpb24oKSB7CQogICAgCQl9OwoKICAgIAkJVGV4dGluNFBhcnNlci5wcm90b3R5cGUucGFyc2VTYW1wbGUgPSBmdW5jdGlvbihzYW1wbGUpIHsKICAgIAkJCXZhciB0ZXh0U3RyaW5nOwogICAgCQkJdmFyIHN0cmVhbSA9IG5ldyBNUDRCb3hTdHJlYW0oc2FtcGxlLmRhdGEuYnVmZmVyKTsKICAgIAkJCXRleHRTdHJpbmcgPSBzdHJlYW0ucmVhZFN0cmluZyhzYW1wbGUuZGF0YS5sZW5ndGgpOwogICAgCQkJcmV0dXJuIHRleHRTdHJpbmc7CiAgICAJCX07CgogICAgCQlUZXh0aW40UGFyc2VyLnByb3RvdHlwZS5wYXJzZUNvbmZpZyA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgIAkJCXZhciB0ZXh0U3RyaW5nOwogICAgCQkJdmFyIHN0cmVhbSA9IG5ldyBNUDRCb3hTdHJlYW0oZGF0YS5idWZmZXIpOwogICAgCQkJc3RyZWFtLnJlYWRVaW50MzIoKTsgLy8gdmVyc2lvbiAmIGZsYWdzCiAgICAJCQl0ZXh0U3RyaW5nID0gc3RyZWFtLnJlYWRDU3RyaW5nKCk7CiAgICAJCQlyZXR1cm4gdGV4dFN0cmluZzsKICAgIAkJfTsKCiAgICAJCXsKICAgIAkJCWV4cG9ydHMuVlRUaW40UGFyc2VyID0gVlRUaW40UGFyc2VyOwogICAgCQkJZXhwb3J0cy5YTUxTdWJ0aXRsZWluNFBhcnNlciA9IFhNTFN1YnRpdGxlaW40UGFyc2VyOwogICAgCQkJZXhwb3J0cy5UZXh0aW40UGFyc2VyID0gVGV4dGluNFBhcnNlcjsKICAgIAkJfQogICAgCQkvLyBmaWxlOnNyYy9pc29maWxlLmpzCiAgICAJCS8qCiAgICAJCSAqIENvcHlyaWdodCAoYykgMjAxMi0yMDEzLiBUZWxlY29tIFBhcmlzVGVjaC9UU0kvTU0vR1BBQyBDeXJpbCBDb25jb2xhdG8KICAgIAkJICogTGljZW5zZTogQlNELTMtQ2xhdXNlIChzZWUgTElDRU5TRSBmaWxlKQogICAgCQkgKi8KICAgIAkJdmFyIElTT0ZpbGUgPSBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAJCQkvKiBNdXRpQnVmZmVyU3RyZWFtIG9iamVjdCB1c2VkIHRvIHBhcnNlIGJveGVzICovCiAgICAJCQl0aGlzLnN0cmVhbSA9IHN0cmVhbSB8fCBuZXcgTXVsdGlCdWZmZXJTdHJlYW0oKTsKICAgIAkJCS8qIEFycmF5IG9mIGFsbCBib3hlcyAoaW4gb3JkZXIpIGZvdW5kIGluIHRoZSBmaWxlICovCiAgICAJCQl0aGlzLmJveGVzID0gW107CiAgICAJCQkvKiBBcnJheSBvZiBhbGwgbWRhdHMgKi8KICAgIAkJCXRoaXMubWRhdHMgPSBbXTsKICAgIAkJCS8qIEFycmF5IG9mIGFsbCBtb29mcyAqLwogICAgCQkJdGhpcy5tb29mcyA9IFtdOwogICAgCQkJLyogQm9vbGVhbiBpbmRpY2F0aW5nIGlmIHRoZSBmaWxlIGlzIGNvbXBhdGlibGUgd2l0aCBwcm9ncmVzc2l2ZSBwYXJzaW5nIChtb292IGZpcnN0KSAqLwogICAgCQkJdGhpcy5pc1Byb2dyZXNzaXZlID0gZmFsc2U7CiAgICAJCQkvKiBCb29sZWFuIHVzZWQgdG8gZmlyZSBtb292IHN0YXJ0IGV2ZW50IG9ubHkgb25jZSAqLwogICAgCQkJdGhpcy5tb292U3RhcnRGb3VuZCA9IGZhbHNlOwogICAgCQkJLyogQ2FsbGJhY2sgY2FsbGVkIHdoZW4gdGhlIG1vb3YgcGFyc2luZyBzdGFydHMgKi8KICAgIAkJCXRoaXMub25Nb292U3RhcnQgPSBudWxsOwogICAgCQkJLyogQm9vbGVhbiBrZWVwaW5nIHRyYWNrIG9mIHRoZSBjYWxsIHRvIG9uTW9vdlN0YXJ0LCB0byBhdm9pZCBkb3VibGUgY2FsbHMgKi8KICAgIAkJCXRoaXMubW9vdlN0YXJ0U2VudCA9IGZhbHNlOwogICAgCQkJLyogQ2FsbGJhY2sgY2FsbGVkIHdoZW4gdGhlIG1vb3YgaXMgZW50aXJlbHkgcGFyc2VkICovCiAgICAJCQl0aGlzLm9uUmVhZHkgPSBudWxsOwogICAgCQkJLyogQm9vbGVhbiBrZWVwaW5nIHRyYWNrIG9mIHRoZSBjYWxsIHRvIG9uUmVhZHksIHRvIGF2b2lkIGRvdWJsZSBjYWxscyAqLwogICAgCQkJdGhpcy5yZWFkeVNlbnQgPSBmYWxzZTsKICAgIAkJCS8qIENhbGxiYWNrIHRvIGNhbGwgd2hlbiBzZWdtZW50cyBhcmUgcmVhZHkgKi8KICAgIAkJCXRoaXMub25TZWdtZW50ID0gbnVsbDsKICAgIAkJCS8qIENhbGxiYWNrIHRvIGNhbGwgd2hlbiBzYW1wbGVzIGFyZSByZWFkeSAqLwogICAgCQkJdGhpcy5vblNhbXBsZXMgPSBudWxsOwogICAgCQkJLyogQ2FsbGJhY2sgdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIGluIHRoZSBwYXJzaW5nIG9yIHByb2Nlc3Npbmcgb2Ygc2FtcGxlcyAqLwogICAgCQkJdGhpcy5vbkVycm9yID0gbnVsbDsKICAgIAkJCS8qIEJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGUgbW9vdiBib3ggcnVuLWxlbmd0aCBlbmNvZGVkIHRhYmxlcyBvZiBzYW1wbGUgaW5mb3JtYXRpb24gaGF2ZSBiZWVuIHByb2Nlc3NlZCAqLwogICAgCQkJdGhpcy5zYW1wbGVMaXN0QnVpbHQgPSBmYWxzZTsKICAgIAkJCS8qIEFycmF5IG9mIFRyYWNrIG9iamVjdHMgZm9yIHdoaWNoIGZyYWdtZW50YXRpb24gb2Ygc2FtcGxlcyBpcyByZXF1ZXN0ZWQgKi8KICAgIAkJCXRoaXMuZnJhZ21lbnRlZFRyYWNrcyA9IFtdOwogICAgCQkJLyogQXJyYXkgb2YgVHJhY2sgb2JqZWN0cyBmb3Igd2hpY2ggZXh0cmFjdGlvbiBvZiBzYW1wbGVzIGlzIHJlcXVlc3RlZCAqLwogICAgCQkJdGhpcy5leHRyYWN0ZWRUcmFja3MgPSBbXTsKICAgIAkJCS8qIEJvb2xlYW4gaW5kaWNhdGluZyB0aGF0IGZyYWdtZW50aW9uIGlzIHJlYWR5ICovCiAgICAJCQl0aGlzLmlzRnJhZ21lbnRhdGlvbkluaXRpYWxpemVkID0gZmFsc2U7CiAgICAJCQkvKiBCb29sZWFuIGluZGljYXRpbmcgdGhhdCBmcmFnbWVudGVkIGhhcyBzdGFydGVkICovCiAgICAJCQl0aGlzLnNhbXBsZVByb2Nlc3NpbmdTdGFydGVkID0gZmFsc2U7CiAgICAJCQkvKiBOdW1iZXIgb2YgdGhlIG5leHQgJ21vb2YnIHRvIGdlbmVyYXRlIHdoZW4gZnJhZ21lbnRpbmcgKi8KICAgIAkJCXRoaXMubmV4dE1vb2ZOdW1iZXIgPSAwOwogICAgCQkJLyogQm9vbGVhbiBpbmRpY2F0aW5nIGlmIHRoZSBpbml0aWFsIGxpc3Qgb2YgaXRlbXMgaGFzIGJlZW4gcHJvZHVjZWQgKi8KICAgIAkJCXRoaXMuaXRlbUxpc3RCdWlsdCA9IGZhbHNlOwogICAgCQkJLyogQXJyYXkgb2YgaXRlbXMgKi8KICAgIAkJCXRoaXMuaXRlbXMgPSBbXTsKICAgIAkJCS8qIEFycmF5IG9mIGVudGl0eSBncm91cHMgKi8KICAgIAkJCXRoaXMuZW50aXR5X2dyb3VwcyA9IFtdOwogICAgCQkJLyogQ2FsbGJhY2sgY2FsbGVkIHdoZW4gdGhlIHNpZHggYm94IGlzIGVudGlyZWx5IHBhcnNlZCAqLwogICAgCQkJdGhpcy5vblNpZHggPSBudWxsOwogICAgCQkJLyogQm9vbGVhbiBrZWVwaW5nIHRyYWNrIG9mIHRoZSBjYWxsIHRvIG9uU2lkeCwgdG8gYXZvaWQgZG91YmxlIGNhbGxzICovCiAgICAJCQl0aGlzLnNpZHhTZW50ID0gZmFsc2U7CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5zZXRTZWdtZW50T3B0aW9ucyA9IGZ1bmN0aW9uKGlkLCB1c2VyLCBvcHRpb25zKSB7CiAgICAJCQl2YXIgdHJhayA9IHRoaXMuZ2V0VHJhY2tCeUlkKGlkKTsKICAgIAkJCWlmICh0cmFrKSB7CiAgICAJCQkJdmFyIGZyYWdUcmFjayA9IHt9OwogICAgCQkJCXRoaXMuZnJhZ21lbnRlZFRyYWNrcy5wdXNoKGZyYWdUcmFjayk7CiAgICAJCQkJZnJhZ1RyYWNrLmlkID0gaWQ7CiAgICAJCQkJZnJhZ1RyYWNrLnVzZXIgPSB1c2VyOwogICAgCQkJCWZyYWdUcmFjay50cmFrID0gdHJhazsKICAgIAkJCQl0cmFrLm5leHRTYW1wbGUgPSAwOwogICAgCQkJCWZyYWdUcmFjay5zZWdtZW50U3RyZWFtID0gbnVsbDsKICAgIAkJCQlmcmFnVHJhY2submJfc2FtcGxlcyA9IDEwMDA7CiAgICAJCQkJZnJhZ1RyYWNrLnJhcEFsaWduZW1lbnQgPSB0cnVlOwogICAgCQkJCWlmIChvcHRpb25zKSB7CiAgICAJCQkJCWlmIChvcHRpb25zLm5iU2FtcGxlcykgZnJhZ1RyYWNrLm5iX3NhbXBsZXMgPSBvcHRpb25zLm5iU2FtcGxlczsKICAgIAkJCQkJaWYgKG9wdGlvbnMucmFwQWxpZ25lbWVudCkgZnJhZ1RyYWNrLnJhcEFsaWduZW1lbnQgPSBvcHRpb25zLnJhcEFsaWduZW1lbnQ7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUudW5zZXRTZWdtZW50T3B0aW9ucyA9IGZ1bmN0aW9uKGlkKSB7CiAgICAJCQl2YXIgaW5kZXggPSAtMTsKICAgIAkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5mcmFnbWVudGVkVHJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdmFyIGZyYWdUcmFjayA9IHRoaXMuZnJhZ21lbnRlZFRyYWNrc1tpXTsKICAgIAkJCQlpZiAoZnJhZ1RyYWNrLmlkID09IGlkKSB7CiAgICAJCQkJCWluZGV4ID0gaTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAoaW5kZXggPiAtMSkgewogICAgCQkJCXRoaXMuZnJhZ21lbnRlZFRyYWNrcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuc2V0RXh0cmFjdGlvbk9wdGlvbnMgPSBmdW5jdGlvbihpZCwgdXNlciwgb3B0aW9ucykgewogICAgCQkJdmFyIHRyYWsgPSB0aGlzLmdldFRyYWNrQnlJZChpZCk7CiAgICAJCQlpZiAodHJhaykgewogICAgCQkJCXZhciBleHRyYWN0VHJhY2sgPSB7fTsKICAgIAkJCQl0aGlzLmV4dHJhY3RlZFRyYWNrcy5wdXNoKGV4dHJhY3RUcmFjayk7CiAgICAJCQkJZXh0cmFjdFRyYWNrLmlkID0gaWQ7CiAgICAJCQkJZXh0cmFjdFRyYWNrLnVzZXIgPSB1c2VyOwogICAgCQkJCWV4dHJhY3RUcmFjay50cmFrID0gdHJhazsKICAgIAkJCQl0cmFrLm5leHRTYW1wbGUgPSAwOwogICAgCQkJCWV4dHJhY3RUcmFjay5uYl9zYW1wbGVzID0gMTAwMDsKICAgIAkJCQlleHRyYWN0VHJhY2suc2FtcGxlcyA9IFtdOwogICAgCQkJCWlmIChvcHRpb25zKSB7CiAgICAJCQkJCWlmIChvcHRpb25zLm5iU2FtcGxlcykgZXh0cmFjdFRyYWNrLm5iX3NhbXBsZXMgPSBvcHRpb25zLm5iU2FtcGxlczsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS51bnNldEV4dHJhY3Rpb25PcHRpb25zID0gZnVuY3Rpb24oaWQpIHsKICAgIAkJCXZhciBpbmRleCA9IC0xOwogICAgCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmV4dHJhY3RlZFRyYWNrcy5sZW5ndGg7IGkrKykgewogICAgCQkJCXZhciBleHRyYWN0VHJhY2sgPSB0aGlzLmV4dHJhY3RlZFRyYWNrc1tpXTsKICAgIAkJCQlpZiAoZXh0cmFjdFRyYWNrLmlkID09IGlkKSB7CiAgICAJCQkJCWluZGV4ID0gaTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAoaW5kZXggPiAtMSkgewogICAgCQkJCXRoaXMuZXh0cmFjdGVkVHJhY2tzLnNwbGljZShpbmRleCwgMSk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKCkgewogICAgCQkJdmFyIHJldDsKICAgIAkJCXZhciBib3g7CiAgICAJCQl2YXIgcGFyc2VCb3hIZWFkZXJzT25seSA9IGZhbHNlOwoKICAgIAkJCWlmICh0aGlzLnJlc3RvcmVQYXJzZVBvc2l0aW9uKQl7CiAgICAJCQkJaWYgKCF0aGlzLnJlc3RvcmVQYXJzZVBvc2l0aW9uKCkpIHsKICAgIAkJCQkJcmV0dXJuOwogICAgCQkJCX0KICAgIAkJCX0KCiAgICAJCQl3aGlsZSAodHJ1ZSkgewoKICAgIAkJCQlpZiAodGhpcy5oYXNJbmNvbXBsZXRlTWRhdCAmJiB0aGlzLmhhc0luY29tcGxldGVNZGF0KCkpIHsKICAgIAkJCQkJaWYgKHRoaXMucHJvY2Vzc0luY29tcGxldGVNZGF0KCkpIHsKICAgIAkJCQkJCWNvbnRpbnVlOwogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJcmV0dXJuOwogICAgCQkJCQl9CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJaWYgKHRoaXMuc2F2ZVBhcnNlUG9zaXRpb24pCXsKICAgIAkJCQkJCXRoaXMuc2F2ZVBhcnNlUG9zaXRpb24oKTsKICAgIAkJCQkJfQogICAgCQkJCQlyZXQgPSBCb3hQYXJzZXIucGFyc2VPbmVCb3godGhpcy5zdHJlYW0sIHBhcnNlQm94SGVhZGVyc09ubHkpOwogICAgCQkJCQlpZiAocmV0LmNvZGUgPT09IEJveFBhcnNlci5FUlJfTk9UX0VOT1VHSF9EQVRBKSB7CiAgICAJCQkJCQlpZiAodGhpcy5wcm9jZXNzSW5jb21wbGV0ZUJveCkgewogICAgCQkJCQkJCWlmICh0aGlzLnByb2Nlc3NJbmNvbXBsZXRlQm94KHJldCkpIHsKICAgIAkJCQkJCQkJY29udGludWU7CiAgICAJCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQkJcmV0dXJuOwogICAgCQkJCQkJCX0KICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJcmV0dXJuOwogICAgCQkJCQkJfQogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJdmFyIGJveF90eXBlOwogICAgCQkJCQkJLyogdGhlIGJveCBpcyBlbnRpcmVseSBwYXJzZWQgKi8KICAgIAkJCQkJCWJveCA9IHJldC5ib3g7CiAgICAJCQkJCQlib3hfdHlwZSA9IChib3gudHlwZSAhPT0gInV1aWQiID8gYm94LnR5cGUgOiBib3gudXVpZCk7CiAgICAJCQkJCQkvKiBzdG9yZSB0aGUgYm94IGluIHRoZSAnYm94ZXMnIGFycmF5IHRvIHByZXNlcnZlIGJveCBvcmRlciAoZm9yIGZpbGUgcmV3cml0ZSBpZiBuZWVkZWQpICAqLwogICAgCQkJCQkJdGhpcy5ib3hlcy5wdXNoKGJveCk7CiAgICAJCQkJCQkvKiBidXQgYWxzbyBzdG9yZSBib3ggaW4gYSBwcm9wZXJ0eSBmb3IgbW9yZSBkaXJlY3QgYWNjZXNzICovCiAgICAJCQkJCQlzd2l0Y2ggKGJveF90eXBlKSB7CiAgICAJCQkJCQkJY2FzZSAibWRhdCI6CiAgICAJCQkJCQkJCXRoaXMubWRhdHMucHVzaChib3gpOwogICAgCQkJCQkJCQlicmVhazsKICAgIAkJCQkJCQljYXNlICJtb29mIjoKICAgIAkJCQkJCQkJdGhpcy5tb29mcy5wdXNoKGJveCk7CiAgICAJCQkJCQkJCWJyZWFrOwogICAgCQkJCQkJCWNhc2UgIm1vb3YiOgogICAgCQkJCQkJCQl0aGlzLm1vb3ZTdGFydEZvdW5kID0gdHJ1ZTsKICAgIAkJCQkJCQkJaWYgKHRoaXMubWRhdHMubGVuZ3RoID09PSAwKSB7CiAgICAJCQkJCQkJCQl0aGlzLmlzUHJvZ3Jlc3NpdmUgPSB0cnVlOwogICAgCQkJCQkJCQl9CiAgICAJCQkJCQkJCS8qIG5vIGJyZWFrICovCiAgICAJCQkJCQkJCS8qIGZhbGxzIHRocm91Z2ggKi8KICAgIAkJCQkJCQlkZWZhdWx0OgogICAgCQkJCQkJCQlpZiAodGhpc1tib3hfdHlwZV0gIT09IHVuZGVmaW5lZCkgewogICAgCQkJCQkJCQkJTG9nLndhcm4oIklTT0ZpbGUiLCAiRHVwbGljYXRlIEJveCBvZiB0eXBlOiAiK2JveF90eXBlKyIsIG92ZXJyaWRpbmcgcHJldmlvdXMgb2NjdXJyZW5jZSIpOwogICAgCQkJCQkJCQl9CiAgICAJCQkJCQkJCXRoaXNbYm94X3R5cGVdID0gYm94OwogICAgCQkJCQkJCQlicmVhazsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWlmICh0aGlzLnVwZGF0ZVVzZWRCeXRlcykgewogICAgCQkJCQkJCXRoaXMudXBkYXRlVXNlZEJ5dGVzKGJveCwgcmV0KTsKICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmNoZWNrQnVmZmVyID0gZnVuY3Rpb24gKGFiKSB7CiAgICAJCQlpZiAoYWIgPT09IG51bGwgfHwgYWIgPT09IHVuZGVmaW5lZCkgewogICAgCQkJCXRocm93KCJCdWZmZXIgbXVzdCBiZSBkZWZpbmVkIGFuZCBub24gZW1wdHkiKTsKICAgIAkJCX0KICAgIAkJCWlmIChhYi5maWxlU3RhcnQgPT09IHVuZGVmaW5lZCkgewogICAgCQkJCXRocm93KCJCdWZmZXIgbXVzdCBoYXZlIGEgZmlsZVN0YXJ0IHByb3BlcnR5Iik7CiAgICAJCQl9CiAgICAJCQlpZiAoYWIuYnl0ZUxlbmd0aCA9PT0gMCkgewogICAgCQkJCUxvZy53YXJuKCJJU09GaWxlIiwgIklnbm9yaW5nIGVtcHR5IGJ1ZmZlciAoZmlsZVN0YXJ0OiAiK2FiLmZpbGVTdGFydCsiKSIpOwogICAgCQkJCXRoaXMuc3RyZWFtLmxvZ0J1ZmZlckxldmVsKCk7CiAgICAJCQkJcmV0dXJuIGZhbHNlOwogICAgCQkJfQogICAgCQkJTG9nLmluZm8oIklTT0ZpbGUiLCAiUHJvY2Vzc2luZyBidWZmZXIgKGZpbGVTdGFydDogIithYi5maWxlU3RhcnQrIikiKTsKCiAgICAJCQkvKiBtYXJrIHRoZSBieXRlcyBpbiB0aGUgYnVmZmVyIGFzIG5vdCBiZWluZyB1c2VkIHlldCAqLwogICAgCQkJYWIudXNlZEJ5dGVzID0gMDsKICAgIAkJCXRoaXMuc3RyZWFtLmluc2VydEJ1ZmZlcihhYik7CiAgICAJCQl0aGlzLnN0cmVhbS5sb2dCdWZmZXJMZXZlbCgpOwoKICAgIAkJCWlmICghdGhpcy5zdHJlYW0uaW5pdGlhbGl6ZWQoKSkgewogICAgCQkJCUxvZy53YXJuKCJJU09GaWxlIiwgIk5vdCByZWFkeSB0byBzdGFydCBwYXJzaW5nIik7CiAgICAJCQkJcmV0dXJuIGZhbHNlOwogICAgCQkJfQogICAgCQkJcmV0dXJuIHRydWU7CiAgICAJCX07CgogICAgCQkvKiBQcm9jZXNzZXMgYSBuZXcgQXJyYXlCdWZmZXIgKHdpdGggYSBmaWxlU3RhcnQgcHJvcGVydHkpCiAgICAJCSAgIFJldHVybnMgdGhlIG5leHQgZXhwZWN0ZWQgZmlsZSBwb3NpdGlvbiwgb3IgdW5kZWZpbmVkIGlmIG5vdCByZWFkeSB0byBwYXJzZSAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5hcHBlbmRCdWZmZXIgPSBmdW5jdGlvbihhYiwgbGFzdCkgewogICAgCQkJdmFyIG5leHRGaWxlU3RhcnQ7CiAgICAJCQlpZiAoIXRoaXMuY2hlY2tCdWZmZXIoYWIpKSB7CiAgICAJCQkJcmV0dXJuOwogICAgCQkJfQoKICAgIAkJCS8qIFBhcnNlIHdoYXRldmVyIGlzIGluIHRoZSBleGlzdGluZyBidWZmZXJzICovCiAgICAJCQl0aGlzLnBhcnNlKCk7CgogICAgCQkJLyogQ2hlY2sgaWYgdGhlIG1vb3ZTdGFydCBjYWxsYmFjayBuZWVkcyB0byBiZSBjYWxsZWQgKi8KICAgIAkJCWlmICh0aGlzLm1vb3ZTdGFydEZvdW5kICYmICF0aGlzLm1vb3ZTdGFydFNlbnQpIHsKICAgIAkJCQl0aGlzLm1vb3ZTdGFydFNlbnQgPSB0cnVlOwogICAgCQkJCWlmICh0aGlzLm9uTW9vdlN0YXJ0KSB0aGlzLm9uTW9vdlN0YXJ0KCk7CiAgICAJCQl9CgogICAgCQkJaWYgKHRoaXMubW9vdikgewogICAgCQkJCS8qIEEgbW9vdiBib3ggaGFzIGJlZW4gZW50aXJlbHkgcGFyc2VkICovCgogICAgCQkJCS8qIGlmIHRoaXMgaXMgdGhlIGZpcnN0IGNhbGwgYWZ0ZXIgdGhlIG1vb3YgaXMgZm91bmQgd2UgaW5pdGlhbGl6ZSB0aGUgbGlzdCBvZiBzYW1wbGVzIChtYXkgYmUgZW1wdHkgaW4gZnJhZ21lbnRlZCBmaWxlcykgKi8KICAgIAkJCQlpZiAoIXRoaXMuc2FtcGxlTGlzdEJ1aWx0KSB7CiAgICAJCQkJCXRoaXMuYnVpbGRTYW1wbGVMaXN0cygpOwogICAgCQkJCQl0aGlzLnNhbXBsZUxpc3RCdWlsdCA9IHRydWU7CiAgICAJCQkJfQoKICAgIAkJCQkvKiBXZSB1cGRhdGUgdGhlIHNhbXBsZSBpbmZvcm1hdGlvbiBpZiB0aGVyZSBhcmUgYW55IG5ldyBtb29mIGJveGVzICovCiAgICAJCQkJdGhpcy51cGRhdGVTYW1wbGVMaXN0cygpOwoKICAgIAkJCQkvKiBJZiB0aGUgYXBwbGljYXRpb24gbmVlZHMgdG8gYmUgaW5mb3JtZWQgdGhhdCB0aGUgJ21vb3YnIGhhcyBiZWVuIGZvdW5kLAogICAgCQkJCSAgIHdlIGNyZWF0ZSB0aGUgaW5mb3JtYXRpb24gb2JqZWN0IGFuZCBjYWxsYmFjayB0aGUgYXBwbGljYXRpb24gKi8KICAgIAkJCQlpZiAodGhpcy5vblJlYWR5ICYmICF0aGlzLnJlYWR5U2VudCkgewogICAgCQkJCQl0aGlzLnJlYWR5U2VudCA9IHRydWU7CiAgICAJCQkJCXRoaXMub25SZWFkeSh0aGlzLmdldEluZm8oKSk7CiAgICAJCQkJfQoKICAgIAkJCQkvKiBTZWUgaWYgYW55IHNhbXBsZSBleHRyYWN0aW9uIG9yIHNlZ21lbnQgY3JlYXRpb24gbmVlZHMgdG8gYmUgZG9uZSB3aXRoIHRoZSBhdmFpbGFibGUgc2FtcGxlcyAqLwogICAgCQkJCXRoaXMucHJvY2Vzc1NhbXBsZXMobGFzdCk7CgogICAgCQkJCS8qIEluZm9ybSBhYm91dCB0aGUgYmVzdCByYW5nZSB0byBmZXRjaCBuZXh0ICovCiAgICAJCQkJaWYgKHRoaXMubmV4dFNlZWtQb3NpdGlvbikgewogICAgCQkJCQluZXh0RmlsZVN0YXJ0ID0gdGhpcy5uZXh0U2Vla1Bvc2l0aW9uOwogICAgCQkJCQl0aGlzLm5leHRTZWVrUG9zaXRpb24gPSB1bmRlZmluZWQ7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJbmV4dEZpbGVTdGFydCA9IHRoaXMubmV4dFBhcnNlUG9zaXRpb247CiAgICAJCQkJfQogICAgCQkJCWlmICh0aGlzLnN0cmVhbS5nZXRFbmRGaWxlUG9zaXRpb25BZnRlcikgewogICAgCQkJCQluZXh0RmlsZVN0YXJ0ID0gdGhpcy5zdHJlYW0uZ2V0RW5kRmlsZVBvc2l0aW9uQWZ0ZXIobmV4dEZpbGVTdGFydCk7CiAgICAJCQkJfQogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlpZiAodGhpcy5uZXh0UGFyc2VQb3NpdGlvbikgewogICAgCQkJCQkvKiBtb292IGhhcyBub3QgYmVlbiBwYXJzZWQgYnV0IHRoZSBmaXJzdCBidWZmZXIgd2FzIHJlY2VpdmVkLAogICAgCQkJCQkgICB0aGUgbmV4dCBmZXRjaCBzaG91bGQgcHJvYmFibHkgYmUgdGhlIG5leHQgYm94IHN0YXJ0ICovCiAgICAJCQkJCW5leHRGaWxlU3RhcnQgPSB0aGlzLm5leHRQYXJzZVBvc2l0aW9uOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCS8qIE5vIHZhbGlkIGJ1ZmZlciBoYXMgYmVlbiBwYXJzZWQgeWV0LCB3ZSBjYW5ub3Qga25vdyB3aGF0IHRvIHBhcnNlIG5leHQgKi8KICAgIAkJCQkJbmV4dEZpbGVTdGFydCA9IDA7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJaWYgKHRoaXMuc2lkeCkgewogICAgCQkJCWlmICh0aGlzLm9uU2lkeCAmJiAhdGhpcy5zaWR4U2VudCkgewogICAgCQkJCQl0aGlzLm9uU2lkeCh0aGlzLnNpZHgpOwogICAgCQkJCQl0aGlzLnNpZHhTZW50ID0gdHJ1ZTsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5tZXRhKSB7CiAgICAJCQkJaWYgKHRoaXMuZmxhdHRlbkl0ZW1JbmZvICYmICF0aGlzLml0ZW1MaXN0QnVpbHQpIHsKICAgIAkJCQkJdGhpcy5mbGF0dGVuSXRlbUluZm8oKTsKICAgIAkJCQkJdGhpcy5pdGVtTGlzdEJ1aWx0ID0gdHJ1ZTsKICAgIAkJCQl9CiAgICAJCQkJaWYgKHRoaXMucHJvY2Vzc0l0ZW1zKSB7CiAgICAJCQkJCXRoaXMucHJvY2Vzc0l0ZW1zKHRoaXMub25JdGVtKTsKICAgIAkJCQl9CiAgICAJCQl9CgogICAgCQkJaWYgKHRoaXMuc3RyZWFtLmNsZWFuQnVmZmVycykgewogICAgCQkJCUxvZy5pbmZvKCJJU09GaWxlIiwgIkRvbmUgcHJvY2Vzc2luZyBidWZmZXIgKGZpbGVTdGFydDogIithYi5maWxlU3RhcnQrIikgLSBuZXh0IGJ1ZmZlciB0byBmZXRjaCBzaG91bGQgaGF2ZSBhIGZpbGVTdGFydCBwb3NpdGlvbiBvZiAiK25leHRGaWxlU3RhcnQpOwogICAgCQkJCXRoaXMuc3RyZWFtLmxvZ0J1ZmZlckxldmVsKCk7CiAgICAJCQkJdGhpcy5zdHJlYW0uY2xlYW5CdWZmZXJzKCk7CiAgICAJCQkJdGhpcy5zdHJlYW0ubG9nQnVmZmVyTGV2ZWwodHJ1ZSk7CiAgICAJCQkJTG9nLmluZm8oIklTT0ZpbGUiLCAiU2FtcGxlIGRhdGEgc2l6ZSBpbiBtZW1vcnk6ICIrdGhpcy5nZXRBbGxvY2F0ZWRTYW1wbGVEYXRhU2l6ZSgpKTsKICAgIAkJCX0KICAgIAkJCXJldHVybiBuZXh0RmlsZVN0YXJ0OwogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuZ2V0SW5mbyA9IGZ1bmN0aW9uKCkgewogICAgCQkJdmFyIGksIGo7CiAgICAJCQl2YXIgbW92aWUgPSB7fTsKICAgIAkJCXZhciB0cmFrOwogICAgCQkJdmFyIHRyYWNrOwogICAgCQkJdmFyIHJlZjsKICAgIAkJCXZhciBzYW1wbGVfZGVzYzsKICAgIAkJCXZhciBfMTkwNCA9IChuZXcgRGF0ZSgnMTkwNC0wMS0wMVQwMDowMDowMFonKS5nZXRUaW1lKCkpOwoKICAgIAkJCWlmICh0aGlzLm1vb3YpIHsKICAgIAkJCQltb3ZpZS5oYXNNb292ID0gdHJ1ZTsKICAgIAkJCQltb3ZpZS5kdXJhdGlvbiA9IHRoaXMubW9vdi5tdmhkLmR1cmF0aW9uOwogICAgCQkJCW1vdmllLnRpbWVzY2FsZSA9IHRoaXMubW9vdi5tdmhkLnRpbWVzY2FsZTsKICAgIAkJCQltb3ZpZS5pc0ZyYWdtZW50ZWQgPSAodGhpcy5tb292Lm12ZXggIT0gbnVsbCk7CiAgICAJCQkJaWYgKG1vdmllLmlzRnJhZ21lbnRlZCAmJiB0aGlzLm1vb3YubXZleC5tZWhkKSB7CiAgICAJCQkJCW1vdmllLmZyYWdtZW50X2R1cmF0aW9uID0gdGhpcy5tb292Lm12ZXgubWVoZC5mcmFnbWVudF9kdXJhdGlvbjsKICAgIAkJCQl9CiAgICAJCQkJbW92aWUuaXNQcm9ncmVzc2l2ZSA9IHRoaXMuaXNQcm9ncmVzc2l2ZTsKICAgIAkJCQltb3ZpZS5oYXNJT0QgPSAodGhpcy5tb292LmlvZHMgIT0gbnVsbCk7CiAgICAJCQkJbW92aWUuYnJhbmRzID0gW107CiAgICAJCQkJbW92aWUuYnJhbmRzLnB1c2godGhpcy5mdHlwLm1ham9yX2JyYW5kKTsKICAgIAkJCQltb3ZpZS5icmFuZHMgPSBtb3ZpZS5icmFuZHMuY29uY2F0KHRoaXMuZnR5cC5jb21wYXRpYmxlX2JyYW5kcyk7CiAgICAJCQkJbW92aWUuY3JlYXRlZCA9IG5ldyBEYXRlKF8xOTA0K3RoaXMubW9vdi5tdmhkLmNyZWF0aW9uX3RpbWUqMTAwMCk7CiAgICAJCQkJbW92aWUubW9kaWZpZWQgPSBuZXcgRGF0ZShfMTkwNCt0aGlzLm1vb3YubXZoZC5tb2RpZmljYXRpb25fdGltZSoxMDAwKTsKICAgIAkJCQltb3ZpZS50cmFja3MgPSBbXTsKICAgIAkJCQltb3ZpZS5hdWRpb1RyYWNrcyA9IFtdOwogICAgCQkJCW1vdmllLnZpZGVvVHJhY2tzID0gW107CiAgICAJCQkJbW92aWUuc3VidGl0bGVUcmFja3MgPSBbXTsKICAgIAkJCQltb3ZpZS5tZXRhZGF0YVRyYWNrcyA9IFtdOwogICAgCQkJCW1vdmllLmhpbnRUcmFja3MgPSBbXTsKICAgIAkJCQltb3ZpZS5vdGhlclRyYWNrcyA9IFtdOwogICAgCQkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLm1vb3YudHJha3MubGVuZ3RoOyBpKyspIHsKICAgIAkJCQkJdHJhayA9IHRoaXMubW9vdi50cmFrc1tpXTsKICAgIAkJCQkJc2FtcGxlX2Rlc2MgPSB0cmFrLm1kaWEubWluZi5zdGJsLnN0c2QuZW50cmllc1swXTsKICAgIAkJCQkJdHJhY2sgPSB7fTsKICAgIAkJCQkJbW92aWUudHJhY2tzLnB1c2godHJhY2spOwogICAgCQkJCQl0cmFjay5pZCA9IHRyYWsudGtoZC50cmFja19pZDsKICAgIAkJCQkJdHJhY2submFtZSA9IHRyYWsubWRpYS5oZGxyLm5hbWU7CiAgICAJCQkJCXRyYWNrLnJlZmVyZW5jZXMgPSBbXTsKICAgIAkJCQkJaWYgKHRyYWsudHJlZikgewogICAgCQkJCQkJZm9yIChqID0gMDsgaiA8IHRyYWsudHJlZi5ib3hlcy5sZW5ndGg7IGorKykgewogICAgCQkJCQkJCXJlZiA9IHt9OwogICAgCQkJCQkJCXRyYWNrLnJlZmVyZW5jZXMucHVzaChyZWYpOwogICAgCQkJCQkJCXJlZi50eXBlID0gdHJhay50cmVmLmJveGVzW2pdLnR5cGU7CiAgICAJCQkJCQkJcmVmLnRyYWNrX2lkcyA9IHRyYWsudHJlZi5ib3hlc1tqXS50cmFja19pZHM7CiAgICAJCQkJCQl9CiAgICAJCQkJCX0KICAgIAkJCQkJaWYgKHRyYWsuZWR0cykgewogICAgCQkJCQkJdHJhY2suZWRpdHMgPSB0cmFrLmVkdHMuZWxzdC5lbnRyaWVzOwogICAgCQkJCQl9CiAgICAJCQkJCXRyYWNrLmNyZWF0ZWQgPSBuZXcgRGF0ZShfMTkwNCt0cmFrLnRraGQuY3JlYXRpb25fdGltZSoxMDAwKTsKICAgIAkJCQkJdHJhY2subW9kaWZpZWQgPSBuZXcgRGF0ZShfMTkwNCt0cmFrLnRraGQubW9kaWZpY2F0aW9uX3RpbWUqMTAwMCk7CiAgICAJCQkJCXRyYWNrLm1vdmllX2R1cmF0aW9uID0gdHJhay50a2hkLmR1cmF0aW9uOwogICAgCQkJCQl0cmFjay5tb3ZpZV90aW1lc2NhbGUgPSBtb3ZpZS50aW1lc2NhbGU7CiAgICAJCQkJCXRyYWNrLmxheWVyID0gdHJhay50a2hkLmxheWVyOwogICAgCQkJCQl0cmFjay5hbHRlcm5hdGVfZ3JvdXAgPSB0cmFrLnRraGQuYWx0ZXJuYXRlX2dyb3VwOwogICAgCQkJCQl0cmFjay52b2x1bWUgPSB0cmFrLnRraGQudm9sdW1lOwogICAgCQkJCQl0cmFjay5tYXRyaXggPSB0cmFrLnRraGQubWF0cml4OwogICAgCQkJCQl0cmFjay50cmFja193aWR0aCA9IHRyYWsudGtoZC53aWR0aC8oMTw8MTYpOwogICAgCQkJCQl0cmFjay50cmFja19oZWlnaHQgPSB0cmFrLnRraGQuaGVpZ2h0LygxPDwxNik7CiAgICAJCQkJCXRyYWNrLnRpbWVzY2FsZSA9IHRyYWsubWRpYS5tZGhkLnRpbWVzY2FsZTsKICAgIAkJCQkJdHJhY2suY3RzX3NoaWZ0ID0gdHJhay5tZGlhLm1pbmYuc3RibC5jc2xnOwogICAgCQkJCQl0cmFjay5kdXJhdGlvbiA9IHRyYWsubWRpYS5tZGhkLmR1cmF0aW9uOwogICAgCQkJCQl0cmFjay5zYW1wbGVzX2R1cmF0aW9uID0gdHJhay5zYW1wbGVzX2R1cmF0aW9uOwogICAgCQkJCQl0cmFjay5jb2RlYyA9IHNhbXBsZV9kZXNjLmdldENvZGVjKCk7CiAgICAJCQkJCXRyYWNrLmtpbmQgPSAodHJhay51ZHRhICYmIHRyYWsudWR0YS5raW5kcy5sZW5ndGggPyB0cmFrLnVkdGEua2luZHNbMF0gOiB7IHNjaGVtZVVSSTogIiIsIHZhbHVlOiAiIn0pOwogICAgCQkJCQl0cmFjay5sYW5ndWFnZSA9ICh0cmFrLm1kaWEuZWxuZyA/IHRyYWsubWRpYS5lbG5nLmV4dGVuZGVkX2xhbmd1YWdlIDogdHJhay5tZGlhLm1kaGQubGFuZ3VhZ2VTdHJpbmcpOwogICAgCQkJCQl0cmFjay5uYl9zYW1wbGVzID0gdHJhay5zYW1wbGVzLmxlbmd0aDsKICAgIAkJCQkJdHJhY2suc2l6ZSA9IHRyYWsuc2FtcGxlc19zaXplOwogICAgCQkJCQl0cmFjay5iaXRyYXRlID0gKHRyYWNrLnNpemUqOCp0cmFjay50aW1lc2NhbGUpL3RyYWNrLnNhbXBsZXNfZHVyYXRpb247CiAgICAJCQkJCWlmIChzYW1wbGVfZGVzYy5pc0F1ZGlvKCkpIHsKICAgIAkJCQkJCXRyYWNrLnR5cGUgPSAiYXVkaW8iOwogICAgCQkJCQkJbW92aWUuYXVkaW9UcmFja3MucHVzaCh0cmFjayk7CiAgICAJCQkJCQl0cmFjay5hdWRpbyA9IHt9OwogICAgCQkJCQkJdHJhY2suYXVkaW8uc2FtcGxlX3JhdGUgPSBzYW1wbGVfZGVzYy5nZXRTYW1wbGVSYXRlKCk7CiAgICAJCQkJCQl0cmFjay5hdWRpby5jaGFubmVsX2NvdW50ID0gc2FtcGxlX2Rlc2MuZ2V0Q2hhbm5lbENvdW50KCk7CiAgICAJCQkJCQl0cmFjay5hdWRpby5zYW1wbGVfc2l6ZSA9IHNhbXBsZV9kZXNjLmdldFNhbXBsZVNpemUoKTsKICAgIAkJCQkJfSBlbHNlIGlmIChzYW1wbGVfZGVzYy5pc1ZpZGVvKCkpIHsKICAgIAkJCQkJCXRyYWNrLnR5cGUgPSAidmlkZW8iOwogICAgCQkJCQkJbW92aWUudmlkZW9UcmFja3MucHVzaCh0cmFjayk7CiAgICAJCQkJCQl0cmFjay52aWRlbyA9IHt9OwogICAgCQkJCQkJdHJhY2sudmlkZW8ud2lkdGggPSBzYW1wbGVfZGVzYy5nZXRXaWR0aCgpOwogICAgCQkJCQkJdHJhY2sudmlkZW8uaGVpZ2h0ID0gc2FtcGxlX2Rlc2MuZ2V0SGVpZ2h0KCk7CiAgICAJCQkJCX0gZWxzZSBpZiAoc2FtcGxlX2Rlc2MuaXNTdWJ0aXRsZSgpKSB7CiAgICAJCQkJCQl0cmFjay50eXBlID0gInN1YnRpdGxlcyI7CiAgICAJCQkJCQltb3ZpZS5zdWJ0aXRsZVRyYWNrcy5wdXNoKHRyYWNrKTsKICAgIAkJCQkJfSBlbHNlIGlmIChzYW1wbGVfZGVzYy5pc0hpbnQoKSkgewogICAgCQkJCQkJdHJhY2sudHlwZSA9ICJtZXRhZGF0YSI7CiAgICAJCQkJCQltb3ZpZS5oaW50VHJhY2tzLnB1c2godHJhY2spOwogICAgCQkJCQl9IGVsc2UgaWYgKHNhbXBsZV9kZXNjLmlzTWV0YWRhdGEoKSkgewogICAgCQkJCQkJdHJhY2sudHlwZSA9ICJtZXRhZGF0YSI7CiAgICAJCQkJCQltb3ZpZS5tZXRhZGF0YVRyYWNrcy5wdXNoKHRyYWNrKTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCXRyYWNrLnR5cGUgPSAibWV0YWRhdGEiOwogICAgCQkJCQkJbW92aWUub3RoZXJUcmFja3MucHVzaCh0cmFjayk7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9IGVsc2UgewogICAgCQkJCW1vdmllLmhhc01vb3YgPSBmYWxzZTsKICAgIAkJCX0KICAgIAkJCW1vdmllLm1pbWUgPSAiIjsKICAgIAkJCWlmIChtb3ZpZS5oYXNNb292ICYmIG1vdmllLnRyYWNrcykgewogICAgCQkJCWlmIChtb3ZpZS52aWRlb1RyYWNrcyAmJiBtb3ZpZS52aWRlb1RyYWNrcy5sZW5ndGggPiAwKSB7CiAgICAJCQkJCW1vdmllLm1pbWUgKz0gJ3ZpZGVvL21wNDsgY29kZWNzPVwiJzsKICAgIAkJCQl9IGVsc2UgaWYgKG1vdmllLmF1ZGlvVHJhY2tzICYmIG1vdmllLmF1ZGlvVHJhY2tzLmxlbmd0aCA+IDApIHsKICAgIAkJCQkJbW92aWUubWltZSArPSAnYXVkaW8vbXA0OyBjb2RlY3M9XCInOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCW1vdmllLm1pbWUgKz0gJ2FwcGxpY2F0aW9uL21wNDsgY29kZWNzPVwiJzsKICAgIAkJCQl9CiAgICAJCQkJZm9yIChpID0gMDsgaSA8IG1vdmllLnRyYWNrcy5sZW5ndGg7IGkrKykgewogICAgCQkJCQlpZiAoaSAhPT0gMCkgbW92aWUubWltZSArPSAnLCc7CiAgICAJCQkJCW1vdmllLm1pbWUrPSBtb3ZpZS50cmFja3NbaV0uY29kZWM7CiAgICAJCQkJfQogICAgCQkJCW1vdmllLm1pbWUgKz0gJ1wiOyBwcm9maWxlcz1cIic7CiAgICAJCQkJbW92aWUubWltZSArPSB0aGlzLmZ0eXAuY29tcGF0aWJsZV9icmFuZHMuam9pbigpOwogICAgCQkJCW1vdmllLm1pbWUgKz0gJ1wiJzsKICAgIAkJCX0KICAgIAkJCXJldHVybiBtb3ZpZTsKICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnNldE5leHRTZWVrUG9zaXRpb25Gcm9tU2FtcGxlID0gZnVuY3Rpb24gKHNhbXBsZSkgewogICAgCQkJaWYgKCFzYW1wbGUpIHsKICAgIAkJCQlyZXR1cm47CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy5uZXh0U2Vla1Bvc2l0aW9uKSB7CiAgICAJCQkJdGhpcy5uZXh0U2Vla1Bvc2l0aW9uID0gTWF0aC5taW4oc2FtcGxlLm9mZnNldCtzYW1wbGUuYWxyZWFkeVJlYWQsdGhpcy5uZXh0U2Vla1Bvc2l0aW9uKTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJdGhpcy5uZXh0U2Vla1Bvc2l0aW9uID0gc2FtcGxlLm9mZnNldCtzYW1wbGUuYWxyZWFkeVJlYWQ7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5wcm9jZXNzU2FtcGxlcyA9IGZ1bmN0aW9uKGxhc3QpIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIHRyYWs7CiAgICAJCQlpZiAoIXRoaXMuc2FtcGxlUHJvY2Vzc2luZ1N0YXJ0ZWQpIHJldHVybjsKCiAgICAJCQkvKiBGb3IgZWFjaCB0cmFjayBtYXJrZWQgZm9yIGZyYWdtZW50YXRpb24sCiAgICAJCQkgICBjaGVjayBpZiB0aGUgbmV4dCBzYW1wbGUgaXMgdGhlcmUgKGkuZS4gaWYgdGhlIHNhbXBsZSBpbmZvcm1hdGlvbiBpcyBrbm93biAoaS5lLiBtb29mIGhhcyBhcnJpdmVkKSBhbmQgaWYgaXQgaGFzIGJlZW4gZG93bmxvYWRlZCkKICAgIAkJCSAgIGFuZCBjcmVhdGUgYSBmcmFnbWVudCB3aXRoIGl0ICovCiAgICAJCQlpZiAodGhpcy5pc0ZyYWdtZW50YXRpb25Jbml0aWFsaXplZCAmJiB0aGlzLm9uU2VnbWVudCAhPT0gbnVsbCkgewogICAgCQkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLmZyYWdtZW50ZWRUcmFja3MubGVuZ3RoOyBpKyspIHsKICAgIAkJCQkJdmFyIGZyYWdUcmFrID0gdGhpcy5mcmFnbWVudGVkVHJhY2tzW2ldOwogICAgCQkJCQl0cmFrID0gZnJhZ1RyYWsudHJhazsKICAgIAkJCQkJd2hpbGUgKHRyYWsubmV4dFNhbXBsZSA8IHRyYWsuc2FtcGxlcy5sZW5ndGggJiYgdGhpcy5zYW1wbGVQcm9jZXNzaW5nU3RhcnRlZCkgewogICAgCQkJCQkJLyogVGhlIHNhbXBsZSBpbmZvcm1hdGlvbiBpcyB0aGVyZSAoZWl0aGVyIGJlY2F1c2UgdGhlIGZpbGUgaXMgbm90IGZyYWdtZW50ZWQgYW5kIHRoaXMgaXMgbm90IHRoZSBsYXN0IHNhbXBsZSwKICAgIAkJCQkJCW9yIGJlY2F1c2UgdGhlIGZpbGUgaXMgZnJhZ21lbnRlZCBhbmQgdGhlIG1vb2YgZm9yIHRoYXQgc2FtcGxlIGhhcyBiZWVuIHJlY2VpdmVkICovCiAgICAJCQkJCQlMb2cuZGVidWcoIklTT0ZpbGUiLCAiQ3JlYXRpbmcgbWVkaWEgZnJhZ21lbnQgb24gdHJhY2sgIyIrZnJhZ1RyYWsuaWQgKyIgZm9yIHNhbXBsZSAiK3RyYWsubmV4dFNhbXBsZSk7CiAgICAJCQkJCQl2YXIgcmVzdWx0ID0gdGhpcy5jcmVhdGVGcmFnbWVudChmcmFnVHJhay5pZCwgdHJhay5uZXh0U2FtcGxlLCBmcmFnVHJhay5zZWdtZW50U3RyZWFtKTsKICAgIAkJCQkJCWlmIChyZXN1bHQpIHsKICAgIAkJCQkJCQlmcmFnVHJhay5zZWdtZW50U3RyZWFtID0gcmVzdWx0OwogICAgCQkJCQkJCXRyYWsubmV4dFNhbXBsZSsrOwogICAgCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQkvKiBUaGUgZnJhZ21lbnQgY291bGQgbm90IGJlIGNyZWF0ZWQgYmVjYXVzZSB0aGUgbWVkaWEgZGF0YSBpcyBub3QgdGhlcmUgKG5vdCBkb3dubG9hZGVkKSwgd2FpdCBmb3IgaXQgKi8KICAgIAkJCQkJCQlicmVhazsKICAgIAkJCQkJCX0KICAgIAkJCQkJCS8qIEEgZnJhZ21lbnQgaXMgY3JlYXRlZCBieSBzYW1wbGUsIGJ1dCB0aGUgc2VnbWVudCBpcyB0aGUgYWNjdW11bGF0aW9uIGluIHRoZSBidWZmZXIgb2YgdGhlc2UgZnJhZ21lbnRzLgogICAgCQkJCQkJICAgSXQgaXMgZmx1c2hlZCBvbmx5IGFzIHJlcXVlc3RlZCBieSB0aGUgYXBwbGljYXRpb24gKG5iX3NhbXBsZXMpIHRvIGF2b2lkIHRvbyBtYW55IGNhbGxiYWNrcyAqLwogICAgCQkJCQkJaWYgKHRyYWsubmV4dFNhbXBsZSAlIGZyYWdUcmFrLm5iX3NhbXBsZXMgPT09IDAgfHwgKGxhc3QgfHwgdHJhay5uZXh0U2FtcGxlID49IHRyYWsuc2FtcGxlcy5sZW5ndGgpKSB7CiAgICAJCQkJCQkJTG9nLmluZm8oIklTT0ZpbGUiLCAiU2VuZGluZyBmcmFnbWVudGVkIGRhdGEgb24gdHJhY2sgIyIrZnJhZ1RyYWsuaWQrIiBmb3Igc2FtcGxlcyBbIitNYXRoLm1heCgwLHRyYWsubmV4dFNhbXBsZS1mcmFnVHJhay5uYl9zYW1wbGVzKSsiLCIrKHRyYWsubmV4dFNhbXBsZS0xKSsiXSIpOwogICAgCQkJCQkJCUxvZy5pbmZvKCJJU09GaWxlIiwgIlNhbXBsZSBkYXRhIHNpemUgaW4gbWVtb3J5OiAiK3RoaXMuZ2V0QWxsb2NhdGVkU2FtcGxlRGF0YVNpemUoKSk7CiAgICAJCQkJCQkJaWYgKHRoaXMub25TZWdtZW50KSB7CiAgICAJCQkJCQkJCXRoaXMub25TZWdtZW50KGZyYWdUcmFrLmlkLCBmcmFnVHJhay51c2VyLCBmcmFnVHJhay5zZWdtZW50U3RyZWFtLmJ1ZmZlciwgdHJhay5uZXh0U2FtcGxlLCAobGFzdCB8fCB0cmFrLm5leHRTYW1wbGUgPj0gdHJhay5zYW1wbGVzLmxlbmd0aCkpOwogICAgCQkJCQkJCX0KICAgIAkJCQkJCQkvKiBmb3JjZSB0aGUgY3JlYXRpb24gb2YgYSBuZXcgYnVmZmVyICovCiAgICAJCQkJCQkJZnJhZ1RyYWsuc2VnbWVudFN0cmVhbSA9IG51bGw7CiAgICAJCQkJCQkJaWYgKGZyYWdUcmFrICE9PSB0aGlzLmZyYWdtZW50ZWRUcmFja3NbaV0pIHsKICAgIAkJCQkJCQkJLyogbWFrZSBzdXJlIHdlIGNhbiBzdG9wIGZyYWdtZW50YXRpb24gaWYgbmVlZGVkICovCiAgICAJCQkJCQkJCWJyZWFrOwogICAgCQkJCQkJCX0KICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KCiAgICAJCQlpZiAodGhpcy5vblNhbXBsZXMgIT09IG51bGwpIHsKICAgIAkJCQkvKiBGb3IgZWFjaCB0cmFjayBtYXJrZWQgZm9yIGRhdGEgZXhwb3J0LAogICAgCQkJCSAgIGNoZWNrIGlmIHRoZSBuZXh0IHNhbXBsZSBpcyB0aGVyZSAoaS5lLiBoYXMgYmVlbiBkb3dubG9hZGVkKSBhbmQgc2VuZCBpdCAqLwogICAgCQkJCWZvciAoaSA9IDA7IGkgPCB0aGlzLmV4dHJhY3RlZFRyYWNrcy5sZW5ndGg7IGkrKykgewogICAgCQkJCQl2YXIgZXh0cmFjdFRyYWsgPSB0aGlzLmV4dHJhY3RlZFRyYWNrc1tpXTsKICAgIAkJCQkJdHJhayA9IGV4dHJhY3RUcmFrLnRyYWs7CiAgICAJCQkJCXdoaWxlICh0cmFrLm5leHRTYW1wbGUgPCB0cmFrLnNhbXBsZXMubGVuZ3RoICYmIHRoaXMuc2FtcGxlUHJvY2Vzc2luZ1N0YXJ0ZWQpIHsKICAgIAkJCQkJCUxvZy5kZWJ1ZygiSVNPRmlsZSIsICJFeHBvcnRpbmcgb24gdHJhY2sgIyIrZXh0cmFjdFRyYWsuaWQgKyIgc2FtcGxlICMiK3RyYWsubmV4dFNhbXBsZSk7CiAgICAJCQkJCQl2YXIgc2FtcGxlID0gdGhpcy5nZXRTYW1wbGUodHJhaywgdHJhay5uZXh0U2FtcGxlKTsKICAgIAkJCQkJCWlmIChzYW1wbGUpIHsKICAgIAkJCQkJCQl0cmFrLm5leHRTYW1wbGUrKzsKICAgIAkJCQkJCQlleHRyYWN0VHJhay5zYW1wbGVzLnB1c2goc2FtcGxlKTsKICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJdGhpcy5zZXROZXh0U2Vla1Bvc2l0aW9uRnJvbVNhbXBsZSh0cmFrLnNhbXBsZXNbdHJhay5uZXh0U2FtcGxlXSk7CiAgICAJCQkJCQkJYnJlYWs7CiAgICAJCQkJCQl9CiAgICAJCQkJCQlpZiAodHJhay5uZXh0U2FtcGxlICUgZXh0cmFjdFRyYWsubmJfc2FtcGxlcyA9PT0gMCB8fCB0cmFrLm5leHRTYW1wbGUgPj0gdHJhay5zYW1wbGVzLmxlbmd0aCkgewogICAgCQkJCQkJCUxvZy5kZWJ1ZygiSVNPRmlsZSIsICJTZW5kaW5nIHNhbXBsZXMgb24gdHJhY2sgIyIrZXh0cmFjdFRyYWsuaWQrIiBmb3Igc2FtcGxlICIrdHJhay5uZXh0U2FtcGxlKTsKICAgIAkJCQkJCQlpZiAodGhpcy5vblNhbXBsZXMpIHsKICAgIAkJCQkJCQkJdGhpcy5vblNhbXBsZXMoZXh0cmFjdFRyYWsuaWQsIGV4dHJhY3RUcmFrLnVzZXIsIGV4dHJhY3RUcmFrLnNhbXBsZXMpOwogICAgCQkJCQkJCX0KICAgIAkJCQkJCQlleHRyYWN0VHJhay5zYW1wbGVzID0gW107CiAgICAJCQkJCQkJaWYgKGV4dHJhY3RUcmFrICE9PSB0aGlzLmV4dHJhY3RlZFRyYWNrc1tpXSkgewogICAgCQkJCQkJCQkvKiBjaGVjayBpZiB0aGUgZXh0cmFjdGlvbiBuZWVkcyB0byBiZSBzdG9wcGVkICovCiAgICAJCQkJCQkJCWJyZWFrOwogICAgCQkJCQkJCX0KICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8qIEZpbmQgYW5kIHJldHVybiBzcGVjaWZpYyBib3hlcyB1c2luZyByZWN1cnNpb24gYW5kIGVhcmx5IHJldHVybiAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRCb3ggPSBmdW5jdGlvbih0eXBlKSB7CiAgICAJCSAgdmFyIHJlc3VsdCA9IHRoaXMuZ2V0Qm94ZXModHlwZSwgdHJ1ZSk7CiAgICAJCSAgcmV0dXJuIChyZXN1bHQubGVuZ3RoID8gcmVzdWx0WzBdIDogbnVsbCk7CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRCb3hlcyA9IGZ1bmN0aW9uKHR5cGUsIHJldHVybkVhcmx5KSB7CiAgICAJCSAgdmFyIHJlc3VsdCA9IFtdOwogICAgCQkgIElTT0ZpbGUuX3N3ZWVwLmNhbGwodGhpcywgdHlwZSwgcmVzdWx0LCByZXR1cm5FYXJseSk7CiAgICAJCSAgcmV0dXJuIHJlc3VsdDsKICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUuX3N3ZWVwID0gZnVuY3Rpb24odHlwZSwgcmVzdWx0LCByZXR1cm5FYXJseSkgewogICAgCQkgIGlmICh0aGlzLnR5cGUgJiYgdGhpcy50eXBlID09IHR5cGUpIHJlc3VsdC5wdXNoKHRoaXMpOwogICAgCQkgIGZvciAodmFyIGJveCBpbiB0aGlzLmJveGVzKSB7CiAgICAJCSAgICBpZiAocmVzdWx0Lmxlbmd0aCAmJiByZXR1cm5FYXJseSkgcmV0dXJuOwogICAgCQkgICAgSVNPRmlsZS5fc3dlZXAuY2FsbCh0aGlzLmJveGVzW2JveF0sIHR5cGUsIHJlc3VsdCwgcmV0dXJuRWFybHkpOwogICAgCQkgIH0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmdldFRyYWNrU2FtcGxlc0luZm8gPSBmdW5jdGlvbih0cmFja19pZCkgewogICAgCQkJdmFyIHRyYWNrID0gdGhpcy5nZXRUcmFja0J5SWQodHJhY2tfaWQpOwogICAgCQkJaWYgKHRyYWNrKSB7CiAgICAJCQkJcmV0dXJuIHRyYWNrLnNhbXBsZXM7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXJldHVybjsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmdldFRyYWNrU2FtcGxlID0gZnVuY3Rpb24odHJhY2tfaWQsIG51bWJlcikgewogICAgCQkJdmFyIHRyYWNrID0gdGhpcy5nZXRUcmFja0J5SWQodHJhY2tfaWQpOwogICAgCQkJdmFyIHNhbXBsZSA9IHRoaXMuZ2V0U2FtcGxlKHRyYWNrLCBudW1iZXIpOwogICAgCQkJcmV0dXJuIHNhbXBsZTsKICAgIAkJfTsKCiAgICAJCS8qIENhbGxlZCBieSB0aGUgYXBwbGljYXRpb24gdG8gcmVsZWFzZSB0aGUgcmVzb3VyY2VzIGFzc29jaWF0ZWQgdG8gc2FtcGxlcyBhbHJlYWR5IGZvcndhcmRlZCB0byB0aGUgYXBwbGljYXRpb24gKi8KICAgIAkJSVNPRmlsZS5wcm90b3R5cGUucmVsZWFzZVVzZWRTYW1wbGVzID0gZnVuY3Rpb24gKGlkLCBzYW1wbGVOdW0pIHsKICAgIAkJCXZhciBzaXplID0gMDsKICAgIAkJCXZhciB0cmFrID0gdGhpcy5nZXRUcmFja0J5SWQoaWQpOwogICAgCQkJaWYgKCF0cmFrLmxhc3RWYWxpZFNhbXBsZSkgdHJhay5sYXN0VmFsaWRTYW1wbGUgPSAwOwogICAgCQkJZm9yICh2YXIgaSA9IHRyYWsubGFzdFZhbGlkU2FtcGxlOyBpIDwgc2FtcGxlTnVtOyBpKyspIHsKICAgIAkJCQlzaXplKz10aGlzLnJlbGVhc2VTYW1wbGUodHJhaywgaSk7CiAgICAJCQl9CiAgICAJCQlMb2cuaW5mbygiSVNPRmlsZSIsICJUcmFjayAjIitpZCsiIHJlbGVhc2VkIHNhbXBsZXMgdXAgdG8gIitzYW1wbGVOdW0rIiAocmVsZWFzZWQgc2l6ZTogIitzaXplKyIsIHJlbWFpbmluZzogIit0aGlzLnNhbXBsZXNEYXRhU2l6ZSsiKSIpOwogICAgCQkJdHJhay5sYXN0VmFsaWRTYW1wbGUgPSBzYW1wbGVOdW07CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCkgewogICAgCQkJdGhpcy5zYW1wbGVQcm9jZXNzaW5nU3RhcnRlZCA9IHRydWU7CiAgICAJCQl0aGlzLnByb2Nlc3NTYW1wbGVzKGZhbHNlKTsKICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHsKICAgIAkJCXRoaXMuc2FtcGxlUHJvY2Vzc2luZ1N0YXJ0ZWQgPSBmYWxzZTsKICAgIAkJfTsKCiAgICAJCS8qIENhbGxlZCBieSB0aGUgYXBwbGljYXRpb24gdG8gZmx1c2ggdGhlIHJlbWFpbmluZyBzYW1wbGVzIChlLmcuIG9uY2UgdGhlIGRvd25sb2FkIGlzIGZpbmlzaGVkIG9yIHdoZW4gbm8gbW9yZSBzYW1wbGVzIHdpbGwgYmUgYWRkZWQpICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24oKSB7CiAgICAJCQlMb2cuaW5mbygiSVNPRmlsZSIsICJGbHVzaGluZyByZW1haW5pbmcgc2FtcGxlcyIpOwogICAgCQkJdGhpcy51cGRhdGVTYW1wbGVMaXN0cygpOwogICAgCQkJdGhpcy5wcm9jZXNzU2FtcGxlcyh0cnVlKTsKICAgIAkJCXRoaXMuc3RyZWFtLmNsZWFuQnVmZmVycygpOwogICAgCQkJdGhpcy5zdHJlYW0ubG9nQnVmZmVyTGV2ZWwodHJ1ZSk7CiAgICAJCX07CgogICAgCQkvKiBGaW5kcyB0aGUgYnl0ZSBvZmZzZXQgZm9yIGEgZ2l2ZW4gdGltZSBvbiBhIGdpdmVuIHRyYWNrCiAgICAJCSAgIGFsc28gcmV0dXJucyB0aGUgdGltZSBvZiB0aGUgcHJldmlvdXMgcmFwICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnNlZWtUcmFjayA9IGZ1bmN0aW9uKHRpbWUsIHVzZVJhcCwgdHJhaykgewogICAgCQkJdmFyIGo7CiAgICAJCQl2YXIgc2FtcGxlOwogICAgCQkJdmFyIHNlZWtfb2Zmc2V0ID0gSW5maW5pdHk7CiAgICAJCQl2YXIgcmFwX3NlZWtfc2FtcGxlX251bSA9IDA7CiAgICAJCQl2YXIgc2Vla19zYW1wbGVfbnVtID0gMDsKICAgIAkJCXZhciB0aW1lc2NhbGU7CgogICAgCQkJaWYgKHRyYWsuc2FtcGxlcy5sZW5ndGggPT09IDApIHsKICAgIAkJCQlMb2cuaW5mbygiSVNPRmlsZSIsICJObyBzYW1wbGUgaW4gdHJhY2ssIGNhbm5vdCBzZWVrISBVc2luZyB0aW1lICIrTG9nLmdldER1cmF0aW9uU3RyaW5nKDAsIDEpICsiIGFuZCBvZmZzZXQ6ICIrMCk7CiAgICAJCQkJcmV0dXJuIHsgb2Zmc2V0OiAwLCB0aW1lOiAwIH07CiAgICAJCQl9CgogICAgCQkJZm9yIChqID0gMDsgaiA8IHRyYWsuc2FtcGxlcy5sZW5ndGg7IGorKykgewogICAgCQkJCXNhbXBsZSA9IHRyYWsuc2FtcGxlc1tqXTsKICAgIAkJCQlpZiAoaiA9PT0gMCkgewogICAgCQkJCQlzZWVrX3NhbXBsZV9udW0gPSAwOwogICAgCQkJCQl0aW1lc2NhbGUgPSBzYW1wbGUudGltZXNjYWxlOwogICAgCQkJCX0gZWxzZSBpZiAoc2FtcGxlLmN0cyA+IHRpbWUgKiBzYW1wbGUudGltZXNjYWxlKSB7CiAgICAJCQkJCXNlZWtfc2FtcGxlX251bSA9IGotMTsKICAgIAkJCQkJYnJlYWs7CiAgICAJCQkJfQogICAgCQkJCWlmICh1c2VSYXAgJiYgc2FtcGxlLmlzX3N5bmMpIHsKICAgIAkJCQkJcmFwX3NlZWtfc2FtcGxlX251bSA9IGo7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJaWYgKHVzZVJhcCkgewogICAgCQkJCXNlZWtfc2FtcGxlX251bSA9IHJhcF9zZWVrX3NhbXBsZV9udW07CiAgICAJCQl9CiAgICAJCQl0aW1lID0gdHJhay5zYW1wbGVzW3NlZWtfc2FtcGxlX251bV0uY3RzOwogICAgCQkJdHJhay5uZXh0U2FtcGxlID0gc2Vla19zYW1wbGVfbnVtOwogICAgCQkJd2hpbGUgKHRyYWsuc2FtcGxlc1tzZWVrX3NhbXBsZV9udW1dLmFscmVhZHlSZWFkID09PSB0cmFrLnNhbXBsZXNbc2Vla19zYW1wbGVfbnVtXS5zaXplKSB7CiAgICAJCQkJLy8gTm8gcmVtYWluaW5nIHNhbXBsZXMgdG8gbG9vayBmb3IsIGFsbCBhcmUgZG93bmxvYWRlZC4KICAgIAkJCQlpZiAoIXRyYWsuc2FtcGxlc1tzZWVrX3NhbXBsZV9udW0gKyAxXSkgewogICAgCQkJCQlicmVhazsKICAgIAkJCQl9CiAgICAJCQkJc2Vla19zYW1wbGVfbnVtKys7CiAgICAJCQl9CiAgICAJCQlzZWVrX29mZnNldCA9IHRyYWsuc2FtcGxlc1tzZWVrX3NhbXBsZV9udW1dLm9mZnNldCt0cmFrLnNhbXBsZXNbc2Vla19zYW1wbGVfbnVtXS5hbHJlYWR5UmVhZDsKICAgIAkJCUxvZy5pbmZvKCJJU09GaWxlIiwgIlNlZWtpbmcgdG8gIisodXNlUmFwID8gIlJBUCI6ICIiKSsiIHNhbXBsZSAjIit0cmFrLm5leHRTYW1wbGUrIiBvbiB0cmFjayAiK3RyYWsudGtoZC50cmFja19pZCsiLCB0aW1lICIrTG9nLmdldER1cmF0aW9uU3RyaW5nKHRpbWUsIHRpbWVzY2FsZSkgKyIgYW5kIG9mZnNldDogIitzZWVrX29mZnNldCk7CiAgICAJCQlyZXR1cm4geyBvZmZzZXQ6IHNlZWtfb2Zmc2V0LCB0aW1lOiB0aW1lL3RpbWVzY2FsZSB9OwogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuZ2V0VHJhY2tEdXJhdGlvbiA9IGZ1bmN0aW9uICh0cmFrKSB7CiAgICAJCQl2YXIgc2FtcGxlOwoKICAgIAkJCWlmICghdHJhay5zYW1wbGVzKSB7CiAgICAJCQkJcmV0dXJuIEluZmluaXR5OwogICAgCQkJfQogICAgCQkJc2FtcGxlID0gdHJhay5zYW1wbGVzW3RyYWsuc2FtcGxlcy5sZW5ndGggLSAxXTsKICAgIAkJCXJldHVybiAoc2FtcGxlLmN0cyArIHNhbXBsZS5kdXJhdGlvbikgLyBzYW1wbGUudGltZXNjYWxlOwogICAgCQl9OwoKICAgIAkJLyogRmluZHMgdGhlIGJ5dGUgb2Zmc2V0IGluIHRoZSBmaWxlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIHRpbWUgb3IgdG8gdGhlIHRpbWUgb2YgdGhlIHByZXZpb3VzIFJBUCAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5zZWVrID0gZnVuY3Rpb24odGltZSwgdXNlUmFwKSB7CiAgICAJCQl2YXIgbW9vdiA9IHRoaXMubW9vdjsKICAgIAkJCXZhciB0cmFrOwogICAgCQkJdmFyIHRyYWtfc2Vla19pbmZvOwogICAgCQkJdmFyIGk7CiAgICAJCQl2YXIgc2Vla19pbmZvID0geyBvZmZzZXQ6IEluZmluaXR5LCB0aW1lOiBJbmZpbml0eSB9OwogICAgCQkJaWYgKCF0aGlzLm1vb3YpIHsKICAgIAkJCQl0aHJvdyAiQ2Fubm90IHNlZWs6IG1vb3Ygbm90IHJlY2VpdmVkISI7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCWZvciAoaSA9IDA7IGk8bW9vdi50cmFrcy5sZW5ndGg7IGkrKykgewogICAgCQkJCQl0cmFrID0gbW9vdi50cmFrc1tpXTsKICAgIAkJCQkJaWYgKHRpbWUgPiB0aGlzLmdldFRyYWNrRHVyYXRpb24odHJhaykpIHsgLy8gc2tpcCB0cmFja3MgdGhhdCBhbHJlYWR5IGVuZGVkCiAgICAJCQkJCQljb250aW51ZTsKICAgIAkJCQkJfQogICAgCQkJCQl0cmFrX3NlZWtfaW5mbyA9IHRoaXMuc2Vla1RyYWNrKHRpbWUsIHVzZVJhcCwgdHJhayk7CiAgICAJCQkJCWlmICh0cmFrX3NlZWtfaW5mby5vZmZzZXQgPCBzZWVrX2luZm8ub2Zmc2V0KSB7CiAgICAJCQkJCQlzZWVrX2luZm8ub2Zmc2V0ID0gdHJha19zZWVrX2luZm8ub2Zmc2V0OwogICAgCQkJCQl9CiAgICAJCQkJCWlmICh0cmFrX3NlZWtfaW5mby50aW1lIDwgc2Vla19pbmZvLnRpbWUpIHsKICAgIAkJCQkJCXNlZWtfaW5mby50aW1lID0gdHJha19zZWVrX2luZm8udGltZTsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCQlMb2cuaW5mbygiSVNPRmlsZSIsICJTZWVraW5nIGF0IHRpbWUgIitMb2cuZ2V0RHVyYXRpb25TdHJpbmcoc2Vla19pbmZvLnRpbWUsIDEpKyIgbmVlZHMgYSBidWZmZXIgd2l0aCBhIGZpbGVTdGFydCBwb3NpdGlvbiBvZiAiK3NlZWtfaW5mby5vZmZzZXQpOwogICAgCQkJCWlmIChzZWVrX2luZm8ub2Zmc2V0ID09PSBJbmZpbml0eSkgewogICAgCQkJCQkvKiBObyBzYW1wbGUgaW5mbywgaW4gYWxsIHRyYWNrcywgY2Fubm90IHNlZWsgKi8KICAgIAkJCQkJc2Vla19pbmZvID0geyBvZmZzZXQ6IHRoaXMubmV4dFBhcnNlUG9zaXRpb24sIHRpbWU6IDAgfTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQkvKiBjaGVjayBpZiB0aGUgc2VlayBwb3NpdGlvbiBpcyBhbHJlYWR5IGluIHNvbWUgYnVmZmVyIGFuZAogICAgCQkJCQkgaW4gdGhhdCBjYXNlIHJldHVybiB0aGUgZW5kIG9mIHRoYXQgYnVmZmVyIChvciBvZiB0aGUgbGFzdCBjb250aWd1b3VzIGJ1ZmZlcikgKi8KICAgIAkJCQkJLyogVE9ETzogU2hvdWxkIHdhaXQgdW50aWwgYXBwZW5kIG9wZXJhdGlvbnMgYXJlIGRvbmUgKi8KICAgIAkJCQkJc2Vla19pbmZvLm9mZnNldCA9IHRoaXMuc3RyZWFtLmdldEVuZEZpbGVQb3NpdGlvbkFmdGVyKHNlZWtfaW5mby5vZmZzZXQpOwogICAgCQkJCX0KICAgIAkJCQlMb2cuaW5mbygiSVNPRmlsZSIsICJBZGp1c3RlZCBzZWVrIHBvc2l0aW9uIChhZnRlciBjaGVja2luZyBkYXRhIGFscmVhZHkgaW4gYnVmZmVyKTogIitzZWVrX2luZm8ub2Zmc2V0KTsKICAgIAkJCQlyZXR1cm4gc2Vla19pbmZvOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuZXF1YWwgPSBmdW5jdGlvbihiKSB7CiAgICAJCQl2YXIgYm94X2luZGV4ID0gMDsKICAgIAkJCXdoaWxlIChib3hfaW5kZXggPCB0aGlzLmJveGVzLmxlbmd0aCAmJiBib3hfaW5kZXggPCBiLmJveGVzLmxlbmd0aCkgewogICAgCQkJCXZhciBhX2JveCA9IHRoaXMuYm94ZXNbYm94X2luZGV4XTsKICAgIAkJCQl2YXIgYl9ib3ggPSBiLmJveGVzW2JveF9pbmRleF07CiAgICAJCQkJaWYgKCFCb3hQYXJzZXIuYm94RXF1YWwoYV9ib3gsIGJfYm94KSkgewogICAgCQkJCQlyZXR1cm4gZmFsc2U7CiAgICAJCQkJfQogICAgCQkJCWJveF9pbmRleCsrOwogICAgCQkJfQogICAgCQkJcmV0dXJuIHRydWU7CiAgICAJCX07CgogICAgCQl7CiAgICAJCQlleHBvcnRzLklTT0ZpbGUgPSBJU09GaWxlOwogICAgCQl9CiAgICAJCS8vIGZpbGU6c3JjL2lzb2ZpbGUtYWR2YW5jZWQtcGFyc2luZy5qcwogICAgCQkvKiBwb3NpdGlvbiBpbiB0aGUgY3VycmVudCBidWZmZXIgb2YgdGhlIGJlZ2lubmluZyBvZiB0aGUgbGFzdCBib3ggcGFyc2VkICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmxhc3RCb3hTdGFydFBvc2l0aW9uID0gMDsKICAgIAkJLyogaW5kaWNhdG9yIGlmIHRoZSBwYXJzaW5nIGlzIHN0dWNrIGluIHRoZSBtaWRkbGUgb2YgYW4gbWRhdCBib3ggKi8KICAgIAkJSVNPRmlsZS5wcm90b3R5cGUucGFyc2luZ01kYXQgPSBudWxsOwogICAgCQkvKiBuZXh0IGZpbGUgcG9zaXRpb24gdGhhdCB0aGUgcGFyc2VyIG5lZWRzOgogICAgCQkgICAgLSAwIHVudGlsIHRoZSBmaXJzdCBidWZmZXIgKGkuZS4gZmlsZVN0YXJ0ID09PTApIGhhcyBiZWVuIHJlY2VpdmVkIAogICAgCQkgICAgLSBvdGhlcndpc2UsIHRoZSBuZXh0IGJveCBzdGFydCB1bnRpbCB0aGUgbW9vdiBib3ggaGFzIGJlZW4gcGFyc2VkCiAgICAJCSAgICAtIG90aGVyd2lzZSwgdGhlIHBvc2l0aW9uIG9mIHRoZSBuZXh0IHNhbXBsZSB0byBmZXRjaAogICAgCQkgKi8KICAgIAkJSVNPRmlsZS5wcm90b3R5cGUubmV4dFBhcnNlUG9zaXRpb24gPSAwOwogICAgCQkvKiBrZWVwIG1kYXQgZGF0YSAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5kaXNjYXJkTWRhdERhdGEgPSBmYWxzZTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnByb2Nlc3NJbmNvbXBsZXRlQm94ID0gZnVuY3Rpb24ocmV0KSB7CiAgICAJCQl2YXIgYm94OwogICAgCQkJdmFyIG1lcmdlZDsKICAgIAkJCXZhciBmb3VuZDsKICAgIAkJCQogICAgCQkJLyogd2UgZGlkIG5vdCBoYXZlIGVub3VnaCBieXRlcyBpbiB0aGUgY3VycmVudCBidWZmZXIgdG8gcGFyc2UgdGhlIGVudGlyZSBib3ggKi8KICAgIAkJCWlmIChyZXQudHlwZSA9PT0gIm1kYXQiKSB7IAogICAgCQkJCS8qIHdlIGhhZCBlbm91Z2ggYnl0ZXMgdG8gZ2V0IGl0cyB0eXBlIGFuZCBzaXplIGFuZCBpdCdzIGFuICdtZGF0JyAqLwogICAgCQkJCQogICAgCQkJCS8qIHNwZWNpYWwgaGFuZGxpbmcgZm9yIG1kYXQgYm94ZXMsIHNpbmNlIHdlIGRvbid0IGFjdHVhbGx5IG5lZWQgdG8gcGFyc2UgaXQgbGluZWFybHkgCiAgICAJCQkJICAgd2UgY3JlYXRlIHRoZSBib3ggKi8KICAgIAkJCQlib3ggPSBuZXcgQm94UGFyc2VyW3JldC50eXBlKyJCb3giXShyZXQuc2l6ZSk7CQogICAgCQkJCXRoaXMucGFyc2luZ01kYXQgPSBib3g7CiAgICAJCQkJdGhpcy5ib3hlcy5wdXNoKGJveCk7CiAgICAJCQkJdGhpcy5tZGF0cy5wdXNoKGJveCk7CQkJCiAgICAJCQkJYm94LnN0YXJ0ID0gcmV0LnN0YXJ0OwogICAgCQkJCWJveC5oZHJfc2l6ZSA9IHJldC5oZHJfc2l6ZTsKICAgIAkJCQl0aGlzLnN0cmVhbS5hZGRVc2VkQnl0ZXMoYm94Lmhkcl9zaXplKTsKCiAgICAJCQkJLyogaW5kaWNhdGUgdGhhdCB0aGUgcGFyc2luZyBzaG91bGQgc3RhcnQgZnJvbSB0aGUgZW5kIG9mIHRoZSBib3ggKi8KICAgIAkJCQl0aGlzLmxhc3RCb3hTdGFydFBvc2l0aW9uID0gYm94LnN0YXJ0ICsgYm94LnNpemU7CiAgICAJCSAJCS8qIGxldCdzIHNlZSBpZiB3ZSBoYXZlIHRoZSBlbmQgb2YgdGhlIGJveCBpbiB0aGUgb3RoZXIgYnVmZmVycyAqLwogICAgCQkJCWZvdW5kID0gdGhpcy5zdHJlYW0uc2Vlayhib3guc3RhcnQgKyBib3guc2l6ZSwgZmFsc2UsIHRoaXMuZGlzY2FyZE1kYXREYXRhKTsKICAgIAkJCQlpZiAoZm91bmQpIHsKICAgIAkJCQkJLyogZm91bmQgdGhlIGVuZCBvZiB0aGUgYm94ICovCiAgICAJCQkJCXRoaXMucGFyc2luZ01kYXQgPSBudWxsOwogICAgCQkJCQkvKiBsZXQncyBzZWUgaWYgd2UgY2FuIHBhcnNlIG1vcmUgaW4gdGhpcyBidWZmZXIgKi8KICAgIAkJCQkJcmV0dXJuIHRydWU7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJLyogJ21kYXQnIGVuZCBub3QgZm91bmQgaW4gdGhlIGV4aXN0aW5nIGJ1ZmZlcnMgKi8KICAgIAkJCQkJLyogZGV0ZXJtaW5lIHRoZSBuZXh0IHBvc2l0aW9uIGluIHRoZSBmaWxlIHRvIHN0YXJ0IHBhcnNpbmcgZnJvbSAqLwogICAgCQkJCQlpZiAoIXRoaXMubW9vdlN0YXJ0Rm91bmQpIHsKICAgIAkJCQkJCS8qIG1vb3Ygbm90IGZpbmQgeWV0LCAKICAgIAkJCQkJCSAgIHRoZSBmaWxlIHByb2JhYmx5IGhhcyAnbWRhdCcgYXQgdGhlIGJlZ2lubmluZywgYW5kICdtb292JyBhdCB0aGUgZW5kLCAKICAgIAkJCQkJCSAgIGluZGljYXRlIHRoYXQgdGhlIGRvd25sb2FkZXIgc2hvdWxkIG5vdCB0cnkgdG8gZG93bmxvYWQgdGhvc2UgYnl0ZXMgbm93ICovCiAgICAJCQkJCQl0aGlzLm5leHRQYXJzZVBvc2l0aW9uID0gYm94LnN0YXJ0ICsgYm94LnNpemU7CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkvKiB3ZSBoYXZlIHRoZSBzdGFydCBvZiB0aGUgbW9vdiBib3gsIAogICAgCQkJCQkJICAgdGhlIG5leHQgYnl0ZXMgc2hvdWxkIHRyeSB0byBjb21wbGV0ZSB0aGUgY3VycmVudCAnbWRhdCcgKi8KICAgIAkJCQkJCXRoaXMubmV4dFBhcnNlUG9zaXRpb24gPSB0aGlzLnN0cmVhbS5maW5kRW5kQ29udGlndW91c0J1ZigpOwogICAgCQkJCQl9CiAgICAJCQkJCS8qIG5vdCBtdWNoIHdlIGNhbiBkbywgd2FpdCBmb3IgbW9yZSBidWZmZXJzIHRvIGFycml2ZSAqLwogICAgCQkJCQlyZXR1cm4gZmFsc2U7CiAgICAJCQkJfQogICAgCQkJfSBlbHNlIHsKICAgIAkJCQkvKiBib3ggaXMgaW5jb21wbGV0ZSwgd2UgbWF5IG5vdCBldmVuIGtub3cgaXRzIHR5cGUgKi8KICAgIAkJCQlpZiAocmV0LnR5cGUgPT09ICJtb292IikgeyAKICAgIAkJCQkJLyogdGhlIGluY29tcGxldGUgYm94IGlzIGEgJ21vb3YnIGJveCAqLwogICAgCQkJCQl0aGlzLm1vb3ZTdGFydEZvdW5kID0gdHJ1ZTsKICAgIAkJCQkJaWYgKHRoaXMubWRhdHMubGVuZ3RoID09PSAwKSB7CiAgICAJCQkJCQl0aGlzLmlzUHJvZ3Jlc3NpdmUgPSB0cnVlOwogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJCS8qIGVpdGhlciBpdCdzIG5vdCBhbiBtZGF0IGJveCAoYW5kIHdlIG5lZWQgdG8gcGFyc2UgaXQsIHdlIGNhbm5vdCBza2lwIGl0KQogICAgCQkJCSAgIChUT0RPOiB3ZSBjb3VsZCBza2lwICdmcmVlJyBib3hlcyAuLi4pCiAgICAJCQkJCSAgIG9yIHdlIGRpZCBub3QgaGF2ZSBlbm91Z2ggZGF0YSB0byBwYXJzZSB0aGUgdHlwZSBhbmQgc2l6ZSBvZiB0aGUgYm94LCAKICAgIAkJCQkgICB3ZSB0cnkgdG8gY29uY2F0ZW5hdGUgdGhlIGN1cnJlbnQgYnVmZmVyIHdpdGggdGhlIG5leHQgYnVmZmVyIHRvIHJlc3RhcnQgcGFyc2luZyAqLwogICAgCQkJCW1lcmdlZCA9ICh0aGlzLnN0cmVhbS5tZXJnZU5leHRCdWZmZXIgPyB0aGlzLnN0cmVhbS5tZXJnZU5leHRCdWZmZXIoKSA6IGZhbHNlKTsKICAgIAkJCQlpZiAobWVyZ2VkKSB7CiAgICAJCQkJCS8qIFRoZSBuZXh0IGJ1ZmZlciB3YXMgY29udGlndW91cywgdGhlIG1lcmdpbmcgc3VjY2VlZGVkLAogICAgCQkJCQkgICB3ZSBjYW4gbm93IGNvbnRpbnVlIHBhcnNpbmcsIAogICAgCQkJCQkgICB0aGUgbmV4dCBiZXN0IHBvc2l0aW9uIHRvIHBhcnNlIGlzIGF0IHRoZSBlbmQgb2YgdGhpcyBuZXcgYnVmZmVyICovCiAgICAJCQkJCXRoaXMubmV4dFBhcnNlUG9zaXRpb24gPSB0aGlzLnN0cmVhbS5nZXRFbmRQb3NpdGlvbigpOwogICAgCQkJCQlyZXR1cm4gdHJ1ZTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQkvKiB3ZSBjYW5ub3QgY29uY2F0ZW5hdGUgZXhpc3RpbmcgYnVmZmVycyBiZWNhdXNlIHRoZXkgYXJlIG5vdCBjb250aWd1b3VzIG9yIGJlY2F1c2UgdGhlcmUgaXMgbm8gYWRkaXRpb25hbCBidWZmZXIgKi8KICAgIAkJCQkJLyogVGhlIG5leHQgYmVzdCBwb3NpdGlvbiB0byBwYXJzZSBpcyBzdGlsbCBhdCB0aGUgZW5kIG9mIHRoaXMgb2xkIGJ1ZmZlciAqLwogICAgCQkJCQlpZiAoIXJldC50eXBlKSB7CiAgICAJCQkJCQkvKiBUaGVyZSB3ZXJlIG5vdCBlbm91Z2ggYnl0ZXMgaW4gdGhlIGJ1ZmZlciB0byBwYXJzZSB0aGUgYm94IHR5cGUgYW5kIGxlbmd0aCwKICAgIAkJCQkJCSAgIHRoZSBuZXh0IGZldGNoIHNob3VsZCByZXRyaWV2ZSB0aG9zZSBtaXNzaW5nIGJ5dGVzLCBpLmUuIHRoZSBuZXh0IGJ5dGVzIGFmdGVyIHRoaXMgYnVmZmVyICovCiAgICAJCQkJCQl0aGlzLm5leHRQYXJzZVBvc2l0aW9uID0gdGhpcy5zdHJlYW0uZ2V0RW5kUG9zaXRpb24oKTsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCS8qIHdlIGhhZCBlbm91Z2ggYnl0ZXMgdG8gcGFyc2Ugc2l6ZSBhbmQgdHlwZSBvZiB0aGUgaW5jb21wbGV0ZSBib3gKICAgIAkJCQkJCSAgIGlmIHdlIGhhdmVuJ3QgZm91bmQgeWV0IHRoZSBtb292IGJveCwgc2tpcCB0aGlzIG9uZSBhbmQgdHJ5IHRoZSBuZXh0IG9uZSAKICAgIAkJCQkJCSAgIGlmIHdlIGhhdmUgZm91bmQgdGhlIG1vb3YgYm94LCBsZXQncyBjb250aW51ZSBsaW5lYXIgcGFyc2luZyAqLwogICAgCQkJCQkJaWYgKHRoaXMubW9vdlN0YXJ0Rm91bmQpIHsKICAgIAkJCQkJCQl0aGlzLm5leHRQYXJzZVBvc2l0aW9uID0gdGhpcy5zdHJlYW0uZ2V0RW5kUG9zaXRpb24oKTsKICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJdGhpcy5uZXh0UGFyc2VQb3NpdGlvbiA9IHRoaXMuc3RyZWFtLmdldFBvc2l0aW9uKCkgKyByZXQuc2l6ZTsKICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCQlyZXR1cm4gZmFsc2U7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuaGFzSW5jb21wbGV0ZU1kYXQgPSBmdW5jdGlvbiAoKSB7CiAgICAJCQlyZXR1cm4gKHRoaXMucGFyc2luZ01kYXQgIT09IG51bGwpOwogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUucHJvY2Vzc0luY29tcGxldGVNZGF0ID0gZnVuY3Rpb24gKCkgewogICAgCQkJdmFyIGJveDsKICAgIAkJCXZhciBmb3VuZDsKICAgIAkJCQogICAgCQkJLyogd2UgYXJlIGluIHRoZSBwYXJzaW5nIG9mIGFuIGluY29tcGxldGUgbWRhdCBib3ggKi8KICAgIAkJCWJveCA9IHRoaXMucGFyc2luZ01kYXQ7CgogICAgCQkJZm91bmQgPSB0aGlzLnN0cmVhbS5zZWVrKGJveC5zdGFydCArIGJveC5zaXplLCBmYWxzZSwgdGhpcy5kaXNjYXJkTWRhdERhdGEpOwogICAgCQkJaWYgKGZvdW5kKSB7CiAgICAJCQkJTG9nLmRlYnVnKCJJU09GaWxlIiwgIkZvdW5kICdtZGF0JyBlbmQgaW4gYnVmZmVyZWQgZGF0YSIpOwogICAgCQkJCS8qIHRoZSBlbmQgb2YgdGhlIG1kYXQgaGFzIGJlZW4gZm91bmQgKi8gCiAgICAJCQkJdGhpcy5wYXJzaW5nTWRhdCA9IG51bGw7CiAgICAJCQkJLyogd2UgY2FuIHBhcnNlIG1vcmUgaW4gdGhpcyBidWZmZXIgKi8KICAgIAkJCQlyZXR1cm4gdHJ1ZTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJLyogd2UgZG9uJ3QgaGF2ZSB0aGUgZW5kIG9mIHRoaXMgbWRhdCB5ZXQsIAogICAgCQkJCSAgIGluZGljYXRlIHRoYXQgdGhlIG5leHQgYnl0ZSB0byBmZXRjaCBpcyB0aGUgZW5kIG9mIHRoZSBidWZmZXJzIHdlIGhhdmUgc28gZmFyLCAKICAgIAkJCQkgICByZXR1cm4gYW5kIHdhaXQgZm9yIG1vcmUgYnVmZmVyIHRvIGNvbWUgKi8KICAgIAkJCQl0aGlzLm5leHRQYXJzZVBvc2l0aW9uID0gdGhpcy5zdHJlYW0uZmluZEVuZENvbnRpZ3VvdXNCdWYoKTsKICAgIAkJCQlyZXR1cm4gZmFsc2U7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5yZXN0b3JlUGFyc2VQb3NpdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgCQkJLyogUmVwb3NpdGlvbiBhdCB0aGUgc3RhcnQgcG9zaXRpb24gb2YgdGhlIHByZXZpb3VzIGJveCBub3QgZW50aXJlbHkgcGFyc2VkICovCiAgICAJCQlyZXR1cm4gdGhpcy5zdHJlYW0uc2Vlayh0aGlzLmxhc3RCb3hTdGFydFBvc2l0aW9uLCB0cnVlLCB0aGlzLmRpc2NhcmRNZGF0RGF0YSk7CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5zYXZlUGFyc2VQb3NpdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgCQkJLyogcmVtZW1iZXIgdGhlIHBvc2l0aW9uIG9mIHRoZSBib3ggc3RhcnQgaW4gY2FzZSB3ZSBuZWVkIHRvIHJvbGwgYmFjayAoaWYgdGhlIGJveCBpcyBpbmNvbXBsZXRlKSAqLwogICAgCQkJdGhpcy5sYXN0Qm94U3RhcnRQb3NpdGlvbiA9IHRoaXMuc3RyZWFtLmdldFBvc2l0aW9uKCk7CQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUudXBkYXRlVXNlZEJ5dGVzID0gZnVuY3Rpb24oYm94LCByZXQpIHsKICAgIAkJCWlmICh0aGlzLnN0cmVhbS5hZGRVc2VkQnl0ZXMpIHsKICAgIAkJCQlpZiAoYm94LnR5cGUgPT09ICJtZGF0IikgewogICAgCQkJCQkvKiBmb3IgYW4gbWRhdCBib3gsIG9ubHkgaXRzIGhlYWRlciBpcyBjb25zaWRlcmVkIHVzZWQsIG90aGVyIGJ5dGVzIHdpbGwgYmUgdXNlZCB3aGVuIHNhbXBsZSBkYXRhIGlzIHJlcXVlc3RlZCAqLwogICAgCQkJCQl0aGlzLnN0cmVhbS5hZGRVc2VkQnl0ZXMoYm94Lmhkcl9zaXplKTsKICAgIAkJCQkJaWYgKHRoaXMuZGlzY2FyZE1kYXREYXRhKSB7CiAgICAJCQkJCQl0aGlzLnN0cmVhbS5hZGRVc2VkQnl0ZXMoYm94LnNpemUtYm94Lmhkcl9zaXplKTsKICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCS8qIGZvciBhbGwgb3RoZXIgYm94ZXMsIHRoZSBlbnRpcmUgYm94IGRhdGEgaXMgY29uc2lkZXJlZCB1c2VkICovCiAgICAJCQkJCXRoaXMuc3RyZWFtLmFkZFVzZWRCeXRlcyhib3guc2l6ZSk7CiAgICAJCQkJfQkKICAgIAkJCX0KICAgIAkJfTsKICAgIAkJLy8gZmlsZTpzcmMvaXNvZmlsZS1hZHZhbmNlZC1jcmVhdGlvbi5qcwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5hZGQgPSBCb3hQYXJzZXIuQm94LnByb3RvdHlwZS5hZGQ7CiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmFkZEJveCA9IEJveFBhcnNlci5Cb3gucHJvdG90eXBlLmFkZEJveDsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoX29wdGlvbnMpIHsKICAgIAkJCXZhciBvcHRpb25zID0gX29wdGlvbnMgfHwge307IAogICAgCQkJdGhpcy5hZGQoImZ0eXAiKS5zZXQoIm1ham9yX2JyYW5kIiwgKG9wdGlvbnMuYnJhbmRzICYmIG9wdGlvbnMuYnJhbmRzWzBdKSB8fCAiaXNvNCIpCiAgICAJCQkJCQkJCQkgICAuc2V0KCJtaW5vcl92ZXJzaW9uIiwgMCkKICAgIAkJCQkJCQkJCSAgIC5zZXQoImNvbXBhdGlibGVfYnJhbmRzIiwgb3B0aW9ucy5icmFuZHMgfHwgWyJpc280Il0pOwogICAgCQkJdmFyIG1vb3YgPSB0aGlzLmFkZCgibW9vdiIpOwogICAgCQkJbW9vdi5hZGQoIm12aGQiKS5zZXQoInRpbWVzY2FsZSIsIG9wdGlvbnMudGltZXNjYWxlIHx8IDYwMCkKICAgIAkJCQkJCQkuc2V0KCJyYXRlIiwgb3B0aW9ucy5yYXRlIHx8IDE8PDE2KQogICAgCQkJCQkJCS5zZXQoImNyZWF0aW9uX3RpbWUiLCAwKQogICAgCQkJCQkJCS5zZXQoIm1vZGlmaWNhdGlvbl90aW1lIiwgMCkKICAgIAkJCQkJCQkuc2V0KCJkdXJhdGlvbiIsIG9wdGlvbnMuZHVyYXRpb24gfHwgMCkKICAgIAkJCQkJCQkuc2V0KCJ2b2x1bWUiLCAob3B0aW9ucy53aWR0aCkgPyAwIDogMHgwMTAwKQogICAgCQkJCQkJCS5zZXQoIm1hdHJpeCIsIFsgMTw8MTYsIDAsIDAsIDAsIDE8PDE2LCAwLCAwLCAwLCAweDQwMDAwMDAwXSkKICAgIAkJCQkJCQkuc2V0KCJuZXh0X3RyYWNrX2lkIiwgMSk7CiAgICAJCQltb292LmFkZCgibXZleCIpOwogICAgCQkJcmV0dXJuIHRoaXM7CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5hZGRUcmFjayA9IGZ1bmN0aW9uIChfb3B0aW9ucykgewogICAgCQkJaWYgKCF0aGlzLm1vb3YpIHsKICAgIAkJCQl0aGlzLmluaXQoX29wdGlvbnMpOwogICAgCQkJfQoKICAgIAkJCXZhciBvcHRpb25zID0gX29wdGlvbnMgfHwge307IAogICAgCQkJb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgMzIwOwogICAgCQkJb3B0aW9ucy5oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAzMjA7CiAgICAJCQlvcHRpb25zLmlkID0gb3B0aW9ucy5pZCB8fCB0aGlzLm1vb3YubXZoZC5uZXh0X3RyYWNrX2lkOwogICAgCQkJb3B0aW9ucy50eXBlID0gb3B0aW9ucy50eXBlIHx8ICJhdmMxIjsKCiAgICAJCQl2YXIgdHJhayA9IHRoaXMubW9vdi5hZGQoInRyYWsiKTsKICAgIAkJCXRoaXMubW9vdi5tdmhkLm5leHRfdHJhY2tfaWQgPSBvcHRpb25zLmlkKzE7CiAgICAJCQl0cmFrLmFkZCgidGtoZCIpLnNldCgiZmxhZ3MiLEJveFBhcnNlci5US0hEX0ZMQUdfRU5BQkxFRCB8IAogICAgCQkJCQkJCQkJCSBCb3hQYXJzZXIuVEtIRF9GTEFHX0lOX01PVklFIHwgCiAgICAJCQkJCQkJCQkJIEJveFBhcnNlci5US0hEX0ZMQUdfSU5fUFJFVklFVykKICAgIAkJCQkJCQkuc2V0KCJjcmVhdGlvbl90aW1lIiwwKQogICAgCQkJCQkJCS5zZXQoIm1vZGlmaWNhdGlvbl90aW1lIiwgMCkKICAgIAkJCQkJCQkuc2V0KCJ0cmFja19pZCIsIG9wdGlvbnMuaWQpCiAgICAJCQkJCQkJLnNldCgiZHVyYXRpb24iLCBvcHRpb25zLmR1cmF0aW9uIHx8IDApCiAgICAJCQkJCQkJLnNldCgibGF5ZXIiLCBvcHRpb25zLmxheWVyIHx8IDApCiAgICAJCQkJCQkJLnNldCgiYWx0ZXJuYXRlX2dyb3VwIiwgMCkKICAgIAkJCQkJCQkuc2V0KCJ2b2x1bWUiLCAxKQogICAgCQkJCQkJCS5zZXQoIm1hdHJpeCIsIFsgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCBdKQogICAgCQkJCQkJCS5zZXQoIndpZHRoIiwgb3B0aW9ucy53aWR0aCA8PCAxNikKICAgIAkJCQkJCQkuc2V0KCJoZWlnaHQiLCBvcHRpb25zLmhlaWdodCA8PCAxNik7CgogICAgCQkJdmFyIG1kaWEgPSB0cmFrLmFkZCgibWRpYSIpOwogICAgCQkJbWRpYS5hZGQoIm1kaGQiKS5zZXQoImNyZWF0aW9uX3RpbWUiLCAwKQogICAgCQkJCQkJCS5zZXQoIm1vZGlmaWNhdGlvbl90aW1lIiwgMCkKICAgIAkJCQkJCQkuc2V0KCJ0aW1lc2NhbGUiLCBvcHRpb25zLnRpbWVzY2FsZSB8fCAxKQogICAgCQkJCQkJCS5zZXQoImR1cmF0aW9uIiwgb3B0aW9ucy5tZWRpYV9kdXJhdGlvbiB8fCAwKQogICAgCQkJCQkJCS5zZXQoImxhbmd1YWdlIiwgb3B0aW9ucy5sYW5ndWFnZSB8fCAidW5kIik7CgogICAgCQkJbWRpYS5hZGQoImhkbHIiKS5zZXQoImhhbmRsZXIiLCBvcHRpb25zLmhkbHIgfHwgInZpZGUiKQogICAgCQkJCQkJCS5zZXQoIm5hbWUiLCBvcHRpb25zLm5hbWUgfHwgIlRyYWNrIGNyZWF0ZWQgd2l0aCBNUDRCb3guanMiKTsKCiAgICAJCQltZGlhLmFkZCgiZWxuZyIpLnNldCgiZXh0ZW5kZWRfbGFuZ3VhZ2UiLCBvcHRpb25zLmxhbmd1YWdlIHx8ICJmci1GUiIpOwoKICAgIAkJCXZhciBtaW5mID0gbWRpYS5hZGQoIm1pbmYiKTsKICAgIAkJCWlmIChCb3hQYXJzZXJbb3B0aW9ucy50eXBlKyJTYW1wbGVFbnRyeSJdID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgIAkJCXZhciBzYW1wbGVfZGVzY3JpcHRpb25fZW50cnkgPSBuZXcgQm94UGFyc2VyW29wdGlvbnMudHlwZSsiU2FtcGxlRW50cnkiXSgpOwogICAgCQkJc2FtcGxlX2Rlc2NyaXB0aW9uX2VudHJ5LmRhdGFfcmVmZXJlbmNlX2luZGV4ID0gMTsKICAgIAkJCXZhciBtZWRpYV90eXBlID0gIiI7CiAgICAJCQlmb3IgKHZhciBtZWRpYVR5cGUgaW4gQm94UGFyc2VyLnNhbXBsZUVudHJ5Q29kZXMpIHsKICAgIAkJCQl2YXIgY29kZXMgPSBCb3hQYXJzZXIuc2FtcGxlRW50cnlDb2Rlc1ttZWRpYVR5cGVdOwogICAgCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgY29kZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQkJaWYgKGNvZGVzLmluZGV4T2Yob3B0aW9ucy50eXBlKSA+IC0xKSB7CiAgICAJCQkJCQltZWRpYV90eXBlID0gbWVkaWFUeXBlOwogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlzd2l0Y2gobWVkaWFfdHlwZSkgewogICAgCQkJCWNhc2UgIlZpc3VhbCI6CiAgICAJCQkJCW1pbmYuYWRkKCJ2bWhkIikuc2V0KCJncmFwaGljc21vZGUiLDApLnNldCgib3Bjb2xvciIsIFsgMCwgMCwgMCBdKTsKICAgIAkJCQkJc2FtcGxlX2Rlc2NyaXB0aW9uX2VudHJ5LnNldCgid2lkdGgiLCBvcHRpb25zLndpZHRoKQogICAgCQkJCQkJCQkuc2V0KCJoZWlnaHQiLCBvcHRpb25zLmhlaWdodCkKICAgIAkJCQkJCQkJLnNldCgiaG9yaXpyZXNvbHV0aW9uIiwgMHg0ODw8MTYpCiAgICAJCQkJCQkJCS5zZXQoInZlcnRyZXNvbHV0aW9uIiwgMHg0ODw8MTYpCiAgICAJCQkJCQkJCS5zZXQoImZyYW1lX2NvdW50IiwgMSkKICAgIAkJCQkJCQkJLnNldCgiY29tcHJlc3Nvcm5hbWUiLCBvcHRpb25zLnR5cGUrIiBDb21wcmVzc29yIikKICAgIAkJCQkJCQkJLnNldCgiZGVwdGgiLCAweDE4KTsKICAgIAkJCQkJaWYgKG9wdGlvbnMuYXZjRGVjb2RlckNvbmZpZ1JlY29yZCkgewogICAgCQkJCQkJdmFyIGF2Y0MgPSBuZXcgQm94UGFyc2VyLmF2Y0NCb3goKTsKICAgIAkJCQkJCWF2Y0MucGFyc2UobmV3IE1QNEJveFN0cmVhbShvcHRpb25zLmF2Y0RlY29kZXJDb25maWdSZWNvcmQpKTsKICAgIAkJCQkJCXNhbXBsZV9kZXNjcmlwdGlvbl9lbnRyeS5hZGRCb3goYXZjQyk7CiAgICAJCQkJCX0gZWxzZSBpZiAob3B0aW9ucy5oZXZjRGVjb2RlckNvbmZpZ1JlY29yZCkgewogICAgCQkJCQkJdmFyIGh2Y0MgPSBuZXcgQm94UGFyc2VyLmh2Y0NCb3goKTsKICAgIAkJCQkJCWh2Y0MucGFyc2UobmV3IE1QNEJveFN0cmVhbShvcHRpb25zLmhldmNEZWNvZGVyQ29uZmlnUmVjb3JkKSk7CiAgICAJCQkJCQlzYW1wbGVfZGVzY3JpcHRpb25fZW50cnkuYWRkQm94KGh2Y0MpOwogICAgCQkJCQl9CiAgICAJCQkJCWJyZWFrOwogICAgCQkJCWNhc2UgIkF1ZGlvIjoKICAgIAkJCQkJbWluZi5hZGQoInNtaGQiKS5zZXQoImJhbGFuY2UiLCBvcHRpb25zLmJhbGFuY2UgfHwgMCk7CiAgICAJCQkJCXNhbXBsZV9kZXNjcmlwdGlvbl9lbnRyeS5zZXQoImNoYW5uZWxfY291bnQiLCBvcHRpb25zLmNoYW5uZWxfY291bnQgfHwgMikKICAgIAkJCQkJCQkJLnNldCgic2FtcGxlc2l6ZSIsIG9wdGlvbnMuc2FtcGxlc2l6ZSB8fCAxNikKICAgIAkJCQkJCQkJLnNldCgic2FtcGxlcmF0ZSIsIG9wdGlvbnMuc2FtcGxlcmF0ZSB8fCAxPDwxNik7CiAgICAJCQkJCWJyZWFrOwogICAgCQkJCWNhc2UgIkhpbnQiOgogICAgCQkJCQltaW5mLmFkZCgiaG1oZCIpOyAvLyBUT0RPOiBhZGQgcHJvcGVydGllcwogICAgCQkJCQlicmVhazsKICAgIAkJCQljYXNlICJTdWJ0aXRsZSI6CiAgICAJCQkJCW1pbmYuYWRkKCJzdGhkIik7CiAgICAJCQkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CiAgICAJCQkJCQljYXNlICJzdHBwIjoKICAgIAkJCQkJCQlzYW1wbGVfZGVzY3JpcHRpb25fZW50cnkuc2V0KCJuYW1lc3BhY2UiLCBvcHRpb25zLm5hbWVzcGFjZSB8fCAibm9uYW1lc3BhY2UiKQogICAgCQkJCQkJCQkJCS5zZXQoInNjaGVtYV9sb2NhdGlvbiIsIG9wdGlvbnMuc2NoZW1hX2xvY2F0aW9uIHx8ICIiKQogICAgCQkJCQkJCQkJCS5zZXQoImF1eGlsaWFyeV9taW1lX3R5cGVzIiwgb3B0aW9ucy5hdXhpbGlhcnlfbWltZV90eXBlcyB8fCAiIik7CiAgICAJCQkJCQkJYnJlYWs7CiAgICAJCQkJCX0KICAgIAkJCQkJYnJlYWs7CiAgICAJCQkJY2FzZSAiTWV0YWRhdGEiOgogICAgCQkJCQltaW5mLmFkZCgibm1oZCIpOwogICAgCQkJCQlicmVhazsKICAgIAkJCQljYXNlICJTeXN0ZW0iOgogICAgCQkJCQltaW5mLmFkZCgibm1oZCIpOwogICAgCQkJCQlicmVhazsKICAgIAkJCQlkZWZhdWx0OgogICAgCQkJCQltaW5mLmFkZCgibm1oZCIpOwogICAgCQkJCQlicmVhazsKICAgIAkJCX0KICAgIAkJCWlmIChvcHRpb25zLmRlc2NyaXB0aW9uKSB7CiAgICAJCQkJc2FtcGxlX2Rlc2NyaXB0aW9uX2VudHJ5LmFkZEJveChvcHRpb25zLmRlc2NyaXB0aW9uKTsKICAgIAkJCX0KICAgIAkJCWlmIChvcHRpb25zLmRlc2NyaXB0aW9uX2JveGVzKSB7CiAgICAJCQkJb3B0aW9ucy5kZXNjcmlwdGlvbl9ib3hlcy5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7CiAgICAJCQkJCXNhbXBsZV9kZXNjcmlwdGlvbl9lbnRyeS5hZGRCb3goYik7CiAgICAJCQkJfSk7CiAgICAJCQl9CiAgICAJCQltaW5mLmFkZCgiZGluZiIpLmFkZCgiZHJlZiIpLmFkZEVudHJ5KChuZXcgQm94UGFyc2VyWyJ1cmwgQm94Il0oKSkuc2V0KCJmbGFncyIsIDB4MSkpOwogICAgCQkJdmFyIHN0YmwgPSBtaW5mLmFkZCgic3RibCIpOwogICAgCQkJc3RibC5hZGQoInN0c2QiKS5hZGRFbnRyeShzYW1wbGVfZGVzY3JpcHRpb25fZW50cnkpOwogICAgCQkJc3RibC5hZGQoInN0dHMiKS5zZXQoInNhbXBsZV9jb3VudHMiLCBbXSkKICAgIAkJCQkJCQkuc2V0KCJzYW1wbGVfZGVsdGFzIiwgW10pOwogICAgCQkJc3RibC5hZGQoInN0c2MiKS5zZXQoImZpcnN0X2NodW5rIiwgW10pCiAgICAJCQkJCQkJLnNldCgic2FtcGxlc19wZXJfY2h1bmsiLCBbXSkKICAgIAkJCQkJCQkuc2V0KCJzYW1wbGVfZGVzY3JpcHRpb25faW5kZXgiLCBbXSk7CiAgICAJCQlzdGJsLmFkZCgic3RjbyIpLnNldCgiY2h1bmtfb2Zmc2V0cyIsIFtdKTsKICAgIAkJCXN0YmwuYWRkKCJzdHN6Iikuc2V0KCJzYW1wbGVfc2l6ZXMiLCBbXSk7CgogICAgCQkJdGhpcy5tb292Lm12ZXguYWRkKCJ0cmV4Iikuc2V0KCJ0cmFja19pZCIsIG9wdGlvbnMuaWQpCiAgICAJCQkJCQkJCQkgIC5zZXQoImRlZmF1bHRfc2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4Iiwgb3B0aW9ucy5kZWZhdWx0X3NhbXBsZV9kZXNjcmlwdGlvbl9pbmRleCB8fCAxKQogICAgCQkJCQkJCQkJICAuc2V0KCJkZWZhdWx0X3NhbXBsZV9kdXJhdGlvbiIsIG9wdGlvbnMuZGVmYXVsdF9zYW1wbGVfZHVyYXRpb24gfHwgMCkKICAgIAkJCQkJCQkJCSAgLnNldCgiZGVmYXVsdF9zYW1wbGVfc2l6ZSIsIG9wdGlvbnMuZGVmYXVsdF9zYW1wbGVfc2l6ZSB8fCAwKQogICAgCQkJCQkJCQkJICAuc2V0KCJkZWZhdWx0X3NhbXBsZV9mbGFncyIsIG9wdGlvbnMuZGVmYXVsdF9zYW1wbGVfZmxhZ3MgfHwgMCk7CiAgICAJCQl0aGlzLmJ1aWxkVHJha1NhbXBsZUxpc3RzKHRyYWspOwogICAgCQkJcmV0dXJuIG9wdGlvbnMuaWQ7CiAgICAJCX07CgogICAgCQlCb3hQYXJzZXIuQm94LnByb3RvdHlwZS5jb21wdXRlU2l6ZSA9IGZ1bmN0aW9uKHN0cmVhbV8pIHsKICAgIAkJCXZhciBzdHJlYW0gPSBzdHJlYW1fIHx8IG5ldyBEYXRhU3RyZWFtKCk7CiAgICAJCQlzdHJlYW0uZW5kaWFubmVzcyA9IERhdGFTdHJlYW0uQklHX0VORElBTjsKICAgIAkJCXRoaXMud3JpdGUoc3RyZWFtKTsKICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmFkZFNhbXBsZSA9IGZ1bmN0aW9uICh0cmFja19pZCwgZGF0YSwgX29wdGlvbnMpIHsKICAgIAkJCXZhciBvcHRpb25zID0gX29wdGlvbnMgfHwge307CiAgICAJCQl2YXIgc2FtcGxlID0ge307CiAgICAJCQl2YXIgdHJhayA9IHRoaXMuZ2V0VHJhY2tCeUlkKHRyYWNrX2lkKTsKICAgIAkJCWlmICh0cmFrID09PSBudWxsKSByZXR1cm47CiAgICAJCSAgICBzYW1wbGUubnVtYmVyID0gdHJhay5zYW1wbGVzLmxlbmd0aDsKICAgIAkJCXNhbXBsZS50cmFja19pZCA9IHRyYWsudGtoZC50cmFja19pZDsKICAgIAkJCXNhbXBsZS50aW1lc2NhbGUgPSB0cmFrLm1kaWEubWRoZC50aW1lc2NhbGU7CiAgICAJCQlzYW1wbGUuZGVzY3JpcHRpb25faW5kZXggPSAob3B0aW9ucy5zYW1wbGVfZGVzY3JpcHRpb25faW5kZXggPyBvcHRpb25zLnNhbXBsZV9kZXNjcmlwdGlvbl9pbmRleCAtIDE6IDApOwogICAgCQkJc2FtcGxlLmRlc2NyaXB0aW9uID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbc2FtcGxlLmRlc2NyaXB0aW9uX2luZGV4XTsKICAgIAkJCXNhbXBsZS5kYXRhID0gZGF0YTsKICAgIAkJCXNhbXBsZS5zaXplID0gZGF0YS5ieXRlTGVuZ3RoOwogICAgCQkJc2FtcGxlLmFscmVhZHlSZWFkID0gc2FtcGxlLnNpemU7CiAgICAJCQlzYW1wbGUuZHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uIHx8IDE7CiAgICAJCQlzYW1wbGUuY3RzID0gb3B0aW9ucy5jdHMgfHwgMDsKICAgIAkJCXNhbXBsZS5kdHMgPSBvcHRpb25zLmR0cyB8fCAwOwogICAgCQkJc2FtcGxlLmlzX3N5bmMgPSBvcHRpb25zLmlzX3N5bmMgfHwgZmFsc2U7CiAgICAJCQlzYW1wbGUuaXNfbGVhZGluZyA9IG9wdGlvbnMuaXNfbGVhZGluZyB8fCAwOwogICAgCQkJc2FtcGxlLmRlcGVuZHNfb24gPSBvcHRpb25zLmRlcGVuZHNfb24gfHwgMDsKICAgIAkJCXNhbXBsZS5pc19kZXBlbmRlZF9vbiA9IG9wdGlvbnMuaXNfZGVwZW5kZWRfb24gfHwgMDsKICAgIAkJCXNhbXBsZS5oYXNfcmVkdW5kYW5jeSA9IG9wdGlvbnMuaGFzX3JlZHVuZGFuY3kgfHwgMDsKICAgIAkJCXNhbXBsZS5kZWdyYWRhdGlvbl9wcmlvcml0eSA9IG9wdGlvbnMuZGVncmFkYXRpb25fcHJpb3JpdHkgfHwgMDsKICAgIAkJCXNhbXBsZS5vZmZzZXQgPSAwOwogICAgCQkJc2FtcGxlLnN1YnNhbXBsZXMgPSBvcHRpb25zLnN1YnNhbXBsZXM7CiAgICAJCQl0cmFrLnNhbXBsZXMucHVzaChzYW1wbGUpOwogICAgCQkJdHJhay5zYW1wbGVzX3NpemUgKz0gc2FtcGxlLnNpemU7CiAgICAJCQl0cmFrLnNhbXBsZXNfZHVyYXRpb24gKz0gc2FtcGxlLmR1cmF0aW9uOwogICAgCQkJaWYgKHRyYWsuZmlyc3RfZHRzID09PSB1bmRlZmluZWQpIHsKICAgIAkJCQl0cmFrLmZpcnN0X2R0cyA9IG9wdGlvbnMuZHRzOwogICAgCQkJfQoKICAgIAkJCXRoaXMucHJvY2Vzc1NhbXBsZXMoKTsKICAgIAkJCQogICAgCQkJdmFyIG1vb2YgPSB0aGlzLmNyZWF0ZVNpbmdsZVNhbXBsZU1vb2Yoc2FtcGxlKTsKICAgIAkJCXRoaXMuYWRkQm94KG1vb2YpOwogICAgCQkJbW9vZi5jb21wdXRlU2l6ZSgpOwogICAgCQkJLyogYWRqdXN0aW5nIHRoZSBkYXRhX29mZnNldCBub3cgdGhhdCB0aGUgbW9vZiBzaXplIGlzIGtub3duKi8KICAgIAkJCW1vb2YudHJhZnNbMF0udHJ1bnNbMF0uZGF0YV9vZmZzZXQgPSBtb29mLnNpemUrODsgLy84IGlzIG1kYXQgaGVhZGVyCiAgICAJCQl0aGlzLmFkZCgibWRhdCIpLmRhdGEgPSBuZXcgVWludDhBcnJheShkYXRhKTsKICAgIAkJCXJldHVybiBzYW1wbGU7CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5jcmVhdGVTaW5nbGVTYW1wbGVNb29mID0gZnVuY3Rpb24oc2FtcGxlKSB7CiAgICAJCQl2YXIgc2FtcGxlX2ZsYWdzID0gMDsKICAgIAkJCWlmIChzYW1wbGUuaXNfc3luYykKICAgIAkJCQlzYW1wbGVfZmxhZ3MgPSAoMSA8PCAyNSk7ICAvLyBzYW1wbGVfZGVwZW5kc19vbl9ub25lIChJIHBpY3R1cmUpCiAgICAJCQllbHNlCiAgICAJCQkJc2FtcGxlX2ZsYWdzID0gKDEgPDwgMTYpOyAgLy8gbm9uLXN5bmMKCiAgICAJCQl2YXIgbW9vZiA9IG5ldyBCb3hQYXJzZXIubW9vZkJveCgpOwogICAgCQkJbW9vZi5hZGQoIm1maGQiKS5zZXQoInNlcXVlbmNlX251bWJlciIsIHRoaXMubmV4dE1vb2ZOdW1iZXIpOwogICAgCQkJdGhpcy5uZXh0TW9vZk51bWJlcisrOwogICAgCQkJdmFyIHRyYWYgPSBtb29mLmFkZCgidHJhZiIpOwogICAgCQkJdmFyIHRyYWsgPSB0aGlzLmdldFRyYWNrQnlJZChzYW1wbGUudHJhY2tfaWQpOwogICAgCQkJdHJhZi5hZGQoInRmaGQiKS5zZXQoInRyYWNrX2lkIiwgc2FtcGxlLnRyYWNrX2lkKQogICAgCQkJCQkJCS5zZXQoImZsYWdzIiwgQm94UGFyc2VyLlRGSERfRkxBR19ERUZBVUxUX0JBU0VfSVNfTU9PRik7CiAgICAJCQl0cmFmLmFkZCgidGZkdCIpLnNldCgiYmFzZU1lZGlhRGVjb2RlVGltZSIsIChzYW1wbGUuZHRzIC0gKHRyYWsuZmlyc3RfZHRzIHx8IDApKSk7CiAgICAJCQl0cmFmLmFkZCgidHJ1biIpLnNldCgiZmxhZ3MiLCBCb3hQYXJzZXIuVFJVTl9GTEFHU19EQVRBX09GRlNFVCB8IEJveFBhcnNlci5UUlVOX0ZMQUdTX0RVUkFUSU9OIHwgCiAgICAJCQkJCQkgCQkJCSAgQm94UGFyc2VyLlRSVU5fRkxBR1NfU0laRSB8IEJveFBhcnNlci5UUlVOX0ZMQUdTX0ZMQUdTIHwgCiAgICAJCQkJCQkgCQkJCSAgQm94UGFyc2VyLlRSVU5fRkxBR1NfQ1RTX09GRlNFVCkKICAgIAkJCQkJCQkuc2V0KCJkYXRhX29mZnNldCIsMCkKICAgIAkJCQkJCQkuc2V0KCJmaXJzdF9zYW1wbGVfZmxhZ3MiLDApCiAgICAJCQkJCQkJLnNldCgic2FtcGxlX2NvdW50IiwxKQogICAgCQkJCQkJCS5zZXQoInNhbXBsZV9kdXJhdGlvbiIsW3NhbXBsZS5kdXJhdGlvbl0pCiAgICAJCQkJCQkJLnNldCgic2FtcGxlX3NpemUiLFtzYW1wbGUuc2l6ZV0pCiAgICAJCQkJCQkJLnNldCgic2FtcGxlX2ZsYWdzIixbc2FtcGxlX2ZsYWdzXSkKICAgIAkJCQkJCQkuc2V0KCJzYW1wbGVfY29tcG9zaXRpb25fdGltZV9vZmZzZXQiLCBbc2FtcGxlLmN0cyAtIHNhbXBsZS5kdHNdKTsKICAgIAkJCXJldHVybiBtb29mOwogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvaXNvZmlsZS1zYW1wbGUtcHJvY2Vzc2luZy5qcwogICAgCQkvKiBJbmRleCBvZiB0aGUgbGFzdCBtb29mIGJveCByZWNlaXZlZCAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5sYXN0TW9vZkluZGV4ID0gMDsKCiAgICAJCS8qIHNpemUgb2YgdGhlIGJ1ZmZlcnMgYWxsb2NhdGVkIGZvciBzYW1wbGVzICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnNhbXBsZXNEYXRhU2l6ZSA9IDA7CgogICAgCQkvKiBSZXNldHMgYWxsIHNhbXBsZSB0YWJsZXMgKi8KICAgIAkJSVNPRmlsZS5wcm90b3R5cGUucmVzZXRUYWJsZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAJCQl2YXIgaTsKICAgIAkJCXZhciB0cmFrLCBzdGNvLCBzdHNjLCBzdHN6LCBzdHRzLCBjdHRzLCBzdHNzOwogICAgCQkJdGhpcy5pbml0aWFsX2R1cmF0aW9uID0gdGhpcy5tb292Lm12aGQuZHVyYXRpb247CiAgICAJCQl0aGlzLm1vb3YubXZoZC5kdXJhdGlvbiA9IDA7CiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5tb292LnRyYWtzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdHJhayA9IHRoaXMubW9vdi50cmFrc1tpXTsKICAgIAkJCQl0cmFrLnRraGQuZHVyYXRpb24gPSAwOwogICAgCQkJCXRyYWsubWRpYS5tZGhkLmR1cmF0aW9uID0gMDsKICAgIAkJCQlzdGNvID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdGNvIHx8IHRyYWsubWRpYS5taW5mLnN0YmwuY282NDsKICAgIAkJCQlzdGNvLmNodW5rX29mZnNldHMgPSBbXTsKICAgIAkJCQlzdHNjID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHNjOwogICAgCQkJCXN0c2MuZmlyc3RfY2h1bmsgPSBbXTsKICAgIAkJCQlzdHNjLnNhbXBsZXNfcGVyX2NodW5rID0gW107CiAgICAJCQkJc3RzYy5zYW1wbGVfZGVzY3JpcHRpb25faW5kZXggPSBbXTsKICAgIAkJCQlzdHN6ID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHN6IHx8IHRyYWsubWRpYS5taW5mLnN0Ymwuc3R6MjsKICAgIAkJCQlzdHN6LnNhbXBsZV9zaXplcyA9IFtdOwogICAgCQkJCXN0dHMgPSB0cmFrLm1kaWEubWluZi5zdGJsLnN0dHM7CiAgICAJCQkJc3R0cy5zYW1wbGVfY291bnRzID0gW107CiAgICAJCQkJc3R0cy5zYW1wbGVfZGVsdGFzID0gW107CiAgICAJCQkJY3R0cyA9IHRyYWsubWRpYS5taW5mLnN0YmwuY3R0czsKICAgIAkJCQlpZiAoY3R0cykgewogICAgCQkJCQljdHRzLnNhbXBsZV9jb3VudHMgPSBbXTsKICAgIAkJCQkJY3R0cy5zYW1wbGVfb2Zmc2V0cyA9IFtdOwogICAgCQkJCX0KICAgIAkJCQlzdHNzID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHNzOwogICAgCQkJCXZhciBrID0gdHJhay5tZGlhLm1pbmYuc3RibC5ib3hlcy5pbmRleE9mKHN0c3MpOwogICAgCQkJCWlmIChrICE9IC0xKSB0cmFrLm1kaWEubWluZi5zdGJsLmJveGVzW2tdID0gbnVsbDsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUuaW5pdFNhbXBsZUdyb3VwcyA9IGZ1bmN0aW9uKHRyYWssIHRyYWYsIHNiZ3BzLCB0cmFrX3NncGRzLCB0cmFmX3NncGRzKSB7CiAgICAJCQl2YXIgbDsKICAgIAkJCXZhciBrOwogICAgCQkJdmFyIHNhbXBsZV9ncm91cF9pbmZvOwogICAgCQkJdmFyIHNhbXBsZV9ncm91cF9rZXk7CiAgICAJCQlmdW5jdGlvbiBTYW1wbGVHcm91cEluZm8oX3R5cGUsIF9wYXJhbWV0ZXIsIF9zYmdwKSB7CiAgICAJCQkJdGhpcy5ncm91cGluZ190eXBlID0gX3R5cGU7CiAgICAJCQkJdGhpcy5ncm91cGluZ190eXBlX3BhcmFtZXRlciA9IF9wYXJhbWV0ZXI7CiAgICAJCQkJdGhpcy5zYmdwID0gX3NiZ3A7CiAgICAJCQkJdGhpcy5sYXN0X3NhbXBsZV9pbl9ydW4gPSAtMTsKICAgIAkJCQl0aGlzLmVudHJ5X2luZGV4ID0gLTE7CQkKICAgIAkJCX0KICAgIAkJCWlmICh0cmFmKSB7CiAgICAJCQkJdHJhZi5zYW1wbGVfZ3JvdXBzX2luZm8gPSBbXTsKICAgIAkJCX0gCiAgICAJCQlpZiAoIXRyYWsuc2FtcGxlX2dyb3Vwc19pbmZvKSB7CiAgICAJCQkJdHJhay5zYW1wbGVfZ3JvdXBzX2luZm8gPSBbXTsKICAgIAkJCX0KICAgIAkJCWZvciAoayA9IDA7IGsgPCBzYmdwcy5sZW5ndGg7IGsrKykgewogICAgCQkJCXNhbXBsZV9ncm91cF9rZXkgPSBzYmdwc1trXS5ncm91cGluZ190eXBlICsiLyIrIHNiZ3BzW2tdLmdyb3VwaW5nX3R5cGVfcGFyYW1ldGVyOwogICAgCQkJCXNhbXBsZV9ncm91cF9pbmZvID0gbmV3IFNhbXBsZUdyb3VwSW5mbyhzYmdwc1trXS5ncm91cGluZ190eXBlLCBzYmdwc1trXS5ncm91cGluZ190eXBlX3BhcmFtZXRlciwgc2JncHNba10pOwogICAgCQkJCWlmICh0cmFmKSB7CiAgICAJCQkJCXRyYWYuc2FtcGxlX2dyb3Vwc19pbmZvW3NhbXBsZV9ncm91cF9rZXldID0gc2FtcGxlX2dyb3VwX2luZm87CiAgICAJCQkJfQogICAgCQkJCWlmICghdHJhay5zYW1wbGVfZ3JvdXBzX2luZm9bc2FtcGxlX2dyb3VwX2tleV0pIHsKICAgIAkJCQkJdHJhay5zYW1wbGVfZ3JvdXBzX2luZm9bc2FtcGxlX2dyb3VwX2tleV0gPSBzYW1wbGVfZ3JvdXBfaW5mbzsKICAgIAkJCQl9CiAgICAJCQkJZm9yIChsPTA7IGwgPHRyYWtfc2dwZHMubGVuZ3RoOyBsKyspIHsKICAgIAkJCQkJaWYgKHRyYWtfc2dwZHNbbF0uZ3JvdXBpbmdfdHlwZSA9PT0gc2JncHNba10uZ3JvdXBpbmdfdHlwZSkgewogICAgCQkJCQkJc2FtcGxlX2dyb3VwX2luZm8uZGVzY3JpcHRpb24gPSB0cmFrX3NncGRzW2xdOwogICAgCQkJCQkJc2FtcGxlX2dyb3VwX2luZm8uZGVzY3JpcHRpb24udXNlZCA9IHRydWU7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQkJaWYgKHRyYWZfc2dwZHMpIHsKICAgIAkJCQkJZm9yIChsPTA7IGwgPHRyYWZfc2dwZHMubGVuZ3RoOyBsKyspIHsKICAgIAkJCQkJCWlmICh0cmFmX3NncGRzW2xdLmdyb3VwaW5nX3R5cGUgPT09IHNiZ3BzW2tdLmdyb3VwaW5nX3R5cGUpIHsKICAgIAkJCQkJCQlzYW1wbGVfZ3JvdXBfaW5mby5mcmFnbWVudF9kZXNjcmlwdGlvbiA9IHRyYWZfc2dwZHNbbF07CiAgICAJCQkJCQkJc2FtcGxlX2dyb3VwX2luZm8uZnJhZ21lbnRfZGVzY3JpcHRpb24udXNlZCA9IHRydWU7CiAgICAJCQkJCQkJc2FtcGxlX2dyb3VwX2luZm8uaXNfZnJhZ21lbnQgPSB0cnVlOwogICAgCQkJCQkJfQogICAgCQkJCQl9CQkJCiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJaWYgKCF0cmFmKSB7CiAgICAJCQkJZm9yIChrID0gMDsgayA8IHRyYWtfc2dwZHMubGVuZ3RoOyBrKyspIHsKICAgIAkJCQkJaWYgKCF0cmFrX3NncGRzW2tdLnVzZWQgJiYgdHJha19zZ3Bkc1trXS52ZXJzaW9uID49IDIpIHsKICAgIAkJCQkJCXNhbXBsZV9ncm91cF9rZXkgPSB0cmFrX3NncGRzW2tdLmdyb3VwaW5nX3R5cGUgKyIvMCI7CiAgICAJCQkJCQlzYW1wbGVfZ3JvdXBfaW5mbyA9IG5ldyBTYW1wbGVHcm91cEluZm8odHJha19zZ3Bkc1trXS5ncm91cGluZ190eXBlLCAwKTsKICAgIAkJCQkJCWlmICghdHJhay5zYW1wbGVfZ3JvdXBzX2luZm9bc2FtcGxlX2dyb3VwX2tleV0pIHsKICAgIAkJCQkJCQl0cmFrLnNhbXBsZV9ncm91cHNfaW5mb1tzYW1wbGVfZ3JvdXBfa2V5XSA9IHNhbXBsZV9ncm91cF9pbmZvOwogICAgCQkJCQkJfQogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlpZiAodHJhZl9zZ3BkcykgewogICAgCQkJCQlmb3IgKGsgPSAwOyBrIDwgdHJhZl9zZ3Bkcy5sZW5ndGg7IGsrKykgewogICAgCQkJCQkJaWYgKCF0cmFmX3NncGRzW2tdLnVzZWQgJiYgdHJhZl9zZ3Bkc1trXS52ZXJzaW9uID49IDIpIHsKICAgIAkJCQkJCQlzYW1wbGVfZ3JvdXBfa2V5ID0gdHJhZl9zZ3Bkc1trXS5ncm91cGluZ190eXBlICsiLzAiOwogICAgCQkJCQkJCXNhbXBsZV9ncm91cF9pbmZvID0gbmV3IFNhbXBsZUdyb3VwSW5mbyh0cmFmX3NncGRzW2tdLmdyb3VwaW5nX3R5cGUsIDApOwogICAgCQkJCQkJCXNhbXBsZV9ncm91cF9pbmZvLmlzX2ZyYWdtZW50ID0gdHJ1ZTsKICAgIAkJCQkJCQlpZiAoIXRyYWYuc2FtcGxlX2dyb3Vwc19pbmZvW3NhbXBsZV9ncm91cF9rZXldKSB7CiAgICAJCQkJCQkJCXRyYWYuc2FtcGxlX2dyb3Vwc19pbmZvW3NhbXBsZV9ncm91cF9rZXldID0gc2FtcGxlX2dyb3VwX2luZm87CiAgICAJCQkJCQkJfQogICAgCQkJCQkJfQogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5zZXRTYW1wbGVHcm91cFByb3BlcnRpZXMgPSBmdW5jdGlvbih0cmFrLCBzYW1wbGUsIHNhbXBsZV9udW1iZXIsIHNhbXBsZV9ncm91cHNfaW5mbykgewogICAgCQkJdmFyIGs7CiAgICAJCQl2YXIgaW5kZXg7CiAgICAJCQlzYW1wbGUuc2FtcGxlX2dyb3VwcyA9IFtdOwogICAgCQkJZm9yIChrIGluIHNhbXBsZV9ncm91cHNfaW5mbykgewogICAgCQkJCXNhbXBsZS5zYW1wbGVfZ3JvdXBzW2tdID0ge307CiAgICAJCQkJc2FtcGxlLnNhbXBsZV9ncm91cHNba10uZ3JvdXBpbmdfdHlwZSA9IHNhbXBsZV9ncm91cHNfaW5mb1trXS5ncm91cGluZ190eXBlOwogICAgCQkJCXNhbXBsZS5zYW1wbGVfZ3JvdXBzW2tdLmdyb3VwaW5nX3R5cGVfcGFyYW1ldGVyID0gc2FtcGxlX2dyb3Vwc19pbmZvW2tdLmdyb3VwaW5nX3R5cGVfcGFyYW1ldGVyOwogICAgCQkJCWlmIChzYW1wbGVfbnVtYmVyID49IHNhbXBsZV9ncm91cHNfaW5mb1trXS5sYXN0X3NhbXBsZV9pbl9ydW4pIHsKICAgIAkJCQkJaWYgKHNhbXBsZV9ncm91cHNfaW5mb1trXS5sYXN0X3NhbXBsZV9pbl9ydW4gPCAwKSB7CiAgICAJCQkJCQlzYW1wbGVfZ3JvdXBzX2luZm9ba10ubGFzdF9zYW1wbGVfaW5fcnVuID0gMDsKICAgIAkJCQkJfQogICAgCQkJCQlzYW1wbGVfZ3JvdXBzX2luZm9ba10uZW50cnlfaW5kZXgrKzsJCiAgICAJCQkJCWlmIChzYW1wbGVfZ3JvdXBzX2luZm9ba10uZW50cnlfaW5kZXggPD0gc2FtcGxlX2dyb3Vwc19pbmZvW2tdLnNiZ3AuZW50cmllcy5sZW5ndGggLSAxKSB7CiAgICAJCQkJCQlzYW1wbGVfZ3JvdXBzX2luZm9ba10ubGFzdF9zYW1wbGVfaW5fcnVuICs9IHNhbXBsZV9ncm91cHNfaW5mb1trXS5zYmdwLmVudHJpZXNbc2FtcGxlX2dyb3Vwc19pbmZvW2tdLmVudHJ5X2luZGV4XS5zYW1wbGVfY291bnQ7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQkJaWYgKHNhbXBsZV9ncm91cHNfaW5mb1trXS5lbnRyeV9pbmRleCA8PSBzYW1wbGVfZ3JvdXBzX2luZm9ba10uc2JncC5lbnRyaWVzLmxlbmd0aCAtIDEpIHsKICAgIAkJCQkJc2FtcGxlLnNhbXBsZV9ncm91cHNba10uZ3JvdXBfZGVzY3JpcHRpb25faW5kZXggPSBzYW1wbGVfZ3JvdXBzX2luZm9ba10uc2JncC5lbnRyaWVzW3NhbXBsZV9ncm91cHNfaW5mb1trXS5lbnRyeV9pbmRleF0uZ3JvdXBfZGVzY3JpcHRpb25faW5kZXg7CiAgICAJCQkJfSBlbHNlIHsKICAgIAkJCQkJc2FtcGxlLnNhbXBsZV9ncm91cHNba10uZ3JvdXBfZGVzY3JpcHRpb25faW5kZXggPSAtMTsgLy8gc3BlY2lhbCB2YWx1ZSBmb3Igbm90IGRlZmluZWQKICAgIAkJCQl9CiAgICAJCQkJaWYgKHNhbXBsZS5zYW1wbGVfZ3JvdXBzW2tdLmdyb3VwX2Rlc2NyaXB0aW9uX2luZGV4ICE9PSAwKSB7CiAgICAJCQkJCXZhciBkZXNjcmlwdGlvbjsKICAgIAkJCQkJaWYgKHNhbXBsZV9ncm91cHNfaW5mb1trXS5mcmFnbWVudF9kZXNjcmlwdGlvbikgewogICAgCQkJCQkJZGVzY3JpcHRpb24gPSBzYW1wbGVfZ3JvdXBzX2luZm9ba10uZnJhZ21lbnRfZGVzY3JpcHRpb247CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQlkZXNjcmlwdGlvbiA9IHNhbXBsZV9ncm91cHNfaW5mb1trXS5kZXNjcmlwdGlvbjsKICAgIAkJCQkJfQogICAgCQkJCQlpZiAoc2FtcGxlLnNhbXBsZV9ncm91cHNba10uZ3JvdXBfZGVzY3JpcHRpb25faW5kZXggPiAwKSB7CiAgICAJCQkJCQlpZiAoc2FtcGxlLnNhbXBsZV9ncm91cHNba10uZ3JvdXBfZGVzY3JpcHRpb25faW5kZXggPiA2NTUzNSkgewogICAgCQkJCQkJCWluZGV4ID0gKHNhbXBsZS5zYW1wbGVfZ3JvdXBzW2tdLmdyb3VwX2Rlc2NyaXB0aW9uX2luZGV4ID4+IDE2KS0xOwogICAgCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQlpbmRleCA9IHNhbXBsZS5zYW1wbGVfZ3JvdXBzW2tdLmdyb3VwX2Rlc2NyaXB0aW9uX2luZGV4LTE7CiAgICAJCQkJCQl9CiAgICAJCQkJCQlpZiAoZGVzY3JpcHRpb24gJiYgaW5kZXggPj0gMCkgewogICAgCQkJCQkJCXNhbXBsZS5zYW1wbGVfZ3JvdXBzW2tdLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24uZW50cmllc1tpbmRleF07CiAgICAJCQkJCQl9CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQlpZiAoZGVzY3JpcHRpb24gJiYgZGVzY3JpcHRpb24udmVyc2lvbiA+PSAyKSB7CiAgICAJCQkJCQkJaWYgKGRlc2NyaXB0aW9uLmRlZmF1bHRfZ3JvdXBfZGVzY3JpcHRpb25faW5kZXggPiAwKSB7CQkJCQkJCQkKICAgIAkJCQkJCQkJc2FtcGxlLnNhbXBsZV9ncm91cHNba10uZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5lbnRyaWVzW2Rlc2NyaXB0aW9uLmRlZmF1bHRfZ3JvdXBfZGVzY3JpcHRpb25faW5kZXgtMV07CiAgICAJCQkJCQkJfQogICAgCQkJCQkJfQogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJfQogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm9jZXNzX3NkdHAgPSBmdW5jdGlvbiAoc2R0cCwgc2FtcGxlLCBudW1iZXIpIHsKICAgIAkJCWlmICghc2FtcGxlKSB7CiAgICAJCQkJcmV0dXJuOwogICAgCQkJfQogICAgCQkJaWYgKHNkdHApIHsKICAgIAkJCQlzYW1wbGUuaXNfbGVhZGluZyA9IHNkdHAuaXNfbGVhZGluZ1tudW1iZXJdOwogICAgCQkJCXNhbXBsZS5kZXBlbmRzX29uID0gc2R0cC5zYW1wbGVfZGVwZW5kc19vbltudW1iZXJdOwogICAgCQkJCXNhbXBsZS5pc19kZXBlbmRlZF9vbiA9IHNkdHAuc2FtcGxlX2lzX2RlcGVuZGVkX29uW251bWJlcl07CiAgICAJCQkJc2FtcGxlLmhhc19yZWR1bmRhbmN5ID0gc2R0cC5zYW1wbGVfaGFzX3JlZHVuZGFuY3lbbnVtYmVyXTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJc2FtcGxlLmlzX2xlYWRpbmcgPSAwOwogICAgCQkJCXNhbXBsZS5kZXBlbmRzX29uID0gMDsKICAgIAkJCQlzYW1wbGUuaXNfZGVwZW5kZWRfb24gPSAwOwogICAgCQkJCXNhbXBsZS5oYXNfcmVkdW5kYW5jeSA9IDA7CiAgICAJCQl9CQogICAgCQl9OwoKICAgIAkJLyogQnVpbGQgaW5pdGlhbCBzYW1wbGUgbGlzdCBmcm9tICBzYW1wbGUgdGFibGVzICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmJ1aWxkU2FtcGxlTGlzdHMgPSBmdW5jdGlvbigpIHsJCiAgICAJCQl2YXIgaTsKICAgIAkJCXZhciB0cmFrOwogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMubW9vdi50cmFrcy5sZW5ndGg7IGkrKykgewogICAgCQkJCXRyYWsgPSB0aGlzLm1vb3YudHJha3NbaV07CiAgICAJCQkJdGhpcy5idWlsZFRyYWtTYW1wbGVMaXN0cyh0cmFrKTsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmJ1aWxkVHJha1NhbXBsZUxpc3RzID0gZnVuY3Rpb24odHJhaykgewkKICAgIAkJCXZhciBqOwogICAgCQkJdmFyIHN0Y28sIHN0c2MsIHN0c3osIHN0dHMsIGN0dHMsIHN0c3MsIHN0c2QsIHN1YnMsIHNiZ3BzLCBzZ3Bkcywgc3RkcDsKICAgIAkJCXZhciBjaHVua19ydW5faW5kZXgsIGNodW5rX2luZGV4LCBsYXN0X2NodW5rX2luX3J1biwgb2Zmc2V0X2luX2NodW5rLCBsYXN0X3NhbXBsZV9pbl9jaHVuazsKICAgIAkJCXZhciBsYXN0X3NhbXBsZV9pbl9zdHRzX3J1biwgc3R0c19ydW5faW5kZXgsIGxhc3Rfc2FtcGxlX2luX2N0dHNfcnVuLCBjdHRzX3J1bl9pbmRleCwgbGFzdF9zdHNzX2luZGV4LCBzdWJzX2VudHJ5X2luZGV4LCBsYXN0X3N1YnNfc2FtcGxlX2luZGV4OwoKICAgIAkJCXRyYWsuc2FtcGxlcyA9IFtdOwogICAgCQkJdHJhay5zYW1wbGVzX2R1cmF0aW9uID0gMDsKICAgIAkJCXRyYWsuc2FtcGxlc19zaXplID0gMDsKICAgIAkJCXN0Y28gPSB0cmFrLm1kaWEubWluZi5zdGJsLnN0Y28gfHwgdHJhay5tZGlhLm1pbmYuc3RibC5jbzY0OwogICAgCQkJc3RzYyA9IHRyYWsubWRpYS5taW5mLnN0Ymwuc3RzYzsKICAgIAkJCXN0c3ogPSB0cmFrLm1kaWEubWluZi5zdGJsLnN0c3ogfHwgdHJhay5tZGlhLm1pbmYuc3RibC5zdHoyOwogICAgCQkJc3R0cyA9IHRyYWsubWRpYS5taW5mLnN0Ymwuc3R0czsKICAgIAkJCWN0dHMgPSB0cmFrLm1kaWEubWluZi5zdGJsLmN0dHM7CiAgICAJCQlzdHNzID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHNzOwogICAgCQkJc3RzZCA9IHRyYWsubWRpYS5taW5mLnN0Ymwuc3RzZDsKICAgIAkJCXN1YnMgPSB0cmFrLm1kaWEubWluZi5zdGJsLnN1YnM7CiAgICAJCQlzdGRwID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdGRwOwogICAgCQkJc2JncHMgPSB0cmFrLm1kaWEubWluZi5zdGJsLnNiZ3BzOwogICAgCQkJc2dwZHMgPSB0cmFrLm1kaWEubWluZi5zdGJsLnNncGRzOwogICAgCQkJCiAgICAJCQlsYXN0X3NhbXBsZV9pbl9zdHRzX3J1biA9IC0xOwogICAgCQkJc3R0c19ydW5faW5kZXggPSAtMTsKICAgIAkJCWxhc3Rfc2FtcGxlX2luX2N0dHNfcnVuID0gLTE7CiAgICAJCQljdHRzX3J1bl9pbmRleCA9IC0xOwogICAgCQkJbGFzdF9zdHNzX2luZGV4ID0gMDsKICAgIAkJCXN1YnNfZW50cnlfaW5kZXggPSAwOwogICAgCQkJbGFzdF9zdWJzX3NhbXBsZV9pbmRleCA9IDA7CQkKCiAgICAJCQlJU09GaWxlLmluaXRTYW1wbGVHcm91cHModHJhaywgbnVsbCwgc2JncHMsIHNncGRzKTsKCiAgICAJCQlpZiAodHlwZW9mIHN0c3ogPT09ICJ1bmRlZmluZWQiKSB7CiAgICAJCQkJcmV0dXJuOwogICAgCQkJfQoKICAgIAkJCS8qIHdlIGJ1aWxkIHRoZSBzYW1wbGVzIG9uZSBieSBvbmUgYW5kIGNvbXB1dGUgdGhlaXIgcHJvcGVydGllcyAqLwogICAgCQkJZm9yIChqID0gMDsgaiA8IHN0c3ouc2FtcGxlX3NpemVzLmxlbmd0aDsgaisrKSB7CiAgICAJCQkJdmFyIHNhbXBsZSA9IHt9OwogICAgCQkJCXNhbXBsZS5udW1iZXIgPSBqOwogICAgCQkJCXNhbXBsZS50cmFja19pZCA9IHRyYWsudGtoZC50cmFja19pZDsKICAgIAkJCQlzYW1wbGUudGltZXNjYWxlID0gdHJhay5tZGlhLm1kaGQudGltZXNjYWxlOwogICAgCQkJCXNhbXBsZS5hbHJlYWR5UmVhZCA9IDA7CiAgICAJCQkJdHJhay5zYW1wbGVzW2pdID0gc2FtcGxlOwogICAgCQkJCS8qIHNpemUgY2FuIGJlIGtub3duIGRpcmVjdGx5ICovCiAgICAJCQkJc2FtcGxlLnNpemUgPSBzdHN6LnNhbXBsZV9zaXplc1tqXTsKICAgIAkJCQl0cmFrLnNhbXBsZXNfc2l6ZSArPSBzYW1wbGUuc2l6ZTsKICAgIAkJCQkvKiBjb21wdXRpbmcgY2h1bmstYmFzZWQgcHJvcGVydGllcyAob2Zmc2V0LCBzYW1wbGUgZGVzY3JpcHRpb24gaW5kZXgpKi8KICAgIAkJCQlpZiAoaiA9PT0gMCkgewkJCQkKICAgIAkJCQkJY2h1bmtfaW5kZXggPSAxOyAvKiB0aGUgZmlyc3Qgc2FtcGxlIGlzIGluIHRoZSBmaXJzdCBjaHVuayAoY2h1bmsgaW5kZXhlcyBhcmUgMS1iYXNlZCkgKi8KICAgIAkJCQkJY2h1bmtfcnVuX2luZGV4ID0gMDsgLyogdGhlIGZpcnN0IGNodW5rIGlzIHRoZSBmaXJzdCBlbnRyeSBpbiB0aGUgZmlyc3RfY2h1bmsgdGFibGUgKi8KICAgIAkJCQkJc2FtcGxlLmNodW5rX2luZGV4ID0gY2h1bmtfaW5kZXg7CiAgICAJCQkJCXNhbXBsZS5jaHVua19ydW5faW5kZXggPSBjaHVua19ydW5faW5kZXg7CiAgICAJCQkJCWxhc3Rfc2FtcGxlX2luX2NodW5rID0gc3RzYy5zYW1wbGVzX3Blcl9jaHVua1tjaHVua19ydW5faW5kZXhdOwogICAgCQkJCQlvZmZzZXRfaW5fY2h1bmsgPSAwOwoKICAgIAkJCQkJLyogSXMgdGhlcmUgYW5vdGhlciBlbnRyeSBpbiB0aGUgZmlyc3RfY2h1bmsgdGFibGUgPyAqLwogICAgCQkJCQlpZiAoY2h1bmtfcnVuX2luZGV4ICsgMSA8IHN0c2MuZmlyc3RfY2h1bmsubGVuZ3RoKSB7CiAgICAJCQkJCQkvKiBUaGUgbGFzdCBjaHVuayBpbiB0aGUgcnVuIGlzIHRoZSBjaHVuayBiZWZvcmUgdGhlIG5leHQgZmlyc3QgY2h1bmsgKi8KICAgIAkJCQkJCWxhc3RfY2h1bmtfaW5fcnVuID0gc3RzYy5maXJzdF9jaHVua1tjaHVua19ydW5faW5kZXgrMV0tMTsgCQogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJLyogVGhlcmUgaXMgb25seSBvbmUgZW50cnkgaW4gdGhlIHRhYmxlLCBpdCBpcyB2YWxpZCBmb3IgYWxsIGZ1dHVyZSBjaHVua3MqLwogICAgCQkJCQkJbGFzdF9jaHVua19pbl9ydW4gPSBJbmZpbml0eTsKICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCWlmIChqIDwgbGFzdF9zYW1wbGVfaW5fY2h1bmspIHsKICAgIAkJCQkJCS8qIHRoZSBzYW1wbGUgaXMgc3RpbGwgaW4gdGhlIGN1cnJlbnQgY2h1bmsgKi8KICAgIAkJCQkJCXNhbXBsZS5jaHVua19pbmRleCA9IGNodW5rX2luZGV4OwogICAgCQkJCQkJc2FtcGxlLmNodW5rX3J1bl9pbmRleCA9IGNodW5rX3J1bl9pbmRleDsKICAgIAkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCS8qIHRoZSBzYW1wbGUgaXMgaW4gdGhlIG5leHQgY2h1bmsgKi8KICAgIAkJCQkJCWNodW5rX2luZGV4Kys7CiAgICAJCQkJCQlzYW1wbGUuY2h1bmtfaW5kZXggPSBjaHVua19pbmRleDsKICAgIAkJCQkJCS8qIHJlc2V0IHRoZSBhY2N1bXVsYXRlZCBvZmZzZXQgaW4gdGhlIGNodW5rICovCiAgICAJCQkJCQlvZmZzZXRfaW5fY2h1bmsgPSAwOwogICAgCQkJCQkJaWYgKGNodW5rX2luZGV4IDw9IGxhc3RfY2h1bmtfaW5fcnVuKSA7IGVsc2UgewogICAgCQkJCQkJCWNodW5rX3J1bl9pbmRleCsrOwogICAgCQkJCQkJCS8qIElzIHRoZXJlIGFub3RoZXIgZW50cnkgaW4gdGhlIGZpcnN0X2NodW5rIHRhYmxlID8gKi8KICAgIAkJCQkJCQlpZiAoY2h1bmtfcnVuX2luZGV4ICsgMSA8IHN0c2MuZmlyc3RfY2h1bmsubGVuZ3RoKSB7CiAgICAJCQkJCQkJCS8qIFRoZSBsYXN0IGNodW5rIGluIHRoZSBydW4gaXMgdGhlIGNodW5rIGJlZm9yZSB0aGUgbmV4dCBmaXJzdCBjaHVuayAqLwogICAgCQkJCQkJCQlsYXN0X2NodW5rX2luX3J1biA9IHN0c2MuZmlyc3RfY2h1bmtbY2h1bmtfcnVuX2luZGV4KzFdLTE7IAkKICAgIAkJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCQkvKiBUaGVyZSBpcyBvbmx5IG9uZSBlbnRyeSBpbiB0aGUgdGFibGUsIGl0IGlzIHZhbGlkIGZvciBhbGwgZnV0dXJlIGNodW5rcyovCiAgICAJCQkJCQkJCWxhc3RfY2h1bmtfaW5fcnVuID0gSW5maW5pdHk7CiAgICAJCQkJCQkJfQogICAgCQkJCQkJCQogICAgCQkJCQkJfQogICAgCQkJCQkJc2FtcGxlLmNodW5rX3J1bl9pbmRleCA9IGNodW5rX3J1bl9pbmRleDsKICAgIAkJCQkJCWxhc3Rfc2FtcGxlX2luX2NodW5rICs9IHN0c2Muc2FtcGxlc19wZXJfY2h1bmtbY2h1bmtfcnVuX2luZGV4XTsKICAgIAkJCQkJfQogICAgCQkJCX0KCiAgICAJCQkJc2FtcGxlLmRlc2NyaXB0aW9uX2luZGV4ID0gc3RzYy5zYW1wbGVfZGVzY3JpcHRpb25faW5kZXhbc2FtcGxlLmNodW5rX3J1bl9pbmRleF0tMTsKICAgIAkJCQlzYW1wbGUuZGVzY3JpcHRpb24gPSBzdHNkLmVudHJpZXNbc2FtcGxlLmRlc2NyaXB0aW9uX2luZGV4XTsKICAgIAkJCQlzYW1wbGUub2Zmc2V0ID0gc3Rjby5jaHVua19vZmZzZXRzW3NhbXBsZS5jaHVua19pbmRleC0xXSArIG9mZnNldF9pbl9jaHVuazsgLyogY2h1bmsgaW5kZXhlcyBhcmUgMS1iYXNlZCAqLwogICAgCQkJCW9mZnNldF9pbl9jaHVuayArPSBzYW1wbGUuc2l6ZTsKCiAgICAJCQkJLyogc2V0dGluZyBkdHMsIGN0cywgZHVyYXRpb24gYW5kIHJhcCBmbGFncyAqLwogICAgCQkJCWlmIChqID4gbGFzdF9zYW1wbGVfaW5fc3R0c19ydW4pIHsKICAgIAkJCQkJc3R0c19ydW5faW5kZXgrKzsKICAgIAkJCQkJaWYgKGxhc3Rfc2FtcGxlX2luX3N0dHNfcnVuIDwgMCkgewogICAgCQkJCQkJbGFzdF9zYW1wbGVfaW5fc3R0c19ydW4gPSAwOwogICAgCQkJCQl9CiAgICAJCQkJCWxhc3Rfc2FtcGxlX2luX3N0dHNfcnVuICs9IHN0dHMuc2FtcGxlX2NvdW50c1tzdHRzX3J1bl9pbmRleF07CQkJCQogICAgCQkJCX0KICAgIAkJCQlpZiAoaiA+IDApIHsKICAgIAkJCQkJdHJhay5zYW1wbGVzW2otMV0uZHVyYXRpb24gPSBzdHRzLnNhbXBsZV9kZWx0YXNbc3R0c19ydW5faW5kZXhdOwogICAgCQkJCQl0cmFrLnNhbXBsZXNfZHVyYXRpb24gKz0gdHJhay5zYW1wbGVzW2otMV0uZHVyYXRpb247CiAgICAJCQkJCXNhbXBsZS5kdHMgPSB0cmFrLnNhbXBsZXNbai0xXS5kdHMgKyB0cmFrLnNhbXBsZXNbai0xXS5kdXJhdGlvbjsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlzYW1wbGUuZHRzID0gMDsKICAgIAkJCQl9CiAgICAJCQkJaWYgKGN0dHMpIHsKICAgIAkJCQkJaWYgKGogPj0gbGFzdF9zYW1wbGVfaW5fY3R0c19ydW4pIHsKICAgIAkJCQkJCWN0dHNfcnVuX2luZGV4Kys7CiAgICAJCQkJCQlpZiAobGFzdF9zYW1wbGVfaW5fY3R0c19ydW4gPCAwKSB7CiAgICAJCQkJCQkJbGFzdF9zYW1wbGVfaW5fY3R0c19ydW4gPSAwOwogICAgCQkJCQkJfQogICAgCQkJCQkJbGFzdF9zYW1wbGVfaW5fY3R0c19ydW4gKz0gY3R0cy5zYW1wbGVfY291bnRzW2N0dHNfcnVuX2luZGV4XTsJCQkJCiAgICAJCQkJCX0KICAgIAkJCQkJc2FtcGxlLmN0cyA9IHRyYWsuc2FtcGxlc1tqXS5kdHMgKyBjdHRzLnNhbXBsZV9vZmZzZXRzW2N0dHNfcnVuX2luZGV4XTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlzYW1wbGUuY3RzID0gc2FtcGxlLmR0czsKICAgIAkJCQl9CiAgICAJCQkJaWYgKHN0c3MpIHsKICAgIAkJCQkJaWYgKGogPT0gc3Rzcy5zYW1wbGVfbnVtYmVyc1tsYXN0X3N0c3NfaW5kZXhdIC0gMSkgeyAvLyBzYW1wbGUgbnVtYmVycyBhcmUgMS1iYXNlZAogICAgCQkJCQkJc2FtcGxlLmlzX3N5bmMgPSB0cnVlOwogICAgCQkJCQkJbGFzdF9zdHNzX2luZGV4Kys7CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQlzYW1wbGUuaXNfc3luYyA9IGZhbHNlOwkJCQkKICAgIAkJCQkJCXNhbXBsZS5kZWdyYWRhdGlvbl9wcmlvcml0eSA9IDA7CiAgICAJCQkJCX0KICAgIAkJCQkJaWYgKHN1YnMpIHsKICAgIAkJCQkJCWlmIChzdWJzLmVudHJpZXNbc3Vic19lbnRyeV9pbmRleF0uc2FtcGxlX2RlbHRhICsgbGFzdF9zdWJzX3NhbXBsZV9pbmRleCA9PSBqKzEpIHsKICAgIAkJCQkJCQlzYW1wbGUuc3Vic2FtcGxlcyA9IHN1YnMuZW50cmllc1tzdWJzX2VudHJ5X2luZGV4XS5zdWJzYW1wbGVzOwogICAgCQkJCQkJCWxhc3Rfc3Vic19zYW1wbGVfaW5kZXggKz0gc3Vicy5lbnRyaWVzW3N1YnNfZW50cnlfaW5kZXhdLnNhbXBsZV9kZWx0YTsKICAgIAkJCQkJCQlzdWJzX2VudHJ5X2luZGV4Kys7CiAgICAJCQkJCQl9CiAgICAJCQkJCX0KICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQlzYW1wbGUuaXNfc3luYyA9IHRydWU7CiAgICAJCQkJfQogICAgCQkJCUlTT0ZpbGUucHJvY2Vzc19zZHRwKHRyYWsubWRpYS5taW5mLnN0Ymwuc2R0cCwgc2FtcGxlLCBzYW1wbGUubnVtYmVyKTsKICAgIAkJCQlpZiAoc3RkcCkgewogICAgCQkJCQlzYW1wbGUuZGVncmFkYXRpb25fcHJpb3JpdHkgPSBzdGRwLnByaW9yaXR5W2pdOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXNhbXBsZS5kZWdyYWRhdGlvbl9wcmlvcml0eSA9IDA7CiAgICAJCQkJfQogICAgCQkJCWlmIChzdWJzKSB7CiAgICAJCQkJCWlmIChzdWJzLmVudHJpZXNbc3Vic19lbnRyeV9pbmRleF0uc2FtcGxlX2RlbHRhICsgbGFzdF9zdWJzX3NhbXBsZV9pbmRleCA9PSBqKSB7CiAgICAJCQkJCQlzYW1wbGUuc3Vic2FtcGxlcyA9IHN1YnMuZW50cmllc1tzdWJzX2VudHJ5X2luZGV4XS5zdWJzYW1wbGVzOwogICAgCQkJCQkJbGFzdF9zdWJzX3NhbXBsZV9pbmRleCArPSBzdWJzLmVudHJpZXNbc3Vic19lbnRyeV9pbmRleF0uc2FtcGxlX2RlbHRhOwogICAgCQkJCQl9CiAgICAJCQkJfQogICAgCQkJCWlmIChzYmdwcy5sZW5ndGggPiAwIHx8IHNncGRzLmxlbmd0aCA+IDApIHsKICAgIAkJCQkJSVNPRmlsZS5zZXRTYW1wbGVHcm91cFByb3BlcnRpZXModHJhaywgc2FtcGxlLCBqLCB0cmFrLnNhbXBsZV9ncm91cHNfaW5mbyk7CiAgICAJCQkJfQogICAgCQkJfQogICAgCQkJaWYgKGo+MCkgewogICAgCQkJCXRyYWsuc2FtcGxlc1tqLTFdLmR1cmF0aW9uID0gTWF0aC5tYXgodHJhay5tZGlhLm1kaGQuZHVyYXRpb24gLSB0cmFrLnNhbXBsZXNbai0xXS5kdHMsIDApOwogICAgCQkJCXRyYWsuc2FtcGxlc19kdXJhdGlvbiArPSB0cmFrLnNhbXBsZXNbai0xXS5kdXJhdGlvbjsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8qIFVwZGF0ZSBzYW1wbGUgbGlzdCB3aGVuIG5ldyAnbW9vZicgYm94ZXMgYXJlIHJlY2VpdmVkICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnVwZGF0ZVNhbXBsZUxpc3RzID0gZnVuY3Rpb24oKSB7CQogICAgCQkJdmFyIGksIGosIGs7CiAgICAJCQl2YXIgZGVmYXVsdF9zYW1wbGVfZGVzY3JpcHRpb25faW5kZXgsIGRlZmF1bHRfc2FtcGxlX2R1cmF0aW9uLCBkZWZhdWx0X3NhbXBsZV9zaXplLCBkZWZhdWx0X3NhbXBsZV9mbGFnczsKICAgIAkJCXZhciBsYXN0X3J1bl9wb3NpdGlvbjsKICAgIAkJCXZhciBib3gsIG1vb2YsIHRyYWYsIHRyYWssIHRyZXg7CiAgICAJCQl2YXIgc2FtcGxlOwogICAgCQkJdmFyIHNhbXBsZV9mbGFnczsKICAgIAkJCQogICAgCQkJaWYgKHRoaXMubW9vdiA9PT0gdW5kZWZpbmVkKSB7CiAgICAJCQkJcmV0dXJuOwogICAgCQkJfQogICAgCQkJLyogaWYgdGhlIGlucHV0IGZpbGUgaXMgZnJhZ21lbnRlZCBhbmQgZmV0Y2hlZCBpbiBtdWx0aXBsZSBkb3dubG9hZHMsIHdlIG5lZWQgdG8gdXBkYXRlIHRoZSBsaXN0IG9mIHNhbXBsZXMgKi8KICAgIAkJCXdoaWxlICh0aGlzLmxhc3RNb29mSW5kZXggPCB0aGlzLm1vb2ZzLmxlbmd0aCkgewogICAgCQkJCWJveCA9IHRoaXMubW9vZnNbdGhpcy5sYXN0TW9vZkluZGV4XTsKICAgIAkJCQl0aGlzLmxhc3RNb29mSW5kZXgrKzsKICAgIAkJCQlpZiAoYm94LnR5cGUgPT0gIm1vb2YiKSB7CiAgICAJCQkJCW1vb2YgPSBib3g7CiAgICAJCQkJCWZvciAoaSA9IDA7IGkgPCBtb29mLnRyYWZzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJCQl0cmFmID0gbW9vZi50cmFmc1tpXTsKICAgIAkJCQkJCXRyYWsgPSB0aGlzLmdldFRyYWNrQnlJZCh0cmFmLnRmaGQudHJhY2tfaWQpOwogICAgCQkJCQkJdHJleCA9IHRoaXMuZ2V0VHJleEJ5SWQodHJhZi50ZmhkLnRyYWNrX2lkKTsKICAgIAkJCQkJCWlmICh0cmFmLnRmaGQuZmxhZ3MgJiBCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9ERVNDKSB7CiAgICAJCQkJCQkJZGVmYXVsdF9zYW1wbGVfZGVzY3JpcHRpb25faW5kZXggPSB0cmFmLnRmaGQuZGVmYXVsdF9zYW1wbGVfZGVzY3JpcHRpb25faW5kZXg7CiAgICAJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCWRlZmF1bHRfc2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4ID0gKHRyZXggPyB0cmV4LmRlZmF1bHRfc2FtcGxlX2Rlc2NyaXB0aW9uX2luZGV4OiAxKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWlmICh0cmFmLnRmaGQuZmxhZ3MgJiBCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9EVVIpIHsKICAgIAkJCQkJCQlkZWZhdWx0X3NhbXBsZV9kdXJhdGlvbiA9IHRyYWYudGZoZC5kZWZhdWx0X3NhbXBsZV9kdXJhdGlvbjsKICAgIAkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJZGVmYXVsdF9zYW1wbGVfZHVyYXRpb24gPSAodHJleCA/IHRyZXguZGVmYXVsdF9zYW1wbGVfZHVyYXRpb24gOiAwKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWlmICh0cmFmLnRmaGQuZmxhZ3MgJiBCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9TSVpFKSB7CiAgICAJCQkJCQkJZGVmYXVsdF9zYW1wbGVfc2l6ZSA9IHRyYWYudGZoZC5kZWZhdWx0X3NhbXBsZV9zaXplOwogICAgCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQlkZWZhdWx0X3NhbXBsZV9zaXplID0gKHRyZXggPyB0cmV4LmRlZmF1bHRfc2FtcGxlX3NpemUgOiAwKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWlmICh0cmFmLnRmaGQuZmxhZ3MgJiBCb3hQYXJzZXIuVEZIRF9GTEFHX1NBTVBMRV9GTEFHUykgewogICAgCQkJCQkJCWRlZmF1bHRfc2FtcGxlX2ZsYWdzID0gdHJhZi50ZmhkLmRlZmF1bHRfc2FtcGxlX2ZsYWdzOwogICAgCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQlkZWZhdWx0X3NhbXBsZV9mbGFncyA9ICh0cmV4ID8gdHJleC5kZWZhdWx0X3NhbXBsZV9mbGFncyA6IDApOwogICAgCQkJCQkJfQogICAgCQkJCQkJdHJhZi5zYW1wbGVfbnVtYmVyID0gMDsKICAgIAkJCQkJCS8qIHByb2Nlc3Mgc2FtcGxlIGdyb3VwcyAqLwogICAgCQkJCQkJaWYgKHRyYWYuc2JncHMubGVuZ3RoID4gMCkgewogICAgCQkJCQkJCUlTT0ZpbGUuaW5pdFNhbXBsZUdyb3Vwcyh0cmFrLCB0cmFmLCB0cmFmLnNiZ3BzLCB0cmFrLm1kaWEubWluZi5zdGJsLnNncGRzLCB0cmFmLnNncGRzKTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWZvciAoaiA9IDA7IGogPCB0cmFmLnRydW5zLmxlbmd0aDsgaisrKSB7CiAgICAJCQkJCQkJdmFyIHRydW4gPSB0cmFmLnRydW5zW2pdOwogICAgCQkJCQkJCWZvciAoayA9IDA7IGsgPCB0cnVuLnNhbXBsZV9jb3VudDsgaysrKSB7CiAgICAJCQkJCQkJCXNhbXBsZSA9IHt9OwogICAgCQkJCQkJCQlzYW1wbGUubW9vZl9udW1iZXIgPSB0aGlzLmxhc3RNb29mSW5kZXg7CiAgICAJCQkJCQkJCXNhbXBsZS5udW1iZXJfaW5fdHJhZiA9IHRyYWYuc2FtcGxlX251bWJlcjsKICAgIAkJCQkJCQkJdHJhZi5zYW1wbGVfbnVtYmVyKys7CiAgICAJCQkJCSAgICAgICAgICAgIHNhbXBsZS5udW1iZXIgPSB0cmFrLnNhbXBsZXMubGVuZ3RoOwogICAgCQkJCQkJCQl0cmFmLmZpcnN0X3NhbXBsZV9pbmRleCA9IHRyYWsuc2FtcGxlcy5sZW5ndGg7CiAgICAJCQkJCQkJCXRyYWsuc2FtcGxlcy5wdXNoKHNhbXBsZSk7CiAgICAJCQkJCQkJCXNhbXBsZS50cmFja19pZCA9IHRyYWsudGtoZC50cmFja19pZDsKICAgIAkJCQkJCQkJc2FtcGxlLnRpbWVzY2FsZSA9IHRyYWsubWRpYS5tZGhkLnRpbWVzY2FsZTsKICAgIAkJCQkJCQkJc2FtcGxlLmRlc2NyaXB0aW9uX2luZGV4ID0gZGVmYXVsdF9zYW1wbGVfZGVzY3JpcHRpb25faW5kZXgtMTsKICAgIAkJCQkJCQkJc2FtcGxlLmRlc2NyaXB0aW9uID0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbc2FtcGxlLmRlc2NyaXB0aW9uX2luZGV4XTsKICAgIAkJCQkJCQkJc2FtcGxlLnNpemUgPSBkZWZhdWx0X3NhbXBsZV9zaXplOwogICAgCQkJCQkJCQlpZiAodHJ1bi5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX1NJWkUpIHsKICAgIAkJCQkJCQkJCXNhbXBsZS5zaXplID0gdHJ1bi5zYW1wbGVfc2l6ZVtrXTsKICAgIAkJCQkJCQkJfQogICAgCQkJCQkJCQl0cmFrLnNhbXBsZXNfc2l6ZSArPSBzYW1wbGUuc2l6ZTsKICAgIAkJCQkJCQkJc2FtcGxlLmR1cmF0aW9uID0gZGVmYXVsdF9zYW1wbGVfZHVyYXRpb247CiAgICAJCQkJCQkJCWlmICh0cnVuLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfRFVSQVRJT04pIHsKICAgIAkJCQkJCQkJCXNhbXBsZS5kdXJhdGlvbiA9IHRydW4uc2FtcGxlX2R1cmF0aW9uW2tdOwogICAgCQkJCQkJCQl9CiAgICAJCQkJCQkJCXRyYWsuc2FtcGxlc19kdXJhdGlvbiArPSBzYW1wbGUuZHVyYXRpb247CiAgICAJCQkJCQkJCWlmICh0cmFrLmZpcnN0X3RyYWZfbWVyZ2VkIHx8IGsgPiAwKSB7CiAgICAJCQkJCQkJCQlzYW1wbGUuZHRzID0gdHJhay5zYW1wbGVzW3RyYWsuc2FtcGxlcy5sZW5ndGgtMl0uZHRzK3RyYWsuc2FtcGxlc1t0cmFrLnNhbXBsZXMubGVuZ3RoLTJdLmR1cmF0aW9uOwogICAgCQkJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCQkJaWYgKHRyYWYudGZkdCkgewogICAgCQkJCQkJCQkJCXNhbXBsZS5kdHMgPSB0cmFmLnRmZHQuYmFzZU1lZGlhRGVjb2RlVGltZTsKICAgIAkJCQkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJCQkJc2FtcGxlLmR0cyA9IDA7CiAgICAJCQkJCQkJCQl9CiAgICAJCQkJCQkJCQl0cmFrLmZpcnN0X3RyYWZfbWVyZ2VkID0gdHJ1ZTsKICAgIAkJCQkJCQkJfQogICAgCQkJCQkJCQlzYW1wbGUuY3RzID0gc2FtcGxlLmR0czsKICAgIAkJCQkJCQkJaWYgKHRydW4uZmxhZ3MgJiBCb3hQYXJzZXIuVFJVTl9GTEFHU19DVFNfT0ZGU0VUKSB7CiAgICAJCQkJCQkJCQlzYW1wbGUuY3RzID0gc2FtcGxlLmR0cyArIHRydW4uc2FtcGxlX2NvbXBvc2l0aW9uX3RpbWVfb2Zmc2V0W2tdOwogICAgCQkJCQkJCQl9CiAgICAJCQkJCQkJCXNhbXBsZV9mbGFncyA9IGRlZmF1bHRfc2FtcGxlX2ZsYWdzOwogICAgCQkJCQkJCQlpZiAodHJ1bi5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX0ZMQUdTKSB7CiAgICAJCQkJCQkJCQlzYW1wbGVfZmxhZ3MgPSB0cnVuLnNhbXBsZV9mbGFnc1trXTsKICAgIAkJCQkJCQkJfSBlbHNlIGlmIChrID09PSAwICYmICh0cnVuLmZsYWdzICYgQm94UGFyc2VyLlRSVU5fRkxBR1NfRklSU1RfRkxBRykpIHsKICAgIAkJCQkJCQkJCXNhbXBsZV9mbGFncyA9IHRydW4uZmlyc3Rfc2FtcGxlX2ZsYWdzOwogICAgCQkJCQkJCQl9CiAgICAJCQkJCQkJCXNhbXBsZS5pc19zeW5jID0gKChzYW1wbGVfZmxhZ3MgPj4gMTYgJiAweDEpID8gZmFsc2UgOiB0cnVlKTsKICAgIAkJCQkJCQkJc2FtcGxlLmlzX2xlYWRpbmcgPSAoc2FtcGxlX2ZsYWdzID4+IDI2ICYgMHgzKTsKICAgIAkJCQkJCQkJc2FtcGxlLmRlcGVuZHNfb24gPSAoc2FtcGxlX2ZsYWdzID4+IDI0ICYgMHgzKTsKICAgIAkJCQkJCQkJc2FtcGxlLmlzX2RlcGVuZGVkX29uID0gKHNhbXBsZV9mbGFncyA+PiAyMiAmIDB4Myk7CiAgICAJCQkJCQkJCXNhbXBsZS5oYXNfcmVkdW5kYW5jeSA9IChzYW1wbGVfZmxhZ3MgPj4gMjAgJiAweDMpOwogICAgCQkJCQkJCQlzYW1wbGUuZGVncmFkYXRpb25fcHJpb3JpdHkgPSAoc2FtcGxlX2ZsYWdzICYgMHhGRkZGKTsKICAgIAkJCQkJCQkJLy9JU09GaWxlLnByb2Nlc3Nfc2R0cCh0cmFmLnNkdHAsIHNhbXBsZSwgc2FtcGxlLm51bWJlcl9pbl90cmFmKTsKICAgIAkJCQkJCQkJdmFyIGJkb3AgPSAodHJhZi50ZmhkLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19CQVNFX0RBVEFfT0ZGU0VUKSA/IHRydWUgOiBmYWxzZTsKICAgIAkJCQkJCQkJdmFyIGRiaW0gPSAodHJhZi50ZmhkLmZsYWdzICYgQm94UGFyc2VyLlRGSERfRkxBR19ERUZBVUxUX0JBU0VfSVNfTU9PRikgPyB0cnVlIDogZmFsc2U7CiAgICAJCQkJCQkJCXZhciBkb3AgPSAodHJ1bi5mbGFncyAmIEJveFBhcnNlci5UUlVOX0ZMQUdTX0RBVEFfT0ZGU0VUKSA/IHRydWUgOiBmYWxzZTsKICAgIAkJCQkJCQkJdmFyIGJkbyA9IDA7CiAgICAJCQkJCQkJCWlmICghYmRvcCkgewogICAgCQkJCQkJCQkJaWYgKCFkYmltKSB7CiAgICAJCQkJCQkJCQkJaWYgKGogPT09IDApIHsgLy8gdGhlIGZpcnN0IHRyYWNrIGluIHRoZSBtb3ZpZSBmcmFnbWVudAogICAgCQkJCQkJCQkJCQliZG8gPSBtb29mLnN0YXJ0OyAvLyB0aGUgcG9zaXRpb24gb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGVuY2xvc2luZyBNb3ZpZSBGcmFnbWVudCBCb3gKICAgIAkJCQkJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCQkJCQliZG8gPSBsYXN0X3J1bl9wb3NpdGlvbjsgLy8gZW5kIG9mIHRoZSBkYXRhIGRlZmluZWQgYnkgdGhlIHByZWNlZGluZyAqdHJhY2sqIChpcnJlc3BlY3RpdmUgb2YgdGhlIHRyYWNrIGlkKSBmcmFnbWVudCBpbiB0aGUgbW9vZgogICAgCQkJCQkJCQkJCX0KICAgIAkJCQkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJCQkJYmRvID0gbW9vZi5zdGFydDsKICAgIAkJCQkJCQkJCX0KICAgIAkJCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQkJCWJkbyA9IHRyYWYudGZoZC5iYXNlX2RhdGFfb2Zmc2V0OwogICAgCQkJCQkJCQl9CiAgICAJCQkJCQkJCWlmIChqID09PSAwICYmIGsgPT09IDApIHsKICAgIAkJCQkJCQkJCWlmIChkb3ApIHsKICAgIAkJCQkJCQkJCQlzYW1wbGUub2Zmc2V0ID0gYmRvICsgdHJ1bi5kYXRhX29mZnNldDsgLy8gSWYgdGhlIGRhdGEtb2Zmc2V0IGlzIHByZXNlbnQsIGl0IGlzIHJlbGF0aXZlIHRvIHRoZSBiYXNlLWRhdGEtb2Zmc2V0IGVzdGFibGlzaGVkIGluIHRoZSB0cmFjayBmcmFnbWVudCBoZWFkZXIKICAgIAkJCQkJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkJCQkJc2FtcGxlLm9mZnNldCA9IGJkbzsgLy8gdGhlIGRhdGEgZm9yIHRoaXMgcnVuIHN0YXJ0cyB0aGUgYmFzZS1kYXRhLW9mZnNldCBkZWZpbmVkIGJ5IHRoZSB0cmFjayBmcmFnbWVudCBoZWFkZXIKICAgIAkJCQkJCQkJCX0KICAgIAkJCQkJCQkJfSBlbHNlIHsKICAgIAkJCQkJCQkJCXNhbXBsZS5vZmZzZXQgPSBsYXN0X3J1bl9wb3NpdGlvbjsgLy8gdGhpcyBydW4gc3RhcnRzIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBkYXRhIG9mIHRoZSBwcmV2aW91cyBydW4KICAgIAkJCQkJCQkJfQogICAgCQkJCQkJCQlsYXN0X3J1bl9wb3NpdGlvbiA9IHNhbXBsZS5vZmZzZXQgKyBzYW1wbGUuc2l6ZTsKICAgIAkJCQkJCQkJaWYgKHRyYWYuc2JncHMubGVuZ3RoID4gMCB8fCB0cmFmLnNncGRzLmxlbmd0aCA+IDAgfHwKICAgIAkJCQkJCQkJCXRyYWsubWRpYS5taW5mLnN0Ymwuc2JncHMubGVuZ3RoID4gMCB8fCB0cmFrLm1kaWEubWluZi5zdGJsLnNncGRzLmxlbmd0aCA+IDApIHsKICAgIAkJCQkJCQkJCUlTT0ZpbGUuc2V0U2FtcGxlR3JvdXBQcm9wZXJ0aWVzKHRyYWssIHNhbXBsZSwgc2FtcGxlLm51bWJlcl9pbl90cmFmLCB0cmFmLnNhbXBsZV9ncm91cHNfaW5mbyk7CiAgICAJCQkJCQkJCX0KICAgIAkJCQkJCQl9CiAgICAJCQkJCQl9CiAgICAJCQkJCQlpZiAodHJhZi5zdWJzKSB7CiAgICAJCQkJCQkJdHJhay5oYXNfZnJhZ21lbnRfc3Vic2FtcGxlcyA9IHRydWU7CiAgICAJCQkJCQkJdmFyIHNhbXBsZV9pbmRleCA9IHRyYWYuZmlyc3Rfc2FtcGxlX2luZGV4OwogICAgCQkJCQkJCWZvciAoaiA9IDA7IGogPCB0cmFmLnN1YnMuZW50cmllcy5sZW5ndGg7IGorKykgewogICAgCQkJCQkJCQlzYW1wbGVfaW5kZXggKz0gdHJhZi5zdWJzLmVudHJpZXNbal0uc2FtcGxlX2RlbHRhOwogICAgCQkJCQkJCQlzYW1wbGUgPSB0cmFrLnNhbXBsZXNbc2FtcGxlX2luZGV4LTFdOwogICAgCQkJCQkJCQlzYW1wbGUuc3Vic2FtcGxlcyA9IHRyYWYuc3Vicy5lbnRyaWVzW2pdLnN1YnNhbXBsZXM7CiAgICAJCQkJCQkJfQkJCQkJCiAgICAJCQkJCQl9CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CQogICAgCQl9OwoKICAgIAkJLyogVHJ5IHRvIGdldCBzYW1wbGUgZGF0YSBmb3IgYSBnaXZlbiBzYW1wbGU6CiAgICAJCSAgIHJldHVybnMgbnVsbCBpZiBub3QgZm91bmQKICAgIAkJICAgcmV0dXJucyB0aGUgc2FtZSBzYW1wbGUgaWYgYWxyZWFkeSByZXF1ZXN0ZWQKICAgIAkJICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmdldFNhbXBsZSA9IGZ1bmN0aW9uKHRyYWssIHNhbXBsZU51bSkgewkKICAgIAkJCXZhciBidWZmZXI7CiAgICAJCQl2YXIgc2FtcGxlID0gdHJhay5zYW1wbGVzW3NhbXBsZU51bV07CiAgICAJCQkKICAgIAkJCWlmICghdGhpcy5tb292KSB7CiAgICAJCQkJcmV0dXJuIG51bGw7CiAgICAJCQl9CgogICAgCQkJaWYgKCFzYW1wbGUuZGF0YSkgewogICAgCQkJCS8qIE5vdCB5ZXQgZmV0Y2hlZCAqLwogICAgCQkJCXNhbXBsZS5kYXRhID0gbmV3IFVpbnQ4QXJyYXkoc2FtcGxlLnNpemUpOwogICAgCQkJCXNhbXBsZS5hbHJlYWR5UmVhZCA9IDA7CiAgICAJCQkJdGhpcy5zYW1wbGVzRGF0YVNpemUgKz0gc2FtcGxlLnNpemU7CiAgICAJCQkJTG9nLmRlYnVnKCJJU09GaWxlIiwgIkFsbG9jYXRpbmcgc2FtcGxlICMiK3NhbXBsZU51bSsiIG9uIHRyYWNrICMiK3RyYWsudGtoZC50cmFja19pZCsiIG9mIHNpemUgIitzYW1wbGUuc2l6ZSsiICh0b3RhbDogIit0aGlzLnNhbXBsZXNEYXRhU2l6ZSsiKSIpOwogICAgCQkJfSBlbHNlIGlmIChzYW1wbGUuYWxyZWFkeVJlYWQgPT0gc2FtcGxlLnNpemUpIHsKICAgIAkJCQkvKiBBbHJlYWR5IGZldGNoZWQgZW50aXJlbHkgKi8KICAgIAkJCQlyZXR1cm4gc2FtcGxlOwogICAgCQkJfQoKICAgIAkJCS8qIFRoZSBzYW1wbGUgaGFzIG9ubHkgYmVlbiBwYXJ0aWFsbHkgZmV0Y2hlZCwgd2UgbmVlZCB0byBjaGVjayBpbiBhbGwgYnVmZmVycyAqLwogICAgCQkJd2hpbGUodHJ1ZSkgewogICAgCQkJCXZhciBpbmRleCA9CXRoaXMuc3RyZWFtLmZpbmRQb3NpdGlvbih0cnVlLCBzYW1wbGUub2Zmc2V0ICsgc2FtcGxlLmFscmVhZHlSZWFkLCBmYWxzZSk7CiAgICAJCQkJaWYgKGluZGV4ID4gLTEpIHsKICAgIAkJCQkJYnVmZmVyID0gdGhpcy5zdHJlYW0uYnVmZmVyc1tpbmRleF07CiAgICAJCQkJCXZhciBsZW5ndGhBZnRlclN0YXJ0ID0gYnVmZmVyLmJ5dGVMZW5ndGggLSAoc2FtcGxlLm9mZnNldCArIHNhbXBsZS5hbHJlYWR5UmVhZCAtIGJ1ZmZlci5maWxlU3RhcnQpOwogICAgCQkJCQlpZiAoc2FtcGxlLnNpemUgLSBzYW1wbGUuYWxyZWFkeVJlYWQgPD0gbGVuZ3RoQWZ0ZXJTdGFydCkgewogICAgCQkJCQkJLyogdGhlIChyZXN0IG9mIHRoZSkgc2FtcGxlIGlzIGVudGlyZWx5IGNvbnRhaW5lZCBpbiB0aGlzIGJ1ZmZlciAqLwoKICAgIAkJCQkJCUxvZy5kZWJ1ZygiSVNPRmlsZSIsIkdldHRpbmcgc2FtcGxlICMiK3NhbXBsZU51bSsiIGRhdGEgKGFscmVhZHlSZWFkOiAiK3NhbXBsZS5hbHJlYWR5UmVhZCsiIG9mZnNldDogIisKICAgIAkJCQkJCQkoc2FtcGxlLm9mZnNldCtzYW1wbGUuYWxyZWFkeVJlYWQgLSBidWZmZXIuZmlsZVN0YXJ0KSsiIHJlYWQgc2l6ZTogIisoc2FtcGxlLnNpemUgLSBzYW1wbGUuYWxyZWFkeVJlYWQpKyIgZnVsbCBzaXplOiAiK3NhbXBsZS5zaXplKyIpIik7CgogICAgCQkJCQkJRGF0YVN0cmVhbS5tZW1jcHkoc2FtcGxlLmRhdGEuYnVmZmVyLCBzYW1wbGUuYWxyZWFkeVJlYWQsCiAgICAJCQkJCQkgICAgICAgICAgICAgICAgICBidWZmZXIsIHNhbXBsZS5vZmZzZXQrc2FtcGxlLmFscmVhZHlSZWFkIC0gYnVmZmVyLmZpbGVTdGFydCwgc2FtcGxlLnNpemUgLSBzYW1wbGUuYWxyZWFkeVJlYWQpOwoKICAgIAkJCQkJCS8qIHVwZGF0ZSB0aGUgbnVtYmVyIG9mIGJ5dGVzIHVzZWQgaW4gdGhpcyBidWZmZXIgYW5kIGNoZWNrIGlmIGl0IG5lZWRzIHRvIGJlIHJlbW92ZWQgKi8KICAgIAkJCQkJCWJ1ZmZlci51c2VkQnl0ZXMgKz0gc2FtcGxlLnNpemUgLSBzYW1wbGUuYWxyZWFkeVJlYWQ7CiAgICAJCQkJCQl0aGlzLnN0cmVhbS5sb2dCdWZmZXJMZXZlbCgpOwoKICAgIAkJCQkJCXNhbXBsZS5hbHJlYWR5UmVhZCA9IHNhbXBsZS5zaXplOwoKICAgIAkJCQkJCXJldHVybiBzYW1wbGU7CiAgICAJCQkJCX0gZWxzZSB7CiAgICAJCQkJCQkvKiB0aGUgc2FtcGxlIGRvZXMgbm90IGVuZCBpbiB0aGlzIGJ1ZmZlciAqLwoKICAgIAkJCQkJCWlmIChsZW5ndGhBZnRlclN0YXJ0ID09PSAwKSByZXR1cm4gbnVsbDsKCiAgICAJCQkJCQlMb2cuZGVidWcoIklTT0ZpbGUiLCJHZXR0aW5nIHNhbXBsZSAjIitzYW1wbGVOdW0rIiBwYXJ0aWFsIGRhdGEgKGFscmVhZHlSZWFkOiAiK3NhbXBsZS5hbHJlYWR5UmVhZCsiIG9mZnNldDogIisKICAgIAkJCQkJCQkoc2FtcGxlLm9mZnNldCtzYW1wbGUuYWxyZWFkeVJlYWQgLSBidWZmZXIuZmlsZVN0YXJ0KSsiIHJlYWQgc2l6ZTogIitsZW5ndGhBZnRlclN0YXJ0KyIgZnVsbCBzaXplOiAiK3NhbXBsZS5zaXplKyIpIik7CgogICAgCQkJCQkJRGF0YVN0cmVhbS5tZW1jcHkoc2FtcGxlLmRhdGEuYnVmZmVyLCBzYW1wbGUuYWxyZWFkeVJlYWQsCiAgICAJCQkJCQkgICAgICAgICAgICAgICAgICBidWZmZXIsIHNhbXBsZS5vZmZzZXQrc2FtcGxlLmFscmVhZHlSZWFkIC0gYnVmZmVyLmZpbGVTdGFydCwgbGVuZ3RoQWZ0ZXJTdGFydCk7CiAgICAJCQkJCQlzYW1wbGUuYWxyZWFkeVJlYWQgKz0gbGVuZ3RoQWZ0ZXJTdGFydDsKCiAgICAJCQkJCQkvKiB1cGRhdGUgdGhlIG51bWJlciBvZiBieXRlcyB1c2VkIGluIHRoaXMgYnVmZmVyIGFuZCBjaGVjayBpZiBpdCBuZWVkcyB0byBiZSByZW1vdmVkICovCiAgICAJCQkJCQlidWZmZXIudXNlZEJ5dGVzICs9IGxlbmd0aEFmdGVyU3RhcnQ7CiAgICAJCQkJCQl0aGlzLnN0cmVhbS5sb2dCdWZmZXJMZXZlbCgpOwoKICAgIAkJCQkJCS8qIGtlZXAgbG9va2luZyBpbiB0aGUgbmV4dCBidWZmZXIgKi8KICAgIAkJCQkJfQogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCXJldHVybiBudWxsOwogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8qIFJlbGVhc2UgdGhlIG1lbW9yeSB1c2VkIHRvIHN0b3JlIHRoZSBkYXRhIG9mIHRoZSBzYW1wbGUgKi8KICAgIAkJSVNPRmlsZS5wcm90b3R5cGUucmVsZWFzZVNhbXBsZSA9IGZ1bmN0aW9uKHRyYWssIHNhbXBsZU51bSkgewkKICAgIAkJCXZhciBzYW1wbGUgPSB0cmFrLnNhbXBsZXNbc2FtcGxlTnVtXTsKICAgIAkJCWlmIChzYW1wbGUuZGF0YSkgewogICAgCQkJCXRoaXMuc2FtcGxlc0RhdGFTaXplIC09IHNhbXBsZS5zaXplOwogICAgCQkJCXNhbXBsZS5kYXRhID0gbnVsbDsKICAgIAkJCQlzYW1wbGUuYWxyZWFkeVJlYWQgPSAwOwogICAgCQkJCXJldHVybiBzYW1wbGUuc2l6ZTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIDA7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRBbGxvY2F0ZWRTYW1wbGVEYXRhU2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgCQkJcmV0dXJuIHRoaXMuc2FtcGxlc0RhdGFTaXplOwogICAgCQl9OwoKICAgIAkJLyogQnVpbGRzIHRoZSBNSU1FIFR5cGUgJ2NvZGVjcycgc3ViLXBhcmFtZXRlcnMgZm9yIHRoZSB3aG9sZSBmaWxlICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmdldENvZGVjcyA9IGZ1bmN0aW9uKCkgewkKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIGNvZGVjcyA9ICIiOwogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMubW9vdi50cmFrcy5sZW5ndGg7IGkrKykgewogICAgCQkJCXZhciB0cmFrID0gdGhpcy5tb292LnRyYWtzW2ldOwogICAgCQkJCWlmIChpPjApIHsKICAgIAkJCQkJY29kZWNzKz0iLCI7IAogICAgCQkJCX0KICAgIAkJCQljb2RlY3MgKz0gdHJhay5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbMF0uZ2V0Q29kZWMoKTsJCQogICAgCQkJfQogICAgCQkJcmV0dXJuIGNvZGVjczsKICAgIAkJfTsKCiAgICAJCS8qIEhlbHBlciBmdW5jdGlvbiAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRUcmV4QnlJZCA9IGZ1bmN0aW9uKGlkKSB7CQogICAgCQkJdmFyIGk7CiAgICAJCQlpZiAoIXRoaXMubW9vdiB8fCAhdGhpcy5tb292Lm12ZXgpIHJldHVybiBudWxsOwogICAgCQkJZm9yIChpID0gMDsgaSA8IHRoaXMubW9vdi5tdmV4LnRyZXhzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdmFyIHRyZXggPSB0aGlzLm1vb3YubXZleC50cmV4c1tpXTsKICAgIAkJCQlpZiAodHJleC50cmFja19pZCA9PSBpZCkgcmV0dXJuIHRyZXg7CiAgICAJCQl9CiAgICAJCQlyZXR1cm4gbnVsbDsKICAgIAkJfTsKCiAgICAJCS8qIEhlbHBlciBmdW5jdGlvbiAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRUcmFja0J5SWQgPSBmdW5jdGlvbihpZCkgewogICAgCQkJaWYgKHRoaXMubW9vdiA9PT0gdW5kZWZpbmVkKSB7CiAgICAJCQkJcmV0dXJuIG51bGw7CiAgICAJCQl9CiAgICAJCQlmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMubW9vdi50cmFrcy5sZW5ndGg7IGorKykgewogICAgCQkJCXZhciB0cmFrID0gdGhpcy5tb292LnRyYWtzW2pdOwogICAgCQkJCWlmICh0cmFrLnRraGQudHJhY2tfaWQgPT0gaWQpIHJldHVybiB0cmFrOwogICAgCQkJfQogICAgCQkJcmV0dXJuIG51bGw7CiAgICAJCX07CiAgICAJCS8vIGZpbGU6c3JjL2lzb2ZpbGUtaXRlbS1wcm9jZXNzaW5nLmpzCiAgICAJCS8qIHNpemUgb2YgdGhlIGJ1ZmZlcnMgYWxsb2NhdGVkIGZvciBzYW1wbGVzICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLml0ZW1zRGF0YVNpemUgPSAwOwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuZmxhdHRlbkl0ZW1JbmZvID0gZnVuY3Rpb24oKSB7CQogICAgCQkJdmFyIGl0ZW1zID0gdGhpcy5pdGVtczsKICAgIAkJCXZhciBlbnRpdHlfZ3JvdXBzID0gdGhpcy5lbnRpdHlfZ3JvdXBzOwogICAgCQkJdmFyIGksIGo7CiAgICAJCQl2YXIgaXRlbTsKICAgIAkJCXZhciBtZXRhID0gdGhpcy5tZXRhOwogICAgCQkJaWYgKG1ldGEgPT09IG51bGwgfHwgbWV0YSA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAJCQlpZiAobWV0YS5oZGxyID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgIAkJCWlmIChtZXRhLmlpbmYgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgCQkJZm9yIChpID0gMDsgaSA8IG1ldGEuaWluZi5pdGVtX2luZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJaXRlbSA9IHt9OwogICAgCQkJCWl0ZW0uaWQgPSBtZXRhLmlpbmYuaXRlbV9pbmZvc1tpXS5pdGVtX0lEOwogICAgCQkJCWl0ZW1zW2l0ZW0uaWRdID0gaXRlbTsKICAgIAkJCQlpdGVtLnJlZl90byA9IFtdOwogICAgCQkJCWl0ZW0ubmFtZSA9IG1ldGEuaWluZi5pdGVtX2luZm9zW2ldLml0ZW1fbmFtZTsKICAgIAkJCQlpZiAobWV0YS5paW5mLml0ZW1faW5mb3NbaV0ucHJvdGVjdGlvbl9pbmRleCA+IDApIHsKICAgIAkJCQkJaXRlbS5wcm90ZWN0aW9uID0gbWV0YS5pcHJvLnByb3RlY3Rpb25zW21ldGEuaWluZi5pdGVtX2luZm9zW2ldLnByb3RlY3Rpb25faW5kZXgtMV07CiAgICAJCQkJfQogICAgCQkJCWlmIChtZXRhLmlpbmYuaXRlbV9pbmZvc1tpXS5pdGVtX3R5cGUpIHsKICAgIAkJCQkJaXRlbS50eXBlID0gbWV0YS5paW5mLml0ZW1faW5mb3NbaV0uaXRlbV90eXBlOwogICAgCQkJCX0gZWxzZSB7CiAgICAJCQkJCWl0ZW0udHlwZSA9ICJtaW1lIjsKICAgIAkJCQl9CiAgICAJCQkJaXRlbS5jb250ZW50X3R5cGUgPSBtZXRhLmlpbmYuaXRlbV9pbmZvc1tpXS5jb250ZW50X3R5cGU7CiAgICAJCQkJaXRlbS5jb250ZW50X2VuY29kaW5nID0gbWV0YS5paW5mLml0ZW1faW5mb3NbaV0uY29udGVudF9lbmNvZGluZzsKICAgIAkJCX0KICAgIAkJCWlmIChtZXRhLmdycGwpIHsKICAgIAkJCQlmb3IgKGkgPSAwOyBpIDwgbWV0YS5ncnBsLmJveGVzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJCWVudGl0eV9ncm91cCA9IHt9OwogICAgCQkJCQllbnRpdHlfZ3JvdXAuaWQgPSBtZXRhLmdycGwuYm94ZXNbaV0uZ3JvdXBfaWQ7CiAgICAJCQkJCWVudGl0eV9ncm91cC5lbnRpdHlfaWRzID0gbWV0YS5ncnBsLmJveGVzW2ldLmVudGl0eV9pZHM7CiAgICAJCQkJCWVudGl0eV9ncm91cC50eXBlID0gbWV0YS5ncnBsLmJveGVzW2ldLnR5cGU7CiAgICAJCQkJCWVudGl0eV9ncm91cHNbZW50aXR5X2dyb3VwLmlkXSA9IGVudGl0eV9ncm91cDsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAobWV0YS5pbG9jKSB7CiAgICAJCQkJZm9yKGkgPSAwOyBpIDwgbWV0YS5pbG9jLml0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJCXZhciBpdGVtbG9jID0gbWV0YS5pbG9jLml0ZW1zW2ldOwogICAgCQkJCQlpdGVtID0gaXRlbXNbaXRlbWxvYy5pdGVtX0lEXTsKICAgIAkJCQkJaWYgKGl0ZW1sb2MuZGF0YV9yZWZlcmVuY2VfaW5kZXggIT09IDApIHsKICAgIAkJCQkJCUxvZy53YXJuKCJJdGVtIHN0b3JhZ2Ugd2l0aCByZWZlcmVuY2UgdG8gb3RoZXIgZmlsZXM6IG5vdCBzdXBwb3J0ZWQiKTsKICAgIAkJCQkJCWl0ZW0uc291cmNlID0gbWV0YS5kaW5mLmJveGVzW2l0ZW1sb2MuZGF0YV9yZWZlcmVuY2VfaW5kZXgtMV07CiAgICAJCQkJCX0KICAgIAkJCQkJc3dpdGNoKGl0ZW1sb2MuY29uc3RydWN0aW9uX21ldGhvZCkgewogICAgCQkJCQkJY2FzZSAwOiAvLyBvZmZzZXQgaW50byB0aGUgZmlsZSByZWZlcmVuY2VkIGJ5IHRoZSBkYXRhIHJlZmVyZW5jZSBpbmRleAogICAgCQkJCQkJYnJlYWs7CiAgICAJCQkJCQljYXNlIDE6IC8vIG9mZnNldCBpbnRvIHRoZSBpZGF0IGJveCBvZiB0aGlzIG1ldGEgYm94CiAgICAJCQkJCQlicmVhazsKICAgIAkJCQkJCWNhc2UgMjogLy8gb2Zmc2V0IGludG8gYW5vdGhlciBpdGVtCiAgICAJCQkJCQlMb2cud2FybigiSXRlbSBzdG9yYWdlIHdpdGggY29uc3RydWN0aW9uX21ldGhvZCA6IG5vdCBzdXBwb3J0ZWQiKTsKICAgIAkJCQkJCWJyZWFrOwogICAgCQkJCQl9CiAgICAJCQkJCWl0ZW0uZXh0ZW50cyA9IFtdOwogICAgCQkJCQlpdGVtLnNpemUgPSAwOwogICAgCQkJCQlmb3IgKGogPSAwOyBqIDwgaXRlbWxvYy5leHRlbnRzLmxlbmd0aDsgaisrKSB7CiAgICAJCQkJCQlpdGVtLmV4dGVudHNbal0gPSB7fTsKICAgIAkJCQkJCWl0ZW0uZXh0ZW50c1tqXS5vZmZzZXQgPSBpdGVtbG9jLmV4dGVudHNbal0uZXh0ZW50X29mZnNldCArIGl0ZW1sb2MuYmFzZV9vZmZzZXQ7CiAgICAJCQkJCQlpZiAoaXRlbWxvYy5jb25zdHJ1Y3Rpb25fbWV0aG9kID09IDEpIHsKICAgIAkJCQkJCQlpdGVtLmV4dGVudHNbal0ub2Zmc2V0ICs9IG1ldGEuaWRhdC5zdGFydCArIG1ldGEuaWRhdC5oZHJfc2l6ZTsKICAgIAkJCQkJCX0KICAgIAkJCQkJCWl0ZW0uZXh0ZW50c1tqXS5sZW5ndGggPSBpdGVtbG9jLmV4dGVudHNbal0uZXh0ZW50X2xlbmd0aDsKICAgIAkJCQkJCWl0ZW0uZXh0ZW50c1tqXS5hbHJlYWR5UmVhZCA9IDA7CiAgICAJCQkJCQlpdGVtLnNpemUgKz0gaXRlbS5leHRlbnRzW2pdLmxlbmd0aDsKICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJCWlmIChtZXRhLnBpdG0pIHsKICAgIAkJCQlpdGVtc1ttZXRhLnBpdG0uaXRlbV9pZF0ucHJpbWFyeSA9IHRydWU7CiAgICAJCQl9CiAgICAJCQlpZiAobWV0YS5pcmVmKSB7CiAgICAJCQkJZm9yIChpPTA7IGkgPG1ldGEuaXJlZi5yZWZlcmVuY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJCXZhciByZWYgPSBtZXRhLmlyZWYucmVmZXJlbmNlc1tpXTsKICAgIAkJCQkJZm9yIChqPTA7IGo8cmVmLnJlZmVyZW5jZXMubGVuZ3RoOyBqKyspIHsKICAgIAkJCQkJCWl0ZW1zW3JlZi5mcm9tX2l0ZW1fSURdLnJlZl90by5wdXNoKHt0eXBlOiByZWYudHlwZSwgaWQ6IHJlZi5yZWZlcmVuY2VzW2pdfSk7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAobWV0YS5pcHJwKSB7CiAgICAJCQkJZm9yICh2YXIgayA9IDA7IGsgPCBtZXRhLmlwcnAuaXBtYXMubGVuZ3RoOyBrKyspIHsKICAgIAkJCQkJdmFyIGlwbWEgPSBtZXRhLmlwcnAuaXBtYXNba107CiAgICAJCQkJCWZvciAoaSA9IDA7IGkgPCBpcG1hLmFzc29jaWF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgCQkJCQkJdmFyIGFzc29jaWF0aW9uID0gaXBtYS5hc3NvY2lhdGlvbnNbaV07CiAgICAJCQkJCQlpdGVtID0gaXRlbXNbYXNzb2NpYXRpb24uaWRdOwogICAgCQkJCQkJaWYgKCFpdGVtKSB7CiAgICAJCQkJCQkJaXRlbSA9IGVudGl0eV9ncm91cHNbYXNzb2NpYXRpb24uaWRdOwogICAgCQkJCQkJfQogICAgCQkJCQkJaWYgKGl0ZW0pIHsKICAgIAkJCQkJCQlpZiAoaXRlbS5wcm9wZXJ0aWVzID09PSB1bmRlZmluZWQpIHsKICAgIAkJCQkJCQkJaXRlbS5wcm9wZXJ0aWVzID0ge307CiAgICAJCQkJCQkJCWl0ZW0ucHJvcGVydGllcy5ib3hlcyA9IFtdOwogICAgCQkJCQkJCX0KICAgIAkJCQkJCQlmb3IgKGogPSAwOyBqIDwgYXNzb2NpYXRpb24ucHJvcHMubGVuZ3RoOyBqKyspIHsKICAgIAkJCQkJCQkJdmFyIHByb3BFbnRyeSA9IGFzc29jaWF0aW9uLnByb3BzW2pdOwogICAgCQkJCQkJCQlpZiAocHJvcEVudHJ5LnByb3BlcnR5X2luZGV4ID4gMCAmJiBwcm9wRW50cnkucHJvcGVydHlfaW5kZXgtMSA8IG1ldGEuaXBycC5pcGNvLmJveGVzLmxlbmd0aCkgewogICAgCQkJCQkJCQkJdmFyIHByb3Bib3ggPSBtZXRhLmlwcnAuaXBjby5ib3hlc1twcm9wRW50cnkucHJvcGVydHlfaW5kZXgtMV07CiAgICAJCQkJCQkJCQlpdGVtLnByb3BlcnRpZXNbcHJvcGJveC50eXBlXSA9IHByb3Bib3g7CiAgICAJCQkJCQkJCQlpdGVtLnByb3BlcnRpZXMuYm94ZXMucHVzaChwcm9wYm94KTsKICAgIAkJCQkJCQkJfQogICAgCQkJCQkJCX0KICAgIAkJCQkJCX0KICAgIAkJCQkJfQogICAgCQkJCX0KICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmdldEl0ZW0gPSBmdW5jdGlvbihpdGVtX2lkKSB7CQogICAgCQkJdmFyIGJ1ZmZlcjsKICAgIAkJCXZhciBpdGVtOwogICAgCQkJCiAgICAJCQlpZiAoIXRoaXMubWV0YSkgewogICAgCQkJCXJldHVybiBudWxsOwogICAgCQkJfQoKICAgIAkJIAlpdGVtID0gdGhpcy5pdGVtc1tpdGVtX2lkXTsKICAgIAkJCWlmICghaXRlbS5kYXRhICYmIGl0ZW0uc2l6ZSkgewogICAgCQkJCS8qIE5vdCB5ZXQgZmV0Y2hlZCAqLwogICAgCQkJCWl0ZW0uZGF0YSA9IG5ldyBVaW50OEFycmF5KGl0ZW0uc2l6ZSk7CiAgICAJCQkJaXRlbS5hbHJlYWR5UmVhZCA9IDA7CiAgICAJCQkJdGhpcy5pdGVtc0RhdGFTaXplICs9IGl0ZW0uc2l6ZTsKICAgIAkJCQlMb2cuZGVidWcoIklTT0ZpbGUiLCAiQWxsb2NhdGluZyBpdGVtICMiK2l0ZW1faWQrIiBvZiBzaXplICIraXRlbS5zaXplKyIgKHRvdGFsOiAiK3RoaXMuaXRlbXNEYXRhU2l6ZSsiKSIpOwogICAgCQkJfSBlbHNlIGlmIChpdGVtLmFscmVhZHlSZWFkID09PSBpdGVtLnNpemUpIHsKICAgIAkJCQkvKiBBbHJlYWR5IGZldGNoZWQgZW50aXJlbHkgKi8KICAgIAkJCQlyZXR1cm4gaXRlbTsKICAgIAkJCX0KCiAgICAJCQkvKiBUaGUgaXRlbSBoYXMgb25seSBiZWVuIHBhcnRpYWxseSBmZXRjaGVkLCB3ZSBuZWVkIHRvIGNoZWNrIGluIGFsbCBidWZmZXJzIHRvIGZpbmQgdGhlIHJlbWFpbmluZyBleHRlbnRzKi8KCiAgICAJCQlmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW0uZXh0ZW50cy5sZW5ndGg7IGkrKykgewogICAgCQkJCXZhciBleHRlbnQgPSBpdGVtLmV4dGVudHNbaV07CiAgICAJCQkJaWYgKGV4dGVudC5hbHJlYWR5UmVhZCA9PT0gZXh0ZW50Lmxlbmd0aCkgewogICAgCQkJCQljb250aW51ZTsKICAgIAkJCQl9IGVsc2UgewogICAgCQkJCQl2YXIgaW5kZXggPQl0aGlzLnN0cmVhbS5maW5kUG9zaXRpb24odHJ1ZSwgZXh0ZW50Lm9mZnNldCArIGV4dGVudC5hbHJlYWR5UmVhZCwgZmFsc2UpOwogICAgCQkJCQlpZiAoaW5kZXggPiAtMSkgewogICAgCQkJCQkJYnVmZmVyID0gdGhpcy5zdHJlYW0uYnVmZmVyc1tpbmRleF07CiAgICAJCQkJCQl2YXIgbGVuZ3RoQWZ0ZXJTdGFydCA9IGJ1ZmZlci5ieXRlTGVuZ3RoIC0gKGV4dGVudC5vZmZzZXQgKyBleHRlbnQuYWxyZWFkeVJlYWQgLSBidWZmZXIuZmlsZVN0YXJ0KTsKICAgIAkJCQkJCWlmIChleHRlbnQubGVuZ3RoIC0gZXh0ZW50LmFscmVhZHlSZWFkIDw9IGxlbmd0aEFmdGVyU3RhcnQpIHsKICAgIAkJCQkJCQkvKiB0aGUgKHJlc3Qgb2YgdGhlKSBleHRlbnQgaXMgZW50aXJlbHkgY29udGFpbmVkIGluIHRoaXMgYnVmZmVyICovCgogICAgCQkJCQkJCUxvZy5kZWJ1ZygiSVNPRmlsZSIsIkdldHRpbmcgaXRlbSAjIitpdGVtX2lkKyIgZXh0ZW50ICMiK2krIiBkYXRhIChhbHJlYWR5UmVhZDogIitleHRlbnQuYWxyZWFkeVJlYWQrCiAgICAJCQkJCQkJCSIgb2Zmc2V0OiAiKyhleHRlbnQub2Zmc2V0K2V4dGVudC5hbHJlYWR5UmVhZCAtIGJ1ZmZlci5maWxlU3RhcnQpKyIgcmVhZCBzaXplOiAiKyhleHRlbnQubGVuZ3RoIC0gZXh0ZW50LmFscmVhZHlSZWFkKSsKICAgIAkJCQkJCQkJIiBmdWxsIGV4dGVudCBzaXplOiAiK2V4dGVudC5sZW5ndGgrIiBmdWxsIGl0ZW0gc2l6ZTogIitpdGVtLnNpemUrIikiKTsKCiAgICAJCQkJCQkJRGF0YVN0cmVhbS5tZW1jcHkoaXRlbS5kYXRhLmJ1ZmZlciwgaXRlbS5hbHJlYWR5UmVhZCwgCiAgICAJCQkJCQkJICAgICAgICAgICAgICAgICAgYnVmZmVyLCBleHRlbnQub2Zmc2V0K2V4dGVudC5hbHJlYWR5UmVhZCAtIGJ1ZmZlci5maWxlU3RhcnQsIGV4dGVudC5sZW5ndGggLSBleHRlbnQuYWxyZWFkeVJlYWQpOwoKICAgIAkJCQkJCQkvKiB1cGRhdGUgdGhlIG51bWJlciBvZiBieXRlcyB1c2VkIGluIHRoaXMgYnVmZmVyIGFuZCBjaGVjayBpZiBpdCBuZWVkcyB0byBiZSByZW1vdmVkICovCiAgICAJCQkJCQkJYnVmZmVyLnVzZWRCeXRlcyArPSBleHRlbnQubGVuZ3RoIC0gZXh0ZW50LmFscmVhZHlSZWFkOwogICAgCQkJCQkJCXRoaXMuc3RyZWFtLmxvZ0J1ZmZlckxldmVsKCk7CgogICAgCQkJCQkJCWl0ZW0uYWxyZWFkeVJlYWQgKz0gKGV4dGVudC5sZW5ndGggLSBleHRlbnQuYWxyZWFkeVJlYWQpOwogICAgCQkJCQkJCWV4dGVudC5hbHJlYWR5UmVhZCA9IGV4dGVudC5sZW5ndGg7CiAgICAJCQkJCQl9IGVsc2UgewogICAgCQkJCQkJCS8qIHRoZSBzYW1wbGUgZG9lcyBub3QgZW5kIGluIHRoaXMgYnVmZmVyICovCgogICAgCQkJCQkJCUxvZy5kZWJ1ZygiSVNPRmlsZSIsIkdldHRpbmcgaXRlbSAjIitpdGVtX2lkKyIgZXh0ZW50ICMiK2krIiBwYXJ0aWFsIGRhdGEgKGFscmVhZHlSZWFkOiAiK2V4dGVudC5hbHJlYWR5UmVhZCsiIG9mZnNldDogIisKICAgIAkJCQkJCQkJKGV4dGVudC5vZmZzZXQrZXh0ZW50LmFscmVhZHlSZWFkIC0gYnVmZmVyLmZpbGVTdGFydCkrIiByZWFkIHNpemU6ICIrbGVuZ3RoQWZ0ZXJTdGFydCsKICAgIAkJCQkJCQkJIiBmdWxsIGV4dGVudCBzaXplOiAiK2V4dGVudC5sZW5ndGgrIiBmdWxsIGl0ZW0gc2l6ZTogIitpdGVtLnNpemUrIikiKTsKCiAgICAJCQkJCQkJRGF0YVN0cmVhbS5tZW1jcHkoaXRlbS5kYXRhLmJ1ZmZlciwgaXRlbS5hbHJlYWR5UmVhZCwgCiAgICAJCQkJCQkJICAgICAgICAgICAgICAgICAgYnVmZmVyLCBleHRlbnQub2Zmc2V0K2V4dGVudC5hbHJlYWR5UmVhZCAtIGJ1ZmZlci5maWxlU3RhcnQsIGxlbmd0aEFmdGVyU3RhcnQpOwogICAgCQkJCQkJCWV4dGVudC5hbHJlYWR5UmVhZCArPSBsZW5ndGhBZnRlclN0YXJ0OwogICAgCQkJCQkJCWl0ZW0uYWxyZWFkeVJlYWQgKz0gbGVuZ3RoQWZ0ZXJTdGFydDsKCiAgICAJCQkJCQkJLyogdXBkYXRlIHRoZSBudW1iZXIgb2YgYnl0ZXMgdXNlZCBpbiB0aGlzIGJ1ZmZlciBhbmQgY2hlY2sgaWYgaXQgbmVlZHMgdG8gYmUgcmVtb3ZlZCAqLwogICAgCQkJCQkJCWJ1ZmZlci51c2VkQnl0ZXMgKz0gbGVuZ3RoQWZ0ZXJTdGFydDsKICAgIAkJCQkJCQl0aGlzLnN0cmVhbS5sb2dCdWZmZXJMZXZlbCgpOwogICAgCQkJCQkJCXJldHVybiBudWxsOwogICAgCQkJCQkJfQogICAgCQkJCQl9IGVsc2UgewogICAgCQkJCQkJcmV0dXJuIG51bGw7CiAgICAJCQkJCX0KICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlpZiAoaXRlbS5hbHJlYWR5UmVhZCA9PT0gaXRlbS5zaXplKSB7CiAgICAJCQkJLyogZmV0Y2hlZCBlbnRpcmVseSAqLwogICAgCQkJCXJldHVybiBpdGVtOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlyZXR1cm4gbnVsbDsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8qIFJlbGVhc2UgdGhlIG1lbW9yeSB1c2VkIHRvIHN0b3JlIHRoZSBkYXRhIG9mIHRoZSBpdGVtICovCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLnJlbGVhc2VJdGVtID0gZnVuY3Rpb24oaXRlbV9pZCkgewkKICAgIAkJCXZhciBpdGVtID0gdGhpcy5pdGVtc1tpdGVtX2lkXTsKICAgIAkJCWlmIChpdGVtLmRhdGEpIHsKICAgIAkJCQl0aGlzLml0ZW1zRGF0YVNpemUgLT0gaXRlbS5zaXplOwogICAgCQkJCWl0ZW0uZGF0YSA9IG51bGw7CiAgICAJCQkJaXRlbS5hbHJlYWR5UmVhZCA9IDA7CiAgICAJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtLmV4dGVudHMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQkJdmFyIGV4dGVudCA9IGl0ZW0uZXh0ZW50c1tpXTsKICAgIAkJCQkJZXh0ZW50LmFscmVhZHlSZWFkID0gMDsKICAgIAkJCQl9CiAgICAJCQkJcmV0dXJuIGl0ZW0uc2l6ZTsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIDA7CiAgICAJCQl9CiAgICAJCX07CgoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUucHJvY2Vzc0l0ZW1zID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIAkJCWZvcih2YXIgaSBpbiB0aGlzLml0ZW1zKSB7CiAgICAJCQkJdmFyIGl0ZW0gPSB0aGlzLml0ZW1zW2ldOwogICAgCQkJCXRoaXMuZ2V0SXRlbShpdGVtLmlkKTsKICAgIAkJCQlpZiAoY2FsbGJhY2sgJiYgIWl0ZW0uc2VudCkgewogICAgCQkJCQljYWxsYmFjayhpdGVtKTsKICAgIAkJCQkJaXRlbS5zZW50ID0gdHJ1ZTsKICAgIAkJCQkJaXRlbS5kYXRhID0gbnVsbDsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5oYXNJdGVtID0gZnVuY3Rpb24obmFtZSkgewogICAgCQkJZm9yKHZhciBpIGluIHRoaXMuaXRlbXMpIHsKICAgIAkJCQl2YXIgaXRlbSA9IHRoaXMuaXRlbXNbaV07CiAgICAJCQkJaWYgKGl0ZW0ubmFtZSA9PT0gbmFtZSkgewogICAgCQkJCQlyZXR1cm4gaXRlbS5pZDsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCQlyZXR1cm4gLTE7CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRNZXRhSGFuZGxlciA9IGZ1bmN0aW9uKCkgewogICAgCQkJaWYgKCF0aGlzLm1ldGEpIHsKICAgIAkJCQlyZXR1cm4gbnVsbDsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIHRoaXMubWV0YS5oZGxyLmhhbmRsZXI7CQkKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmdldFByaW1hcnlJdGVtID0gZnVuY3Rpb24oKSB7CiAgICAJCQlpZiAoIXRoaXMubWV0YSB8fCAhdGhpcy5tZXRhLnBpdG0pIHsKICAgIAkJCQlyZXR1cm4gbnVsbDsKICAgIAkJCX0gZWxzZSB7CiAgICAJCQkJcmV0dXJuIHRoaXMuZ2V0SXRlbSh0aGlzLm1ldGEucGl0bS5pdGVtX2lkKTsKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLml0ZW1Ub0ZyYWdtZW50ZWRUcmFja0ZpbGUgPSBmdW5jdGlvbihfb3B0aW9ucykgewogICAgCQkJdmFyIG9wdGlvbnMgPSBfb3B0aW9ucyB8fCB7fTsKICAgIAkJCXZhciBpdGVtID0gbnVsbDsKICAgIAkJCWlmIChvcHRpb25zLml0ZW1JZCkgewogICAgCQkJCWl0ZW0gPSB0aGlzLmdldEl0ZW0ob3B0aW9ucy5pdGVtSWQpOwogICAgCQkJfSBlbHNlIHsKICAgIAkJCQlpdGVtID0gdGhpcy5nZXRQcmltYXJ5SXRlbSgpOwogICAgCQkJfQogICAgCQkJaWYgKGl0ZW0gPT0gbnVsbCkgcmV0dXJuIG51bGw7CgogICAgCQkJdmFyIGZpbGUgPSBuZXcgSVNPRmlsZSgpOwogICAgCQkJZmlsZS5kaXNjYXJkTWRhdERhdGEgPSBmYWxzZTsKICAgIAkJCS8vIGFzc3VtaW5nIHRoZSB0cmFjayB0eXBlIGlzIHRoZSBzYW1lIGFzIHRoZSBpdGVtIHR5cGUKICAgIAkJCXZhciB0cmFja09wdGlvbnMgPSB7IHR5cGU6IGl0ZW0udHlwZSwgZGVzY3JpcHRpb25fYm94ZXM6IGl0ZW0ucHJvcGVydGllcy5ib3hlc307CiAgICAJCQlpZiAoaXRlbS5wcm9wZXJ0aWVzLmlzcGUpIHsKICAgIAkJCQl0cmFja09wdGlvbnMud2lkdGggPSBpdGVtLnByb3BlcnRpZXMuaXNwZS5pbWFnZV93aWR0aDsKICAgIAkJCQl0cmFja09wdGlvbnMuaGVpZ2h0ID0gaXRlbS5wcm9wZXJ0aWVzLmlzcGUuaW1hZ2VfaGVpZ2h0OwogICAgCQkJfQogICAgCQkJdmFyIHRyYWNrSWQgPSBmaWxlLmFkZFRyYWNrKHRyYWNrT3B0aW9ucyk7CiAgICAJCQlpZiAodHJhY2tJZCkgewogICAgCQkJCWZpbGUuYWRkU2FtcGxlKHRyYWNrSWQsIGl0ZW0uZGF0YSk7CiAgICAJCQkJcmV0dXJuIGZpbGU7CiAgICAJCQl9IGVsc2UgewogICAgCQkJCXJldHVybiBudWxsOwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLy8gZmlsZTpzcmMvaXNvZmlsZS13cml0ZS5qcwogICAgCQkvKiBSZXdyaXRlIHRoZSBlbnRpcmUgZmlsZSAqLwogICAgCQlJU09GaWxlLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKG91dHN0cmVhbSkgewogICAgCQkJZm9yICh2YXIgaT0wOyBpPHRoaXMuYm94ZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQl0aGlzLmJveGVzW2ldLndyaXRlKG91dHN0cmVhbSk7CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5jcmVhdGVGcmFnbWVudCA9IGZ1bmN0aW9uKHRyYWNrX2lkLCBzYW1wbGVOdW1iZXIsIHN0cmVhbV8pIHsKICAgIAkJCXZhciB0cmFrID0gdGhpcy5nZXRUcmFja0J5SWQodHJhY2tfaWQpOwogICAgCQkJdmFyIHNhbXBsZSA9IHRoaXMuZ2V0U2FtcGxlKHRyYWssIHNhbXBsZU51bWJlcik7CiAgICAJCQlpZiAoc2FtcGxlID09IG51bGwpIHsKICAgIAkJCQl0aGlzLnNldE5leHRTZWVrUG9zaXRpb25Gcm9tU2FtcGxlKHRyYWsuc2FtcGxlc1tzYW1wbGVOdW1iZXJdKTsKICAgIAkJCQlyZXR1cm4gbnVsbDsKICAgIAkJCX0KICAgIAkJCQogICAgCQkJdmFyIHN0cmVhbSA9IHN0cmVhbV8gfHwgbmV3IERhdGFTdHJlYW0oKTsKICAgIAkJCXN0cmVhbS5lbmRpYW5uZXNzID0gRGF0YVN0cmVhbS5CSUdfRU5ESUFOOwoKICAgIAkJCXZhciBtb29mID0gdGhpcy5jcmVhdGVTaW5nbGVTYW1wbGVNb29mKHNhbXBsZSk7CiAgICAJCQltb29mLndyaXRlKHN0cmVhbSk7CgogICAgCQkJLyogYWRqdXN0aW5nIHRoZSBkYXRhX29mZnNldCBub3cgdGhhdCB0aGUgbW9vZiBzaXplIGlzIGtub3duKi8KICAgIAkJCW1vb2YudHJhZnNbMF0udHJ1bnNbMF0uZGF0YV9vZmZzZXQgPSBtb29mLnNpemUrODsgLy84IGlzIG1kYXQgaGVhZGVyCiAgICAJCQlMb2cuZGVidWcoIk1QNEJveCIsICJBZGp1c3RpbmcgZGF0YV9vZmZzZXQgd2l0aCBuZXcgdmFsdWUgIittb29mLnRyYWZzWzBdLnRydW5zWzBdLmRhdGFfb2Zmc2V0KTsKICAgIAkJCXN0cmVhbS5hZGp1c3RVaW50MzIobW9vZi50cmFmc1swXS50cnVuc1swXS5kYXRhX29mZnNldF9wb3NpdGlvbiwgbW9vZi50cmFmc1swXS50cnVuc1swXS5kYXRhX29mZnNldCk7CiAgICAJCQkJCiAgICAJCQl2YXIgbWRhdCA9IG5ldyBCb3hQYXJzZXIubWRhdEJveCgpOwogICAgCQkJbWRhdC5kYXRhID0gc2FtcGxlLmRhdGE7CiAgICAJCQltZGF0LndyaXRlKHN0cmVhbSk7CiAgICAJCQlyZXR1cm4gc3RyZWFtOwogICAgCQl9OwoKICAgIAkJLyogTW9kaWZ5IHRoZSBmaWxlIGFuZCBjcmVhdGUgdGhlIGluaXRpYWxpemF0aW9uIHNlZ21lbnQgKi8KICAgIAkJSVNPRmlsZS53cml0ZUluaXRpYWxpemF0aW9uU2VnbWVudCA9IGZ1bmN0aW9uKGZ0eXAsIG1vb3YsIHRvdGFsX2R1cmF0aW9uLCBzYW1wbGVfZHVyYXRpb24pIHsKICAgIAkJCXZhciBpOwogICAgCQkJTG9nLmRlYnVnKCJJU09GaWxlIiwgIkdlbmVyYXRpbmcgaW5pdGlhbGl6YXRpb24gc2VnbWVudCIpOwoKICAgIAkJCXZhciBzdHJlYW0gPSBuZXcgRGF0YVN0cmVhbSgpOwogICAgCQkJc3RyZWFtLmVuZGlhbm5lc3MgPSBEYXRhU3RyZWFtLkJJR19FTkRJQU47CiAgICAJCQlmdHlwLndyaXRlKHN0cmVhbSk7CiAgICAJCQkKICAgIAkJCS8qIHdlIGNhbiBub3cgY3JlYXRlIHRoZSBuZXcgbXZleCBib3ggKi8KICAgIAkJCXZhciBtdmV4ID0gbW9vdi5hZGQoIm12ZXgiKTsKICAgIAkJCWlmICh0b3RhbF9kdXJhdGlvbikgewogICAgCQkJCW12ZXguYWRkKCJtZWhkIikuc2V0KCJmcmFnbWVudF9kdXJhdGlvbiIsIHRvdGFsX2R1cmF0aW9uKTsKICAgIAkJCX0KICAgIAkJCWZvciAoaSA9IDA7IGkgPCBtb292LnRyYWtzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJbXZleC5hZGQoInRyZXgiKS5zZXQoInRyYWNrX2lkIiwgbW9vdi50cmFrc1tpXS50a2hkLnRyYWNrX2lkKQogICAgCQkJCQkJCQkuc2V0KCJkZWZhdWx0X3NhbXBsZV9kZXNjcmlwdGlvbl9pbmRleCIsIDEpCiAgICAJCQkJCQkJCS5zZXQoImRlZmF1bHRfc2FtcGxlX2R1cmF0aW9uIiwgc2FtcGxlX2R1cmF0aW9uKQogICAgCQkJCQkJCQkuc2V0KCJkZWZhdWx0X3NhbXBsZV9zaXplIiwgMCkKICAgIAkJCQkJCQkJLnNldCgiZGVmYXVsdF9zYW1wbGVfZmxhZ3MiLCAxPDwxNik7CiAgICAJCQl9CiAgICAJCQltb292LndyaXRlKHN0cmVhbSk7CgogICAgCQkJcmV0dXJuIHN0cmVhbS5idWZmZXI7CgogICAgCQl9OwoKICAgIAkJSVNPRmlsZS5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIAkJCXZhciBzdHJlYW0gPSBuZXcgRGF0YVN0cmVhbSgpOwogICAgCQkJc3RyZWFtLmVuZGlhbm5lc3MgPSBEYXRhU3RyZWFtLkJJR19FTkRJQU47CiAgICAJCQl0aGlzLndyaXRlKHN0cmVhbSk7CiAgICAJCQlzdHJlYW0uc2F2ZShuYW1lKTsJCiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5nZXRCdWZmZXIgPSBmdW5jdGlvbigpIHsKICAgIAkJCXZhciBzdHJlYW0gPSBuZXcgRGF0YVN0cmVhbSgpOwogICAgCQkJc3RyZWFtLmVuZGlhbm5lc3MgPSBEYXRhU3RyZWFtLkJJR19FTkRJQU47CiAgICAJCQl0aGlzLndyaXRlKHN0cmVhbSk7CiAgICAJCQlyZXR1cm4gc3RyZWFtLmJ1ZmZlcjsKICAgIAkJfTsKCiAgICAJCUlTT0ZpbGUucHJvdG90eXBlLmluaXRpYWxpemVTZWdtZW50YXRpb24gPSBmdW5jdGlvbigpIHsKICAgIAkJCXZhciBpOwogICAgCQkJdmFyIGluaXRTZWdzOwogICAgCQkJdmFyIHRyYWs7CiAgICAJCQl2YXIgc2VnOwogICAgCQkJaWYgKHRoaXMub25TZWdtZW50ID09PSBudWxsKSB7CiAgICAJCQkJTG9nLndhcm4oIk1QNEJveCIsICJObyBzZWdtZW50YXRpb24gY2FsbGJhY2sgc2V0ISIpOwogICAgCQkJfQogICAgCQkJaWYgKCF0aGlzLmlzRnJhZ21lbnRhdGlvbkluaXRpYWxpemVkKSB7CiAgICAJCQkJdGhpcy5pc0ZyYWdtZW50YXRpb25Jbml0aWFsaXplZCA9IHRydWU7CQkKICAgIAkJCQl0aGlzLm5leHRNb29mTnVtYmVyID0gMDsKICAgIAkJCQl0aGlzLnJlc2V0VGFibGVzKCk7CiAgICAJCQl9CQogICAgCQkJaW5pdFNlZ3MgPSBbXTsJCiAgICAJCQlmb3IgKGkgPSAwOyBpIDwgdGhpcy5mcmFnbWVudGVkVHJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAJCQkJdmFyIG1vb3YgPSBuZXcgQm94UGFyc2VyLm1vb3ZCb3goKTsKICAgIAkJCQltb292Lm12aGQgPSB0aGlzLm1vb3YubXZoZDsKICAgIAkJCSAgICBtb292LmJveGVzLnB1c2gobW9vdi5tdmhkKTsKICAgIAkJCQl0cmFrID0gdGhpcy5nZXRUcmFja0J5SWQodGhpcy5mcmFnbWVudGVkVHJhY2tzW2ldLmlkKTsKICAgIAkJCQltb292LmJveGVzLnB1c2godHJhayk7CiAgICAJCQkJbW9vdi50cmFrcy5wdXNoKHRyYWspOwogICAgCQkJCXNlZyA9IHt9OwogICAgCQkJCXNlZy5pZCA9IHRyYWsudGtoZC50cmFja19pZDsKICAgIAkJCQlzZWcudXNlciA9IHRoaXMuZnJhZ21lbnRlZFRyYWNrc1tpXS51c2VyOwogICAgCQkJCXNlZy5idWZmZXIgPSBJU09GaWxlLndyaXRlSW5pdGlhbGl6YXRpb25TZWdtZW50KHRoaXMuZnR5cCwgbW9vdiwgKHRoaXMubW9vdi5tdmV4ICYmIHRoaXMubW9vdi5tdmV4Lm1laGQgPyB0aGlzLm1vb3YubXZleC5tZWhkLmZyYWdtZW50X2R1cmF0aW9uOiB1bmRlZmluZWQpLCAodGhpcy5tb292LnRyYWtzW2ldLnNhbXBsZXMubGVuZ3RoPjAgPyB0aGlzLm1vb3YudHJha3NbaV0uc2FtcGxlc1swXS5kdXJhdGlvbjogMCkpOwogICAgCQkJCWluaXRTZWdzLnB1c2goc2VnKTsKICAgIAkJCX0KICAgIAkJCXJldHVybiBpbml0U2VnczsKICAgIAkJfTsKCiAgICAJCS8vIGZpbGU6c3JjL2JveC1wcmludC5qcwogICAgCQkvKiAKICAgIAkJICogQ29weXJpZ2h0IChjKSBUZWxlY29tIFBhcmlzVGVjaC9UU0kvTU0vR1BBQyBDeXJpbCBDb25jb2xhdG8KICAgIAkJICogTGljZW5zZTogQlNELTMtQ2xhdXNlIChzZWUgTElDRU5TRSBmaWxlKQogICAgCQkgKi8KICAgIAkJQm94UGFyc2VyLkJveC5wcm90b3R5cGUucHJpbnRIZWFkZXIgPSBmdW5jdGlvbihvdXRwdXQpIHsKICAgIAkJCXRoaXMuc2l6ZSArPSA4OwogICAgCQkJaWYgKHRoaXMuc2l6ZSA+IE1BWF9TSVpFKSB7CiAgICAJCQkJdGhpcy5zaXplICs9IDg7CiAgICAJCQl9CiAgICAJCQlpZiAodGhpcy50eXBlID09PSAidXVpZCIpIHsKICAgIAkJCQl0aGlzLnNpemUgKz0gMTY7CiAgICAJCQl9CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrInNpemU6Iit0aGlzLnNpemUpOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJ0eXBlOiIrdGhpcy50eXBlKTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5GdWxsQm94LnByb3RvdHlwZS5wcmludEhlYWRlciA9IGZ1bmN0aW9uKG91dHB1dCkgewogICAgCQkJdGhpcy5zaXplICs9IDQ7CiAgICAJCQlCb3hQYXJzZXIuQm94LnByb3RvdHlwZS5wcmludEhlYWRlci5jYWxsKHRoaXMsIG91dHB1dCk7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrInZlcnNpb246Iit0aGlzLnZlcnNpb24pOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJmbGFnczoiK3RoaXMuZmxhZ3MpOwogICAgCQl9OwoKICAgIAkJQm94UGFyc2VyLkJveC5wcm90b3R5cGUucHJpbnQgPSBmdW5jdGlvbihvdXRwdXQpIHsKICAgIAkJCXRoaXMucHJpbnRIZWFkZXIob3V0cHV0KTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5Db250YWluZXJCb3gucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24ob3V0cHV0KSB7CiAgICAJCQl0aGlzLnByaW50SGVhZGVyKG91dHB1dCk7CiAgICAJCQlmb3IgKHZhciBpPTA7IGk8dGhpcy5ib3hlcy5sZW5ndGg7IGkrKykgewogICAgCQkJCWlmICh0aGlzLmJveGVzW2ldKSB7CiAgICAJCQkJCXZhciBwcmV2X2luZGVudCA9IG91dHB1dC5pbmRlbnQ7CiAgICAJCQkJCW91dHB1dC5pbmRlbnQgKz0gIiAiOwogICAgCQkJCQl0aGlzLmJveGVzW2ldLnByaW50KG91dHB1dCk7CiAgICAJCQkJCW91dHB1dC5pbmRlbnQgPSBwcmV2X2luZGVudDsKICAgIAkJCQl9CiAgICAJCQl9CiAgICAJCX07CgogICAgCQlJU09GaWxlLnByb3RvdHlwZS5wcmludCA9IGZ1bmN0aW9uKG91dHB1dCkgewogICAgCQkJb3V0cHV0LmluZGVudCA9ICIiOwogICAgCQkJZm9yICh2YXIgaT0wOyBpPHRoaXMuYm94ZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJCQlpZiAodGhpcy5ib3hlc1tpXSkgewogICAgCQkJCQl0aGlzLmJveGVzW2ldLnByaW50KG91dHB1dCk7CiAgICAJCQkJfQogICAgCQkJfQkKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci5tdmhkQm94LnByb3RvdHlwZS5wcmludCA9IGZ1bmN0aW9uKG91dHB1dCkgewogICAgCQkJQm94UGFyc2VyLkZ1bGxCb3gucHJvdG90eXBlLnByaW50SGVhZGVyLmNhbGwodGhpcywgb3V0cHV0KTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsiY3JlYXRpb25fdGltZTogIit0aGlzLmNyZWF0aW9uX3RpbWUpOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJtb2RpZmljYXRpb25fdGltZTogIit0aGlzLm1vZGlmaWNhdGlvbl90aW1lKTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsidGltZXNjYWxlOiAiK3RoaXMudGltZXNjYWxlKTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsiZHVyYXRpb246ICIrdGhpcy5kdXJhdGlvbik7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrInJhdGU6ICIrdGhpcy5yYXRlKTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsidm9sdW1lOiAiKyh0aGlzLnZvbHVtZT4+OCkpOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJtYXRyaXg6ICIrdGhpcy5tYXRyaXguam9pbigiLCAiKSk7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrIm5leHRfdHJhY2tfaWQ6ICIrdGhpcy5uZXh0X3RyYWNrX2lkKTsKICAgIAkJfTsKCiAgICAJCUJveFBhcnNlci50a2hkQm94LnByb3RvdHlwZS5wcmludCA9IGZ1bmN0aW9uKG91dHB1dCkgewogICAgCQkJQm94UGFyc2VyLkZ1bGxCb3gucHJvdG90eXBlLnByaW50SGVhZGVyLmNhbGwodGhpcywgb3V0cHV0KTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsiY3JlYXRpb25fdGltZTogIit0aGlzLmNyZWF0aW9uX3RpbWUpOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJtb2RpZmljYXRpb25fdGltZTogIit0aGlzLm1vZGlmaWNhdGlvbl90aW1lKTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsidHJhY2tfaWQ6ICIrdGhpcy50cmFja19pZCk7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrImR1cmF0aW9uOiAiK3RoaXMuZHVyYXRpb24pOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJ2b2x1bWU6ICIrKHRoaXMudm9sdW1lPj44KSk7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrIm1hdHJpeDogIit0aGlzLm1hdHJpeC5qb2luKCIsICIpKTsKICAgIAkJCW91dHB1dC5sb2cob3V0cHV0LmluZGVudCsibGF5ZXI6ICIrdGhpcy5sYXllcik7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrImFsdGVybmF0ZV9ncm91cDogIit0aGlzLmFsdGVybmF0ZV9ncm91cCk7CiAgICAJCQlvdXRwdXQubG9nKG91dHB1dC5pbmRlbnQrIndpZHRoOiAiK3RoaXMud2lkdGgpOwogICAgCQkJb3V0cHV0LmxvZyhvdXRwdXQuaW5kZW50KyJoZWlnaHQ6ICIrdGhpcy5oZWlnaHQpOwogICAgCQl9Oy8vIGZpbGU6c3JjL21wNGJveC5qcwogICAgCQkvKgogICAgCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTItMjAxMy4gVGVsZWNvbSBQYXJpc1RlY2gvVFNJL01NL0dQQUMgQ3lyaWwgQ29uY29sYXRvCiAgICAJCSAqIExpY2Vuc2U6IEJTRC0zLUNsYXVzZSAoc2VlIExJQ0VOU0UgZmlsZSkKICAgIAkJICovCiAgICAJCXZhciBNUDRCb3ggPSB7fTsKCiAgICAJCU1QNEJveC5jcmVhdGVGaWxlID0gZnVuY3Rpb24gKF9rZWVwTWRhdERhdGEsIF9zdHJlYW0pIHsKICAgIAkJCS8qIEJvb2xlYW4gaW5kaWNhdGluZyBpZiBieXRlcyBjb250YWluaW5nIG1lZGlhIGRhdGEgc2hvdWxkIGJlIGtlcHQgaW4gbWVtb3J5ICovCiAgICAJCQl2YXIga2VlcE1kYXREYXRhID0gKF9rZWVwTWRhdERhdGEgIT09IHVuZGVmaW5lZCA/IF9rZWVwTWRhdERhdGEgOiB0cnVlKTsKICAgIAkJCXZhciBmaWxlID0gbmV3IElTT0ZpbGUoX3N0cmVhbSk7CiAgICAJCQlmaWxlLmRpc2NhcmRNZGF0RGF0YSA9IChrZWVwTWRhdERhdGEgPyBmYWxzZSA6IHRydWUpOwogICAgCQkJcmV0dXJuIGZpbGU7CiAgICAJCX07CgogICAgCQl7CiAgICAJCQlleHBvcnRzLmNyZWF0ZUZpbGUgPSBNUDRCb3guY3JlYXRlRmlsZTsKICAgIAkJfSAKICAgIAl9IChtcDRib3hfYWxsKSk7CiAgICAJcmV0dXJuIG1wNGJveF9hbGw7CiAgICB9CgogICAgdmFyIG1wNGJveF9hbGxFeHBvcnRzID0gcmVxdWlyZU1wNGJveF9hbGwoKTsKICAgIHZhciBtcDRib3ggPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMobXA0Ym94X2FsbEV4cG9ydHMpOwoKICAgIGZ1bmN0aW9uIG1wNEZpbGVUb1NhbXBsZXMoZmV0Y2hlcikgewogICAgICAgIHJldHVybiBfX2F3YWl0ZXIkMSh0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICAgICAgbGV0IG1wNEluZm8gPSBudWxsOwogICAgICAgICAgICBsZXQgdmlkZW9UcmFjayA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IGRlY29kZXJDb25maWcgPSB7IHZpZGVvOiBudWxsLCBhdWRpbzogbnVsbCB9OwogICAgICAgICAgICBjb25zdCB2aWRlb1NhbXBsZXMgPSBbXTsKICAgICAgICAgICAgbGV0IHZpZGVvRGVsdGFUUyA9IC0xOwogICAgICAgICAgICBjb25zdCByZWFkZXIgPSB5aWVsZCBmZXRjaGVyLmdldFJlYWRlcigpOwogICAgICAgICAgICB5aWVsZCBxdWlja1BhcnNlTVA0RmlsZShyZWFkZXIsIChkYXRhKSA9PiB7CiAgICAgICAgICAgICAgICBtcDRJbmZvID0gZGF0YS5pbmZvOwogICAgICAgICAgICAgICAgY29uc3QgeyB2aWRlb0RlY29kZXJDb25mOiB2YywgdmlkZW9UcmFja0NvbmY6IHZ0IH0gPSBleHRyYWN0RmlsZUNvbmZpZyhkYXRhLm1wNGJveEZpbGUsIGRhdGEuaW5mbyk7CiAgICAgICAgICAgICAgICBkZWNvZGVyQ29uZmlnLnZpZGVvID0gdmMgIT09IG51bGwgJiYgdmMgIT09IHZvaWQgMCA/IHZjIDogbnVsbDsKICAgICAgICAgICAgICAgIHZpZGVvVHJhY2sgPSB2dCAhPT0gbnVsbCAmJiB2dCAhPT0gdm9pZCAwID8gdnQgOiBudWxsOwogICAgICAgICAgICAgICAgaWYgKHZjID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTm8gdmlkZW8gdHJhY2snKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtcDRib3hmaWxlIG1vb3YgcmVhZHknLCBkZWNvZGVyQ29uZmlnKTsKICAgICAgICAgICAgfSwgKF8sIHR5cGUsIHNhbXBsZXMpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAndmlkZW8nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZGVvRGVsdGFUUyA9PT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvRGVsdGFUUyA9IHNhbXBsZXNbMF0uZHRzOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc2FtcGxlIG9mIHNhbXBsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9TYW1wbGVzLnB1c2gobm9ybWFsaXplVGltZXNjYWxlKHNhbXBsZSwgdmlkZW9EZWx0YVRTKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgeWllbGQgcmVhZGVyLmNsb3NlKCk7CiAgICAgICAgICAgIGNvbnN0IGxhc3RTYW1wbGUgPSB2aWRlb1NhbXBsZXMuYXQoLTEpOwogICAgICAgICAgICBpZiAobXA0SW5mbyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0cmVhbSBpcyBkb25lLCBidXQgbm90IGVtaXQgcmVhZHknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChsYXN0U2FtcGxlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU3RyZWFtIG5vdCBjb250YWluIGFueSBzYW1wbGUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDkv67lpI3pppbluKfpu5HlsY8KICAgICAgICAgICAgZml4Rmlyc3RCbGFja0ZyYW1lKHZpZGVvU2FtcGxlcyk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB2aWRlb1NhbXBsZXMsCiAgICAgICAgICAgICAgICBkZWNvZGVyQ29uZmlnLAogICAgICAgICAgICAgICAgdmlkZW9UcmFjawogICAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gZml4Rmlyc3RCbGFja0ZyYW1lKHNhbXBsZXMpIHsKICAgICAgICBsZXQgaWZyYW1lQ250ID0gMDsKICAgICAgICBsZXQgbWluQ3RzU2FtcGxlID0gbnVsbDsKICAgICAgICBmb3IgKGNvbnN0IHMgb2Ygc2FtcGxlcykgewogICAgICAgICAgICBpZiAocy5kZWxldGVkKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmIChzLmlzX3N5bmMpCiAgICAgICAgICAgICAgICBpZnJhbWVDbnQgKz0gMTsKICAgICAgICAgICAgaWYgKGlmcmFtZUNudCA+PSAyKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGlmIChtaW5DdHNTYW1wbGUgPT0gbnVsbCB8fCBzLmN0cyA8IG1pbkN0c1NhbXBsZS5jdHMpIHsKICAgICAgICAgICAgICAgIG1pbkN0c1NhbXBsZSA9IHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g5raI6ZmkMjAwbXPlhoXnmoTpu5HluKcKICAgICAgICAgICAgaWYgKG1pbkN0c1NhbXBsZSAhPSBudWxsICYmIG1pbkN0c1NhbXBsZS5jdHMgPCAyMDBlMykgewogICAgICAgICAgICAgICAgbWluQ3RzU2FtcGxlLmR1cmF0aW9uICs9IG1pbkN0c1NhbXBsZS5jdHM7CiAgICAgICAgICAgICAgICBtaW5DdHNTYW1wbGUuY3RzID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHF1aWNrUGFyc2VNUDRGaWxlKHJlYWRlciwgb25SZWFkeSwgb25TYW1wbGVzKSB7CiAgICAgICAgcmV0dXJuIF9fYXdhaXRlciQxKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgICAgICBjb25zdCBtcDRib3hGaWxlID0gbXA0Ym94LmNyZWF0ZUZpbGUoZmFsc2UpOwogICAgICAgICAgICBtcDRib3hGaWxlLm9uUmVhZHkgPSAoaW5mbykgPT4gewogICAgICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICAgICAgb25SZWFkeSh7IG1wNGJveEZpbGUsIGluZm8gfSk7CiAgICAgICAgICAgICAgICBjb25zdCB2VHJhY2tJZCA9IChfYSA9IGluZm8udmlkZW9UcmFja3NbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZDsKICAgICAgICAgICAgICAgIGlmICh2VHJhY2tJZCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIG1wNGJveEZpbGUuc2V0RXh0cmFjdGlvbk9wdGlvbnModlRyYWNrSWQsICd2aWRlbycsIHsgbmJTYW1wbGVzOiAxMDAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBUT0RPOiDpn7PpopEKICAgICAgICAgICAgICAgIG1wNGJveEZpbGUuc3RhcnQoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbXA0Ym94RmlsZS5vblNhbXBsZXMgPSBvblNhbXBsZXM7CiAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlciQxKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgICAgICAgICAgICAgIGxldCBjdXJzb3IgPSAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFJlYWRTaXplID0gMzAgKiAxMDI0ICogMTAyNDsgLy8gMzBNQgogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSAoeWllbGQgcmVhZGVyLnJlYWQobWF4UmVhZFNpemUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0OiBjdXJzb3IKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5ieXRlTGVuZ3RoID09PSAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZVN0YXJ0ID0gY3Vyc29yOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0UG9zID0gbXA0Ym94RmlsZS5hcHBlbmRCdWZmZXIoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0UG9zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yID0gbmV4dFBvczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB5aWVsZCBwYXJzZSgpOwogICAgICAgICAgICBtcDRib3hGaWxlLnN0b3AoKTsKICAgICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIGV4dHJhY3RGaWxlQ29uZmlnKGZpbGUsIGluZm8pIHsKICAgICAgICBjb25zdCB2VHJhY2sgPSBpbmZvLnZpZGVvVHJhY2tzWzBdOwogICAgICAgIGNvbnN0IHJzID0ge307CiAgICAgICAgaWYgKHZUcmFjayAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IHZpZGVvRGVzYyA9IHBhcnNlVmlkZW9Db2RlY0Rlc2MoZmlsZS5nZXRUcmFja0J5SWQodlRyYWNrLmlkKSkuYnVmZmVyOwogICAgICAgICAgICBjb25zdCB7IGRlc2NLZXksIHR5cGUgfSA9IHZUcmFjay5jb2RlYy5zdGFydHNXaXRoKCdhdmMxJykKICAgICAgICAgICAgICAgID8geyBkZXNjS2V5OiAnYXZjRGVjb2RlckNvbmZpZ1JlY29yZCcsIHR5cGU6ICdhdmMxJyB9CiAgICAgICAgICAgICAgICA6IHZUcmFjay5jb2RlYy5zdGFydHNXaXRoKCdodmMxJykKICAgICAgICAgICAgICAgICAgICA/IHsgZGVzY0tleTogJ2hldmNEZWNvZGVyQ29uZmlnUmVjb3JkJywgdHlwZTogJ2h2YzEnIH0KICAgICAgICAgICAgICAgICAgICA6IHsgZGVzY0tleTogJycsIHR5cGU6ICcnIH07CiAgICAgICAgICAgIGlmIChkZXNjS2V5ICE9PSAnJykgewogICAgICAgICAgICAgICAgcnMudmlkZW9UcmFja0NvbmYgPSB7CiAgICAgICAgICAgICAgICAgICAgdGltZXNjYWxlOiAxZTYsCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IG5vcm1hbGl6ZVRpbWUodlRyYWNrLmR1cmF0aW9uLCB2VHJhY2sudGltZXNjYWxlKSwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogdlRyYWNrLnZpZGVvLndpZHRoLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogdlRyYWNrLnZpZGVvLmhlaWdodCwKICAgICAgICAgICAgICAgICAgICBicmFuZHM6IGluZm8uYnJhbmRzLAogICAgICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICAgICAgW2Rlc2NLZXldOiB2aWRlb0Rlc2MsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJzLnZpZGVvRGVjb2RlckNvbmYgPSB7CiAgICAgICAgICAgICAgICBjb2RlYzogdlRyYWNrLmNvZGVjLAogICAgICAgICAgICAgICAgY29kZWRIZWlnaHQ6IHZUcmFjay52aWRlby5oZWlnaHQsCiAgICAgICAgICAgICAgICBjb2RlZFdpZHRoOiB2VHJhY2sudmlkZW8ud2lkdGgsCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmlkZW9EZXNjLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICAvLyBUT0RPOiDlpITnkIbpn7PpopHphY3nva4KICAgICAgICByZXR1cm4gcnM7CiAgICB9CiAgICAvLyB0cmFjayBpcyBILjI2NCwgSC4yNjUgb3IgVlBYLgogICAgZnVuY3Rpb24gcGFyc2VWaWRlb0NvZGVjRGVzYyh0cmFjaykgewogICAgICAgIHZhciBfYSwgX2IsIF9jOwogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgdHJhY2subWRpYS5taW5mLnN0Ymwuc3RzZC5lbnRyaWVzKSB7CiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgICAgICAgY29uc3QgYm94ID0gKF9jID0gKF9iID0gKF9hID0gZW50cnkuYXZjQykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZW50cnkuaHZjQykgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZW50cnkuYXYxQykgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogZW50cnkudnBjQzsKICAgICAgICAgICAgaWYgKGJveCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdHJlYW0gPSBuZXcgbXA0Ym94LkRhdGFTdHJlYW0odW5kZWZpbmVkLCAwLCBtcDRib3guRGF0YVN0cmVhbS5CSUdfRU5ESUFOKTsKICAgICAgICAgICAgICAgIGJveC53cml0ZShzdHJlYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHN0cmVhbS5idWZmZXIuc2xpY2UoOCkpOyAvLyBSZW1vdmUgdGhlIGJveCBoZWFkZXIuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgRXJyb3IoJ2F2Y0MsIGh2Y0MsIGF2MUMgb3IgVlBYIG5vdCBmb3VuZCcpOwogICAgfQogICAgZnVuY3Rpb24gaXNJRFJGcmFtZSh1OEFyciwgdHlwZSkgewogICAgICAgIGlmICh0eXBlICE9PSAnYXZjMScgJiYgdHlwZSAhPT0gJ2h2YzEnKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBjb25zdCBkdiA9IG5ldyBEYXRhVmlldyh1OEFyci5idWZmZXIpOwogICAgICAgIGxldCBpID0gMDsKICAgICAgICBmb3IgKDsgaSA8IHU4QXJyLmJ5dGVMZW5ndGggLSA0OykgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2F2YzEnICYmIChkdi5nZXRVaW50OChpICsgNCkgJiAweDFmKSA9PT0gNSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2h2YzEnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuYWxVbml0VHlwZSA9IChkdi5nZXRVaW50OChpICsgNCkgPj4gMSkgJiAweDNmOwogICAgICAgICAgICAgICAgaWYgKG5hbFVuaXRUeXBlID09PSAxOSB8fCBuYWxVbml0VHlwZSA9PT0gMjApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g6Lez6Iez5LiL5LiA5LiqIE5BTFUg57un57ut5qOA5p+lCiAgICAgICAgICAgIGkgKz0gZHYuZ2V0VWludDMyKGkpICsgNDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8g6I635Y+W6LW35aeL5L2N572u55qEIFNFSSDplb/luqYKICAgIGZ1bmN0aW9uIHNlaUxlbk9mU3RhcnQodThBcnIsIHR5cGUpIHsKICAgICAgICBpZiAodHlwZSAhPT0gJ2F2YzEnICYmIHR5cGUgIT09ICdodmMxJykKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgY29uc3QgZHYgPSBuZXcgRGF0YVZpZXcodThBcnIuYnVmZmVyKTsKICAgICAgICBpZiAodHlwZSA9PT0gJ2F2YzEnICYmIChkdi5nZXRVaW50OCg0KSAmIDB4MWYpID09PSA2KSB7CiAgICAgICAgICAgIHJldHVybiBkdi5nZXRVaW50MzIoMCkgKyA0OwogICAgICAgIH0KICAgICAgICBpZiAodHlwZSA9PT0gJ2h2YzEnKSB7CiAgICAgICAgICAgIGNvbnN0IG5hbFVuaXRUeXBlID0gKGR2LmdldFVpbnQ4KDQpID4+IDEpICYgMHgzZjsKICAgICAgICAgICAgaWYgKG5hbFVuaXRUeXBlID09PSAzOSB8fCBuYWxVbml0VHlwZSA9PT0gNDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBkdi5nZXRVaW50MzIoMCkgKyA0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQogICAgZnVuY3Rpb24gbm9ybWFsaXplVGltZXNjYWxlKHMsIGRlbHRhID0gMCwgc2FtcGxlVHlwZSkgewogICAgICAgIGNvbnN0IGlzX2lkciA9IHMuaXNfc3luYyAmJiBpc0lEUkZyYW1lKHMuZGF0YSwgcy5kZXNjcmlwdGlvbi50eXBlKTsKICAgICAgICBsZXQgb2Zmc2V0ID0gcy5vZmZzZXQ7CiAgICAgICAgbGV0IHNpemUgPSBzLnNpemU7CiAgICAgICAgaWYgKGlzX2lkcikgewogICAgICAgICAgICAvLyDlvZMgSURSIOW4p+WJjemdouaQuuW4piBTRUkg5pWw5o2u5Y+v6IO95a+86Ie06Kej56CB5aSx6LSlCiAgICAgICAgICAgIC8vIOaJgOS7peatpOWkhOmAmui/h+aOp+WItiBvZmZzZXTjgIFzaXplIOWtl+autSDot7Pov4cgU0VJIOaVsOaNrgogICAgICAgICAgICBjb25zdCBzZWlMZW4gPSBzZWlMZW5PZlN0YXJ0KHMuZGF0YSwgcy5kZXNjcmlwdGlvbi50eXBlKTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHNlaUxlbjsKICAgICAgICAgICAgc2l6ZSAtPSBzZWlMZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHMpLCB7IGlzX2lkciwKICAgICAgICAgICAgb2Zmc2V0LAogICAgICAgICAgICBzaXplLCBjdHM6ICgocy5jdHMgLSBkZWx0YSkgLyBzLnRpbWVzY2FsZSkgKiAxZTYsIGR0czogKChzLmR0cyAtIGRlbHRhKSAvIHMudGltZXNjYWxlKSAqIDFlNiwgZHVyYXRpb246IChzLmR1cmF0aW9uIC8gcy50aW1lc2NhbGUpICogMWU2LCB0aW1lc2NhbGU6IDFlNiwgCiAgICAgICAgICAgIC8vIOmfs+mikeaVsOaNrumHj+Wwj+WPr+aOp++8jOebtOaOpeS/neWtmOWcqOWGheWtmOS4rQogICAgICAgICAgICBkYXRhOiBudWxsICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVRpbWUodGltZSwgdGltZXNjYWxlKSB7CiAgICAgICAgcmV0dXJuIHRpbWUgLyB0aW1lc2NhbGUgKiAxZTY7CiAgICB9CgogICAgY2xhc3MgV2ViRGVtdXhlciB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMudmlkZW9TYW1wbGVzID0gW107CiAgICAgICAgICAgIHRoaXMuZGVjb2RlQ29uZiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMudmlkZW9UcmFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuZGVtdXhlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBkZW11eChmZXRjaGVyKSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIkMSh0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgZGVjb2RlckNvbmZpZywgdmlkZW9TYW1wbGVzLCB2aWRlb1RyYWNrIH0gPSB5aWVsZCBtcDRGaWxlVG9TYW1wbGVzKGZldGNoZXIpOwogICAgICAgICAgICAgICAgdGhpcy52aWRlb1NhbXBsZXMgPSB2aWRlb1NhbXBsZXM7CiAgICAgICAgICAgICAgICB0aGlzLmRlY29kZUNvbmYgPSBkZWNvZGVyQ29uZmlnOwogICAgICAgICAgICAgICAgdGhpcy52aWRlb1RyYWNrID0gdmlkZW9UcmFjazsKICAgICAgICAgICAgICAgIHRoaXMuZGVtdXhlZCA9IHRydWU7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBkZXN0cm95KCkgewogICAgICAgICAgICB0aGlzLnZpZGVvU2FtcGxlcyA9IFtdOwogICAgICAgICAgICB0aGlzLmRlY29kZUNvbmYgPSBudWxsOwogICAgICAgICAgICB0aGlzLnZpZGVvVHJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLmRlbXV4ZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KICAgIC8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCwgSXRlcmF0b3IgKi8NCg0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIFtdKSkubmV4dCgpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHsNCiAgICAgICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gImZ1bmN0aW9uIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCB0cnVlIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOw0KICAgICAgICByZXR1cm4ga2luZCA9PT0gIm0iID8gZiA6IGtpbmQgPT09ICJhIiA/IGYuY2FsbChyZWNlaXZlcikgOiBmID8gZi52YWx1ZSA6IHN0YXRlLmdldChyZWNlaXZlcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7DQogICAgICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09ICJmdW5jdGlvbiIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgdHJ1ZSA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOw0KICAgICAgICByZXR1cm4gKHN0YXRlLnNldChyZWNlaXZlciwgdmFsdWUpKSwgdmFsdWU7DQogICAgfQ0KDQogICAgdHlwZW9mIFN1cHByZXNzZWRFcnJvciA9PT0gImZ1bmN0aW9uIiA/IFN1cHByZXNzZWRFcnJvciA6IGZ1bmN0aW9uIChlcnJvciwgc3VwcHJlc3NlZCwgbWVzc2FnZSkgew0KICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTsNCiAgICAgICAgcmV0dXJuIGUubmFtZSA9ICJTdXBwcmVzc2VkRXJyb3IiLCBlLmVycm9yID0gZXJyb3IsIGUuc3VwcHJlc3NlZCA9IHN1cHByZXNzZWQsIGU7DQogICAgfTsKCiAgICBjb25zdCBpc0ZpbGUgPSAoZmlsZSkgPT4gZmlsZSBpbnN0YW5jZW9mIEZpbGU7CiAgICBjb25zdCBpc1VSTCA9ICh1cmwpID0+IHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnICYmIHVybC5zdGFydHNXaXRoKCdodHRwJyk7CgogICAgdmFyIFUgPSAocikgPT4gewogICAgICB0aHJvdyBUeXBlRXJyb3Iocik7CiAgICB9OwogICAgdmFyIE8gPSAociwgZSwgdCkgPT4gZS5oYXMocikgfHwgVSgiQ2Fubm90ICIgKyB0KTsKICAgIHZhciBzID0gKHIsIGUsIHQpID0+IChPKHIsIGUsICJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLCB0ID8gdC5jYWxsKHIpIDogZS5nZXQocikpLCBvID0gKHIsIGUsIHQpID0+IGUuaGFzKHIpID8gVSgiQ2Fubm90IGFkZCB0aGUgc2FtZSBwcml2YXRlIG1lbWJlciBtb3JlIHRoYW4gb25jZSIpIDogZSBpbnN0YW5jZW9mIFdlYWtTZXQgPyBlLmFkZChyKSA6IGUuc2V0KHIsIHQpLCBsID0gKHIsIGUsIHQsIGEpID0+IChPKHIsIGUsICJ3cml0ZSB0byBwcml2YXRlIGZpZWxkIiksIGUuc2V0KHIsIHQpLCB0KTsKICAgIGNvbnN0IEsgPSAiS0daMWJtTjBhVzl1S0NsN0luVnpaU0J6ZEhKcFkzUWlPMloxYm1OMGFXOXVJSFVvYmlsN2FXWW9iajA5UFNJdklpbHlaWFIxY201N2NHRnlaVzUwT201MWJHd3NibUZ0WlRvaUluMDdZMjl1YzNRZ1pUMXVMbk53YkdsMEtDSXZJaWt1Wm1sc2RHVnlLR2s5UG1rdWJHVnVaM1JvUGpBcE8ybG1LR1V1YkdWdVozUm9QVDA5TUNsMGFISnZkeUJGY25KdmNpZ2lTVzUyWVd4cFpDQndZWFJvSWlrN1kyOXVjM1FnWVQxbFcyVXViR1Z1WjNSb0xURmRMSEk5SWk4aUsyVXVjMnhwWTJVb01Dd3RNU2t1YW05cGJpZ2lMeUlwTzNKbGRIVnlibnR1WVcxbE9tRXNjR0Z5Wlc1ME9uSjlmV0Z6ZVc1aklHWjFibU4wYVc5dUlIY29iaXhsS1h0amIyNXpkSHR3WVhKbGJuUTZZU3h1WVcxbE9uSjlQWFVvYmlrN2FXWW9ZVDA5Ym5Wc2JDbHlaWFIxY200Z1lYZGhhWFFnYm1GMmFXZGhkRzl5TG5OMGIzSmhaMlV1WjJWMFJHbHlaV04wYjNKNUtDazdZMjl1YzNRZ2FUMWhMbk53YkdsMEtDSXZJaWt1Wm1sc2RHVnlLSFE5UG5RdWJHVnVaM1JvUGpBcE8zUnllWHRzWlhRZ2REMWhkMkZwZENCdVlYWnBaMkYwYjNJdWMzUnZjbUZuWlM1blpYUkVhWEpsWTNSdmNua29LVHRtYjNJb1kyOXVjM1FnY3lCdlppQnBLWFE5WVhkaGFYUWdkQzVuWlhSRWFYSmxZM1J2Y25sSVlXNWtiR1VvY3l4N1kzSmxZWFJsT21VdVkzSmxZWFJsZlNrN2FXWW9aUzVwYzBacGJHVXBjbVYwZFhKdUlHRjNZV2wwSUhRdVoyVjBSbWxzWlVoaGJtUnNaU2h5TEh0amNtVmhkR1U2WlM1amNtVmhkR1Y5S1gxallYUmphQ2gwS1h0cFppaDBMbTVoYldVOVBUMGlUbTkwUm05MWJtUkZjbkp2Y2lJcGNtVjBkWEp1SUc1MWJHdzdkR2h5YjNjZ2RIMTlZMjl1YzNRZ1pqMTdmVHR6Wld4bUxtOXViV1Z6YzJGblpUMWhjM2x1WXlCdVBUNTdkbUZ5SUdrN1kyOXVjM1I3WlhaMFZIbHdaVHBsTEdGeVozTTZZWDA5Ymk1a1lYUmhPMnhsZENCeVBXWmJZUzVtYVd4bFNXUmRPM1J5ZVh0c1pYUWdkRHRqYjI1emRDQnpQVnRkTzJsbUtHVTlQVDBpY21WbmFYTjBaWElpS1h0amIyNXpkQ0JzUFdGM1lXbDBJSGNvWVM1bWFXeGxVR0YwYUN4N1kzSmxZWFJsT2lFd0xHbHpSbWxzWlRvaE1IMHBPMmxtS0d3OVBXNTFiR3dwZEdoeWIzY2dSWEp5YjNJb1lHNXZkQ0JtYjNWdVpDQm1hV3hsT2lBa2UyRXVabWxzWlVsa2ZXQXBPM0k5WVhkaGFYUWdiQzVqY21WaGRHVlRlVzVqUVdOalpYTnpTR0Z1Wkd4bEtIdHRiMlJsT21FdWJXOWtaWDBwTEdaYllTNW1hV3hsU1dSZFBYSjlaV3h6WlNCcFppaGxQVDA5SW1Oc2IzTmxJaWxoZDJGcGRDQnlMbU5zYjNObEtDa3NaR1ZzWlhSbElHWmJZUzVtYVd4bFNXUmRPMlZzYzJVZ2FXWW9aVDA5UFNKMGNuVnVZMkYwWlNJcFlYZGhhWFFnY2k1MGNuVnVZMkYwWlNoaExtNWxkMU5wZW1VcE8yVnNjMlVnYVdZb1pUMDlQU0ozY21sMFpTSXBlMk52Ym5OMGUyUmhkR0U2YkN4dmNIUnpPbTk5UFc0dVpHRjBZUzVoY21kek8zUTlZWGRoYVhRZ2NpNTNjbWwwWlNoc0xHOHBmV1ZzYzJVZ2FXWW9aVDA5UFNKeVpXRmtJaWw3WTI5dWMzUjdiMlptYzJWME9td3NjMmw2WlRwdmZUMXVMbVJoZEdFdVlYSm5jeXhuUFc1bGR5QlZhVzUwT0VGeWNtRjVLRzhwTEdROVlYZGhhWFFnY2k1eVpXRmtLR2NzZTJGME9teDlLU3hqUFdjdVluVm1abVZ5TzNROVpEMDlQVzgvWXpvb0tHazlZeTUwY21GdWMyWmxjaWs5UFc1MWJHdy9kbTlwWkNBd09ta3VZMkZzYkNoakxHUXBLVDgvWXk1emJHbGpaU2d3TEdRcExITXVjSFZ6YUNoMEtYMWxiSE5sSUdVOVBUMGlaMlYwVTJsNlpTSS9kRDFoZDJGcGRDQnlMbWRsZEZOcGVtVW9LVHBsUFQwOUltWnNkWE5vSWlZbVlYZGhhWFFnY2k1bWJIVnphQ2dwTzNObGJHWXVjRzl6ZEUxbGMzTmhaMlVvZTJWMmRGUjVjR1U2SW1OaGJHeGlZV05ySWl4allrbGtPbTR1WkdGMFlTNWpZa2xrTEhKbGRIVnlibFpoYkRwMGZTeHpLWDFqWVhSamFDaDBLWHRqYjI1emRDQnpQWFE3YzJWc1ppNXdiM04wVFdWemMyRm5aU2g3WlhaMFZIbHdaVG9pZEdoeWIzZEZjbkp2Y2lJc1kySkpaRHB1TG1SaGRHRXVZMkpKWkN4bGNuSk5jMmM2Y3k1dVlXMWxLeUk2SUNJcmN5NXRaWE56WVdkbEsyQUtZQ3RLVTA5T0xuTjBjbWx1WjJsbWVTaHVMbVJoZEdFcGZTbDlmWDBwS0NrN0NpOHZJeUJ6YjNWeVkyVk5ZWEJ3YVc1blZWSk1QVzl3Wm5NdGQyOXlhMlZ5TFVZMFVsZHNjV05mTG1wekxtMWhjQW89IiwgUSA9IChyKSA9PiBVaW50OEFycmF5LmZyb20oYXRvYihyKSwgKGUpID0+IGUuY2hhckNvZGVBdCgwKSksIEMgPSB0eXBlb2Ygc2VsZiA8ICJ1IiAmJiBzZWxmLkJsb2IgJiYgbmV3IEJsb2IoW1EoSyldLCB7IHR5cGU6ICJ0ZXh0L2phdmFzY3JpcHQ7Y2hhcnNldD11dGYtOCIgfSk7CiAgICBmdW5jdGlvbiBEKHIpIHsKICAgICAgbGV0IGU7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGUgPSBDICYmIChzZWxmLlVSTCB8fCBzZWxmLndlYmtpdFVSTCkuY3JlYXRlT2JqZWN0VVJMKEMpLCAhZSkgdGhyb3cgIiI7CiAgICAgICAgY29uc3QgdCA9IG5ldyBXb3JrZXIoZSwgewogICAgICAgICAgbmFtZTogciA9PSBudWxsID8gdm9pZCAwIDogci5uYW1lCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHQuYWRkRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCAoKSA9PiB7CiAgICAgICAgICAoc2VsZi5VUkwgfHwgc2VsZi53ZWJraXRVUkwpLnJldm9rZU9iamVjdFVSTChlKTsKICAgICAgICB9KSwgdDsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgcmV0dXJuIG5ldyBXb3JrZXIoCiAgICAgICAgICAiZGF0YTp0ZXh0L2phdmFzY3JpcHQ7YmFzZTY0LCIgKyBLLAogICAgICAgICAgewogICAgICAgICAgICBuYW1lOiByID09IG51bGwgPyB2b2lkIDAgOiByLm5hbWUKICAgICAgICAgIH0KICAgICAgICApOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGUgJiYgKHNlbGYuVVJMIHx8IHNlbGYud2Via2l0VVJMKS5yZXZva2VPYmplY3RVUkwoZSk7CiAgICAgIH0KICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIE0ociwgZSwgdCkgewogICAgICBjb25zdCBhID0gXygpOwogICAgICByZXR1cm4gYXdhaXQgYSgicmVnaXN0ZXIiLCB7IGZpbGVJZDogciwgZmlsZVBhdGg6IGUsIG1vZGU6IHQgfSksIHsKICAgICAgICByZWFkOiBhc3luYyAoaSwgbikgPT4gYXdhaXQgYSgicmVhZCIsIHsKICAgICAgICAgIGZpbGVJZDogciwKICAgICAgICAgIG9mZnNldDogaSwKICAgICAgICAgIHNpemU6IG4KICAgICAgICB9KSwKICAgICAgICB3cml0ZTogYXN5bmMgKGksIG4pID0+IGF3YWl0IGEoCiAgICAgICAgICAid3JpdGUiLAogICAgICAgICAgewogICAgICAgICAgICBmaWxlSWQ6IHIsCiAgICAgICAgICAgIGRhdGE6IGksCiAgICAgICAgICAgIG9wdHM6IG4KICAgICAgICAgIH0sCiAgICAgICAgICBbQXJyYXlCdWZmZXIuaXNWaWV3KGkpID8gaS5idWZmZXIgOiBpXQogICAgICAgICksCiAgICAgICAgY2xvc2U6IGFzeW5jICgpID0+IGF3YWl0IGEoImNsb3NlIiwgewogICAgICAgICAgZmlsZUlkOiByCiAgICAgICAgfSksCiAgICAgICAgdHJ1bmNhdGU6IGFzeW5jIChpKSA9PiBhd2FpdCBhKCJ0cnVuY2F0ZSIsIHsKICAgICAgICAgIGZpbGVJZDogciwKICAgICAgICAgIG5ld1NpemU6IGkKICAgICAgICB9KSwKICAgICAgICBnZXRTaXplOiBhc3luYyAoKSA9PiBhd2FpdCBhKCJnZXRTaXplIiwgewogICAgICAgICAgZmlsZUlkOiByCiAgICAgICAgfSksCiAgICAgICAgZmx1c2g6IGFzeW5jICgpID0+IGF3YWl0IGEoImZsdXNoIiwgewogICAgICAgICAgZmlsZUlkOiByCiAgICAgICAgfSkKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IEkgPSBbXTsKICAgIGxldCBrID0gMDsKICAgIGZ1bmN0aW9uIF8oKSB7CiAgICAgIGlmIChJLmxlbmd0aCA8IDMpIHsKICAgICAgICBjb25zdCBlID0gcigpOwogICAgICAgIHJldHVybiBJLnB1c2goZSksIGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZSA9IElba107CiAgICAgICAgcmV0dXJuIGsgPSAoayArIDEpICUgSS5sZW5ndGgsIGU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcigpIHsKICAgICAgICBjb25zdCBlID0gbmV3IEQoKTsKICAgICAgICBsZXQgdCA9IDAsIGEgPSB7fTsKICAgICAgICByZXR1cm4gZS5vbm1lc3NhZ2UgPSAoewogICAgICAgICAgZGF0YTogaQogICAgICAgIH0pID0+IHsKICAgICAgICAgIHZhciBuLCBjOwogICAgICAgICAgaS5ldnRUeXBlID09PSAiY2FsbGJhY2siID8gKG4gPSBhW2kuY2JJZF0pID09IG51bGwgfHwgbi5yZXNvbHZlKGkucmV0dXJuVmFsKSA6IGkuZXZ0VHlwZSA9PT0gInRocm93RXJyb3IiICYmICgoYyA9IGFbaS5jYklkXSkgPT0gbnVsbCB8fCBjLnJlamVjdChFcnJvcihpLmVyck1zZykpKSwgZGVsZXRlIGFbaS5jYklkXTsKICAgICAgICB9LCBhc3luYyBmdW5jdGlvbihuLCBjLCB1ID0gW10pIHsKICAgICAgICAgIHQgKz0gMTsKICAgICAgICAgIGNvbnN0IHcgPSBuZXcgUHJvbWlzZSgoeSwgVikgPT4gewogICAgICAgICAgICBhW3RdID0geyByZXNvbHZlOiB5LCByZWplY3Q6IFYgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGUucG9zdE1lc3NhZ2UoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjYklkOiB0LAogICAgICAgICAgICAgIGV2dFR5cGU6IG4sCiAgICAgICAgICAgICAgYXJnczogYwogICAgICAgICAgICB9LAogICAgICAgICAgICB1CiAgICAgICAgICApLCB3OwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIFQocikgewogICAgICBpZiAociA9PT0gIi8iKSByZXR1cm4geyBwYXJlbnQ6IG51bGwsIG5hbWU6ICIiIH07CiAgICAgIGNvbnN0IGUgPSByLnNwbGl0KCIvIikuZmlsdGVyKChpKSA9PiBpLmxlbmd0aCA+IDApOwogICAgICBpZiAoZS5sZW5ndGggPT09IDApIHRocm93IEVycm9yKCJJbnZhbGlkIHBhdGgiKTsKICAgICAgY29uc3QgdCA9IGVbZS5sZW5ndGggLSAxXSwgYSA9ICIvIiArIGUuc2xpY2UoMCwgLTEpLmpvaW4oIi8iKTsKICAgICAgcmV0dXJuIHsgbmFtZTogdCwgcGFyZW50OiBhIH07CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBkKHIsIGUpIHsKICAgICAgY29uc3QgeyBwYXJlbnQ6IHQsIG5hbWU6IGEgfSA9IFQocik7CiAgICAgIGlmICh0ID09IG51bGwpIHJldHVybiBhd2FpdCBuYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTsKICAgICAgY29uc3QgaSA9IHQuc3BsaXQoIi8iKS5maWx0ZXIoKG4pID0+IG4ubGVuZ3RoID4gMCk7CiAgICAgIHRyeSB7CiAgICAgICAgbGV0IG4gPSBhd2FpdCBuYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTsKICAgICAgICBmb3IgKGNvbnN0IGMgb2YgaSkKICAgICAgICAgIG4gPSBhd2FpdCBuLmdldERpcmVjdG9yeUhhbmRsZShjLCB7CiAgICAgICAgICAgIGNyZWF0ZTogZS5jcmVhdGUKICAgICAgICAgIH0pOwogICAgICAgIHJldHVybiBlLmlzRmlsZSA/IGF3YWl0IG4uZ2V0RmlsZUhhbmRsZShhLCB7CiAgICAgICAgICBjcmVhdGU6IGUuY3JlYXRlCiAgICAgICAgfSkgOiBhd2FpdCBuLmdldERpcmVjdG9yeUhhbmRsZShhLCB7CiAgICAgICAgICBjcmVhdGU6IGUuY3JlYXRlCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICBpZiAobi5uYW1lID09PSAiTm90Rm91bmRFcnJvciIpCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB0aHJvdyBuOwogICAgICB9CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBKKHIpIHsKICAgICAgY29uc3QgeyBwYXJlbnQ6IGUsIG5hbWU6IHQgfSA9IFQocik7CiAgICAgIGlmIChlID09IG51bGwpIHsKICAgICAgICBjb25zdCBpID0gYXdhaXQgbmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7CiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBuIG9mIGkua2V5cygpKQogICAgICAgICAgYXdhaXQgaS5yZW1vdmVFbnRyeShuLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgYSA9IGF3YWl0IGQoZSwgewogICAgICAgIGNyZWF0ZTogZmFsc2UsCiAgICAgICAgaXNGaWxlOiBmYWxzZQogICAgICB9KTsKICAgICAgYSAhPSBudWxsICYmIGF3YWl0IGEucmVtb3ZlRW50cnkodCwgeyByZWN1cnNpdmU6IHRydWUgfSk7CiAgICB9CiAgICBmdW5jdGlvbiB4KHIsIGUpIHsKICAgICAgcmV0dXJuIGAke3J9LyR7ZX1gLnJlcGxhY2UoIi8vIiwgIi8iKTsKICAgIH0KICAgIGZ1bmN0aW9uIGcocikgewogICAgICByZXR1cm4gbmV3IHYocik7CiAgICB9CiAgICB2YXIgaCwgUywgYjsKICAgIGNvbnN0IEggPSBjbGFzcyBIIHsKICAgICAgY29uc3RydWN0b3IoZSkgewogICAgICAgIG8odGhpcywgaCk7CiAgICAgICAgbyh0aGlzLCBTKTsKICAgICAgICBvKHRoaXMsIGIpOwogICAgICAgIGwodGhpcywgaCwgZSk7CiAgICAgICAgY29uc3QgeyBwYXJlbnQ6IHQsIG5hbWU6IGEgfSA9IFQoZSk7CiAgICAgICAgbCh0aGlzLCBTLCBhKSwgbCh0aGlzLCBiLCB0KTsKICAgICAgfQogICAgICBnZXQga2luZCgpIHsKICAgICAgICByZXR1cm4gImRpciI7CiAgICAgIH0KICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHModGhpcywgUyk7CiAgICAgIH0KICAgICAgZ2V0IHBhdGgoKSB7CiAgICAgICAgcmV0dXJuIHModGhpcywgaCk7CiAgICAgIH0KICAgICAgZ2V0IHBhcmVudCgpIHsKICAgICAgICByZXR1cm4gcyh0aGlzLCBiKSA9PSBudWxsID8gbnVsbCA6IGcocyh0aGlzLCBiKSk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIENyZWF0ZXMgdGhlIGRpcmVjdG9yeS4KICAgICAgICogcmV0dXJuIEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGRpcmVjdG9yeSBpcyBjcmVhdGVkLgogICAgICAgKi8KICAgICAgYXN5bmMgY3JlYXRlKCkgewogICAgICAgIHJldHVybiBhd2FpdCBkKHModGhpcywgaCksIHsKICAgICAgICAgIGNyZWF0ZTogdHJ1ZSwKICAgICAgICAgIGlzRmlsZTogZmFsc2UKICAgICAgICB9KSwgZyhzKHRoaXMsIGgpKTsKICAgICAgfQogICAgICAvKioKICAgICAgICogQ2hlY2tzIGlmIHRoZSBkaXJlY3RvcnkgZXhpc3RzLgogICAgICAgKiByZXR1cm4gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gdHJ1ZSBpZiB0aGUgZGlyZWN0b3J5IGV4aXN0cywgb3RoZXJ3aXNlIGZhbHNlLgogICAgICAgKi8KICAgICAgYXN5bmMgZXhpc3RzKCkgewogICAgICAgIHJldHVybiBhd2FpdCBkKHModGhpcywgaCksIHsKICAgICAgICAgIGNyZWF0ZTogZmFsc2UsCiAgICAgICAgICBpc0ZpbGU6IGZhbHNlCiAgICAgICAgfSkgaW5zdGFuY2VvZiBGaWxlU3lzdGVtRGlyZWN0b3J5SGFuZGxlOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBSZW1vdmVzIHRoZSBkaXJlY3RvcnkuCiAgICAgICAqIHJldHVybiBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBkaXJlY3RvcnkgaXMgcmVtb3ZlZC4KICAgICAgICovCiAgICAgIGFzeW5jIHJlbW92ZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGUgb2YgYXdhaXQgdGhpcy5jaGlsZHJlbigpKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgZS5yZW1vdmUoKTsKICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKHQpOwogICAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCBKKHModGhpcywgaCkpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUud2FybihlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIFJldHJpZXZlcyB0aGUgY2hpbGRyZW4gb2YgdGhlIGRpcmVjdG9yeS4KICAgICAgICogcmV0dXJuIEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGFuIGFycmF5IG9mIG9iamVjdHMgcmVwcmVzZW50aW5nIHRoZSBjaGlsZHJlbi4KICAgICAgICovCiAgICAgIGFzeW5jIGNoaWxkcmVuKCkgewogICAgICAgIGNvbnN0IGUgPSBhd2FpdCBkKHModGhpcywgaCksIHsKICAgICAgICAgIGNyZWF0ZTogZmFsc2UsCiAgICAgICAgICBpc0ZpbGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgaWYgKGUgPT0gbnVsbCkgcmV0dXJuIFtdOwogICAgICAgIGNvbnN0IHQgPSBbXTsKICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGEgb2YgZS52YWx1ZXMoKSkKICAgICAgICAgIHQucHVzaCgoYS5raW5kID09PSAiZmlsZSIgPyBGIDogZykoeChzKHRoaXMsIGgpLCBhLm5hbWUpKSk7CiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIElmIHRoZSBkZXN0IGZvbGRlciBleGlzdHMsIGNvcHkgdGhlIGN1cnJlbnQgZGlyZWN0b3J5IGludG8gdGhlIGRlc3QgZm9sZGVyOwogICAgICAgKiBpZiB0aGUgZGVzdCBmb2xkZXIgZG9lcyBub3QgZXhpc3QsIHJlbmFtZSB0aGUgY3VycmVudCBkaXJlY3RvcnkgdG8gZGVzdCBuYW1lLgogICAgICAgKi8KICAgICAgYXN5bmMgY29weVRvKGUpIHsKICAgICAgICBpZiAoIWF3YWl0IHRoaXMuZXhpc3RzKCkpCiAgICAgICAgICB0aHJvdyBFcnJvcihgZGlyICR7dGhpcy5wYXRofSBub3QgZXhpc3RzYCk7CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBIKSB7CiAgICAgICAgICBjb25zdCB0ID0gYXdhaXQgZS5leGlzdHMoKSA/IGcoeChlLnBhdGgsIHRoaXMubmFtZSkpIDogZTsKICAgICAgICAgIGF3YWl0IHQuY3JlYXRlKCksIGF3YWl0IFByb21pc2UuYWxsKChhd2FpdCB0aGlzLmNoaWxkcmVuKCkpLm1hcCgoYSkgPT4gYS5jb3B5VG8odCkpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBGaWxlU3lzdGVtRGlyZWN0b3J5SGFuZGxlKSB7CiAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCgKICAgICAgICAgICAgKGF3YWl0IHRoaXMuY2hpbGRyZW4oKSkubWFwKGFzeW5jICh0KSA9PiB7CiAgICAgICAgICAgICAgdC5raW5kID09PSAiZmlsZSIgPyBhd2FpdCB0LmNvcHlUbygKICAgICAgICAgICAgICAgIGF3YWl0IGUuZ2V0RmlsZUhhbmRsZSh0Lm5hbWUsIHsgY3JlYXRlOiB0cnVlIH0pCiAgICAgICAgICAgICAgKSA6IGF3YWl0IHQuY29weVRvKAogICAgICAgICAgICAgICAgYXdhaXQgZS5nZXREaXJlY3RvcnlIYW5kbGUodC5uYW1lLCB7IGNyZWF0ZTogdHJ1ZSB9KQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aHJvdyBFcnJvcigiSWxsZWdhbCB0YXJnZXQgdHlwZSIpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBtb3ZlIGRpcmVjdG9yeSwgY29weSB0aGVuIHJlbW92ZSBjdXJyZW50CiAgICAgICAqLwogICAgICBhc3luYyBtb3ZlVG8oZSkgewogICAgICAgIGF3YWl0IHRoaXMuY29weVRvKGUpLCBhd2FpdCB0aGlzLnJlbW92ZSgpOwogICAgICB9CiAgICB9OwogICAgaCA9IG5ldyBXZWFrTWFwKCksIFMgPSBuZXcgV2Vha01hcCgpLCBiID0gbmV3IFdlYWtNYXAoKTsKICAgIGxldCB2ID0gSDsKICAgIGNvbnN0IHogPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgZnVuY3Rpb24gRihyLCBlID0gInJ3IikgewogICAgICBpZiAoZSA9PT0gInJ3IikgewogICAgICAgIGNvbnN0IHQgPSB6LmdldChyKSA/PyBuZXcgVyhyLCBlKTsKICAgICAgICByZXR1cm4gei5zZXQociwgdCksIHQ7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBXKHIsIGUpOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gTihyLCBlLCB0ID0geyBvdmVyd3JpdGU6IHRydWUgfSkgewogICAgICBpZiAoZSBpbnN0YW5jZW9mIFcpIHsKICAgICAgICBhd2FpdCBOKHIsIGF3YWl0IGUuc3RyZWFtKCksIHQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBhID0gYXdhaXQgKHIgaW5zdGFuY2VvZiBXID8gciA6IEYociwgInJ3IikpLmNyZWF0ZVdyaXRlcigpOwogICAgICB0cnkgewogICAgICAgIGlmICh0Lm92ZXJ3cml0ZSAmJiBhd2FpdCBhLnRydW5jYXRlKDApLCBlIGluc3RhbmNlb2YgUmVhZGFibGVTdHJlYW0pIHsKICAgICAgICAgIGNvbnN0IGkgPSBlLmdldFJlYWRlcigpOwogICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgIGNvbnN0IHsgZG9uZTogbiwgdmFsdWU6IGMgfSA9IGF3YWl0IGkucmVhZCgpOwogICAgICAgICAgICBpZiAobikgYnJlYWs7CiAgICAgICAgICAgIGF3YWl0IGEud3JpdGUoYyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgICBhd2FpdCBhLndyaXRlKGUpOwogICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgdGhyb3cgaTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBhd2FpdCBhLmNsb3NlKCk7CiAgICAgIH0KICAgIH0KICAgIGxldCBBID0gMDsKICAgIGNvbnN0ICQgPSAoKSA9PiArK0E7CiAgICB2YXIgZiwgcCwgRywgWiwgWCwgbSwgUiwgWTsKICAgIGNvbnN0IFAgPSBjbGFzcyBQIHsKICAgICAgY29uc3RydWN0b3IoZSwgdCkgewogICAgICAgIG8odGhpcywgZik7CiAgICAgICAgbyh0aGlzLCBwKTsKICAgICAgICBvKHRoaXMsIEcpOwogICAgICAgIG8odGhpcywgWik7CiAgICAgICAgbyh0aGlzLCBYKTsKICAgICAgICBvKHRoaXMsIG0sIDApOwogICAgICAgIG8odGhpcywgUiwgLyogQF9fUFVSRV9fICovICgoKSA9PiB7CiAgICAgICAgICBsZXQgZSA9IG51bGw7CiAgICAgICAgICByZXR1cm4gKCkgPT4gKGwodGhpcywgbSwgcyh0aGlzLCBtKSArIDEpLCBlID8/IChlID0gbmV3IFByb21pc2UoYXN5bmMgKHQsIGEpID0+IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCBpID0gYXdhaXQgTSgKICAgICAgICAgICAgICAgIHModGhpcywgWCksCiAgICAgICAgICAgICAgICBzKHRoaXMsIGYpLAogICAgICAgICAgICAgICAgcyh0aGlzLCBaKQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdChbCiAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICBsKHRoaXMsIG0sIHModGhpcywgbSkgLSAxKSwgIShzKHRoaXMsIG0pID4gMCkgJiYgKGUgPSBudWxsLCBhd2FpdCBpLmNsb3NlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICAgICAgYShpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkpKTsKICAgICAgICB9KSgpKTsKICAgICAgICBvKHRoaXMsIFksIGZhbHNlKTsKICAgICAgICBsKHRoaXMsIFgsICQoKSksIGwodGhpcywgZiwgZSksIGwodGhpcywgWiwgewogICAgICAgICAgcjogInJlYWQtb25seSIsCiAgICAgICAgICBydzogInJlYWR3cml0ZSIsCiAgICAgICAgICAicnctdW5zYWZlIjogInJlYWR3cml0ZS11bnNhZmUiCiAgICAgICAgfVt0XSk7CiAgICAgICAgY29uc3QgeyBwYXJlbnQ6IGEsIG5hbWU6IGkgfSA9IFQoZSk7CiAgICAgICAgaWYgKGEgPT0gbnVsbCkgdGhyb3cgRXJyb3IoIkludmFsaWQgcGF0aCIpOwogICAgICAgIGwodGhpcywgRywgaSksIGwodGhpcywgcCwgYSk7CiAgICAgIH0KICAgICAgZ2V0IGtpbmQoKSB7CiAgICAgICAgcmV0dXJuICJmaWxlIjsKICAgICAgfQogICAgICBnZXQgcGF0aCgpIHsKICAgICAgICByZXR1cm4gcyh0aGlzLCBmKTsKICAgICAgfQogICAgICBnZXQgbmFtZSgpIHsKICAgICAgICByZXR1cm4gcyh0aGlzLCBHKTsKICAgICAgfQogICAgICBnZXQgcGFyZW50KCkgewogICAgICAgIHJldHVybiBzKHRoaXMsIHApID09IG51bGwgPyBudWxsIDogZyhzKHRoaXMsIHApKTsKICAgICAgfQogICAgICAvKioKICAgICAgICogUmFuZG9tIHdyaXRlIHRvIGZpbGUKICAgICAgICovCiAgICAgIGFzeW5jIGNyZWF0ZVdyaXRlcigpIHsKICAgICAgICBpZiAocyh0aGlzLCBaKSA9PT0gInJlYWQtb25seSIpIHRocm93IEVycm9yKCJmaWxlIGlzIHJlYWQtb25seSIpOwogICAgICAgIGlmIChzKHRoaXMsIFkpKSB0aHJvdyBFcnJvcigiT3RoZXIgd3JpdGVyIGhhdmUgbm90IGJlZW4gY2xvc2VkIik7CiAgICAgICAgbCh0aGlzLCBZLCB0cnVlKTsKICAgICAgICBjb25zdCBlID0gbmV3IFRleHRFbmNvZGVyKCksIFt0LCBhXSA9IGF3YWl0IHModGhpcywgUikuY2FsbCh0aGlzKTsKICAgICAgICBsZXQgaSA9IGF3YWl0IHQuZ2V0U2l6ZSgpLCBuID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHdyaXRlOiBhc3luYyAoYywgdSA9IHt9KSA9PiB7CiAgICAgICAgICAgIGlmIChuKSB0aHJvdyBFcnJvcigiV3JpdGVyIGlzIGNsb3NlZCIpOwogICAgICAgICAgICBjb25zdCB3ID0gdHlwZW9mIGMgPT0gInN0cmluZyIgPyBlLmVuY29kZShjKSA6IGMsIHkgPSB1LmF0ID8/IGksIFYgPSB3LmJ5dGVMZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBpID0geSArIFYsIGF3YWl0IHQud3JpdGUodywgeyBhdDogeSB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICB0cnVuY2F0ZTogYXN5bmMgKGMpID0+IHsKICAgICAgICAgICAgaWYgKG4pIHRocm93IEVycm9yKCJXcml0ZXIgaXMgY2xvc2VkIik7CiAgICAgICAgICAgIGF3YWl0IHQudHJ1bmNhdGUoYyksIGkgPiBjICYmIChpID0gYyk7CiAgICAgICAgICB9LAogICAgICAgICAgZmx1c2g6IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgaWYgKG4pIHRocm93IEVycm9yKCJXcml0ZXIgaXMgY2xvc2VkIik7CiAgICAgICAgICAgIGF3YWl0IHQuZmx1c2goKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjbG9zZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgICBpZiAobikgdGhyb3cgRXJyb3IoIldyaXRlciBpcyBjbG9zZWQiKTsKICAgICAgICAgICAgbiA9IHRydWUsIGwodGhpcywgWSwgZmFsc2UpLCBhd2FpdCBhKCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgICAvKioKICAgICAgICogUmFuZG9tIGFjY2VzcyB0byBmaWxlCiAgICAgICAqLwogICAgICBhc3luYyBjcmVhdGVSZWFkZXIoKSB7CiAgICAgICAgY29uc3QgW2UsIHRdID0gYXdhaXQgcyh0aGlzLCBSKS5jYWxsKHRoaXMpOwogICAgICAgIGxldCBhID0gZmFsc2UsIGkgPSAwOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZWFkOiBhc3luYyAobiwgYyA9IHt9KSA9PiB7CiAgICAgICAgICAgIGlmIChhKSB0aHJvdyBFcnJvcigiUmVhZGVyIGlzIGNsb3NlZCIpOwogICAgICAgICAgICBjb25zdCB1ID0gYy5hdCA/PyBpLCB3ID0gYXdhaXQgZS5yZWFkKHUsIG4pOwogICAgICAgICAgICByZXR1cm4gaSA9IHUgKyB3LmJ5dGVMZW5ndGgsIHc7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0U2l6ZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgICBpZiAoYSkgdGhyb3cgRXJyb3IoIlJlYWRlciBpcyBjbG9zZWQiKTsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGUuZ2V0U2l6ZSgpOwogICAgICAgICAgfSwKICAgICAgICAgIGNsb3NlOiBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGEgfHwgKGEgPSB0cnVlLCBhd2FpdCB0KCkpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgYXN5bmMgdGV4dCgpIHsKICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGF3YWl0IHRoaXMuYXJyYXlCdWZmZXIoKSk7CiAgICAgIH0KICAgICAgYXN5bmMgYXJyYXlCdWZmZXIoKSB7CiAgICAgICAgY29uc3QgZSA9IGF3YWl0IGQocyh0aGlzLCBmKSwgeyBjcmVhdGU6IGZhbHNlLCBpc0ZpbGU6IHRydWUgfSk7CiAgICAgICAgcmV0dXJuIGUgPT0gbnVsbCA/IG5ldyBBcnJheUJ1ZmZlcigwKSA6IChhd2FpdCBlLmdldEZpbGUoKSkuYXJyYXlCdWZmZXIoKTsKICAgICAgfQogICAgICBhc3luYyBzdHJlYW0oKSB7CiAgICAgICAgY29uc3QgZSA9IGF3YWl0IHRoaXMuZ2V0T3JpZ2luRmlsZSgpOwogICAgICAgIHJldHVybiBlID09IG51bGwgPyBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgICAgcHVsbDogKHQpID0+IHsKICAgICAgICAgICAgdC5jbG9zZSgpOwogICAgICAgICAgfQogICAgICAgIH0pIDogZS5zdHJlYW0oKTsKICAgICAgfQogICAgICBhc3luYyBnZXRPcmlnaW5GaWxlKCkgewogICAgICAgIHZhciBlOwogICAgICAgIHJldHVybiAoZSA9IGF3YWl0IGQocyh0aGlzLCBmKSwgeyBjcmVhdGU6IGZhbHNlLCBpc0ZpbGU6IHRydWUgfSkpID09IG51bGwgPyB2b2lkIDAgOiBlLmdldEZpbGUoKTsKICAgICAgfQogICAgICBhc3luYyBnZXRTaXplKCkgewogICAgICAgIGNvbnN0IGUgPSBhd2FpdCBkKHModGhpcywgZiksIHsgY3JlYXRlOiBmYWxzZSwgaXNGaWxlOiB0cnVlIH0pOwogICAgICAgIHJldHVybiBlID09IG51bGwgPyAwIDogKGF3YWl0IGUuZ2V0RmlsZSgpKS5zaXplOwogICAgICB9CiAgICAgIGFzeW5jIGV4aXN0cygpIHsKICAgICAgICByZXR1cm4gYXdhaXQgZChzKHRoaXMsIGYpLCB7CiAgICAgICAgICBjcmVhdGU6IGZhbHNlLAogICAgICAgICAgaXNGaWxlOiB0cnVlCiAgICAgICAgfSkgaW5zdGFuY2VvZiBGaWxlU3lzdGVtRmlsZUhhbmRsZTsKICAgICAgfQogICAgICBhc3luYyByZW1vdmUoKSB7CiAgICAgICAgaWYgKHModGhpcywgbSkpIHRocm93IEVycm9yKCJleGlzdHMgdW5jbG9zZWQgcmVhZGVyL3dyaXRlciIpOwogICAgICAgIGF3YWl0IEoocyh0aGlzLCBmKSk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIElmIHRoZSB0YXJnZXQgaXMgYSBmaWxlLCB1c2UgY3VycmVudCBvdmVyd3JpdGUgdGhlIHRhcmdldDsKICAgICAgICogaWYgdGhlIHRhcmdldCBpcyBhIGZvbGRlciwgY29weSB0aGUgY3VycmVudCBmaWxlIGludG8gdGhhdCBmb2xkZXIuCiAgICAgICAqLwogICAgICBhc3luYyBjb3B5VG8oZSkgewogICAgICAgIGlmIChlIGluc3RhbmNlb2YgUCkgewogICAgICAgICAgaWYgKGUucGF0aCA9PT0gdGhpcy5wYXRoKSByZXR1cm47CiAgICAgICAgICBhd2FpdCBOKGUucGF0aCwgdGhpcyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIGlmIChlIGluc3RhbmNlb2YgdikgewogICAgICAgICAgaWYgKCFhd2FpdCB0aGlzLmV4aXN0cygpKQogICAgICAgICAgICB0aHJvdyBFcnJvcihgZmlsZSAke3RoaXMucGF0aH0gbm90IGV4aXN0c2ApOwogICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29weVRvKEYoeChlLnBhdGgsIHRoaXMubmFtZSkpKTsKICAgICAgICB9IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBGaWxlU3lzdGVtRmlsZUhhbmRsZSkgewogICAgICAgICAgYXdhaXQgKGF3YWl0IHRoaXMuc3RyZWFtKCkpLnBpcGVUbyhhd2FpdCBlLmNyZWF0ZVdyaXRhYmxlKCkpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aHJvdyBFcnJvcigiSWxsZWdhbCB0YXJnZXQgdHlwZSIpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiBtb3ZlIGZpbGUsIGNvcHkgdGhlbiByZW1vdmUgY3VycmVudAogICAgICAgKi8KICAgICAgYXN5bmMgbW92ZVRvKGUpIHsKICAgICAgICBhd2FpdCB0aGlzLmNvcHlUbyhlKSwgYXdhaXQgdGhpcy5yZW1vdmUoKTsKICAgICAgfQogICAgfTsKICAgIGYgPSBuZXcgV2Vha01hcCgpLCBwID0gbmV3IFdlYWtNYXAoKSwgRyA9IG5ldyBXZWFrTWFwKCksIFogPSBuZXcgV2Vha01hcCgpLCBYID0gbmV3IFdlYWtNYXAoKSwgbSA9IG5ldyBXZWFrTWFwKCksIFIgPSBuZXcgV2Vha01hcCgpLCBZID0gbmV3IFdlYWtNYXAoKTsKICAgIGxldCBXID0gUDsKICAgIGNvbnN0IEUgPSAiLy5vcGZzLXRvb2xzLXRlbXAtZGlyIjsKICAgIGFzeW5jIGZ1bmN0aW9uIEIocikgewogICAgICB0cnkgewogICAgICAgIGlmIChyLmtpbmQgPT09ICJmaWxlIikgewogICAgICAgICAgaWYgKCFhd2FpdCByLmV4aXN0cygpKSByZXR1cm4gITA7CiAgICAgICAgICBjb25zdCBlID0gYXdhaXQgci5jcmVhdGVXcml0ZXIoKTsKICAgICAgICAgIGF3YWl0IGUudHJ1bmNhdGUoMCksIGF3YWl0IGUuY2xvc2UoKSwgYXdhaXQgci5yZW1vdmUoKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgIGF3YWl0IHIucmVtb3ZlKCk7CiAgICAgICAgcmV0dXJuICEwOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihlKSwgZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHEoKSB7CiAgICAgIHNldEludGVydmFsKGFzeW5jICgpID0+IHsKICAgICAgICBmb3IgKGNvbnN0IGUgb2YgYXdhaXQgZyhFKS5jaGlsZHJlbigpKSB7CiAgICAgICAgICBjb25zdCB0ID0gL15cZCstKFxkKykkLy5leGVjKGUubmFtZSk7CiAgICAgICAgICAodCA9PSBudWxsIHx8IERhdGUubm93KCkgLSBOdW1iZXIodFsxXSkgPiAyNTkyZTUpICYmIGF3YWl0IEIoZSk7CiAgICAgICAgfQogICAgICB9LCA2MCAqIDFlMyk7CiAgICB9CiAgICBjb25zdCBMID0gW107CiAgICBsZXQgaiA9IGZhbHNlOwogICAgYXN5bmMgZnVuY3Rpb24gZWUoKSB7CiAgICAgIGlmIChnbG9iYWxUaGlzLmxvY2FsU3RvcmFnZSA9PSBudWxsKSByZXR1cm47CiAgICAgIGNvbnN0IHIgPSAiT1BGU19UT09MU19FWFBJUkVTX1RNUF9GSUxFUyI7CiAgICAgIGogfHwgKGogPSB0cnVlLCBnbG9iYWxUaGlzLmFkZEV2ZW50TGlzdGVuZXIoInVubG9hZCIsICgpID0+IHsKICAgICAgICBMLmxlbmd0aCAhPT0gMCAmJiBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgKICAgICAgICAgIHIsCiAgICAgICAgICBgJHtsb2NhbFN0b3JhZ2UuZ2V0SXRlbShyKSA/PyAiIn0sJHtMLmpvaW4oIiwiKX1gCiAgICAgICAgKTsKICAgICAgfSkpOwogICAgICBsZXQgZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHIpID8/ICIiOwogICAgICBmb3IgKGNvbnN0IHQgb2YgZS5zcGxpdCgiLCIpKQogICAgICAgIHQubGVuZ3RoICE9PSAwICYmIGF3YWl0IEIoRihgJHtFfS8ke3R9YCkpICYmIChlID0gZS5yZXBsYWNlKHQsICIiKSk7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHIsIGUucmVwbGFjZSgvLHsyLH0vZywgIiwiKSk7CiAgICB9CiAgICAoYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBlOwogICAgICBnbG9iYWxUaGlzLl9fb3Bmc190b29sc190bXBmaWxlX2luaXRfXyAhPT0gdHJ1ZSAmJiAoZ2xvYmFsVGhpcy5fX29wZnNfdG9vbHNfdG1wZmlsZV9pbml0X18gPSB0cnVlLCAhKGdsb2JhbFRoaXMuRmlsZVN5c3RlbURpcmVjdG9yeUhhbmRsZSA9PSBudWxsIHx8IGdsb2JhbFRoaXMuRmlsZVN5c3RlbUZpbGVIYW5kbGUgPT0gbnVsbCB8fCAoKGUgPSBnbG9iYWxUaGlzLm5hdmlnYXRvcikgPT0gbnVsbCA/IHZvaWQgMCA6IGUuc3RvcmFnZS5nZXREaXJlY3RvcnkpID09IG51bGwpICYmIChxKCksIGF3YWl0IGVlKCkpKTsKICAgIH0pKCk7CgogICAgdmFyIF9XZWJGZXRjaGVyX2xvY2FsRmlsZTsKICAgIGNvbnN0IGdldElEID0gKCkgPT4gK25ldyBEYXRlKCk7CiAgICBjbGFzcyBXZWJGZXRjaGVyIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgX1dlYkZldGNoZXJfbG9jYWxGaWxlLnNldCh0aGlzLCBgY29kZWNzLXRlbXAtZGlyL2ZpbGVfJHtnZXRJRCgpfWApOwogICAgICAgICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBsb2FkKGlucHV0KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXZWJGZXRjaGVyIGNhbiBvbmx5IGxvYWQgb25jZSwgcGxlYXNlIGludm9rZSBgZGVzdHJveWAgbWV0aG9kIGlmIHJldXNlIHRoZSBpbnN0YW5jZScpOwogICAgICAgICAgICAgICAgaWYgKGlzVVJMKGlucHV0KSkgewogICAgICAgICAgICAgICAgICAgIHlpZWxkIE4oX19jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfV2ViRmV0Y2hlcl9sb2NhbEZpbGUsICJmIiksIHlpZWxkIHRoaXMuZmV0Y2hSZW1vdGVVUkwoaW5wdXQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzRmlsZShpbnB1dCkpIHsKICAgICAgICAgICAgICAgICAgICB5aWVsZCBOKF9fY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX1dlYkZldGNoZXJfbG9jYWxGaWxlLCAiZiIpLCB0aGlzLmdldExvY2FsRmlsZVN0cmVhbShpbnB1dCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZWFkYWJsZVN0cmVhbSkgewogICAgICAgICAgICAgICAgICAgIHlpZWxkIE4oX19jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfV2ViRmV0Y2hlcl9sb2NhbEZpbGUsICJmIiksIGlucHV0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBpbnB1dCBmb3JtYXQsIG9ubHkgcmVjZWl2ZSB1cmwsIGZpbGUgb3IgcmVhZGFibGVzdHJlYW0nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9XZWJGZXRjaGVyX2xvY2FsRmlsZSwgImYiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGdldFJlYWRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5sb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgaW5zdGFuY2UgaGFzIG5vdCBsb2FkZWQgZmlsZScpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29qYmsnKTsKICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCBGKF9fY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX1dlYkZldGNoZXJfbG9jYWxGaWxlLCAiZiIpKS5jcmVhdGVSZWFkZXIoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGRlc3Ryb3koKSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgeWllbGQgRihfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9XZWJGZXRjaGVyX2xvY2FsRmlsZSwgImYiKSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCh0aGlzLCBfV2ViRmV0Y2hlcl9sb2NhbEZpbGUsIGBjb2RlY3MtdGVtcC1kaXIvZmlsZV8ke2dldElEKCl9YCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmZXRjaFJlbW90ZVVSTCh1cmwpIHsKICAgICAgICAgICAgcmV0dXJuIGZldGNoKHVybCkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5ib2R5KTsKICAgICAgICB9CiAgICAgICAgZ2V0TG9jYWxGaWxlU3RyZWFtKGZpbGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZpbGUuc3RyZWFtKCk7CiAgICAgICAgfQogICAgfQogICAgX1dlYkZldGNoZXJfbG9jYWxGaWxlID0gbmV3IFdlYWtNYXAoKTsKCiAgICBjb25zdCBzbGVlcCA9ICh0aW1lKSA9PiBfX2F3YWl0ZXIkMih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgeyByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGltZSkpOyB9KTsKICAgIGNvbnN0IHZpZGVvU2FtcGxlczJDaHVua3MgPSAoc2FtcGxlcywgcmVhZGVyKSA9PiBfX2F3YWl0ZXIkMih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgIGNvbnN0IGZpcnN0ID0gc2FtcGxlc1swXTsKICAgICAgICBjb25zdCBsYXN0ID0gc2FtcGxlcy5hdCgtMSk7CiAgICAgICAgaWYgKGxhc3QgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIGNvbnN0IHJhbmdlU2l6ZSA9IGxhc3Qub2Zmc2V0ICsgbGFzdC5zaXplIC0gZmlyc3Qub2Zmc2V0OwogICAgICAgIC8vIOWNleasoeivu+WPluaVsOaNruWwj+S6jjMwTULml7bvvIzkuIDmrKHmgKfor7vlj5bpmY3kvY7popHmrKHvvIzkvYbpnIDopoHliqDovb3liLDlhoXlrZjkuK0KICAgICAgICBpZiAocmFuZ2VTaXplIDwgMzBlNikgewogICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoeWllbGQgcmVhZGVyLnJlYWQocmFuZ2VTaXplLCB7IGF0OiBmaXJzdC5vZmZzZXQgfSkpOwogICAgICAgICAgICByZXR1cm4gc2FtcGxlcy5tYXAoKHMpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHMub2Zmc2V0IC0gZmlyc3Qub2Zmc2V0OwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFbmNvZGVkVmlkZW9DaHVuayh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogcy5pc19pZHIgPyAna2V5JyA6ICdkZWx0YScsCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBzLmN0cywKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogcy5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgcy5zaXplKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAvLyDlpKfkuo4zME1C77yM5YiG5qyh6K+75Y+WCiAgICAgICAgcmV0dXJuIHlpZWxkIFByb21pc2UuYWxsKHNhbXBsZXMubWFwKChzKSA9PiBfX2F3YWl0ZXIkMih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEVuY29kZWRWaWRlb0NodW5rKHsKICAgICAgICAgICAgICAgIHR5cGU6IHMuaXNfaWRyID8gJ2tleScgOiAnZGVsdGEnLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBzLmN0cywKICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBzLmR1cmF0aW9uLAogICAgICAgICAgICAgICAgZGF0YTogeWllbGQgcmVhZGVyLnJlYWQocy5zaXplLCB7CiAgICAgICAgICAgICAgICAgICAgYXQ6IHMub2Zmc2V0CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICB9KSkpOwogICAgfSk7CiAgICBjb25zdCBkZWNvZGVDaHVua3MgPSAoZGVjb2RlciwgY2h1bmtzLCBvcHRzKSA9PiB7CiAgICAgICAgaWYgKGRlY29kZXIuc3RhdGUgIT09ICdjb25maWd1cmVkJykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBkZWNvZGVyLmRlY29kZShjaHVua3NbaV0pOwogICAgICAgIC8vIHdpbmRvd3Mg5p+Q5Lqb6K6+5aSHIGZsdXNoIOWPr+iDveS4jeS8muiiqyByZXNvbHZlZO+8jOaJgOS7peS4jeiDvSBhd2FpdCBmbHVzaAogICAgICAgIGRlY29kZXIuZmx1c2goKS5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIEVycm9yKSkKICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgaWYgKGVyci5tZXNzYWdlLmluY2x1ZGVzKCdEZWNvZGluZyBlcnJvcicpICYmCiAgICAgICAgICAgICAgICBvcHRzLm9uRGVjb2RpbmdFcnJvciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBvcHRzLm9uRGVjb2RpbmdFcnJvcihlcnIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHJlc2V0IOS4reaWreino+eggeWZqO+8jOmihOacn+S8muaKm+WHuiBBYm9ydGVkRXJyb3IKICAgICAgICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcygnQWJvcnRlZCBkdWUgdG8gY2xvc2UnKSkgewogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBMb2dMZXZlbEVudW07CiAgICAoZnVuY3Rpb24gKExvZ0xldmVsRW51bSkgewogICAgICAgIExvZ0xldmVsRW51bVsiTE9HIl0gPSAibG9nIjsKICAgICAgICBMb2dMZXZlbEVudW1bIldBUk4iXSA9ICJ3YXJuIjsKICAgICAgICBMb2dMZXZlbEVudW1bIkVSUk9SIl0gPSAiZXJyb3IiOwogICAgfSkoTG9nTGV2ZWxFbnVtIHx8IChMb2dMZXZlbEVudW0gPSB7fSkpOwogICAgY2xhc3MgQ29tbW9uTG9nIHsKICAgICAgICBjb25zdHJ1Y3RvcihwcmVmaXgsIGxldmVsID0gTG9nTGV2ZWxFbnVtLkxPRykgewogICAgICAgICAgICB0aGlzLnByZWZpeCA9IHByZWZpeDsKICAgICAgICAgICAgdGhpcy5sZXZlbCA9IGxldmVsOwogICAgICAgIH0KICAgICAgICBnZXQgaW5uZXJfcHJlZml4KCkgewogICAgICAgICAgICByZXR1cm4gYOOAkCR7dGhpcy5wcmVmaXh944CRYDsKICAgICAgICB9CiAgICAgICAgbG9nKC4uLmFyZ3MpIHsKICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgIT09IExvZ0xldmVsRW51bS5MT0cpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuaW5uZXJfcHJlZml4fSBgLCAuLi5hcmdzKTsKICAgICAgICB9CiAgICAgICAgd2FybiguLi5hcmdzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsID09PSBMb2dMZXZlbEVudW0uRVJST1IpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgJHt0aGlzLmlubmVyX3ByZWZpeH0gYCwgLi4uYXJncyk7CiAgICAgICAgfQogICAgICAgIGVycm9yKC4uLmFyZ3MpIHsKICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgIT09IExvZ0xldmVsRW51bS5FUlJPUikKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihgJHt0aGlzLmlubmVyX3ByZWZpeH0gYCwgLi4uYXJncyk7CiAgICAgICAgfQogICAgfQoKICAgIHZhciBfVmlkZW9GcmFtZUZpbmRlcl9kZWMsIF9WaWRlb0ZyYW1lRmluZGVyX3RzLCBfVmlkZW9GcmFtZUZpbmRlcl9jdXJBYm9ydGVyLCBfVmlkZW9GcmFtZUZpbmRlcl9sYXN0VmZEdXIsIF9WaWRlb0ZyYW1lRmluZGVyX2Rvd25ncmFkZVNvZnREZWNvZGUsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRGVjQ3Vyc29ySWR4LCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0ZyYW1lcywgX1ZpZGVvRnJhbWVGaW5kZXJfb3V0cHV0RnJhbWVDbnQsIF9WaWRlb0ZyYW1lRmluZGVyX2lucHV0Q2h1bmtDbnQsIF9WaWRlb0ZyYW1lRmluZGVyX3NsZWVwQ250LCBfVmlkZW9GcmFtZUZpbmRlcl9wYXJzZUZyYW1lLCBfVmlkZW9GcmFtZUZpbmRlcl9kZWNvZGluZywgX1ZpZGVvRnJhbWVGaW5kZXJfc3RhcnREZWNvZGUsIF9WaWRlb0ZyYW1lRmluZGVyX3Jlc2V0LCBfVmlkZW9GcmFtZUZpbmRlcl9nZXRTdGF0ZTsKICAgIGNvbnN0IGxvZyA9IG5ldyBDb21tb25Mb2coJ1ZpZGVvRnJhbWVGaW5kZXInKTsKICAgIGNsYXNzIFZpZGVvRnJhbWVGaW5kZXIgewogICAgICAgIGNvbnN0cnVjdG9yKGxvY2FsRmlsZVJlYWRlciwgc2FtcGxlcywgY29uZikgewogICAgICAgICAgICB0aGlzLmxvY2FsRmlsZVJlYWRlciA9IGxvY2FsRmlsZVJlYWRlcjsKICAgICAgICAgICAgdGhpcy5zYW1wbGVzID0gc2FtcGxlczsKICAgICAgICAgICAgdGhpcy5jb25mID0gY29uZjsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjLnNldCh0aGlzLCBudWxsKTsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfdHMuc2V0KHRoaXMsIDApOwogICAgICAgICAgICBfVmlkZW9GcmFtZUZpbmRlcl9jdXJBYm9ydGVyLnNldCh0aGlzLCB7IGFib3J0OiBmYWxzZSwgc3Q6IHBlcmZvcm1hbmNlLm5vdygpIH0pOwogICAgICAgICAgICB0aGlzLmZpbmQgPSAodGltZSkgPT4gX19hd2FpdGVyJDIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgImYiKSA9PSBudWxsIHx8CiAgICAgICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgImYiKS5zdGF0ZSA9PT0gJ2Nsb3NlZCcgfHwKICAgICAgICAgICAgICAgICAgICB0aW1lIDw9IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl90cywgImYiKSB8fAogICAgICAgICAgICAgICAgICAgIHRpbWUgLSBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfdHMsICJmIikgPiAzZTYpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzZXQnKTsKICAgICAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfcmVzZXQsICJmIikuY2FsbCh0aGlzLCB0aW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9jdXJBYm9ydGVyLCAiZiIpLmFib3J0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl90cywgdGltZSwgImYiKTsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9jdXJBYm9ydGVyLCB7IGFib3J0OiBmYWxzZSwgc3Q6IHBlcmZvcm1hbmNlLm5vdygpIH0sICJmIik7CiAgICAgICAgICAgICAgICBjb25zdCB2ZiA9IHlpZWxkIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9wYXJzZUZyYW1lLCAiZiIpLmNhbGwodGhpcywgdGltZSwgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgImYiKSwgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2N1ckFib3J0ZXIsICJmIikpOwogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3NsZWVwQ250LCAwLCAiZiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZmOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gZml4IFZpZGVvRnJhbWUgZHVyYXRpb24gaXMgbnVsbAogICAgICAgICAgICBfVmlkZW9GcmFtZUZpbmRlcl9sYXN0VmZEdXIuc2V0KHRoaXMsIDApOwogICAgICAgICAgICBfVmlkZW9GcmFtZUZpbmRlcl9kb3duZ3JhZGVTb2Z0RGVjb2RlLnNldCh0aGlzLCBmYWxzZSk7CiAgICAgICAgICAgIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRGVjQ3Vyc29ySWR4LnNldCh0aGlzLCAwKTsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9GcmFtZXMuc2V0KHRoaXMsIFtdKTsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfb3V0cHV0RnJhbWVDbnQuc2V0KHRoaXMsIDApOwogICAgICAgICAgICBfVmlkZW9GcmFtZUZpbmRlcl9pbnB1dENodW5rQ250LnNldCh0aGlzLCAwKTsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfc2xlZXBDbnQuc2V0KHRoaXMsIDApOwogICAgICAgICAgICBfVmlkZW9GcmFtZUZpbmRlcl9wYXJzZUZyYW1lLnNldCh0aGlzLCAodGltZSwgZGVjLCBhYm9ydGVyKSA9PiBfX2F3YWl0ZXIkMih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgICAgIGlmIChkZWMgPT0gbnVsbCB8fCBkZWMuc3RhdGUgPT09ICdjbG9zZWQnIHx8IGFib3J0ZXIuYWJvcnQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRnJhbWVzLCAiZiIpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZiA9IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0ZyYW1lcywgImYiKVswXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGltZSA8IHZmLnRpbWVzdGFtcCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgLy8g5by55Ye656ys5LiA5binCiAgICAgICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRnJhbWVzLCAiZiIpLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgLy8g56ys5LiA5bin6L+H5pyf77yM5om+5LiL5LiA5binCiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWUgPiB2Zi50aW1lc3RhbXAgKyAoKF9hID0gdmYuZHVyYXRpb24pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZmLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfcGFyc2VGcmFtZSwgImYiKS5jYWxsKHRoaXMsIHRpbWUsIGRlYywgYWJvcnRlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9GcmFtZXMsICJmIikubGVuZ3RoIDwgMTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g6aKE6Kej56CBIOmBv+WFjeetieW+hQogICAgICAgICAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfc3RhcnREZWNvZGUsICJmIikuY2FsbCh0aGlzLCBkZWMpLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9yZXNldCwgImYiKS5jYWxsKHRoaXMsIHRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g56ym5ZCI5pyf5pybCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZmOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g57y65bCR5bin5pWw5o2uCiAgICAgICAgICAgICAgICBpZiAoX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlY29kaW5nLCAiZiIpIHx8CiAgICAgICAgICAgICAgICAgICAgKF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9vdXRwdXRGcmFtZUNudCwgImYiKSA8IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9pbnB1dENodW5rQ250LCAiZiIpICYmIGRlYy5kZWNvZGVRdWV1ZVNpemUgPiAwKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChwZXJmb3JtYW5jZS5ub3coKSAtIGFib3J0ZXIuc3QgPiA2ZTMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1QNENsaXAudGljayB2aWRlbyB0aW1lb3V0LCAke0pTT04uc3RyaW5naWZ5KF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9nZXRTdGF0ZSwgImYiKS5jYWxsKHRoaXMpKX1gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g6Kej56CB5Lit77yM562J5b6F77yM54S25ZCO6YeN6K+VCiAgICAgICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3NsZWVwQ250LCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfc2xlZXBDbnQsICJmIikgKyAxLCAiZiIpOwogICAgICAgICAgICAgICAgICAgIHlpZWxkIHNsZWVwKDE1KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0RlY0N1cnNvcklkeCwgImYiKSA+PSB0aGlzLnNhbXBsZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZGVjb2RlIGNvbXBsZXRlZAogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3N0YXJ0RGVjb2RlLCAiZiIpLmNhbGwodGhpcywgZGVjKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfcmVzZXQsICJmIikuY2FsbCh0aGlzLCB0aW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfcGFyc2VGcmFtZSwgImYiKS5jYWxsKHRoaXMsIHRpbWUsIGRlYywgYWJvcnRlcik7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjb2Rpbmcuc2V0KHRoaXMsIGZhbHNlKTsKICAgICAgICAgICAgX1ZpZGVvRnJhbWVGaW5kZXJfc3RhcnREZWNvZGUuc2V0KHRoaXMsIChkZWMpID0+IF9fYXdhaXRlciQyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2M7CiAgICAgICAgICAgICAgICBpZiAoX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlY29kaW5nLCAiZiIpIHx8IGRlYy5kZWNvZGVRdWV1ZVNpemUgPiA2MDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgLy8g5ZCv5Yqo6Kej56CB5Lu75Yqh77yM54S25ZCO6YeN6K+VCiAgICAgICAgICAgICAgICBsZXQgZW5kSWR4ID0gX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRGVjQ3Vyc29ySWR4LCAiZiIpICsgMTsKICAgICAgICAgICAgICAgIGlmIChlbmRJZHggPiB0aGlzLnNhbXBsZXMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9kZWNvZGluZywgdHJ1ZSwgImYiKTsKICAgICAgICAgICAgICAgIC8vIOivpSBHb1Ag5pe26Ze05Yy66Ze05pyJ5pe26Ze05Yy56YWN77yM5LiU5pyq6KKr5Yig6Zmk55qE5binCiAgICAgICAgICAgICAgICBsZXQgaGFzVmFsaWRGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgZm9yICg7IGVuZElkeCA8IHRoaXMuc2FtcGxlcy5sZW5ndGg7IGVuZElkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuc2FtcGxlc1tlbmRJZHhdOwogICAgICAgICAgICAgICAgICAgIGlmICghaGFzVmFsaWRGcmFtZSAmJiAhcy5kZWxldGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhc1ZhbGlkRnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyDmib7kuIDkuKogR29Q77yM5omA5Lul5piv5LiL5LiA5LiqIElEUiDluKfnu5PmnZ8KICAgICAgICAgICAgICAgICAgICBpZiAocy5pc19pZHIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhhc1ZhbGlkRnJhbWUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVzID0gdGhpcy5zYW1wbGVzLnNsaWNlKF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0RlY0N1cnNvcklkeCwgImYiKSwgZW5kSWR4KTsKICAgICAgICAgICAgICAgICAgICBpZiAoKChfYSA9IHNhbXBsZXNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc19pZHIpICE9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCdGaXJzdCBzYW1wbGUgbm90IGlkciBmcmFtZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVhZFN0YXJUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IHlpZWxkIHZpZGVvU2FtcGxlczJDaHVua3Moc2FtcGxlcywgdGhpcy5sb2NhbEZpbGVSZWFkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFkQ29zdCA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcmVhZFN0YXJUaW1lOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhZENvc3QgPiAxMDAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdCA9IHNhbXBsZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0ID0gc2FtcGxlcy5hdCgtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nU2l6ZSA9IGxhc3Qub2Zmc2V0ICsgbGFzdC5zaXplIC0gZmlyc3Qub2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oYFJlYWQgdmlkZW8gc2FtcGxlcyB0aW1lIGNvc3Q6ICR7TWF0aC5yb3VuZChyZWFkQ29zdCl9bXMsIGZpbGUgY2h1bmsgc2l6ZTogJHtyYW5nU2l6ZX1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyBXYWl0IGZvciB0aGUgcHJldmlvdXMgYXN5bmNocm9ub3VzIG9wZXJhdGlvbiB0byBjb21wbGV0ZSwgYXQgd2hpY2ggcG9pbnQgdGhlIHRhc2sgbWF5IGhhdmUgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlYy5zdGF0ZSA9PT0gJ2Nsb3NlZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9sYXN0VmZEdXIsIChfYyA9IChfYiA9IGNodW5rc1swXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmR1cmF0aW9uKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAwLCAiZiIpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWNvZGVDaHVua3MoZGVjLCBjaHVua3MsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRGVjb2RpbmdFcnJvcjogKGVycikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfZG93bmdyYWRlU29mdERlY29kZSwgImYiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9vdXRwdXRGcmFtZUNudCwgImYiKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfZG93bmdyYWRlU29mdERlY29kZSwgdHJ1ZSwgImYiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oJ0Rvd25ncmFkZSB0byBzb2Z0d2FyZSBkZWNvZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3Jlc2V0LCAiZiIpLmNhbGwodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9pbnB1dENodW5rQ250LCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfaW5wdXRDaHVua0NudCwgImYiKSArIGNodW5rcy5sZW5ndGgsICJmIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRGVjQ3Vyc29ySWR4LCBlbmRJZHgsICJmIik7CiAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjb2RpbmcsIGZhbHNlLCAiZiIpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIF9WaWRlb0ZyYW1lRmluZGVyX3Jlc2V0LnNldCh0aGlzLCAodGltZSkgPT4gewogICAgICAgICAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9kZWNvZGluZywgZmFsc2UsICJmIik7CiAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9GcmFtZXMsICJmIikuZm9yRWFjaCgoZikgPT4gZi5jbG9zZSgpKTsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0ZyYW1lcywgW10sICJmIik7CiAgICAgICAgICAgICAgICBpZiAodGltZSA9PSBudWxsIHx8IHRpbWUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9EZWNDdXJzb3JJZHgsIDAsICJmIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsZXQga2V5SWR4ID0gMDsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2FtcGxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gdGhpcy5zYW1wbGVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5pc19pZHIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlJZHggPSBpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5jdHMgPCB0aW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0RlY0N1cnNvcklkeCwga2V5SWR4LCAiZiIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfaW5wdXRDaHVua0NudCwgMCwgImYiKTsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9vdXRwdXRGcmFtZUNudCwgMCwgImYiKTsKICAgICAgICAgICAgICAgIGlmICgoKF9hID0gX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgImYiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSAhPT0gJ2Nsb3NlZCcpCiAgICAgICAgICAgICAgICAgICAgKF9iID0gX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgImYiKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBlbmNvZGVyQ29uZiA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jb25mKSwgKF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9kb3duZ3JhZGVTb2Z0RGVjb2RlLCAiZiIpCiAgICAgICAgICAgICAgICAgICAgPyB7IGhhcmR3YXJlQWNjZWxlcmF0aW9uOiAncHJlZmVyLXNvZnR3YXJlJyB9CiAgICAgICAgICAgICAgICAgICAgOiB7fSkpOwogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgbmV3IFZpZGVvRGVjb2Rlcih7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiAodmYpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX291dHB1dEZyYW1lQ250LCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfb3V0cHV0RnJhbWVDbnQsICJmIikgKyAxLCAiZiIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmYudGltZXN0YW1wID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmYuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcnNWZiA9IHZmOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmYuZHVyYXRpb24gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcnNWZiA9IG5ldyBWaWRlb0ZyYW1lKHZmLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9sYXN0VmZEdXIsICJmIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZmLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRnJhbWVzLCAiZiIpLnB1c2gocnNWZik7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogKGVycikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvZGVjIHJlY2xhaW1lZCBkdWUgdG8gaW5hY3Rpdml0eScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjLCBudWxsLCAiZiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVyck1zZyA9IGBWaWRlb0ZpbmRlciBWaWRlb0RlY29kZXIgZXJyOiAke2Vyci5tZXNzYWdlfSwgY29uZmlnOiAke0pTT04uc3RyaW5naWZ5KGVuY29kZXJDb25mKX0sIHN0YXRlOiAke0pTT04uc3RyaW5naWZ5KF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9nZXRTdGF0ZSwgImYiKS5jYWxsKHRoaXMpKX1gOwogICAgICAgICAgICAgICAgICAgICAgICBsb2cuZXJyb3IoZXJyTXNnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoZXJyTXNnKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSksICJmIik7CiAgICAgICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjLCAiZiIpLmNvbmZpZ3VyZShlbmNvZGVyQ29uZik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfVmlkZW9GcmFtZUZpbmRlcl9nZXRTdGF0ZS5zZXQodGhpcywgKCkgPT4gewogICAgICAgICAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAgICAgICAgIHJldHVybiAoewogICAgICAgICAgICAgICAgICAgIHRpbWU6IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl90cywgImYiKSwKICAgICAgICAgICAgICAgICAgICBkZWNTdGF0ZTogKF9hID0gX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgImYiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLAogICAgICAgICAgICAgICAgICAgIGRlY1FTaXplOiAoX2IgPSBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjLCAiZiIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGVjb2RlUXVldWVTaXplLAogICAgICAgICAgICAgICAgICAgIGRlY0N1c29ySWR4OiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9EZWNDdXJzb3JJZHgsICJmIiksCiAgICAgICAgICAgICAgICAgICAgc2FtcGxlTGVuOiB0aGlzLnNhbXBsZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGlucHV0Q250OiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfaW5wdXRDaHVua0NudCwgImYiKSwKICAgICAgICAgICAgICAgICAgICBvdXRwdXRDbnQ6IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9vdXRwdXRGcmFtZUNudCwgImYiKSwKICAgICAgICAgICAgICAgICAgICBjYWNoZUZyYW1lTGVuOiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9GcmFtZXMsICJmIikubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIHNvZnREZW9jZGU6IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9kb3duZ3JhZGVTb2Z0RGVjb2RlLCAiZiIpLAogICAgICAgICAgICAgICAgICAgIHNsZWVwQ250OiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX1ZpZGVvRnJhbWVGaW5kZXJfc2xlZXBDbnQsICJmIiksCiAgICAgICAgICAgICAgICAgICAgbWVtSW5mbzogbWVtb3J5VXNhZ2VJbmZvKCksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZGVzdHJveSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7CiAgICAgICAgICAgICAgICBpZiAoKChfYSA9IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9kZWMsICJmIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgIT09ICdjbG9zZWQnKQogICAgICAgICAgICAgICAgICAgIChfYiA9IF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9kZWMsICJmIikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbG9zZSgpOwogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX2RlYywgbnVsbCwgImYiKTsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl9jdXJBYm9ydGVyLCAiZiIpLmFib3J0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfVmlkZW9GcmFtZUZpbmRlcl92aWRlb0ZyYW1lcywgImYiKS5mb3JFYWNoKChmKSA9PiBmLmNsb3NlKCkpOwogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRnJhbWVzLCBbXSwgImYiKTsKICAgICAgICAgICAgICAgIHRoaXMubG9jYWxGaWxlUmVhZGVyLmNsb3NlKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgX1ZpZGVvRnJhbWVGaW5kZXJfZGVjID0gbmV3IFdlYWtNYXAoKSwgX1ZpZGVvRnJhbWVGaW5kZXJfdHMgPSBuZXcgV2Vha01hcCgpLCBfVmlkZW9GcmFtZUZpbmRlcl9jdXJBYm9ydGVyID0gbmV3IFdlYWtNYXAoKSwgX1ZpZGVvRnJhbWVGaW5kZXJfbGFzdFZmRHVyID0gbmV3IFdlYWtNYXAoKSwgX1ZpZGVvRnJhbWVGaW5kZXJfZG93bmdyYWRlU29mdERlY29kZSA9IG5ldyBXZWFrTWFwKCksIF9WaWRlb0ZyYW1lRmluZGVyX3ZpZGVvRGVjQ3Vyc29ySWR4ID0gbmV3IFdlYWtNYXAoKSwgX1ZpZGVvRnJhbWVGaW5kZXJfdmlkZW9GcmFtZXMgPSBuZXcgV2Vha01hcCgpLCBfVmlkZW9GcmFtZUZpbmRlcl9vdXRwdXRGcmFtZUNudCA9IG5ldyBXZWFrTWFwKCksIF9WaWRlb0ZyYW1lRmluZGVyX2lucHV0Q2h1bmtDbnQgPSBuZXcgV2Vha01hcCgpLCBfVmlkZW9GcmFtZUZpbmRlcl9zbGVlcENudCA9IG5ldyBXZWFrTWFwKCksIF9WaWRlb0ZyYW1lRmluZGVyX3BhcnNlRnJhbWUgPSBuZXcgV2Vha01hcCgpLCBfVmlkZW9GcmFtZUZpbmRlcl9kZWNvZGluZyA9IG5ldyBXZWFrTWFwKCksIF9WaWRlb0ZyYW1lRmluZGVyX3N0YXJ0RGVjb2RlID0gbmV3IFdlYWtNYXAoKSwgX1ZpZGVvRnJhbWVGaW5kZXJfcmVzZXQgPSBuZXcgV2Vha01hcCgpLCBfVmlkZW9GcmFtZUZpbmRlcl9nZXRTdGF0ZSA9IG5ldyBXZWFrTWFwKCk7CiAgICBmdW5jdGlvbiBtZW1vcnlVc2FnZUluZm8oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy9AdHMtZXhwZWN0LWVycm9yIFBlcmZvcm1hbmNlIG1heWJlIG5vdCBjb250YWluIG1lbW9yeQogICAgICAgICAgICBjb25zdCBtZW0gPSBwZXJmb3JtYW5jZS5tZW1vcnk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBqc0hlYXBTaXplTGltaXQ6IG1lbS5qc0hlYXBTaXplTGltaXQsCiAgICAgICAgICAgICAgICB0b3RhbEpTSGVhcFNpemU6IG1lbS50b3RhbEpTSGVhcFNpemUsCiAgICAgICAgICAgICAgICB1c2VkSlNIZWFwU2l6ZTogbWVtLnVzZWRKU0hlYXBTaXplLAogICAgICAgICAgICAgICAgcGVyY2VudFVzZWQ6IChtZW0udXNlZEpTSGVhcFNpemUgLyBtZW0uanNIZWFwU2l6ZUxpbWl0KS50b0ZpeGVkKDMpLAogICAgICAgICAgICAgICAgcGVyY2VudFRvdGFsOiAobWVtLnRvdGFsSlNIZWFwU2l6ZSAvIG1lbS5qc0hlYXBTaXplTGltaXQpLnRvRml4ZWQoMyksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNhdGNoIChfYSkgewogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgfQogICAgfQoKICAgIHZhciBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2ZldGNoZXIsIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZGVtdXhlciwgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9mcmFtZUZpbmRlcjsKICAgIGNsYXNzIENvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB7CiAgICAgICAgICAgICAgICBmZXRjaGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlbXV4ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgaW5pdGQ6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZmV0Y2hlci5zZXQodGhpcywgbmV3IFdlYkZldGNoZXIoKSk7CiAgICAgICAgICAgIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZGVtdXhlci5zZXQodGhpcywgbmV3IFdlYkRlbXV4ZXIoKSk7CiAgICAgICAgICAgIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZnJhbWVGaW5kZXIuc2V0KHRoaXMsIG51bGwpOwogICAgICAgIH0KICAgICAgICBzdGF0aWMgaXNTdXBwb3J0KCkgewogICAgICAgICAgICByZXR1cm4gKHdpbmRvdyA9PT0gbnVsbCB8fCB3aW5kb3cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHdpbmRvdy5WaWRlb0RlY29kZXIpICYmICh3aW5kb3cgPT09IG51bGwgfHwgd2luZG93ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aW5kb3cuaXNTZWN1cmVDb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgbG9hZChpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyJDIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICAgICAgICB5aWVsZCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9mZXRjaGVyLCAiZiIpLmxvYWQoaW5wdXQpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5mZXRjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHlpZWxkIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2RlbXV4ZXIsICJmIikuZGVtdXgoX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZmV0Y2hlciwgImYiKSk7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmRlbXV4ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCQxKHRoaXMsIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZnJhbWVGaW5kZXIsIG5ldyBWaWRlb0ZyYW1lRmluZGVyKHlpZWxkIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2ZldGNoZXIsICJmIikuZ2V0UmVhZGVyKCksIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2RlbXV4ZXIsICJmIikudmlkZW9TYW1wbGVzLCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9kZW11eGVyLCAiZiIpLmRlY29kZUNvbmYudmlkZW8pLCAiZiIpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5pbml0ZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZGVtdXhlciwgImYiKS52aWRlb1RyYWNrOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZmluZCh0aW1lKSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIkMih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5pbml0ZCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNob3VsZCBsb2FkIGZpcnN0Iik7CiAgICAgICAgICAgICAgICBjb25zdCB2ZiA9IHlpZWxkICgoX2EgPSBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9mcmFtZUZpbmRlciwgImYiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmQodGltZSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZmOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdGh1bWJuYWlscyhwYXJhbXMpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlciQyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmRlbXV4ZWQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJTaG91bGQgbG9hZCBmaXJzdCIpOwogICAgICAgICAgICAgICAgY29uc3QgZnJhbWVGaW5kZXIgPSBuZXcgVmlkZW9GcmFtZUZpbmRlcih5aWVsZCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9mZXRjaGVyLCAiZiIpLmdldFJlYWRlcigpLCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9kZW11eGVyLCAiZiIpLnZpZGVvU2FtcGxlcywgX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZGVtdXhlciwgImYiKS5kZWNvZGVDb25mLnZpZGVvKTsKICAgICAgICAgICAgICAgIGNvbnN0IHsgc3RhcnQsIGVuZCwgc3RlcCB9ID0gcGFyYW1zOwogICAgICAgICAgICAgICAgY29uc3QgZnJhbWVzID0gW107CiAgICAgICAgICAgICAgICBsZXQgY3VyID0gc3RhcnQ7CiAgICAgICAgICAgICAgICB3aGlsZSAoY3VyIDw9IGVuZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZmID0geWllbGQgZnJhbWVGaW5kZXIuZmluZChjdXIpOwogICAgICAgICAgICAgICAgICAgIGlmICh2ZikKICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVzLnB1c2godmYpOwogICAgICAgICAgICAgICAgICAgIGN1ciArPSBzdGVwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnJhbWVGaW5kZXIuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZyYW1lczsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGRlc3Ryb3koKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgKF9hID0gX19jbGFzc1ByaXZhdGVGaWVsZEdldCQxKHRoaXMsIF9Db2RlY3NFeHRyYWN0RnJhbWVNb2R1bGVfZnJhbWVGaW5kZXIsICJmIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZXN0cm95KCk7CiAgICAgICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQkMSh0aGlzLCBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2RlbXV4ZXIsICJmIikuZGVzdHJveSgpOwogICAgICAgICAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0JDEodGhpcywgX0NvZGVjc0V4dHJhY3RGcmFtZU1vZHVsZV9mZXRjaGVyLCAiZiIpLmRlc3Ryb3koKTsKICAgICAgICB9CiAgICB9CiAgICBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2ZldGNoZXIgPSBuZXcgV2Vha01hcCgpLCBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2RlbXV4ZXIgPSBuZXcgV2Vha01hcCgpLCBfQ29kZWNzRXh0cmFjdEZyYW1lTW9kdWxlX2ZyYW1lRmluZGVyID0gbmV3IFdlYWtNYXAoKTsKCiAgICB2YXIgV29ya2VyRXZlbnRFbnVtOwogICAgKGZ1bmN0aW9uIChXb3JrZXJFdmVudEVudW0pIHsKICAgICAgICBXb3JrZXJFdmVudEVudW1bIklOSVQiXSA9ICJpbml0IjsKICAgICAgICBXb3JrZXJFdmVudEVudW1bIkVSUk9SIl0gPSAiZXJyb3IiOwogICAgICAgIFdvcmtlckV2ZW50RW51bVsiRklORCJdID0gImZpbmQiOwogICAgICAgIFdvcmtlckV2ZW50RW51bVsiVEhVTUJOQUlMUyJdID0gInRodW1ibmFpbHMiOwogICAgICAgIFdvcmtlckV2ZW50RW51bVsiQ0xPU0UiXSA9ICJjbG9zZSI7CiAgICB9KShXb3JrZXJFdmVudEVudW0gfHwgKFdvcmtlckV2ZW50RW51bSA9IHt9KSk7CgogICAgc2VsZi5pbnN0YW5jZSA9IG5ldyBDb2RlY3NFeHRyYWN0RnJhbWVNb2R1bGUoKTsKICAgIHNlbGYub25tZXNzYWdlID0gKF9hKSA9PiBfX2F3YWl0ZXIkMih2b2lkIDAsIFtfYV0sIHZvaWQgMCwgZnVuY3Rpb24qICh7IGRhdGE6IHsgdHlwZSwgaWQsIGRhdGE6IF9kYXRhIH0gfSkgewogICAgICAgIGxldCByZXN1bHQ7CiAgICAgICAgY29uc3QgdHJhbnNmZXJhYmxlID0gW107CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50RW51bS5JTklUOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHlpZWxkIHNlbGYuaW5zdGFuY2UubG9hZChfZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50RW51bS5GSU5EOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHlpZWxkIHNlbGYuaW5zdGFuY2UuZmluZChfZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmZXJhYmxlLnB1c2gocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnRFbnVtLlRIVU1CTkFJTFM6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0geWllbGQgc2VsZi5pbnN0YW5jZS50aHVtYm5haWxzKF9kYXRhKTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2ZlcmFibGUucHVzaCguLi5yZXN1bHQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudEVudW0uQ0xPU0U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbnN0YW5jZS5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyB0eXBlLCBkYXRhOiByZXN1bHQsIGlkIH0sIHRyYW5zZmVyYWJsZSk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IHR5cGU6IFdvcmtlckV2ZW50RW51bS5FUlJPUiwgZGF0YTogZXJyLCBpZCB9KTsKICAgICAgICB9CiAgICB9KTsKCn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtlci5qcy5tYXAKCg=="),zt,Li,qn,$I,Lt,EI;const zh=(()=>{let e=0;return()=>e++})();class LA{get loaded(){return ug(this,Li,"f")}static isSupport(){return(window==null?void 0:window.VideoDecoder)&&(window==null?void 0:window.isSecureContext)}constructor(){if(zt.add(this),Li.set(this,!1),qn.set(this,void 0),$I.set(this,{}),Lt.set(this,{}),!LA.isSupport())throw new Error("");Nu(this,qn,new Nh),this.initEvent()}load(g){let l=g;return g instanceof File&&(l=g.stream()),ug(this,zt,"m",EI).call(this,{type:kl.INIT,data:l},typeof g=="string"?[]:[l])}find(g){if(!this.loaded)throw new rr(gt.UN_LOADED);return ug(this,zt,"m",EI).call(this,{type:kl.FIND,data:g})}thumbnails(g){if(!this.loaded)throw new rr(gt.UN_LOADED);return ug(this,zt,"m",EI).call(this,{type:kl.THUMBNAILS,data:g})}destroy(){ug(this,zt,"m",EI).call(this,{type:kl.CLOSE}),ug(this,qn,"f").terminate();const g=Object.keys(ug(this,Lt,"f"));for(const l of g)ug(this,Lt,"f")[l](new rr(gt.TERMINATED))}initEvent(){ug(this,qn,"f").onmessage=this.handleMessage.bind(this),ug(this,qn,"f").onmessageerror=this.handleMessageError.bind(this)}handleMessage({data:{id:g,type:l,data:t}}){switch(l){case kl.INIT:Nu(this,Li,!0),ug(this,$I,"f")[g](t);break;case kl.FIND:case kl.THUMBNAILS:ug(this,$I,"f")[g](t);break;case kl.ERROR:ug(this,Lt,"f")[g](t);break;case kl.CLOSE:}}handleMessageError(g){console.error(g)}}Li=new WeakMap,qn=new WeakMap,$I=new WeakMap,Lt=new WeakMap,zt=new WeakSet,EI=function(g,l=[]){return new Promise((t,I)=>{const i=zh();ug(this,$I,"f")[i]=t,ug(this,Lt,"f")[i]=I,ug(this,qn,"f").postMessage(Object.assign(Object.assign({},g),{id:i}),l)})};var UA=u.createContext({});function Be(){return Be=Object.assign?Object.assign.bind():function(e){for(var g=1;g<arguments.length;g++){var l=arguments[g];for(var t in l)({}).hasOwnProperty.call(l,t)&&(e[t]=l[t])}return e},Be.apply(null,arguments)}function SJ(e){if(Array.isArray(e))return e}function Lh(e,g){var l=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(l!=null){var t,I,i,a,r=[],s=!0,d=!1;try{if(i=(l=l.call(e)).next,g===0){if(Object(l)!==l)return;s=!1}else for(;!(s=(t=i.call(l)).done)&&(r.push(t.value),r.length!==g);s=!0);}catch(J){d=!0,I=J}finally{try{if(!s&&l.return!=null&&(a=l.return(),Object(a)!==a))return}finally{if(d)throw I}}return r}}function Ur(e,g){(g==null||g>e.length)&&(g=e.length);for(var l=0,t=Array(g);l<g;l++)t[l]=e[l];return t}function MA(e,g){if(e){if(typeof e=="string")return Ur(e,g);var l={}.toString.call(e).slice(8,-1);return l==="Object"&&e.constructor&&(l=e.constructor.name),l==="Map"||l==="Set"?Array.from(e):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?Ur(e,g):void 0}}function YJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oe(e,g){return SJ(e)||Lh(e,g)||MA(e,g)||YJ()}function Qe(e){"@babel/helpers - typeof";return Qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},Qe(e)}function Uh(e,g){if(Qe(e)!="object"||!e)return e;var l=e[Symbol.toPrimitive];if(l!==void 0){var t=l.call(e,g);if(Qe(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(e)}function FJ(e){var g=Uh(e,"string");return Qe(g)=="symbol"?g:g+""}function D(e,g,l){return(g=FJ(g))in e?Object.defineProperty(e,g,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[g]=l,e}function Mh(e,g){if(e==null)return{};var l={};for(var t in e)if({}.hasOwnProperty.call(e,t)){if(g.indexOf(t)!==-1)continue;l[t]=e[t]}return l}function wC(e,g){if(e==null)return{};var l,t,I=Mh(e,g);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)l=i[t],g.indexOf(l)===-1&&{}.propertyIsEnumerable.call(e,l)&&(I[l]=e[l])}return I}var Ar={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var zu;function xh(){return zu||(zu=1,function(e){(function(){var g={}.hasOwnProperty;function l(){for(var i="",a=0;a<arguments.length;a++){var r=arguments[a];r&&(i=I(i,t(r)))}return i}function t(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return l.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var a="";for(var r in i)g.call(i,r)&&i[r]&&(a=I(a,r));return a}function I(i,a){return a?i?i+" "+a:i+a:i}e.exports?(l.default=l,e.exports=l):window.classNames=l})()}(Ar)),Ar.exports}var Th=xh();const me=NA(Th),lg=Math.round;function sr(e,g){const l=e.replace(/^[^(]*\((.*)/,"$1").replace(/\).*/,"").match(/\d*\.?\d+%?/g)||[],t=l.map(I=>parseFloat(I));for(let I=0;I<3;I+=1)t[I]=g(t[I]||0,l[I]||"",I);return l[3]?t[3]=l[3].includes("%")?t[3]/100:t[3]:t[3]=1,t}const Lu=(e,g,l)=>l===0?e:e/100;function UI(e,g){const l=g||255;return e>l?l:e<0?0:e}class AC{constructor(g){D(this,"isValid",!0),D(this,"r",0),D(this,"g",0),D(this,"b",0),D(this,"a",1),D(this,"_h",void 0),D(this,"_s",void 0),D(this,"_l",void 0),D(this,"_v",void 0),D(this,"_max",void 0),D(this,"_min",void 0),D(this,"_brightness",void 0);function l(I){return I[0]in g&&I[1]in g&&I[2]in g}if(g)if(typeof g=="string"){let i=function(a){return I.startsWith(a)};var t=i;const I=g.trim();/^#?[A-F\d]{3,8}$/i.test(I)?this.fromHexString(I):i("rgb")?this.fromRgbString(I):i("hsl")?this.fromHslString(I):(i("hsv")||i("hsb"))&&this.fromHsvString(I)}else if(g instanceof AC)this.r=g.r,this.g=g.g,this.b=g.b,this.a=g.a,this._h=g._h,this._s=g._s,this._l=g._l,this._v=g._v;else if(l("rgb"))this.r=UI(g.r),this.g=UI(g.g),this.b=UI(g.b),this.a=typeof g.a=="number"?UI(g.a,1):1;else if(l("hsl"))this.fromHsl(g);else if(l("hsv"))this.fromHsv(g);else throw new Error("@ant-design/fast-color: unsupported input "+JSON.stringify(g))}setR(g){return this._sc("r",g)}setG(g){return this._sc("g",g)}setB(g){return this._sc("b",g)}setA(g){return this._sc("a",g,1)}setHue(g){const l=this.toHsv();return l.h=g,this._c(l)}getLuminance(){function g(i){const a=i/255;return a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4)}const l=g(this.r),t=g(this.g),I=g(this.b);return .2126*l+.7152*t+.0722*I}getHue(){if(typeof this._h>"u"){const g=this.getMax()-this.getMin();g===0?this._h=0:this._h=lg(60*(this.r===this.getMax()?(this.g-this.b)/g+(this.g<this.b?6:0):this.g===this.getMax()?(this.b-this.r)/g+2:(this.r-this.g)/g+4))}return this._h}getSaturation(){if(typeof this._s>"u"){const g=this.getMax()-this.getMin();g===0?this._s=0:this._s=g/this.getMax()}return this._s}getLightness(){return typeof this._l>"u"&&(this._l=(this.getMax()+this.getMin())/510),this._l}getValue(){return typeof this._v>"u"&&(this._v=this.getMax()/255),this._v}getBrightness(){return typeof this._brightness>"u"&&(this._brightness=(this.r*299+this.g*587+this.b*114)/1e3),this._brightness}darken(g=10){const l=this.getHue(),t=this.getSaturation();let I=this.getLightness()-g/100;return I<0&&(I=0),this._c({h:l,s:t,l:I,a:this.a})}lighten(g=10){const l=this.getHue(),t=this.getSaturation();let I=this.getLightness()+g/100;return I>1&&(I=1),this._c({h:l,s:t,l:I,a:this.a})}mix(g,l=50){const t=this._c(g),I=l/100,i=r=>(t[r]-this[r])*I+this[r],a={r:lg(i("r")),g:lg(i("g")),b:lg(i("b")),a:lg(i("a")*100)/100};return this._c(a)}tint(g=10){return this.mix({r:255,g:255,b:255,a:1},g)}shade(g=10){return this.mix({r:0,g:0,b:0,a:1},g)}onBackground(g){const l=this._c(g),t=this.a+l.a*(1-this.a),I=i=>lg((this[i]*this.a+l[i]*l.a*(1-this.a))/t);return this._c({r:I("r"),g:I("g"),b:I("b"),a:t})}isDark(){return this.getBrightness()<128}isLight(){return this.getBrightness()>=128}equals(g){return this.r===g.r&&this.g===g.g&&this.b===g.b&&this.a===g.a}clone(){return this._c(this)}toHexString(){let g="#";const l=(this.r||0).toString(16);g+=l.length===2?l:"0"+l;const t=(this.g||0).toString(16);g+=t.length===2?t:"0"+t;const I=(this.b||0).toString(16);if(g+=I.length===2?I:"0"+I,typeof this.a=="number"&&this.a>=0&&this.a<1){const i=lg(this.a*255).toString(16);g+=i.length===2?i:"0"+i}return g}toHsl(){return{h:this.getHue(),s:this.getSaturation(),l:this.getLightness(),a:this.a}}toHslString(){const g=this.getHue(),l=lg(this.getSaturation()*100),t=lg(this.getLightness()*100);return this.a!==1?`hsla(${g},${l}%,${t}%,${this.a})`:`hsl(${g},${l}%,${t}%)`}toHsv(){return{h:this.getHue(),s:this.getSaturation(),v:this.getValue(),a:this.a}}toRgb(){return{r:this.r,g:this.g,b:this.b,a:this.a}}toRgbString(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:`rgb(${this.r},${this.g},${this.b})`}toString(){return this.toRgbString()}_sc(g,l,t){const I=this.clone();return I[g]=UI(l,t),I}_c(g){return new this.constructor(g)}getMax(){return typeof this._max>"u"&&(this._max=Math.max(this.r,this.g,this.b)),this._max}getMin(){return typeof this._min>"u"&&(this._min=Math.min(this.r,this.g,this.b)),this._min}fromHexString(g){const l=g.replace("#","");function t(I,i){return parseInt(l[I]+l[i||I],16)}l.length<6?(this.r=t(0),this.g=t(1),this.b=t(2),this.a=l[3]?t(3)/255:1):(this.r=t(0,1),this.g=t(2,3),this.b=t(4,5),this.a=l[6]?t(6,7)/255:1)}fromHsl({h:g,s:l,l:t,a:I}){if(this._h=g%360,this._s=l,this._l=t,this.a=typeof I=="number"?I:1,l<=0){const b=lg(t*255);this.r=b,this.g=b,this.b=b}let i=0,a=0,r=0;const s=g/60,d=(1-Math.abs(2*t-1))*l,J=d*(1-Math.abs(s%2-1));s>=0&&s<1?(i=d,a=J):s>=1&&s<2?(i=J,a=d):s>=2&&s<3?(a=d,r=J):s>=3&&s<4?(a=J,r=d):s>=4&&s<5?(i=J,r=d):s>=5&&s<6&&(i=d,r=J);const Z=t-d/2;this.r=lg((i+Z)*255),this.g=lg((a+Z)*255),this.b=lg((r+Z)*255)}fromHsv({h:g,s:l,v:t,a:I}){this._h=g%360,this._s=l,this._v=t,this.a=typeof I=="number"?I:1;const i=lg(t*255);if(this.r=i,this.g=i,this.b=i,l<=0)return;const a=g/60,r=Math.floor(a),s=a-r,d=lg(t*(1-l)*255),J=lg(t*(1-l*s)*255),Z=lg(t*(1-l*(1-s))*255);switch(r){case 0:this.g=Z,this.b=d;break;case 1:this.r=J,this.b=d;break;case 2:this.r=d,this.b=Z;break;case 3:this.r=d,this.g=J;break;case 4:this.r=Z,this.g=d;break;case 5:default:this.g=d,this.b=J;break}}fromHsvString(g){const l=sr(g,Lu);this.fromHsv({h:l[0],s:l[1],v:l[2],a:l[3]})}fromHslString(g){const l=sr(g,Lu);this.fromHsl({h:l[0],s:l[1],l:l[2],a:l[3]})}fromRgbString(g){const l=sr(g,(t,I)=>I.includes("%")?lg(t/100*255):t);this.r=l[0],this.g=l[1],this.b=l[2],this.a=l[3]}}var Ri=2,Uu=.16,Dh=.05,Eh=.05,Oh=.15,KJ=5,wJ=4,Ph=[{index:7,amount:15},{index:6,amount:25},{index:5,amount:30},{index:5,amount:45},{index:5,amount:65},{index:5,amount:85},{index:4,amount:90},{index:3,amount:95},{index:2,amount:97},{index:1,amount:98}];function Mu(e,g,l){var t;return Math.round(e.h)>=60&&Math.round(e.h)<=240?t=l?Math.round(e.h)-Ri*g:Math.round(e.h)+Ri*g:t=l?Math.round(e.h)+Ri*g:Math.round(e.h)-Ri*g,t<0?t+=360:t>=360&&(t-=360),t}function xu(e,g,l){if(e.h===0&&e.s===0)return e.s;var t;return l?t=e.s-Uu*g:g===wJ?t=e.s+Uu:t=e.s+Dh*g,t>1&&(t=1),l&&g===KJ&&t>.1&&(t=.1),t<.06&&(t=.06),Math.round(t*100)/100}function Tu(e,g,l){var t;return l?t=e.v+Eh*g:t=e.v-Oh*g,t=Math.max(0,Math.min(1,t)),Math.round(t*100)/100}function Co(e){for(var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=[],t=new AC(e),I=t.toHsv(),i=KJ;i>0;i-=1){var a=new AC({h:Mu(I,i,!0),s:xu(I,i,!0),v:Tu(I,i,!0)});l.push(a)}l.push(t);for(var r=1;r<=wJ;r+=1){var s=new AC({h:Mu(I,r),s:xu(I,r),v:Tu(I,r)});l.push(s)}return g.theme==="dark"?Ph.map(function(d){var J=d.index,Z=d.amount;return new AC(g.backgroundColor||"#141414").mix(l[J],Z).toHexString()}):l.map(function(d){return d.toHexString()})}var Et={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},Mr=["#fff1f0","#ffccc7","#ffa39e","#ff7875","#ff4d4f","#f5222d","#cf1322","#a8071a","#820014","#5c0011"];Mr.primary=Mr[5];var xr=["#fff2e8","#ffd8bf","#ffbb96","#ff9c6e","#ff7a45","#fa541c","#d4380d","#ad2102","#871400","#610b00"];xr.primary=xr[5];var Tr=["#fff7e6","#ffe7ba","#ffd591","#ffc069","#ffa940","#fa8c16","#d46b08","#ad4e00","#873800","#612500"];Tr.primary=Tr[5];var Dr=["#fffbe6","#fff1b8","#ffe58f","#ffd666","#ffc53d","#faad14","#d48806","#ad6800","#874d00","#613400"];Dr.primary=Dr[5];var Er=["#feffe6","#ffffb8","#fffb8f","#fff566","#ffec3d","#fadb14","#d4b106","#ad8b00","#876800","#614700"];Er.primary=Er[5];var Or=["#fcffe6","#f4ffb8","#eaff8f","#d3f261","#bae637","#a0d911","#7cb305","#5b8c00","#3f6600","#254000"];Or.primary=Or[5];var Pr=["#f6ffed","#d9f7be","#b7eb8f","#95de64","#73d13d","#52c41a","#389e0d","#237804","#135200","#092b00"];Pr.primary=Pr[5];var jr=["#e6fffb","#b5f5ec","#87e8de","#5cdbd3","#36cfc9","#13c2c2","#08979c","#006d75","#00474f","#002329"];jr.primary=jr[5];var jt=["#e6f4ff","#bae0ff","#91caff","#69b1ff","#4096ff","#1677ff","#0958d9","#003eb3","#002c8c","#001d66"];jt.primary=jt[5];var $r=["#f0f5ff","#d6e4ff","#adc6ff","#85a5ff","#597ef7","#2f54eb","#1d39c4","#10239e","#061178","#030852"];$r.primary=$r[5];var qr=["#f9f0ff","#efdbff","#d3adf7","#b37feb","#9254de","#722ed1","#531dab","#391085","#22075e","#120338"];qr.primary=qr[5];var _r=["#fff0f6","#ffd6e7","#ffadd2","#ff85c0","#f759ab","#eb2f96","#c41d7f","#9e1068","#780650","#520339"];_r.primary=_r[5];var eA=["#a6a6a6","#999999","#8c8c8c","#808080","#737373","#666666","#404040","#1a1a1a","#000000","#000000"];eA.primary=eA[5];var dr={red:Mr,volcano:xr,orange:Tr,gold:Dr,yellow:Er,lime:Or,green:Pr,cyan:jr,blue:jt,geekblue:$r,purple:qr,magenta:_r,grey:eA};function Du(e,g){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);g&&(t=t.filter(function(I){return Object.getOwnPropertyDescriptor(e,I).enumerable})),l.push.apply(l,t)}return l}function O(e){for(var g=1;g<arguments.length;g++){var l=arguments[g]!=null?arguments[g]:{};g%2?Du(Object(l),!0).forEach(function(t){D(e,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):Du(Object(l)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))})}return e}function Fg(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function CA(e,g){if(!e)return!1;if(e.contains)return e.contains(g);for(var l=g;l;){if(l===e)return!0;l=l.parentNode}return!1}var Eu="data-rc-order",Ou="data-rc-priority",jh="rc-util-key",gA=new Map;function HJ(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=e.mark;return g?g.startsWith("data-")?g:"data-".concat(g):jh}function dc(e){if(e.attachTo)return e.attachTo;var g=document.querySelector("head");return g||document.body}function $h(e){return e==="queue"?"prependQueue":e?"prepend":"append"}function xA(e){return Array.from((gA.get(e)||e).children).filter(function(g){return g.tagName==="STYLE"})}function NJ(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fg())return null;var l=g.csp,t=g.prepend,I=g.priority,i=I===void 0?0:I,a=$h(t),r=a==="prependQueue",s=document.createElement("style");s.setAttribute(Eu,a),r&&i&&s.setAttribute(Ou,"".concat(i)),l!=null&&l.nonce&&(s.nonce=l==null?void 0:l.nonce),s.innerHTML=e;var d=dc(g),J=d.firstChild;if(t){if(r){var Z=(g.styles||xA(d)).filter(function(b){if(!["prepend","prependQueue"].includes(b.getAttribute(Eu)))return!1;var p=Number(b.getAttribute(Ou)||0);return i>=p});if(Z.length)return d.insertBefore(s,Z[Z.length-1].nextSibling),s}d.insertBefore(s,J)}else d.appendChild(s);return s}function zJ(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=dc(g);return(g.styles||xA(l)).find(function(t){return t.getAttribute(HJ(g))===e})}function go(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=zJ(e,g);if(l){var t=dc(g);t.removeChild(l)}}function qh(e,g){var l=gA.get(e);if(!l||!CA(document,l)){var t=NJ("",g),I=t.parentNode;gA.set(e,I),e.removeChild(t)}}function en(e,g){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=dc(l),I=xA(t),i=O(O({},l),{},{styles:I});qh(t,i);var a=zJ(g,i);if(a){var r,s;if((r=i.csp)!==null&&r!==void 0&&r.nonce&&a.nonce!==((s=i.csp)===null||s===void 0?void 0:s.nonce)){var d;a.nonce=(d=i.csp)===null||d===void 0?void 0:d.nonce}return a.innerHTML!==e&&(a.innerHTML=e),a}var J=NJ(e,i);return J.setAttribute(HJ(i),g),J}function LJ(e){var g;return e==null||(g=e.getRootNode)===null||g===void 0?void 0:g.call(e)}function _h(e){return LJ(e)instanceof ShadowRoot}function qi(e){return _h(e)?LJ(e):null}var lA={},eG=function(g){};function CG(e,g){}function gG(e,g){}function lG(){lA={}}function UJ(e,g,l){!g&&!lA[l]&&(e(!1,l),lA[l]=!0)}function Yg(e,g){UJ(CG,e,g)}function nG(e,g){UJ(gG,e,g)}Yg.preMessage=eG;Yg.resetWarned=lG;Yg.noteOnce=nG;function tG(e){return e.replace(/-(.)/g,function(g,l){return l.toUpperCase()})}function IG(e,g){Yg(e,"[@ant-design/icons] ".concat(g))}function Pu(e){return Qe(e)==="object"&&typeof e.name=="string"&&typeof e.theme=="string"&&(Qe(e.icon)==="object"||typeof e.icon=="function")}function ju(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.keys(e).reduce(function(g,l){var t=e[l];switch(l){case"class":g.className=t,delete g.class;break;default:delete g[l],g[tG(l)]=t}return g},{})}function nA(e,g,l){return l?de.createElement(e.tag,O(O({key:g},ju(e.attrs)),l),(e.children||[]).map(function(t,I){return nA(t,"".concat(g,"-").concat(e.tag,"-").concat(I))})):de.createElement(e.tag,O({key:g},ju(e.attrs)),(e.children||[]).map(function(t,I){return nA(t,"".concat(g,"-").concat(e.tag,"-").concat(I))}))}function MJ(e){return Co(e)[0]}function xJ(e){return e?Array.isArray(e)?e:[e]:[]}var oG=`
.anticon {
  display: inline-flex;
  align-items: center;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
`,iG=function(g){var l=u.useContext(UA),t=l.csp,I=l.prefixCls,i=l.layer,a=oG;I&&(a=a.replace(/anticon/g,I)),i&&(a="@layer ".concat(i,` {
`).concat(a,`
}`)),u.useEffect(function(){var r=g.current,s=qi(r);en(a,"@ant-design-icons",{prepend:!i,csp:t,attachTo:s})},[])},cG=["icon","className","onClick","style","primaryColor","secondaryColor"],qI={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};function aG(e){var g=e.primaryColor,l=e.secondaryColor;qI.primaryColor=g,qI.secondaryColor=l||MJ(g),qI.calculated=!!l}function rG(){return O({},qI)}var II=function(g){var l=g.icon,t=g.className,I=g.onClick,i=g.style,a=g.primaryColor,r=g.secondaryColor,s=wC(g,cG),d=u.useRef(),J=qI;if(a&&(J={primaryColor:a,secondaryColor:r||MJ(a)}),iG(d),IG(Pu(l),"icon should be icon definiton, but got ".concat(l)),!Pu(l))return null;var Z=l;return Z&&typeof Z.icon=="function"&&(Z=O(O({},Z),{},{icon:Z.icon(J.primaryColor,J.secondaryColor)})),nA(Z.icon,"svg-".concat(Z.name),O(O({className:t,onClick:I,style:i,"data-icon":Z.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},s),{},{ref:d}))};II.displayName="IconReact";II.getTwoToneColors=rG;II.setTwoToneColors=aG;function TJ(e){var g=xJ(e),l=oe(g,2),t=l[0],I=l[1];return II.setTwoToneColors({primaryColor:t,secondaryColor:I})}function AG(){var e=II.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor}var sG=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];TJ(jt.primary);var BC=u.forwardRef(function(e,g){var l=e.className,t=e.icon,I=e.spin,i=e.rotate,a=e.tabIndex,r=e.onClick,s=e.twoToneColor,d=wC(e,sG),J=u.useContext(UA),Z=J.prefixCls,b=Z===void 0?"anticon":Z,p=J.rootClassName,y=me(p,b,D(D({},"".concat(b,"-").concat(t.name),!!t.name),"".concat(b,"-spin"),!!I||t.name==="loading"),l),G=a;G===void 0&&r&&(G=-1);var h=i?{msTransform:"rotate(".concat(i,"deg)"),transform:"rotate(".concat(i,"deg)")}:void 0,f=xJ(s),W=oe(f,2),X=W[0],B=W[1];return u.createElement("span",Be({role:"img","aria-label":t.name},d,{ref:g,tabIndex:G,onClick:r,className:y}),u.createElement(II,{icon:t,primaryColor:X,secondaryColor:B,style:h}))});BC.displayName="AntdIcon";BC.getTwoToneColor=AG;BC.setTwoToneColor=TJ;var dG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"},uG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:dG}))},DJ=u.forwardRef(uG),mG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"},JG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:mG}))},ZG=u.forwardRef(JG),bG={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"}}]},name:"close-circle",theme:"filled"},hG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:bG}))},EJ=u.forwardRef(hG),GG={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"}}]},name:"close",theme:"outlined"},yG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:GG}))},TA=u.forwardRef(yG),kG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},pG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:kG}))},WG=u.forwardRef(pG),VG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},fG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:VG}))},XG=u.forwardRef(fG),RG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"},QG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:RG}))},vG=u.forwardRef(QG),BG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"},SG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:BG}))},OJ=u.forwardRef(SG),YG={icon:function(g,l){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:l}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:g}}]}},name:"file",theme:"twotone"},FG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:YG}))},KG=u.forwardRef(FG),wG={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},HG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:wG}))},NG=u.forwardRef(HG),zG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"},LG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:zG}))},UG=u.forwardRef(LG),MG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"},xG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:MG}))},TG=u.forwardRef(xG),DG={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},EG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:DG}))},_i=u.forwardRef(EG),OG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"},PG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:OG}))},jG=u.forwardRef(PG),$G={icon:function(g,l){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:g}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:l}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:l}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:l}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:g}}]}},name:"picture",theme:"twotone"},qG=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:$G}))},_G=u.forwardRef(qG),ey={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"},Cy=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:ey}))},gy=u.forwardRef(Cy),ly={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z"}},{tag:"path",attrs:{d:"M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z"}}]},name:"rotate-left",theme:"outlined"},ny=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:ly}))},ty=u.forwardRef(ny),Iy={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z"}},{tag:"path",attrs:{d:"M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z"}}]},name:"rotate-right",theme:"outlined"},oy=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:Iy}))},iy=u.forwardRef(oy),cy={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},ay=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:cy}))},$u=u.forwardRef(ay),ry={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-in",theme:"outlined"},Ay=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:ry}))},sy=u.forwardRef(Ay),dy={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-out",theme:"outlined"},uy=function(g,l){return u.createElement(BC,Be({},g,{ref:l,icon:dy}))},my=u.forwardRef(uy),ur={exports:{}},dC={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qu;function Jy(){if(qu)return dC;qu=1;var e=Symbol.for("react.element"),g=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),t=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),a=Symbol.for("react.context"),r=Symbol.for("react.server_context"),s=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),y;y=Symbol.for("react.module.reference");function G(h){if(typeof h=="object"&&h!==null){var f=h.$$typeof;switch(f){case e:switch(h=h.type,h){case l:case I:case t:case d:case J:return h;default:switch(h=h&&h.$$typeof,h){case r:case a:case s:case b:case Z:case i:return h;default:return f}}case g:return f}}}return dC.ContextConsumer=a,dC.ContextProvider=i,dC.Element=e,dC.ForwardRef=s,dC.Fragment=l,dC.Lazy=b,dC.Memo=Z,dC.Portal=g,dC.Profiler=I,dC.StrictMode=t,dC.Suspense=d,dC.SuspenseList=J,dC.isAsyncMode=function(){return!1},dC.isConcurrentMode=function(){return!1},dC.isContextConsumer=function(h){return G(h)===a},dC.isContextProvider=function(h){return G(h)===i},dC.isElement=function(h){return typeof h=="object"&&h!==null&&h.$$typeof===e},dC.isForwardRef=function(h){return G(h)===s},dC.isFragment=function(h){return G(h)===l},dC.isLazy=function(h){return G(h)===b},dC.isMemo=function(h){return G(h)===Z},dC.isPortal=function(h){return G(h)===g},dC.isProfiler=function(h){return G(h)===I},dC.isStrictMode=function(h){return G(h)===t},dC.isSuspense=function(h){return G(h)===d},dC.isSuspenseList=function(h){return G(h)===J},dC.isValidElementType=function(h){return typeof h=="string"||typeof h=="function"||h===l||h===I||h===t||h===d||h===J||h===p||typeof h=="object"&&h!==null&&(h.$$typeof===b||h.$$typeof===Z||h.$$typeof===i||h.$$typeof===a||h.$$typeof===s||h.$$typeof===y||h.getModuleId!==void 0)},dC.typeOf=G,dC}var _u;function Zy(){return _u||(_u=1,ur.exports=Jy()),ur.exports}var mr=Zy();function DA(e,g,l){var t=u.useRef({});return(!("value"in t.current)||l(t.current.condition,g))&&(t.current.value=e(),t.current.condition=g),t.current.value}var by=Symbol.for("react.element"),hy=Symbol.for("react.transitional.element"),Gy=Symbol.for("react.fragment");function PJ(e){return e&&Qe(e)==="object"&&(e.$$typeof===by||e.$$typeof===hy)&&e.type===Gy}var yy=Number(u.version.split(".")[0]),EA=function(g,l){typeof g=="function"?g(l):Qe(g)==="object"&&g&&"current"in g&&(g.current=l)},uc=function(){for(var g=arguments.length,l=new Array(g),t=0;t<g;t++)l[t]=arguments[t];var I=l.filter(Boolean);return I.length<=1?I[0]:function(i){l.forEach(function(a){EA(a,i)})}},Go=function(){for(var g=arguments.length,l=new Array(g),t=0;t<g;t++)l[t]=arguments[t];return DA(function(){return uc.apply(void 0,l)},l,function(I,i){return I.length!==i.length||I.every(function(a,r){return a!==i[r]})})},yo=function(g){var l,t;if(!g)return!1;if(jJ(g)&&yy>=19)return!0;var I=mr.isMemo(g)?g.type.type:g.type;return!(typeof I=="function"&&!((l=I.prototype)!==null&&l!==void 0&&l.render)&&I.$$typeof!==mr.ForwardRef||typeof g=="function"&&!((t=g.prototype)!==null&&t!==void 0&&t.render)&&g.$$typeof!==mr.ForwardRef)};function jJ(e){return u.isValidElement(e)&&!PJ(e)}var mc=function(g){if(g&&jJ(g)){var l=g;return l.props.propertyIsEnumerable("ref")?l.props.ref:l.ref}return null};function ec(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=[];return de.Children.forEach(e,function(t){t==null&&!g.keepEmpty||(Array.isArray(t)?l=l.concat(ec(t)):PJ(t)&&t.props?l=l.concat(ec(t.props.children,g)):l.push(t))}),l}var $t=vJ();const lo=NA($t),ky=QJ({__proto__:null,default:lo},[$t]);function no(e){return e instanceof HTMLElement||e instanceof SVGElement}function py(e){return e&&Qe(e)==="object"&&no(e.nativeElement)?e.nativeElement:no(e)?e:null}function Ui(e){var g=py(e);if(g)return g;if(e instanceof de.Component){var l;return(l=lo.findDOMNode)===null||l===void 0?void 0:l.call(lo,e)}return null}var tA=u.createContext(null);function Wy(e){var g=e.children,l=e.onBatchResize,t=u.useRef(0),I=u.useRef([]),i=u.useContext(tA),a=u.useCallback(function(r,s,d){t.current+=1;var J=t.current;I.current.push({size:r,element:s,data:d}),Promise.resolve().then(function(){J===t.current&&(l==null||l(I.current),I.current=[])}),i==null||i(r,s,d)},[l,i]);return u.createElement(tA.Provider,{value:a},g)}var $J=function(){if(typeof Map<"u")return Map;function e(g,l){var t=-1;return g.some(function(I,i){return I[0]===l?(t=i,!0):!1}),t}return function(){function g(){this.__entries__=[]}return Object.defineProperty(g.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),g.prototype.get=function(l){var t=e(this.__entries__,l),I=this.__entries__[t];return I&&I[1]},g.prototype.set=function(l,t){var I=e(this.__entries__,l);~I?this.__entries__[I][1]=t:this.__entries__.push([l,t])},g.prototype.delete=function(l){var t=this.__entries__,I=e(t,l);~I&&t.splice(I,1)},g.prototype.has=function(l){return!!~e(this.__entries__,l)},g.prototype.clear=function(){this.__entries__.splice(0)},g.prototype.forEach=function(l,t){t===void 0&&(t=null);for(var I=0,i=this.__entries__;I<i.length;I++){var a=i[I];l.call(t,a[1],a[0])}},g}()}(),IA=typeof window<"u"&&typeof document<"u"&&window.document===document,Cc=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Vy=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Cc):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),fy=2;function Xy(e,g){var l=!1,t=!1,I=0;function i(){l&&(l=!1,e()),t&&r()}function a(){Vy(i)}function r(){var s=Date.now();if(l){if(s-I<fy)return;t=!0}else l=!0,t=!1,setTimeout(a,g);I=s}return r}var Ry=20,Qy=["top","right","bottom","left","width","height","size","weight"],vy=typeof MutationObserver<"u",By=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Xy(this.refresh.bind(this),Ry)}return e.prototype.addObserver=function(g){~this.observers_.indexOf(g)||this.observers_.push(g),this.connected_||this.connect_()},e.prototype.removeObserver=function(g){var l=this.observers_,t=l.indexOf(g);~t&&l.splice(t,1),!l.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var g=this.updateObservers_();g&&this.refresh()},e.prototype.updateObservers_=function(){var g=this.observers_.filter(function(l){return l.gatherActive(),l.hasActive()});return g.forEach(function(l){return l.broadcastActive()}),g.length>0},e.prototype.connect_=function(){!IA||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),vy?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!IA||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(g){var l=g.propertyName,t=l===void 0?"":l,I=Qy.some(function(i){return!!~t.indexOf(i)});I&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),qJ=function(e,g){for(var l=0,t=Object.keys(g);l<t.length;l++){var I=t[l];Object.defineProperty(e,I,{value:g[I],enumerable:!1,writable:!1,configurable:!0})}return e},qt=function(e){var g=e&&e.ownerDocument&&e.ownerDocument.defaultView;return g||Cc},_J=Jc(0,0,0,0);function gc(e){return parseFloat(e)||0}function em(e){for(var g=[],l=1;l<arguments.length;l++)g[l-1]=arguments[l];return g.reduce(function(t,I){var i=e["border-"+I+"-width"];return t+gc(i)},0)}function Sy(e){for(var g=["top","right","bottom","left"],l={},t=0,I=g;t<I.length;t++){var i=I[t],a=e["padding-"+i];l[i]=gc(a)}return l}function Yy(e){var g=e.getBBox();return Jc(0,0,g.width,g.height)}function Fy(e){var g=e.clientWidth,l=e.clientHeight;if(!g&&!l)return _J;var t=qt(e).getComputedStyle(e),I=Sy(t),i=I.left+I.right,a=I.top+I.bottom,r=gc(t.width),s=gc(t.height);if(t.boxSizing==="border-box"&&(Math.round(r+i)!==g&&(r-=em(t,"left","right")+i),Math.round(s+a)!==l&&(s-=em(t,"top","bottom")+a)),!wy(e)){var d=Math.round(r+i)-g,J=Math.round(s+a)-l;Math.abs(d)!==1&&(r-=d),Math.abs(J)!==1&&(s-=J)}return Jc(I.left,I.top,r,s)}var Ky=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof qt(e).SVGGraphicsElement}:function(e){return e instanceof qt(e).SVGElement&&typeof e.getBBox=="function"}}();function wy(e){return e===qt(e).document.documentElement}function Hy(e){return IA?Ky(e)?Yy(e):Fy(e):_J}function Ny(e){var g=e.x,l=e.y,t=e.width,I=e.height,i=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,a=Object.create(i.prototype);return qJ(a,{x:g,y:l,width:t,height:I,top:l,right:g+t,bottom:I+l,left:g}),a}function Jc(e,g,l,t){return{x:e,y:g,width:l,height:t}}var zy=function(){function e(g){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Jc(0,0,0,0),this.target=g}return e.prototype.isActive=function(){var g=Hy(this.target);return this.contentRect_=g,g.width!==this.broadcastWidth||g.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var g=this.contentRect_;return this.broadcastWidth=g.width,this.broadcastHeight=g.height,g},e}(),Ly=function(){function e(g,l){var t=Ny(l);qJ(this,{target:g,contentRect:t})}return e}(),Uy=function(){function e(g,l,t){if(this.activeObservations_=[],this.observations_=new $J,typeof g!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=g,this.controller_=l,this.callbackCtx_=t}return e.prototype.observe=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(g instanceof qt(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var l=this.observations_;l.has(g)||(l.set(g,new zy(g)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(g instanceof qt(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var l=this.observations_;l.has(g)&&(l.delete(g),l.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var g=this;this.clearActive(),this.observations_.forEach(function(l){l.isActive()&&g.activeObservations_.push(l)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var g=this.callbackCtx_,l=this.activeObservations_.map(function(t){return new Ly(t.target,t.broadcastRect())});this.callback_.call(g,l,g),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),eZ=typeof WeakMap<"u"?new WeakMap:new $J,CZ=function(){function e(g){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var l=By.getInstance(),t=new Uy(g,l,this);eZ.set(this,t)}return e}();["observe","unobserve","disconnect"].forEach(function(e){CZ.prototype[e]=function(){var g;return(g=eZ.get(this))[e].apply(g,arguments)}});var My=function(){return typeof Cc.ResizeObserver<"u"?Cc.ResizeObserver:CZ}(),Wn=new Map;function xy(e){e.forEach(function(g){var l,t=g.target;(l=Wn.get(t))===null||l===void 0||l.forEach(function(I){return I(t)})})}var gZ=new My(xy);function Ty(e,g){Wn.has(e)||(Wn.set(e,new Set),gZ.observe(e)),Wn.get(e).add(g)}function Dy(e,g){Wn.has(e)&&(Wn.get(e).delete(g),Wn.get(e).size||(gZ.unobserve(e),Wn.delete(e)))}function DC(e,g){if(!(e instanceof g))throw new TypeError("Cannot call a class as a function")}function Cm(e,g){for(var l=0;l<g.length;l++){var t=g[l];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,FJ(t.key),t)}}function EC(e,g,l){return g&&Cm(e.prototype,g),l&&Cm(e,l),Object.defineProperty(e,"prototype",{writable:!1}),e}function to(e,g){return to=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,t){return l.__proto__=t,l},to(e,g)}function wl(e,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(g&&g.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),g&&to(e,g)}function Io(e){return Io=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},Io(e)}function OA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(OA=function(){return!!e})()}function Ne(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ey(e,g){if(g&&(Qe(g)=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ne(e)}function Hl(e){var g=OA();return function(){var l,t=Io(e);if(g){var I=Io(this).constructor;l=Reflect.construct(t,arguments,I)}else l=t.apply(this,arguments);return Ey(this,l)}}var Oy=function(e){wl(l,e);var g=Hl(l);function l(){return DC(this,l),g.apply(this,arguments)}return EC(l,[{key:"render",value:function(){return this.props.children}}]),l}(u.Component);function Py(e,g){var l=e.children,t=e.disabled,I=u.useRef(null),i=u.useRef(null),a=u.useContext(tA),r=typeof l=="function",s=r?l(I):l,d=u.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),J=!r&&u.isValidElement(s)&&yo(s),Z=J?mc(s):null,b=Go(Z,I),p=function(){var f;return Ui(I.current)||(I.current&&Qe(I.current)==="object"?Ui((f=I.current)===null||f===void 0?void 0:f.nativeElement):null)||Ui(i.current)};u.useImperativeHandle(g,function(){return p()});var y=u.useRef(e);y.current=e;var G=u.useCallback(function(h){var f=y.current,W=f.onResize,X=f.data,B=h.getBoundingClientRect(),V=B.width,Q=B.height,v=h.offsetWidth,Y=h.offsetHeight,F=Math.floor(V),L=Math.floor(Q);if(d.current.width!==F||d.current.height!==L||d.current.offsetWidth!==v||d.current.offsetHeight!==Y){var M={width:F,height:L,offsetWidth:v,offsetHeight:Y};d.current=M;var ee=v===Math.round(V)?V:v,q=Y===Math.round(Q)?Q:Y,P=O(O({},M),{},{offsetWidth:ee,offsetHeight:q});a==null||a(P,h,X),W&&Promise.resolve().then(function(){W(P,h)})}},[]);return u.useEffect(function(){var h=p();return h&&!t&&Ty(h,G),function(){return Dy(h,G)}},[I.current,t]),u.createElement(Oy,{ref:i},J?u.cloneElement(s,{ref:b}):s)}var jy=u.forwardRef(Py),$y="rc-observer-key";function qy(e,g){var l=e.children,t=typeof l=="function"?[l]:ec(l);return t.map(function(I,i){var a=(I==null?void 0:I.key)||"".concat($y,"-").concat(i);return u.createElement(jy,Be({},e,{key:a,ref:i===0?g:void 0}),I)})}var PA=u.forwardRef(qy);PA.Collection=Wy;function _y(e){if(Array.isArray(e))return Ur(e)}function lZ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ek(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ye(e){return _y(e)||lZ(e)||MA(e)||ek()}var nZ=function(g){return+setTimeout(g,16)},tZ=function(g){return clearTimeout(g)};typeof window<"u"&&"requestAnimationFrame"in window&&(nZ=function(g){return window.requestAnimationFrame(g)},tZ=function(g){return window.cancelAnimationFrame(g)});var gm=0,jA=new Map;function IZ(e){jA.delete(e)}var Rn=function(g){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;gm+=1;var t=gm;function I(i){if(i===0)IZ(t),g();else{var a=nZ(function(){I(i-1)});jA.set(t,a)}}return I(l),t};Rn.cancel=function(e){var g=jA.get(e);return IZ(e),tZ(g)};function oo(e){for(var g=0,l,t=0,I=e.length;I>=4;++t,I-=4)l=e.charCodeAt(t)&255|(e.charCodeAt(++t)&255)<<8|(e.charCodeAt(++t)&255)<<16|(e.charCodeAt(++t)&255)<<24,l=(l&65535)*1540483477+((l>>>16)*59797<<16),l^=l>>>24,g=(l&65535)*1540483477+((l>>>16)*59797<<16)^(g&65535)*1540483477+((g>>>16)*59797<<16);switch(I){case 3:g^=(e.charCodeAt(t+2)&255)<<16;case 2:g^=(e.charCodeAt(t+1)&255)<<8;case 1:g^=e.charCodeAt(t)&255,g=(g&65535)*1540483477+((g>>>16)*59797<<16)}return g^=g>>>13,g=(g&65535)*1540483477+((g>>>16)*59797<<16),((g^g>>>15)>>>0).toString(36)}function lc(e,g){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,t=new Set;function I(i,a){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=t.has(i);if(Yg(!s,"Warning: There may be circular references"),s)return!1;if(i===a)return!0;if(l&&r>1)return!1;t.add(i);var d=r+1;if(Array.isArray(i)){if(!Array.isArray(a)||i.length!==a.length)return!1;for(var J=0;J<i.length;J++)if(!I(i[J],a[J],d))return!1;return!0}if(i&&a&&Qe(i)==="object"&&Qe(a)==="object"){var Z=Object.keys(i);return Z.length!==Object.keys(a).length?!1:Z.every(function(b){return I(i[b],a[b],d)})}return!1}return I(e,g)}var Ck="%";function oA(e){return e.join(Ck)}var gk=function(){function e(g){DC(this,e),D(this,"instanceId",void 0),D(this,"cache",new Map),this.instanceId=g}return EC(e,[{key:"get",value:function(l){return this.opGet(oA(l))}},{key:"opGet",value:function(l){return this.cache.get(l)||null}},{key:"update",value:function(l,t){return this.opUpdate(oA(l),t)}},{key:"opUpdate",value:function(l,t){var I=this.cache.get(l),i=t(I);i===null?this.cache.delete(l):this.cache.set(l,i)}}]),e}(),_t="data-token-hash",Vl="data-css-hash",Vn="__cssinjs_instance__";function lk(){var e=Math.random().toString(12).slice(2);if(typeof document<"u"&&document.head&&document.body){var g=document.body.querySelectorAll("style[".concat(Vl,"]"))||[],l=document.head.firstChild;Array.from(g).forEach(function(I){I[Vn]=I[Vn]||e,I[Vn]===e&&document.head.insertBefore(I,l)});var t={};Array.from(document.querySelectorAll("style[".concat(Vl,"]"))).forEach(function(I){var i=I.getAttribute(Vl);if(t[i]){if(I[Vn]===e){var a;(a=I.parentNode)===null||a===void 0||a.removeChild(I)}}else t[i]=!0})}return new gk(e)}var ko=u.createContext({hashPriority:"low",cache:lk(),defaultCache:!0});function nk(e,g){if(e.length!==g.length)return!1;for(var l=0;l<e.length;l++)if(e[l]!==g[l])return!1;return!0}var $A=function(){function e(){DC(this,e),D(this,"cache",void 0),D(this,"keys",void 0),D(this,"cacheCallTimes",void 0),this.cache=new Map,this.keys=[],this.cacheCallTimes=0}return EC(e,[{key:"size",value:function(){return this.keys.length}},{key:"internalGet",value:function(l){var t,I,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a={map:this.cache};return l.forEach(function(r){if(!a)a=void 0;else{var s;a=(s=a)===null||s===void 0||(s=s.map)===null||s===void 0?void 0:s.get(r)}}),(t=a)!==null&&t!==void 0&&t.value&&i&&(a.value[1]=this.cacheCallTimes++),(I=a)===null||I===void 0?void 0:I.value}},{key:"get",value:function(l){var t;return(t=this.internalGet(l,!0))===null||t===void 0?void 0:t[0]}},{key:"has",value:function(l){return!!this.internalGet(l)}},{key:"set",value:function(l,t){var I=this;if(!this.has(l)){if(this.size()+1>e.MAX_CACHE_SIZE+e.MAX_CACHE_OFFSET){var i=this.keys.reduce(function(d,J){var Z=oe(d,2),b=Z[1];return I.internalGet(J)[1]<b?[J,I.internalGet(J)[1]]:d},[this.keys[0],this.cacheCallTimes]),a=oe(i,1),r=a[0];this.delete(r)}this.keys.push(l)}var s=this.cache;l.forEach(function(d,J){if(J===l.length-1)s.set(d,{value:[t,I.cacheCallTimes++]});else{var Z=s.get(d);Z?Z.map||(Z.map=new Map):s.set(d,{map:new Map}),s=s.get(d).map}})}},{key:"deleteByPath",value:function(l,t){var I=l.get(t[0]);if(t.length===1){var i;return I.map?l.set(t[0],{map:I.map}):l.delete(t[0]),(i=I.value)===null||i===void 0?void 0:i[0]}var a=this.deleteByPath(I.map,t.slice(1));return(!I.map||I.map.size===0)&&!I.value&&l.delete(t[0]),a}},{key:"delete",value:function(l){if(this.has(l))return this.keys=this.keys.filter(function(t){return!nk(t,l)}),this.deleteByPath(this.cache,l)}}]),e}();D($A,"MAX_CACHE_SIZE",20);D($A,"MAX_CACHE_OFFSET",5);var lm=0,oZ=function(){function e(g){DC(this,e),D(this,"derivatives",void 0),D(this,"id",void 0),this.derivatives=Array.isArray(g)?g:[g],this.id=lm,g.length===0&&(g.length>0,void 0),lm+=1}return EC(e,[{key:"getDerivativeToken",value:function(l){return this.derivatives.reduce(function(t,I){return I(l,t)},void 0)}}]),e}(),Jr=new $A;function iA(e){var g=Array.isArray(e)?e:[e];return Jr.has(g)||Jr.set(g,new oZ(g)),Jr.get(g)}var tk=new WeakMap,Zr={};function Ik(e,g){for(var l=tk,t=0;t<g.length;t+=1){var I=g[t];l.has(I)||l.set(I,new WeakMap),l=l.get(I)}return l.has(Zr)||l.set(Zr,e()),l.get(Zr)}var nm=new WeakMap;function _I(e){var g=nm.get(e)||"";return g||(Object.keys(e).forEach(function(l){var t=e[l];g+=l,t instanceof oZ?g+=t.id:t&&Qe(t)==="object"?g+=_I(t):g+=t}),g=oo(g),nm.set(e,g)),g}function tm(e,g){return oo("".concat(g,"_").concat(_I(e)))}var cA=Fg();function Le(e){return typeof e=="number"?"".concat(e,"px"):e}function nc(e,g,l){var t,I=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(i)return e;var a=O(O({},I),{},(t={},D(t,_t,g),D(t,Vl,l),t)),r=Object.keys(a).map(function(s){var d=a[s];return d?"".concat(s,'="').concat(d,'"'):null}).filter(function(s){return s}).join(" ");return"<style ".concat(r,">").concat(e,"</style>")}var Mi=function(g){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return"--".concat(l?"".concat(l,"-"):"").concat(g).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z]+)([A-Z][a-z0-9]+)/g,"$1-$2").replace(/([a-z])([A-Z0-9])/g,"$1-$2").toLowerCase()},ok=function(g,l,t){return Object.keys(g).length?".".concat(l).concat(t!=null&&t.scope?".".concat(t.scope):"","{").concat(Object.entries(g).map(function(I){var i=oe(I,2),a=i[0],r=i[1];return"".concat(a,":").concat(r,";")}).join(""),"}"):""},iZ=function(g,l,t){var I={},i={};return Object.entries(g).forEach(function(a){var r,s,d=oe(a,2),J=d[0],Z=d[1];if(t!=null&&(r=t.preserve)!==null&&r!==void 0&&r[J])i[J]=Z;else if((typeof Z=="string"||typeof Z=="number")&&!(t!=null&&(s=t.ignore)!==null&&s!==void 0&&s[J])){var b,p=Mi(J,t==null?void 0:t.prefix);I[p]=typeof Z=="number"&&!(t!=null&&(b=t.unitless)!==null&&b!==void 0&&b[J])?"".concat(Z,"px"):String(Z),i[J]="var(".concat(p,")")}}),[i,ok(I,l,{scope:t==null?void 0:t.scope})]},Im=Fg()?u.useLayoutEffect:u.useEffect,kg=function(g,l){var t=u.useRef(!0);Im(function(){return g(t.current)},l),Im(function(){return t.current=!1,function(){t.current=!0}},[])},om=function(g,l){kg(function(t){if(!t)return g()},l)},ik=O({},sc),im=ik.useInsertionEffect,ck=function(g,l,t){u.useMemo(g,t),kg(function(){return l(!0)},t)},ak=im?function(e,g,l){return im(function(){return e(),g()},l)}:ck,rk=O({},sc),Ak=rk.useInsertionEffect,sk=function(g){var l=[],t=!1;function I(i){t||l.push(i)}return u.useEffect(function(){return t=!1,function(){t=!0,l.length&&l.forEach(function(i){return i()})}},g),I},dk=function(){return function(g){g()}},uk=typeof Ak<"u"?sk:dk;function qA(e,g,l,t,I){var i=u.useContext(ko),a=i.cache,r=[e].concat(ye(g)),s=oA(r),d=uk([s]),J=function(y){a.opUpdate(s,function(G){var h=G||[void 0,void 0],f=oe(h,2),W=f[0],X=W===void 0?0:W,B=f[1],V=B,Q=V||l(),v=[X,Q];return y?y(v):v})};u.useMemo(function(){J()},[s]);var Z=a.opGet(s),b=Z[1];return ak(function(){I==null||I(b)},function(p){return J(function(y){var G=oe(y,2),h=G[0],f=G[1];return p&&h===0&&(I==null||I(b)),[h+1,f]}),function(){a.opUpdate(s,function(y){var G=y||[],h=oe(G,2),f=h[0],W=f===void 0?0:f,X=h[1],B=W-1;return B===0?(d(function(){(p||!a.opGet(s))&&(t==null||t(X,!1))}),null):[W-1,X]})}},[s]),b}var mk={},Jk="css",_n=new Map;function Zk(e){_n.set(e,(_n.get(e)||0)+1)}function bk(e,g){if(typeof document<"u"){var l=document.querySelectorAll("style[".concat(_t,'="').concat(e,'"]'));l.forEach(function(t){if(t[Vn]===g){var I;(I=t.parentNode)===null||I===void 0||I.removeChild(t)}})}}var hk=0;function Gk(e,g){_n.set(e,(_n.get(e)||0)-1);var l=Array.from(_n.keys()),t=l.filter(function(I){var i=_n.get(I)||0;return i<=0});l.length-t.length>hk&&t.forEach(function(I){bk(I,g),_n.delete(I)})}var yk=function(g,l,t,I){var i=t.getDerivativeToken(g),a=O(O({},i),l);return I&&(a=I(a)),a},cZ="token";function kk(e,g){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=u.useContext(ko),I=t.cache.instanceId,i=t.container,a=l.salt,r=a===void 0?"":a,s=l.override,d=s===void 0?mk:s,J=l.formatToken,Z=l.getComputedToken,b=l.cssVar,p=Ik(function(){return Object.assign.apply(Object,[{}].concat(ye(g)))},g),y=_I(p),G=_I(d),h=b?_I(b):"",f=qA(cZ,[r,e.id,y,G,h],function(){var W,X=Z?Z(p,d,e):yk(p,d,e,J),B=O({},X),V="";if(b){var Q=iZ(X,b.key,{prefix:b.prefix,ignore:b.ignore,unitless:b.unitless,preserve:b.preserve}),v=oe(Q,2);X=v[0],V=v[1]}var Y=tm(X,r);X._tokenKey=Y,B._tokenKey=tm(B,r);var F=(W=b==null?void 0:b.key)!==null&&W!==void 0?W:Y;X._themeKey=F,Zk(F);var L="".concat(Jk,"-").concat(oo(Y));return X._hashId=L,[X,L,B,V,(b==null?void 0:b.key)||""]},function(W){Gk(W[0]._themeKey,I)},function(W){var X=oe(W,4),B=X[0],V=X[3];if(b&&V){var Q=en(V,oo("css-variables-".concat(B._themeKey)),{mark:Vl,prepend:"queue",attachTo:i,priority:-999});Q[Vn]=I,Q.setAttribute(_t,B._themeKey)}});return f}var pk=function(g,l,t){var I=oe(g,5),i=I[2],a=I[3],r=I[4],s=t||{},d=s.plain;if(!a)return null;var J=i._tokenKey,Z=-999,b={"data-rc-order":"prependQueue","data-rc-priority":"".concat(Z)},p=nc(a,r,J,b,d);return[Z,J,p]},Wk={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},aZ="comm",rZ="rule",AZ="decl",Vk="@import",fk="@namespace",Xk="@keyframes",Rk="@layer",sZ=Math.abs,_A=String.fromCharCode;function dZ(e){return e.trim()}function xi(e,g,l){return e.replace(g,l)}function Qk(e,g,l){return e.indexOf(g,l)}function Ot(e,g){return e.charCodeAt(g)|0}function eI(e,g,l){return e.slice(g,l)}function Fl(e){return e.length}function vk(e){return e.length}function Qi(e,g){return g.push(e),e}var Zc=1,CI=1,uZ=0,sl=0,TC=0,oI="";function es(e,g,l,t,I,i,a,r){return{value:e,root:g,parent:l,type:t,props:I,children:i,line:Zc,column:CI,length:a,return:"",siblings:r}}function Bk(){return TC}function Sk(){return TC=sl>0?Ot(oI,--sl):0,CI--,TC===10&&(CI=1,Zc--),TC}function fl(){return TC=sl<uZ?Ot(oI,sl++):0,CI++,TC===10&&(CI=1,Zc++),TC}function fn(){return Ot(oI,sl)}function Ti(){return sl}function bc(e,g){return eI(oI,e,g)}function io(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Yk(e){return Zc=CI=1,uZ=Fl(oI=e),sl=0,[]}function Fk(e){return oI="",e}function br(e){return dZ(bc(sl-1,aA(e===91?e+2:e===40?e+1:e)))}function Kk(e){for(;(TC=fn())&&TC<33;)fl();return io(e)>2||io(TC)>3?"":" "}function wk(e,g){for(;--g&&fl()&&!(TC<48||TC>102||TC>57&&TC<65||TC>70&&TC<97););return bc(e,Ti()+(g<6&&fn()==32&&fl()==32))}function aA(e){for(;fl();)switch(TC){case e:return sl;case 34:case 39:e!==34&&e!==39&&aA(TC);break;case 40:e===41&&aA(e);break;case 92:fl();break}return sl}function Hk(e,g){for(;fl()&&e+TC!==57;)if(e+TC===84&&fn()===47)break;return"/*"+bc(g,sl-1)+"*"+_A(e===47?e:fl())}function Nk(e){for(;!io(fn());)fl();return bc(e,sl)}function zk(e){return Fk(Di("",null,null,null,[""],e=Yk(e),0,[0],e))}function Di(e,g,l,t,I,i,a,r,s){for(var d=0,J=0,Z=a,b=0,p=0,y=0,G=1,h=1,f=1,W=0,X="",B=I,V=i,Q=t,v=X;h;)switch(y=W,W=fl()){case 40:if(y!=108&&Ot(v,Z-1)==58){Qk(v+=xi(br(W),"&","&\f"),"&\f",sZ(d?r[d-1]:0))!=-1&&(f=-1);break}case 34:case 39:case 91:v+=br(W);break;case 9:case 10:case 13:case 32:v+=Kk(y);break;case 92:v+=wk(Ti()-1,7);continue;case 47:switch(fn()){case 42:case 47:Qi(Lk(Hk(fl(),Ti()),g,l,s),s),(io(y||1)==5||io(fn()||1)==5)&&Fl(v)&&eI(v,-1,void 0)!==" "&&(v+=" ");break;default:v+="/"}break;case 123*G:r[d++]=Fl(v)*f;case 125*G:case 59:case 0:switch(W){case 0:case 125:h=0;case 59+J:f==-1&&(v=xi(v,/\f/g,"")),p>0&&(Fl(v)-Z||G===0&&y===47)&&Qi(p>32?am(v+";",t,l,Z-1,s):am(xi(v," ","")+";",t,l,Z-2,s),s);break;case 59:v+=";";default:if(Qi(Q=cm(v,g,l,d,J,I,r,X,B=[],V=[],Z,i),i),W===123)if(J===0)Di(v,g,Q,Q,B,i,Z,r,V);else{switch(b){case 99:if(Ot(v,3)===110)break;case 108:if(Ot(v,2)===97)break;default:J=0;case 100:case 109:case 115:}J?Di(e,Q,Q,t&&Qi(cm(e,Q,Q,0,0,I,r,X,I,B=[],Z,V),V),I,V,Z,r,t?B:V):Di(v,Q,Q,Q,[""],V,0,r,V)}}d=J=p=0,G=f=1,X=v="",Z=a;break;case 58:Z=1+Fl(v),p=y;default:if(G<1){if(W==123)--G;else if(W==125&&G++==0&&Sk()==125)continue}switch(v+=_A(W),W*G){case 38:f=J>0?1:(v+="\f",-1);break;case 44:r[d++]=(Fl(v)-1)*f,f=1;break;case 64:fn()===45&&(v+=br(fl())),b=fn(),J=Z=Fl(X=v+=Nk(Ti())),W++;break;case 45:y===45&&Fl(v)==2&&(G=0)}}return i}function cm(e,g,l,t,I,i,a,r,s,d,J,Z){for(var b=I-1,p=I===0?i:[""],y=vk(p),G=0,h=0,f=0;G<t;++G)for(var W=0,X=eI(e,b+1,b=sZ(h=a[G])),B=e;W<y;++W)(B=dZ(h>0?p[W]+" "+X:xi(X,/&\f/g,p[W])))&&(s[f++]=B);return es(e,g,l,I===0?rZ:r,s,d,J,Z)}function Lk(e,g,l,t){return es(e,g,l,aZ,_A(Bk()),eI(e,2,-2),0,t)}function am(e,g,l,t,I){return es(e,g,l,AZ,eI(e,0,t),eI(e,t+1,-1),t,I)}function rA(e,g){for(var l="",t=0;t<e.length;t++)l+=g(e[t],t,e,g)||"";return l}function Uk(e,g,l,t){switch(e.type){case Rk:if(e.children.length)break;case Vk:case fk:case AZ:return e.return=e.return||e.value;case aZ:return"";case Xk:return e.return=e.value+"{"+rA(e.children,t)+"}";case rZ:if(!Fl(e.value=e.props.join(",")))return""}return Fl(l=rA(e.children,t))?e.return=e.value+"{"+l+"}":""}var rm="data-ant-cssinjs-cache-path",mZ="_FILE_STYLE__",lt,JZ=!0;function Mk(){if(!lt&&(lt={},Fg())){var e=document.createElement("div");e.className=rm,e.style.position="fixed",e.style.visibility="hidden",e.style.top="-9999px",document.body.appendChild(e);var g=getComputedStyle(e).content||"";g=g.replace(/^"/,"").replace(/"$/,""),g.split(";").forEach(function(I){var i=I.split(":"),a=oe(i,2),r=a[0],s=a[1];lt[r]=s});var l=document.querySelector("style[".concat(rm,"]"));if(l){var t;JZ=!1,(t=l.parentNode)===null||t===void 0||t.removeChild(l)}document.body.removeChild(e)}}function xk(e){return Mk(),!!lt[e]}function Tk(e){var g=lt[e],l=null;if(g&&Fg())if(JZ)l=mZ;else{var t=document.querySelector("style[".concat(Vl,'="').concat(lt[e],'"]'));t?l=t.innerHTML:delete lt[e]}return[l,g]}var Dk="_skip_check_",ZZ="_multi_value_";function Ei(e){var g=rA(zk(e),Uk);return g.replace(/\{%%%\:[^;];}/g,";")}function Ek(e){return Qe(e)==="object"&&e&&(Dk in e||ZZ in e)}function Am(e,g,l){if(!g)return e;var t=".".concat(g),I=l==="low"?":where(".concat(t,")"):t,i=e.split(",").map(function(a){var r,s=a.trim().split(/\s+/),d=s[0]||"",J=((r=d.match(/^\w+/))===null||r===void 0?void 0:r[0])||"";return d="".concat(J).concat(I).concat(d.slice(J.length)),[d].concat(ye(s.slice(1))).join(" ")});return i.join(",")}var Ok=function e(g){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{root:!0,parentSelectors:[]},I=t.root,i=t.injectHash,a=t.parentSelectors,r=l.hashId,s=l.layer;l.path;var d=l.hashPriority,J=l.transformers,Z=J===void 0?[]:J;l.linters;var b="",p={};function y(f){var W=f.getName(r);if(!p[W]){var X=e(f.style,l,{root:!1,parentSelectors:a}),B=oe(X,1),V=B[0];p[W]="@keyframes ".concat(f.getName(r)).concat(V)}}function G(f){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return f.forEach(function(X){Array.isArray(X)?G(X,W):X&&W.push(X)}),W}var h=G(Array.isArray(g)?g:[g]);return h.forEach(function(f){var W=typeof f=="string"&&!I?{}:f;if(typeof W=="string")b+="".concat(W,`
`);else if(W._keyframe)y(W);else{var X=Z.reduce(function(B,V){var Q;return(V==null||(Q=V.visit)===null||Q===void 0?void 0:Q.call(V,B))||B},W);Object.keys(X).forEach(function(B){var V=X[B];if(Qe(V)==="object"&&V&&(B!=="animationName"||!V._keyframe)&&!Ek(V)){var Q=!1,v=B.trim(),Y=!1;(I||i)&&r?v.startsWith("@")?Q=!0:v==="&"?v=Am("",r,d):v=Am(B,r,d):I&&!r&&(v==="&"||v==="")&&(v="",Y=!0);var F=e(V,l,{root:Y,injectHash:Q,parentSelectors:[].concat(ye(a),[v])}),L=oe(F,2),M=L[0],ee=L[1];p=O(O({},p),ee),b+="".concat(v).concat(M)}else{let le=function(N,w){var K=N.replace(/[A-Z]/g,function(z){return"-".concat(z.toLowerCase())}),T=w;!Wk[N]&&typeof T=="number"&&T!==0&&(T="".concat(T,"px")),N==="animationName"&&w!==null&&w!==void 0&&w._keyframe&&(y(w),T=w.getName(r)),b+="".concat(K,":").concat(T,";")};var q,P=(q=V==null?void 0:V.value)!==null&&q!==void 0?q:V;Qe(V)==="object"&&V!==null&&V!==void 0&&V[ZZ]&&Array.isArray(P)?P.forEach(function(N){le(B,N)}):le(B,P)}})}}),I?s&&(b&&(b="@layer ".concat(s.name," {").concat(b,"}")),s.dependencies&&(p["@layer ".concat(s.name)]=s.dependencies.map(function(f){return"@layer ".concat(f,", ").concat(s.name,";")}).join(`
`))):b="{".concat(b,"}"),[b,p]};function bZ(e,g){return oo("".concat(e.join("%")).concat(g))}function Pk(){return null}var hZ="style";function AA(e,g){var l=e.token,t=e.path,I=e.hashId,i=e.layer,a=e.nonce,r=e.clientOnly,s=e.order,d=s===void 0?0:s,J=u.useContext(ko),Z=J.autoClear;J.mock;var b=J.defaultCache,p=J.hashPriority,y=J.container,G=J.ssrInline,h=J.transformers,f=J.linters,W=J.cache,X=J.layer,B=l._tokenKey,V=[B];X&&V.push("layer"),V.push.apply(V,ye(t));var Q=cA,v=qA(hZ,V,function(){var ee=V.join("|");if(xk(ee)){var q=Tk(ee),P=oe(q,2),le=P[0],N=P[1];if(le)return[le,B,N,{},r,d]}var w=g(),K=Ok(w,{hashId:I,hashPriority:p,layer:X?i:void 0,path:t.join("-"),transformers:h,linters:f}),T=oe(K,2),z=T[0],R=T[1],H=Ei(z),E=bZ(V,H);return[H,B,E,R,r,d]},function(ee,q){var P=oe(ee,3),le=P[2];(q||Z)&&cA&&go(le,{mark:Vl})},function(ee){var q=oe(ee,4),P=q[0];q[1];var le=q[2],N=q[3];if(Q&&P!==mZ){var w={mark:Vl,prepend:X?!1:"queue",attachTo:y,priority:d},K=typeof a=="function"?a():a;K&&(w.csp={nonce:K});var T=[],z=[];Object.keys(N).forEach(function(H){H.startsWith("@layer")?T.push(H):z.push(H)}),T.forEach(function(H){en(Ei(N[H]),"_layer-".concat(H),O(O({},w),{},{prepend:!0}))});var R=en(P,le,w);R[Vn]=W.instanceId,R.setAttribute(_t,B),z.forEach(function(H){en(Ei(N[H]),"_effect-".concat(H),w)})}}),Y=oe(v,3),F=Y[0],L=Y[1],M=Y[2];return function(ee){var q;if(!G||Q||!b)q=u.createElement(Pk,null);else{var P;q=u.createElement("style",Be({},(P={},D(P,_t,L),D(P,Vl,M),P),{dangerouslySetInnerHTML:{__html:F}}))}return u.createElement(u.Fragment,null,q,ee)}}var jk=function(g,l,t){var I=oe(g,6),i=I[0],a=I[1],r=I[2],s=I[3],d=I[4],J=I[5],Z=t||{},b=Z.plain;if(d)return null;var p=i,y={"data-rc-order":"prependQueue","data-rc-priority":"".concat(J)};return p=nc(i,a,r,y,b),s&&Object.keys(s).forEach(function(G){if(!l[G]){l[G]=!0;var h=Ei(s[G]),f=nc(h,a,"_effect-".concat(G),y,b);G.startsWith("@layer")?p=f+p:p+=f}}),[J,r,p]},GZ="cssVar",$k=function(g,l){var t=g.key,I=g.prefix,i=g.unitless,a=g.ignore,r=g.token,s=g.scope,d=s===void 0?"":s,J=u.useContext(ko),Z=J.cache.instanceId,b=J.container,p=r._tokenKey,y=[].concat(ye(g.path),[t,d,p]),G=qA(GZ,y,function(){var h=l(),f=iZ(h,t,{prefix:I,unitless:i,ignore:a,scope:d}),W=oe(f,2),X=W[0],B=W[1],V=bZ(y,B);return[X,B,V,t]},function(h){var f=oe(h,3),W=f[2];cA&&go(W,{mark:Vl})},function(h){var f=oe(h,3),W=f[1],X=f[2];if(W){var B=en(W,X,{mark:Vl,prepend:"queue",attachTo:b,priority:-999});B[Vn]=Z,B.setAttribute(_t,t)}});return G},qk=function(g,l,t){var I=oe(g,4),i=I[1],a=I[2],r=I[3],s=t||{},d=s.plain;if(!i)return null;var J=-999,Z={"data-rc-order":"prependQueue","data-rc-priority":"".concat(J)},b=nc(i,r,a,Z,d);return[J,a,b]},MI;MI={},D(MI,hZ,jk),D(MI,cZ,pk),D(MI,GZ,qk);var $C=function(){function e(g,l){DC(this,e),D(this,"name",void 0),D(this,"style",void 0),D(this,"_keyframe",!0),this.name=g,this.style=l}return EC(e,[{key:"getName",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return l?"".concat(l,"-").concat(this.name):this.name}}]),e}();function Yt(e){return e.notSplit=!0,e}Yt(["borderTop","borderBottom"]),Yt(["borderTop"]),Yt(["borderBottom"]),Yt(["borderLeft","borderRight"]),Yt(["borderLeft"]),Yt(["borderRight"]);function _k(e){return SJ(e)||lZ(e)||MA(e)||YJ()}function Kl(e,g){for(var l=e,t=0;t<g.length;t+=1){if(l==null)return;l=l[g[t]]}return l}function yZ(e,g,l,t){if(!g.length)return l;var I=_k(g),i=I[0],a=I.slice(1),r;return!e&&typeof i=="number"?r=[]:Array.isArray(e)?r=ye(e):r=O({},e),t&&l===void 0&&a.length===1?delete r[i][a[0]]:r[i]=yZ(r[i],a,l,t),r}function pl(e,g,l){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return g.length&&t&&l===void 0&&!Kl(e,g.slice(0,-1))?e:yZ(e,g,l,t)}function ep(e){return Qe(e)==="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}function sm(e){return Array.isArray(e)?[]:{}}var Cp=typeof Reflect>"u"?Object.keys:Reflect.ownKeys;function Ut(){for(var e=arguments.length,g=new Array(e),l=0;l<e;l++)g[l]=arguments[l];var t=sm(g[0]);return g.forEach(function(I){function i(a,r){var s=new Set(r),d=Kl(I,a),J=Array.isArray(d);if(J||ep(d)){if(!s.has(d)){s.add(d);var Z=Kl(t,a);J?t=pl(t,a,[]):(!Z||Qe(Z)!=="object")&&(t=pl(t,a,sm(d))),Cp(d).forEach(function(b){i([].concat(ye(a),[b]),s)})}}else t=pl(t,a,d)}i([])}),t}function gp(){}const lp=u.createContext({}),Cs=()=>{const e=()=>{};return e.deprecated=gp,e},np=u.createContext(void 0);var tp={items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"},Ip={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0},op=O(O({},Ip),{},{locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"OK",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",dateFormat:"M/D/YYYY",dateTimeFormat:"M/D/YYYY HH:mm:ss",previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"});const kZ={placeholder:"Select time",rangePlaceholder:["Start time","End time"]},dm={lang:Object.assign({placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeQuarterPlaceholder:["Start quarter","End quarter"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"]},op),timePickerLocale:Object.assign({},kZ)},Og="${label} is not a valid ${type}",Cn={locale:"en",Pagination:tp,DatePicker:dm,TimePicker:kZ,Calendar:dm,global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectNone:"Clear all data",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting"},Tour:{Next:"Next",Previous:"Previous",Finish:"Finish"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",deselectAll:"Deselect all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand",collapse:"Collapse"},Form:{optional:"(optional)",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:Og,method:Og,array:Og,object:Og,number:Og,date:Og,boolean:Og,integer:Og,float:Og,regexp:Og,email:Og,url:Og,hex:Og},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},Image:{preview:"Preview"},QRCode:{expired:"QR code expired",refresh:"Refresh",scanned:"Scanned"},ColorPicker:{presetEmpty:"Empty",transparent:"Transparent",singleColor:"Single",gradientColor:"Gradient"}};Object.assign({},Cn.Modal);let Oi=[];const um=()=>Oi.reduce((e,g)=>Object.assign(Object.assign({},e),g),Cn.Modal);function ip(e){if(e){const g=Object.assign({},e);return Oi.push(g),um(),()=>{Oi=Oi.filter(l=>l!==g),um()}}Object.assign({},Cn.Modal)}const gs=u.createContext(void 0),cp=(e,g)=>{const l=u.useContext(gs),t=u.useMemo(()=>{var i;const a=g||Cn[e],r=(i=l==null?void 0:l[e])!==null&&i!==void 0?i:{};return Object.assign(Object.assign({},typeof a=="function"?a():a),r||{})},[e,g,l]),I=u.useMemo(()=>{const i=l==null?void 0:l.locale;return l!=null&&l.exist&&!i?Cn.locale:i},[l]);return[t,I]},ap="internalMark",rp=e=>{const{locale:g={},children:l,_ANT_MARK__:t}=e;u.useEffect(()=>ip(g==null?void 0:g.Modal),[g]);const I=u.useMemo(()=>Object.assign(Object.assign({},g),{exist:!0}),[g]);return u.createElement(gs.Provider,{value:I},l)},pZ={blue:"#1677FF",purple:"#722ED1",cyan:"#13C2C2",green:"#52C41A",magenta:"#EB2F96",pink:"#EB2F96",red:"#F5222D",orange:"#FA8C16",yellow:"#FADB14",volcano:"#FA541C",geekblue:"#2F54EB",gold:"#FAAD14",lime:"#A0D911"},co=Object.assign(Object.assign({},pZ),{colorPrimary:"#1677ff",colorSuccess:"#52c41a",colorWarning:"#faad14",colorError:"#ff4d4f",colorInfo:"#1677ff",colorLink:"",colorTextBase:"",colorBgBase:"",fontFamily:`-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
'Noto Color Emoji'`,fontFamilyCode:"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace",fontSize:14,lineWidth:1,lineType:"solid",motionUnit:.1,motionBase:0,motionEaseOutCirc:"cubic-bezier(0.08, 0.82, 0.17, 1)",motionEaseInOutCirc:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",motionEaseOut:"cubic-bezier(0.215, 0.61, 0.355, 1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)",motionEaseOutBack:"cubic-bezier(0.12, 0.4, 0.29, 1.46)",motionEaseInBack:"cubic-bezier(0.71, -0.46, 0.88, 0.6)",motionEaseInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",motionEaseOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0});function Ap(e,g){let{generateColorPalettes:l,generateNeutralColorPalettes:t}=g;const{colorSuccess:I,colorWarning:i,colorError:a,colorInfo:r,colorPrimary:s,colorBgBase:d,colorTextBase:J}=e,Z=l(s),b=l(I),p=l(i),y=l(a),G=l(r),h=t(d,J),f=e.colorLink||e.colorInfo,W=l(f),X=new AC(y[1]).mix(new AC(y[3]),50).toHexString();return Object.assign(Object.assign({},h),{colorPrimaryBg:Z[1],colorPrimaryBgHover:Z[2],colorPrimaryBorder:Z[3],colorPrimaryBorderHover:Z[4],colorPrimaryHover:Z[5],colorPrimary:Z[6],colorPrimaryActive:Z[7],colorPrimaryTextHover:Z[8],colorPrimaryText:Z[9],colorPrimaryTextActive:Z[10],colorSuccessBg:b[1],colorSuccessBgHover:b[2],colorSuccessBorder:b[3],colorSuccessBorderHover:b[4],colorSuccessHover:b[4],colorSuccess:b[6],colorSuccessActive:b[7],colorSuccessTextHover:b[8],colorSuccessText:b[9],colorSuccessTextActive:b[10],colorErrorBg:y[1],colorErrorBgHover:y[2],colorErrorBgFilledHover:X,colorErrorBgActive:y[3],colorErrorBorder:y[3],colorErrorBorderHover:y[4],colorErrorHover:y[5],colorError:y[6],colorErrorActive:y[7],colorErrorTextHover:y[8],colorErrorText:y[9],colorErrorTextActive:y[10],colorWarningBg:p[1],colorWarningBgHover:p[2],colorWarningBorder:p[3],colorWarningBorderHover:p[4],colorWarningHover:p[4],colorWarning:p[6],colorWarningActive:p[7],colorWarningTextHover:p[8],colorWarningText:p[9],colorWarningTextActive:p[10],colorInfoBg:G[1],colorInfoBgHover:G[2],colorInfoBorder:G[3],colorInfoBorderHover:G[4],colorInfoHover:G[4],colorInfo:G[6],colorInfoActive:G[7],colorInfoTextHover:G[8],colorInfoText:G[9],colorInfoTextActive:G[10],colorLinkHover:W[4],colorLink:W[6],colorLinkActive:W[7],colorBgMask:new AC("#000").setA(.45).toRgbString(),colorWhite:"#fff"})}const sp=e=>{let g=e,l=e,t=e,I=e;return e<6&&e>=5?g=e+1:e<16&&e>=6?g=e+2:e>=16&&(g=16),e<7&&e>=5?l=4:e<8&&e>=7?l=5:e<14&&e>=8?l=6:e<16&&e>=14?l=7:e>=16&&(l=8),e<6&&e>=2?t=1:e>=6&&(t=2),e>4&&e<8?I=4:e>=8&&(I=6),{borderRadius:e,borderRadiusXS:t,borderRadiusSM:l,borderRadiusLG:g,borderRadiusOuter:I}};function dp(e){const{motionUnit:g,motionBase:l,borderRadius:t,lineWidth:I}=e;return Object.assign({motionDurationFast:`${(l+g).toFixed(1)}s`,motionDurationMid:`${(l+g*2).toFixed(1)}s`,motionDurationSlow:`${(l+g*3).toFixed(1)}s`,lineWidthBold:I+1},sp(t))}const up=e=>{const{controlHeight:g}=e;return{controlHeightSM:g*.75,controlHeightXS:g*.5,controlHeightLG:g*1.25}};function Pi(e){return(e+8)/e}function mp(e){const g=new Array(10).fill(null).map((l,t)=>{const I=t-1,i=e*Math.pow(Math.E,I/5),a=t>1?Math.floor(i):Math.ceil(i);return Math.floor(a/2)*2});return g[1]=e,g.map(l=>({size:l,lineHeight:Pi(l)}))}const Jp=e=>{const g=mp(e),l=g.map(J=>J.size),t=g.map(J=>J.lineHeight),I=l[1],i=l[0],a=l[2],r=t[1],s=t[0],d=t[2];return{fontSizeSM:i,fontSize:I,fontSizeLG:a,fontSizeXL:l[3],fontSizeHeading1:l[6],fontSizeHeading2:l[5],fontSizeHeading3:l[4],fontSizeHeading4:l[3],fontSizeHeading5:l[2],lineHeight:r,lineHeightLG:d,lineHeightSM:s,fontHeight:Math.round(r*I),fontHeightLG:Math.round(d*a),fontHeightSM:Math.round(s*i),lineHeightHeading1:t[6],lineHeightHeading2:t[5],lineHeightHeading3:t[4],lineHeightHeading4:t[3],lineHeightHeading5:t[2]}};function Zp(e){const{sizeUnit:g,sizeStep:l}=e;return{sizeXXL:g*(l+8),sizeXL:g*(l+4),sizeLG:g*(l+2),sizeMD:g*(l+1),sizeMS:g*l,size:g*l,sizeSM:g*(l-1),sizeXS:g*(l-2),sizeXXS:g*(l-3)}}const cl=(e,g)=>new AC(e).setA(g).toRgbString(),xI=(e,g)=>new AC(e).darken(g).toHexString(),bp=e=>{const g=Co(e);return{1:g[0],2:g[1],3:g[2],4:g[3],5:g[4],6:g[5],7:g[6],8:g[4],9:g[5],10:g[6]}},hp=(e,g)=>{const l=e||"#fff",t=g||"#000";return{colorBgBase:l,colorTextBase:t,colorText:cl(t,.88),colorTextSecondary:cl(t,.65),colorTextTertiary:cl(t,.45),colorTextQuaternary:cl(t,.25),colorFill:cl(t,.15),colorFillSecondary:cl(t,.06),colorFillTertiary:cl(t,.04),colorFillQuaternary:cl(t,.02),colorBgSolid:cl(t,1),colorBgSolidHover:cl(t,.75),colorBgSolidActive:cl(t,.95),colorBgLayout:xI(l,4),colorBgContainer:xI(l,0),colorBgElevated:xI(l,0),colorBgSpotlight:cl(t,.85),colorBgBlur:"transparent",colorBorder:xI(l,15),colorBorderSecondary:xI(l,6)}};function Gp(e){Et.pink=Et.magenta,dr.pink=dr.magenta;const g=Object.keys(pZ).map(l=>{const t=e[l]===Et[l]?dr[l]:Co(e[l]);return new Array(10).fill(1).reduce((I,i,a)=>(I[`${l}-${a+1}`]=t[a],I[`${l}${a+1}`]=t[a],I),{})}).reduce((l,t)=>(l=Object.assign(Object.assign({},l),t),l),{});return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),g),Ap(e,{generateColorPalettes:bp,generateNeutralColorPalettes:hp})),Jp(e.fontSize)),Zp(e)),up(e)),dp(e))}const WZ=iA(Gp),sA={token:co,override:{override:co},hashed:!0},VZ=de.createContext(sA),ao="ant",hc="anticon",yp=(e,g)=>g||(e?`${ao}-${e}`:ao),zC=u.createContext({getPrefixCls:yp,iconPrefixCls:hc}),{Consumer:CB}=zC,kp=`-ant-${Date.now()}-${Math.random()}`;function pp(e,g){const l={},t=(a,r)=>{let s=a.clone();return s=(r==null?void 0:r(s))||s,s.toRgbString()},I=(a,r)=>{const s=new AC(a),d=Co(s.toRgbString());l[`${r}-color`]=t(s),l[`${r}-color-disabled`]=d[1],l[`${r}-color-hover`]=d[4],l[`${r}-color-active`]=d[6],l[`${r}-color-outline`]=s.clone().setA(.2).toRgbString(),l[`${r}-color-deprecated-bg`]=d[0],l[`${r}-color-deprecated-border`]=d[2]};if(g.primaryColor){I(g.primaryColor,"primary");const a=new AC(g.primaryColor),r=Co(a.toRgbString());r.forEach((d,J)=>{l[`primary-${J+1}`]=d}),l["primary-color-deprecated-l-35"]=t(a,d=>d.lighten(35)),l["primary-color-deprecated-l-20"]=t(a,d=>d.lighten(20)),l["primary-color-deprecated-t-20"]=t(a,d=>d.tint(20)),l["primary-color-deprecated-t-50"]=t(a,d=>d.tint(50)),l["primary-color-deprecated-f-12"]=t(a,d=>d.setA(d.a*.12));const s=new AC(r[0]);l["primary-color-active-deprecated-f-30"]=t(s,d=>d.setA(d.a*.3)),l["primary-color-active-deprecated-d-02"]=t(s,d=>d.darken(2))}return g.successColor&&I(g.successColor,"success"),g.warningColor&&I(g.warningColor,"warning"),g.errorColor&&I(g.errorColor,"error"),g.infoColor&&I(g.infoColor,"info"),`
  :root {
    ${Object.keys(l).map(a=>`--${e}-${a}: ${l[a]};`).join(`
`)}
  }
  `.trim()}function Wp(e,g){const l=pp(e,g);Fg()&&en(l,`${kp}-dynamic-theme`)}const ro=u.createContext(!1),Vp=e=>{let{children:g,disabled:l}=e;const t=u.useContext(ro);return u.createElement(ro.Provider,{value:l??t},g)},gI=u.createContext(void 0),fp=e=>{let{children:g,size:l}=e;const t=u.useContext(gI);return u.createElement(gI.Provider,{value:l||t},g)};function Xp(){const e=u.useContext(ro),g=u.useContext(gI);return{componentDisabled:e,componentSize:g}}var fZ=EC(function e(){DC(this,e)}),XZ="CALC_UNIT",Rp=new RegExp(XZ,"g");function hr(e){return typeof e=="number"?"".concat(e).concat(XZ):e}var Qp=function(e){wl(l,e);var g=Hl(l);function l(t,I){var i;DC(this,l),i=g.call(this),D(Ne(i),"result",""),D(Ne(i),"unitlessCssVar",void 0),D(Ne(i),"lowPriority",void 0);var a=Qe(t);return i.unitlessCssVar=I,t instanceof l?i.result="(".concat(t.result,")"):a==="number"?i.result=hr(t):a==="string"&&(i.result=t),i}return EC(l,[{key:"add",value:function(I){return I instanceof l?this.result="".concat(this.result," + ").concat(I.getResult()):(typeof I=="number"||typeof I=="string")&&(this.result="".concat(this.result," + ").concat(hr(I))),this.lowPriority=!0,this}},{key:"sub",value:function(I){return I instanceof l?this.result="".concat(this.result," - ").concat(I.getResult()):(typeof I=="number"||typeof I=="string")&&(this.result="".concat(this.result," - ").concat(hr(I))),this.lowPriority=!0,this}},{key:"mul",value:function(I){return this.lowPriority&&(this.result="(".concat(this.result,")")),I instanceof l?this.result="".concat(this.result," * ").concat(I.getResult(!0)):(typeof I=="number"||typeof I=="string")&&(this.result="".concat(this.result," * ").concat(I)),this.lowPriority=!1,this}},{key:"div",value:function(I){return this.lowPriority&&(this.result="(".concat(this.result,")")),I instanceof l?this.result="".concat(this.result," / ").concat(I.getResult(!0)):(typeof I=="number"||typeof I=="string")&&(this.result="".concat(this.result," / ").concat(I)),this.lowPriority=!1,this}},{key:"getResult",value:function(I){return this.lowPriority||I?"(".concat(this.result,")"):this.result}},{key:"equal",value:function(I){var i=this,a=I||{},r=a.unit,s=!0;return typeof r=="boolean"?s=r:Array.from(this.unitlessCssVar).some(function(d){return i.result.includes(d)})&&(s=!1),this.result=this.result.replace(Rp,s?"px":""),typeof this.lowPriority<"u"?"calc(".concat(this.result,")"):this.result}}]),l}(fZ),vp=function(e){wl(l,e);var g=Hl(l);function l(t){var I;return DC(this,l),I=g.call(this),D(Ne(I),"result",0),t instanceof l?I.result=t.result:typeof t=="number"&&(I.result=t),I}return EC(l,[{key:"add",value:function(I){return I instanceof l?this.result+=I.result:typeof I=="number"&&(this.result+=I),this}},{key:"sub",value:function(I){return I instanceof l?this.result-=I.result:typeof I=="number"&&(this.result-=I),this}},{key:"mul",value:function(I){return I instanceof l?this.result*=I.result:typeof I=="number"&&(this.result*=I),this}},{key:"div",value:function(I){return I instanceof l?this.result/=I.result:typeof I=="number"&&(this.result/=I),this}},{key:"equal",value:function(){return this.result}}]),l}(fZ),Bp=function(g,l){var t=g==="css"?Qp:vp;return function(I){return new t(I,l)}},mm=function(g,l){return"".concat([l,g.replace(/([A-Z]+)([A-Z][a-z]+)/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2")].filter(Boolean).join("-"))};function jg(e){var g=u.useRef();g.current=e;var l=u.useCallback(function(){for(var t,I=arguments.length,i=new Array(I),a=0;a<I;a++)i[a]=arguments[a];return(t=g.current)===null||t===void 0?void 0:t.call.apply(t,[g].concat(i))},[]);return l}function Ao(e){var g=u.useRef(!1),l=u.useState(e),t=oe(l,2),I=t[0],i=t[1];u.useEffect(function(){return g.current=!1,function(){g.current=!0}},[]);function a(r,s){s&&g.current||i(r)}return[I,a]}function Gr(e){return e!==void 0}function so(e,g){var l=g||{},t=l.defaultValue,I=l.value,i=l.onChange,a=l.postState,r=Ao(function(){return Gr(I)?I:Gr(t)?typeof t=="function"?t():t:typeof e=="function"?e():e}),s=oe(r,2),d=s[0],J=s[1],Z=I!==void 0?I:d,b=a?a(Z):Z,p=jg(i),y=Ao([Z]),G=oe(y,2),h=G[0],f=G[1];om(function(){var X=h[0];d!==X&&p(d,X)},[h]),om(function(){Gr(I)||J(I)},[I]);var W=jg(function(X,B){J(X,B),f([Z],B)});return[b,W]}function Jm(e,g,l,t){var I=O({},g[e]);if(t!=null&&t.deprecatedTokens){var i=t.deprecatedTokens;i.forEach(function(r){var s=oe(r,2),d=s[0],J=s[1];if(I!=null&&I[d]||I!=null&&I[J]){var Z;(Z=I[J])!==null&&Z!==void 0||(I[J]=I==null?void 0:I[d])}})}var a=O(O({},l),I);return Object.keys(a).forEach(function(r){a[r]===g[r]&&delete a[r]}),a}var RZ=typeof CSSINJS_STATISTIC<"u",dA=!0;function pg(){for(var e=arguments.length,g=new Array(e),l=0;l<e;l++)g[l]=arguments[l];if(!RZ)return Object.assign.apply(Object,[{}].concat(g));dA=!1;var t={};return g.forEach(function(I){if(Qe(I)==="object"){var i=Object.keys(I);i.forEach(function(a){Object.defineProperty(t,a,{configurable:!0,enumerable:!0,get:function(){return I[a]}})})}}),dA=!0,t}var Zm={};function Sp(){}var Yp=function(g){var l,t=g,I=Sp;return RZ&&typeof Proxy<"u"&&(l=new Set,t=new Proxy(g,{get:function(a,r){if(dA){var s;(s=l)===null||s===void 0||s.add(r)}return a[r]}}),I=function(a,r){var s;Zm[a]={global:Array.from(l),component:O(O({},(s=Zm[a])===null||s===void 0?void 0:s.component),r)}}),{token:t,keys:l,flush:I}};function bm(e,g,l){if(typeof l=="function"){var t;return l(pg(g,(t=g[e])!==null&&t!==void 0?t:{}))}return l??{}}function Fp(e){return e==="js"?{max:Math.max,min:Math.min}:{max:function(){for(var l=arguments.length,t=new Array(l),I=0;I<l;I++)t[I]=arguments[I];return"max(".concat(t.map(function(i){return Le(i)}).join(","),")")},min:function(){for(var l=arguments.length,t=new Array(l),I=0;I<l;I++)t[I]=arguments[I];return"min(".concat(t.map(function(i){return Le(i)}).join(","),")")}}}var Kp=1e3*60*10,wp=function(){function e(){DC(this,e),D(this,"map",new Map),D(this,"objectIDMap",new WeakMap),D(this,"nextID",0),D(this,"lastAccessBeat",new Map),D(this,"accessBeat",0)}return EC(e,[{key:"set",value:function(l,t){this.clear();var I=this.getCompositeKey(l);this.map.set(I,t),this.lastAccessBeat.set(I,Date.now())}},{key:"get",value:function(l){var t=this.getCompositeKey(l),I=this.map.get(t);return this.lastAccessBeat.set(t,Date.now()),this.accessBeat+=1,I}},{key:"getCompositeKey",value:function(l){var t=this,I=l.map(function(i){return i&&Qe(i)==="object"?"obj_".concat(t.getObjectID(i)):"".concat(Qe(i),"_").concat(i)});return I.join("|")}},{key:"getObjectID",value:function(l){if(this.objectIDMap.has(l))return this.objectIDMap.get(l);var t=this.nextID;return this.objectIDMap.set(l,t),this.nextID+=1,t}},{key:"clear",value:function(){var l=this;if(this.accessBeat>1e4){var t=Date.now();this.lastAccessBeat.forEach(function(I,i){t-I>Kp&&(l.map.delete(i),l.lastAccessBeat.delete(i))}),this.accessBeat=0}}}]),e}(),hm=new wp;function Hp(e,g){return de.useMemo(function(){var l=hm.get(g);if(l)return l;var t=e();return hm.set(g,t),t},g)}var Np=function(){return{}};function zp(e){var g=e.useCSP,l=g===void 0?Np:g,t=e.useToken,I=e.usePrefix,i=e.getResetStyles,a=e.getCommonStyle,r=e.getCompUnitless;function s(b,p,y,G){var h=Array.isArray(b)?b[0]:b;function f(Y){return"".concat(String(h)).concat(Y.slice(0,1).toUpperCase()).concat(Y.slice(1))}var W=(G==null?void 0:G.unitless)||{},X=typeof r=="function"?r(b):{},B=O(O({},X),{},D({},f("zIndexPopup"),!0));Object.keys(W).forEach(function(Y){B[f(Y)]=W[Y]});var V=O(O({},G),{},{unitless:B,prefixToken:f}),Q=J(b,p,y,V),v=d(h,y,V);return function(Y){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Y,L=Q(Y,F),M=oe(L,2),ee=M[1],q=v(F),P=oe(q,2),le=P[0],N=P[1];return[le,ee,N]}}function d(b,p,y){var G=y.unitless,h=y.injectStyle,f=h===void 0?!0:h,W=y.prefixToken,X=y.ignore,B=function(v){var Y=v.rootCls,F=v.cssVar,L=F===void 0?{}:F,M=t(),ee=M.realToken;return $k({path:[b],prefix:L.prefix,key:L.key,unitless:G,ignore:X,token:ee,scope:Y},function(){var q=bm(b,ee,p),P=Jm(b,ee,q,{deprecatedTokens:y==null?void 0:y.deprecatedTokens});return Object.keys(q).forEach(function(le){P[W(le)]=P[le],delete P[le]}),P}),null},V=function(v){var Y=t(),F=Y.cssVar;return[function(L){return f&&F?de.createElement(de.Fragment,null,de.createElement(B,{rootCls:v,cssVar:F,component:b}),L):L},F==null?void 0:F.key]};return V}function J(b,p,y){var G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},h=Array.isArray(b)?b:[b,b],f=oe(h,1),W=f[0],X=h.join("-"),B=e.layer||{name:"antd"};return function(V){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:V,v=t(),Y=v.theme,F=v.realToken,L=v.hashId,M=v.token,ee=v.cssVar,q=I(),P=q.rootPrefixCls,le=q.iconPrefixCls,N=l(),w=ee?"css":"js",K=Hp(function(){var j=new Set;return ee&&Object.keys(G.unitless||{}).forEach(function(ge){j.add(Mi(ge,ee.prefix)),j.add(Mi(ge,mm(W,ee.prefix)))}),Bp(w,j)},[w,W,ee==null?void 0:ee.prefix]),T=Fp(w),z=T.max,R=T.min,H={theme:Y,token:M,hashId:L,nonce:function(){return N.nonce},clientOnly:G.clientOnly,layer:B,order:G.order||-999};typeof i=="function"&&AA(O(O({},H),{},{clientOnly:!1,path:["Shared",P]}),function(){return i(M,{prefix:{rootPrefixCls:P,iconPrefixCls:le},csp:N})});var E=AA(O(O({},H),{},{path:[X,V,le]}),function(){if(G.injectStyle===!1)return[];var j=Yp(M),ge=j.token,ne=j.flush,ie=bm(W,F,y),Ae=".".concat(V),ae=Jm(W,F,ie,{deprecatedTokens:G.deprecatedTokens});ee&&ie&&Qe(ie)==="object"&&Object.keys(ie).forEach(function(Je){ie[Je]="var(".concat(Mi(Je,mm(W,ee.prefix)),")")});var se=pg(ge,{componentCls:Ae,prefixCls:V,iconCls:".".concat(le),antCls:".".concat(P),calc:K,max:z,min:R},ee?ie:ae),ze=p(se,{hashId:L,prefixCls:V,rootPrefixCls:P,iconPrefixCls:le});ne(W,ae);var We=typeof a=="function"?a(se,V,Q,G.resetFont):null;return[G.resetStyle===!1?null:We,ze]});return[E,L]}}function Z(b,p,y){var G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},h=J(b,p,y,O({resetStyle:!1,order:-998},G)),f=function(X){var B=X.prefixCls,V=X.rootCls,Q=V===void 0?B:V;return h(B,Q),null};return f}return{genStyleHooks:s,genSubStyleComponent:Z,genComponentStyleHook:J}}const lI=["blue","purple","cyan","green","magenta","pink","red","orange","yellow","volcano","geekblue","lime","gold"],Lp="5.23.4";function yr(e){return e>=0&&e<=255}function vi(e,g){const{r:l,g:t,b:I,a:i}=new AC(e).toRgb();if(i<1)return e;const{r:a,g:r,b:s}=new AC(g).toRgb();for(let d=.01;d<=1;d+=.01){const J=Math.round((l-a*(1-d))/d),Z=Math.round((t-r*(1-d))/d),b=Math.round((I-s*(1-d))/d);if(yr(J)&&yr(Z)&&yr(b))return new AC({r:J,g:Z,b,a:Math.round(d*100)/100}).toRgbString()}return new AC({r:l,g:t,b:I,a:1}).toRgbString()}var Up=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};function QZ(e){const{override:g}=e,l=Up(e,["override"]),t=Object.assign({},g);Object.keys(co).forEach(b=>{delete t[b]});const I=Object.assign(Object.assign({},l),t),i=480,a=576,r=768,s=992,d=1200,J=1600;if(I.motion===!1){const b="0s";I.motionDurationFast=b,I.motionDurationMid=b,I.motionDurationSlow=b}return Object.assign(Object.assign(Object.assign({},I),{colorFillContent:I.colorFillSecondary,colorFillContentHover:I.colorFill,colorFillAlter:I.colorFillQuaternary,colorBgContainerDisabled:I.colorFillTertiary,colorBorderBg:I.colorBgContainer,colorSplit:vi(I.colorBorderSecondary,I.colorBgContainer),colorTextPlaceholder:I.colorTextQuaternary,colorTextDisabled:I.colorTextQuaternary,colorTextHeading:I.colorText,colorTextLabel:I.colorTextSecondary,colorTextDescription:I.colorTextTertiary,colorTextLightSolid:I.colorWhite,colorHighlight:I.colorError,colorBgTextHover:I.colorFillSecondary,colorBgTextActive:I.colorFill,colorIcon:I.colorTextTertiary,colorIconHover:I.colorText,colorErrorOutline:vi(I.colorErrorBg,I.colorBgContainer),colorWarningOutline:vi(I.colorWarningBg,I.colorBgContainer),fontSizeIcon:I.fontSizeSM,lineWidthFocus:I.lineWidth*3,lineWidth:I.lineWidth,controlOutlineWidth:I.lineWidth*2,controlInteractiveSize:I.controlHeight/2,controlItemBgHover:I.colorFillTertiary,controlItemBgActive:I.colorPrimaryBg,controlItemBgActiveHover:I.colorPrimaryBgHover,controlItemBgActiveDisabled:I.colorFill,controlTmpOutline:I.colorFillQuaternary,controlOutline:vi(I.colorPrimaryBg,I.colorBgContainer),lineType:I.lineType,borderRadius:I.borderRadius,borderRadiusXS:I.borderRadiusXS,borderRadiusSM:I.borderRadiusSM,borderRadiusLG:I.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:"none",linkHoverDecoration:"none",linkFocusDecoration:"none",controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:I.sizeXXS,paddingXS:I.sizeXS,paddingSM:I.sizeSM,padding:I.size,paddingMD:I.sizeMD,paddingLG:I.sizeLG,paddingXL:I.sizeXL,paddingContentHorizontalLG:I.sizeLG,paddingContentVerticalLG:I.sizeMS,paddingContentHorizontal:I.sizeMS,paddingContentVertical:I.sizeSM,paddingContentHorizontalSM:I.size,paddingContentVerticalSM:I.sizeXS,marginXXS:I.sizeXXS,marginXS:I.sizeXS,marginSM:I.sizeSM,margin:I.size,marginMD:I.sizeMD,marginLG:I.sizeLG,marginXL:I.sizeXL,marginXXL:I.sizeXXL,boxShadow:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowSecondary:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTertiary:`
      0 1px 2px 0 rgba(0, 0, 0, 0.03),
      0 1px 6px -1px rgba(0, 0, 0, 0.02),
      0 2px 4px 0 rgba(0, 0, 0, 0.02)
    `,screenXS:i,screenXSMin:i,screenXSMax:a-1,screenSM:a,screenSMMin:a,screenSMMax:r-1,screenMD:r,screenMDMin:r,screenMDMax:s-1,screenLG:s,screenLGMin:s,screenLGMax:d-1,screenXL:d,screenXLMin:d,screenXLMax:J-1,screenXXL:J,screenXXLMin:J,boxShadowPopoverArrow:"2px 2px 5px rgba(0, 0, 0, 0.05)",boxShadowCard:`
      0 1px 2px -2px ${new AC("rgba(0, 0, 0, 0.16)").toRgbString()},
      0 3px 6px 0 ${new AC("rgba(0, 0, 0, 0.12)").toRgbString()},
      0 5px 12px 4px ${new AC("rgba(0, 0, 0, 0.09)").toRgbString()}
    `,boxShadowDrawerRight:`
      -6px 0 16px 0 rgba(0, 0, 0, 0.08),
      -3px 0 6px -4px rgba(0, 0, 0, 0.12),
      -9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerLeft:`
      6px 0 16px 0 rgba(0, 0, 0, 0.08),
      3px 0 6px -4px rgba(0, 0, 0, 0.12),
      9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerUp:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerDown:`
      0 -6px 16px 0 rgba(0, 0, 0, 0.08),
      0 -3px 6px -4px rgba(0, 0, 0, 0.12),
      0 -9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTabsOverflowLeft:"inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowRight:"inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowTop:"inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowBottom:"inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)"}),t)}var Gm=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const vZ={lineHeight:!0,lineHeightSM:!0,lineHeightLG:!0,lineHeightHeading1:!0,lineHeightHeading2:!0,lineHeightHeading3:!0,lineHeightHeading4:!0,lineHeightHeading5:!0,opacityLoading:!0,fontWeightStrong:!0,zIndexPopupBase:!0,zIndexBase:!0,opacityImage:!0},Mp={size:!0,sizeSM:!0,sizeLG:!0,sizeMD:!0,sizeXS:!0,sizeXXS:!0,sizeMS:!0,sizeXL:!0,sizeXXL:!0,sizeUnit:!0,sizeStep:!0,motionBase:!0,motionUnit:!0},xp={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0},BZ=(e,g,l)=>{const t=l.getDerivativeToken(e),{override:I}=g,i=Gm(g,["override"]);let a=Object.assign(Object.assign({},t),{override:I});return a=QZ(a),i&&Object.entries(i).forEach(r=>{let[s,d]=r;const{theme:J}=d,Z=Gm(d,["theme"]);let b=Z;J&&(b=BZ(Object.assign(Object.assign({},a),Z),{override:Z},J)),a[s]=b}),a};function vn(){const{token:e,hashed:g,theme:l,override:t,cssVar:I}=de.useContext(VZ),i=`${Lp}-${g||""}`,a=l||WZ,[r,s,d]=kk(a,[co,e],{salt:i,override:t,getComputedToken:BZ,formatToken:QZ,cssVar:I&&{prefix:I.prefix,key:I.key,unitless:vZ,ignore:Mp,preserve:xp}});return[a,d,g?s:"",r,I]}const ls={overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},po=function(e){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return{boxSizing:"border-box",margin:0,padding:0,color:e.colorText,fontSize:e.fontSize,lineHeight:e.lineHeight,listStyle:"none",fontFamily:g?"inherit":e.fontFamily}},SZ=()=>({display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),YZ=()=>({"&::before":{display:"table",content:'""'},"&::after":{display:"table",clear:"both",content:'""'}}),Tp=e=>({a:{color:e.colorLink,textDecoration:e.linkDecoration,backgroundColor:"transparent",outline:"none",cursor:"pointer",transition:`color ${e.motionDurationSlow}`,"-webkit-text-decoration-skip":"objects","&:hover":{color:e.colorLinkHover},"&:active":{color:e.colorLinkActive},"&:active, &:hover":{textDecoration:e.linkHoverDecoration,outline:0},"&:focus":{textDecoration:e.linkFocusDecoration,outline:0},"&[disabled]":{color:e.colorTextDisabled,cursor:"not-allowed"}}}),Dp=(e,g,l,t)=>{const I=`[class^="${g}"], [class*=" ${g}"]`,i=l?`.${l}`:I,a={boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"}};let r={};return t!==!1&&(r={fontFamily:e.fontFamily,fontSize:e.fontSize}),{[i]:Object.assign(Object.assign(Object.assign({},r),a),{[I]:a})}},Ep=(e,g)=>({outline:`${Le(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`,outlineOffset:g??1,transition:"outline-offset 0s, outline 0s"}),FZ=(e,g)=>({"&:focus-visible":Object.assign({},Ep(e,g))}),KZ=e=>({[`.${e}`]:Object.assign(Object.assign({},SZ()),{[`.${e} .${e}-icon`]:{display:"block"}})}),{genStyleHooks:gn,genComponentStyleHook:Op,genSubStyleComponent:Pp}=zp({usePrefix:()=>{const{getPrefixCls:e,iconPrefixCls:g}=u.useContext(zC);return{rootPrefixCls:e(),iconPrefixCls:g}},useToken:()=>{const[e,g,l,t,I]=vn();return{theme:e,realToken:g,hashId:l,token:t,cssVar:I}},useCSP:()=>{const{csp:e}=u.useContext(zC);return e??{}},getResetStyles:(e,g)=>{var l;return[{"&":Tp(e)},KZ((l=g==null?void 0:g.prefix.iconPrefixCls)!==null&&l!==void 0?l:hc)]},getCommonStyle:Dp,getCompUnitless:()=>vZ});function jp(e,g){return lI.reduce((l,t)=>{const I=e[`${t}1`],i=e[`${t}3`],a=e[`${t}6`],r=e[`${t}7`];return Object.assign(Object.assign({},l),g(t,{lightColor:I,lightBorderColor:i,darkColor:a,textColor:r}))},{})}const $p=(e,g)=>{const[l,t]=vn();return AA({token:t,hashId:"",path:["ant-design-icons",e],nonce:()=>g==null?void 0:g.nonce,layer:{name:"antd"}},()=>[KZ(e)])},qp=Object.assign({},sc),{useId:ym}=qp,_p=()=>"",eW=typeof ym>"u"?_p:ym;function CW(e,g,l){var t;Cs();const I=e||{},i=I.inherit===!1||!g?Object.assign(Object.assign({},sA),{hashed:(t=g==null?void 0:g.hashed)!==null&&t!==void 0?t:sA.hashed,cssVar:g==null?void 0:g.cssVar}):g,a=eW();return DA(()=>{var r,s;if(!e)return g;const d=Object.assign({},i.components);Object.keys(e.components||{}).forEach(b=>{d[b]=Object.assign(Object.assign({},d[b]),e.components[b])});const J=`css-var-${a.replace(/:/g,"")}`,Z=((r=I.cssVar)!==null&&r!==void 0?r:i.cssVar)&&Object.assign(Object.assign(Object.assign({prefix:l==null?void 0:l.prefixCls},typeof i.cssVar=="object"?i.cssVar:{}),typeof I.cssVar=="object"?I.cssVar:{}),{key:typeof I.cssVar=="object"&&((s=I.cssVar)===null||s===void 0?void 0:s.key)||J});return Object.assign(Object.assign(Object.assign({},i),I),{token:Object.assign(Object.assign({},i.token),I.token),components:d,cssVar:Z})},[I,i],(r,s)=>r.some((d,J)=>{const Z=s[J];return!lc(d,Z,!0)}))}var gW=["children"],wZ=u.createContext({});function lW(e){var g=e.children,l=wC(e,gW);return u.createElement(wZ.Provider,{value:l},g)}var nW=function(e){wl(l,e);var g=Hl(l);function l(){return DC(this,l),g.apply(this,arguments)}return EC(l,[{key:"render",value:function(){return this.props.children}}]),l}(u.Component);function tW(e){var g=u.useReducer(function(r){return r+1},0),l=oe(g,2),t=l[1],I=u.useRef(e),i=jg(function(){return I.current}),a=jg(function(r){I.current=typeof r=="function"?r(I.current):r,t()});return[i,a]}var kn="none",Bi="appear",Si="enter",Yi="leave",km="none",Wl="prepare",Mt="start",xt="active",ns="end",HZ="prepared";function pm(e,g){var l={};return l[e.toLowerCase()]=g.toLowerCase(),l["Webkit".concat(e)]="webkit".concat(g),l["Moz".concat(e)]="moz".concat(g),l["ms".concat(e)]="MS".concat(g),l["O".concat(e)]="o".concat(g.toLowerCase()),l}function IW(e,g){var l={animationend:pm("Animation","AnimationEnd"),transitionend:pm("Transition","TransitionEnd")};return e&&("AnimationEvent"in g||delete l.animationend.animation,"TransitionEvent"in g||delete l.transitionend.transition),l}var oW=IW(Fg(),typeof window<"u"?window:{}),NZ={};if(Fg()){var iW=document.createElement("div");NZ=iW.style}var Fi={};function zZ(e){if(Fi[e])return Fi[e];var g=oW[e];if(g)for(var l=Object.keys(g),t=l.length,I=0;I<t;I+=1){var i=l[I];if(Object.prototype.hasOwnProperty.call(g,i)&&i in NZ)return Fi[e]=g[i],Fi[e]}return""}var LZ=zZ("animationend"),UZ=zZ("transitionend"),MZ=!!(LZ&&UZ),Wm=LZ||"animationend",Vm=UZ||"transitionend";function fm(e,g){if(!e)return null;if(Qe(e)==="object"){var l=g.replace(/-\w/g,function(t){return t[1].toUpperCase()});return e[l]}return"".concat(e,"-").concat(g)}const cW=function(e){var g=u.useRef();function l(I){I&&(I.removeEventListener(Vm,e),I.removeEventListener(Wm,e))}function t(I){g.current&&g.current!==I&&l(g.current),I&&I!==g.current&&(I.addEventListener(Vm,e),I.addEventListener(Wm,e),g.current=I)}return u.useEffect(function(){return function(){l(g.current)}},[]),[t,l]};var xZ=Fg()?u.useLayoutEffect:u.useEffect;const aW=function(){var e=u.useRef(null);function g(){Rn.cancel(e.current)}function l(t){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;g();var i=Rn(function(){I<=1?t({isCanceled:function(){return i!==e.current}}):l(t,I-1)});e.current=i}return u.useEffect(function(){return function(){g()}},[]),[l,g]};var rW=[Wl,Mt,xt,ns],AW=[Wl,HZ],TZ=!1,sW=!0;function DZ(e){return e===xt||e===ns}const dW=function(e,g,l){var t=Ao(km),I=oe(t,2),i=I[0],a=I[1],r=aW(),s=oe(r,2),d=s[0],J=s[1];function Z(){a(Wl,!0)}var b=g?AW:rW;return xZ(function(){if(i!==km&&i!==ns){var p=b.indexOf(i),y=b[p+1],G=l(i);G===TZ?a(y,!0):y&&d(function(h){function f(){h.isCanceled()||a(y,!0)}G===!0?f():Promise.resolve(G).then(f)})}},[e,i]),u.useEffect(function(){return function(){J()}},[]),[Z,i]};function uW(e,g,l,t){var I=t.motionEnter,i=I===void 0?!0:I,a=t.motionAppear,r=a===void 0?!0:a,s=t.motionLeave,d=s===void 0?!0:s,J=t.motionDeadline,Z=t.motionLeaveImmediately,b=t.onAppearPrepare,p=t.onEnterPrepare,y=t.onLeavePrepare,G=t.onAppearStart,h=t.onEnterStart,f=t.onLeaveStart,W=t.onAppearActive,X=t.onEnterActive,B=t.onLeaveActive,V=t.onAppearEnd,Q=t.onEnterEnd,v=t.onLeaveEnd,Y=t.onVisibleChanged,F=Ao(),L=oe(F,2),M=L[0],ee=L[1],q=tW(kn),P=oe(q,2),le=P[0],N=P[1],w=Ao(null),K=oe(w,2),T=K[0],z=K[1],R=le(),H=u.useRef(!1),E=u.useRef(null);function j(){return l()}var ge=u.useRef(!1);function ne(){N(kn),z(null,!0)}var ie=jg(function(Re){var De=le();if(De!==kn){var fe=j();if(!(Re&&!Re.deadline&&Re.target!==fe)){var _e=ge.current,eC;De===Bi&&_e?eC=V==null?void 0:V(fe,Re):De===Si&&_e?eC=Q==null?void 0:Q(fe,Re):De===Yi&&_e&&(eC=v==null?void 0:v(fe,Re)),_e&&eC!==!1&&ne()}}}),Ae=cW(ie),ae=oe(Ae,1),se=ae[0],ze=function(De){switch(De){case Bi:return D(D(D({},Wl,b),Mt,G),xt,W);case Si:return D(D(D({},Wl,p),Mt,h),xt,X);case Yi:return D(D(D({},Wl,y),Mt,f),xt,B);default:return{}}},We=u.useMemo(function(){return ze(R)},[R]),Je=dW(R,!e,function(Re){if(Re===Wl){var De=We[Wl];return De?De(j()):TZ}if(Se in We){var fe;z(((fe=We[Se])===null||fe===void 0?void 0:fe.call(We,j(),null))||null)}return Se===xt&&R!==kn&&(se(j()),J>0&&(clearTimeout(E.current),E.current=setTimeout(function(){ie({deadline:!0})},J))),Se===HZ&&ne(),sW}),ue=oe(Je,2),he=ue[0],Se=ue[1],Ke=DZ(Se);ge.current=Ke;var Ye=u.useRef(null);xZ(function(){if(!(H.current&&Ye.current===g)){ee(g);var Re=H.current;H.current=!0;var De;!Re&&g&&r&&(De=Bi),Re&&g&&i&&(De=Si),(Re&&!g&&d||!Re&&Z&&!g&&d)&&(De=Yi);var fe=ze(De);De&&(e||fe[Wl])?(N(De),he()):N(kn),Ye.current=g}},[g]),u.useEffect(function(){(R===Bi&&!r||R===Si&&!i||R===Yi&&!d)&&N(kn)},[r,i,d]),u.useEffect(function(){return function(){H.current=!1,clearTimeout(E.current)}},[]);var Ue=u.useRef(!1);u.useEffect(function(){M&&(Ue.current=!0),M!==void 0&&R===kn&&((Ue.current||M)&&(Y==null||Y(M)),Ue.current=!0)},[M,R]);var Me=T;return We[Wl]&&Se===Mt&&(Me=O({transition:"none"},Me)),[R,Se,Me,M??g]}function mW(e){var g=e;Qe(e)==="object"&&(g=e.transitionSupport);function l(I,i){return!!(I.motionName&&g&&i!==!1)}var t=u.forwardRef(function(I,i){var a=I.visible,r=a===void 0?!0:a,s=I.removeOnLeave,d=s===void 0?!0:s,J=I.forceRender,Z=I.children,b=I.motionName,p=I.leavedClassName,y=I.eventProps,G=u.useContext(wZ),h=G.motion,f=l(I,h),W=u.useRef(),X=u.useRef();function B(){try{return W.current instanceof HTMLElement?W.current:Ui(X.current)}catch{return null}}var V=uW(f,r,B,I),Q=oe(V,4),v=Q[0],Y=Q[1],F=Q[2],L=Q[3],M=u.useRef(L);L&&(M.current=!0);var ee=u.useCallback(function(K){W.current=K,EA(i,K)},[i]),q,P=O(O({},y),{},{visible:r});if(!Z)q=null;else if(v===kn)L?q=Z(O({},P),ee):!d&&M.current&&p?q=Z(O(O({},P),{},{className:p}),ee):J||!d&&!p?q=Z(O(O({},P),{},{style:{display:"none"}}),ee):q=null;else{var le;Y===Wl?le="prepare":DZ(Y)?le="active":Y===Mt&&(le="start");var N=fm(b,"".concat(v,"-").concat(le));q=Z(O(O({},P),{},{className:me(fm(b,v),D(D({},N,N&&le),b,typeof b=="string")),style:F}),ee)}if(u.isValidElement(q)&&yo(q)){var w=mc(q);w||(q=u.cloneElement(q,{ref:ee}))}return u.createElement(nW,{ref:X},q)});return t.displayName="CSSMotion",t}const Nl=mW(MZ);var uA="add",mA="keep",JA="remove",kr="removed";function JW(e){var g;return e&&Qe(e)==="object"&&"key"in e?g=e:g={key:e},O(O({},g),{},{key:String(g.key)})}function ZA(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return e.map(JW)}function ZW(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=[],t=0,I=g.length,i=ZA(e),a=ZA(g);i.forEach(function(d){for(var J=!1,Z=t;Z<I;Z+=1){var b=a[Z];if(b.key===d.key){t<Z&&(l=l.concat(a.slice(t,Z).map(function(p){return O(O({},p),{},{status:uA})})),t=Z),l.push(O(O({},b),{},{status:mA})),t+=1,J=!0;break}}J||l.push(O(O({},d),{},{status:JA}))}),t<I&&(l=l.concat(a.slice(t).map(function(d){return O(O({},d),{},{status:uA})})));var r={};l.forEach(function(d){var J=d.key;r[J]=(r[J]||0)+1});var s=Object.keys(r).filter(function(d){return r[d]>1});return s.forEach(function(d){l=l.filter(function(J){var Z=J.key,b=J.status;return Z!==d||b!==JA}),l.forEach(function(J){J.key===d&&(J.status=mA)})}),l}var bW=["component","children","onVisibleChanged","onAllRemoved"],hW=["status"],GW=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];function yW(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nl,l=function(t){wl(i,t);var I=Hl(i);function i(){var a;DC(this,i);for(var r=arguments.length,s=new Array(r),d=0;d<r;d++)s[d]=arguments[d];return a=I.call.apply(I,[this].concat(s)),D(Ne(a),"state",{keyEntities:[]}),D(Ne(a),"removeKey",function(J){a.setState(function(Z){var b=Z.keyEntities.map(function(p){return p.key!==J?p:O(O({},p),{},{status:kr})});return{keyEntities:b}},function(){var Z=a.state.keyEntities,b=Z.filter(function(p){var y=p.status;return y!==kr}).length;b===0&&a.props.onAllRemoved&&a.props.onAllRemoved()})}),a}return EC(i,[{key:"render",value:function(){var r=this,s=this.state.keyEntities,d=this.props,J=d.component,Z=d.children,b=d.onVisibleChanged;d.onAllRemoved;var p=wC(d,bW),y=J||u.Fragment,G={};return GW.forEach(function(h){G[h]=p[h],delete p[h]}),delete p.keys,u.createElement(y,p,s.map(function(h,f){var W=h.status,X=wC(h,hW),B=W===uA||W===mA;return u.createElement(g,Be({},G,{key:X.key,visible:B,eventProps:X,onVisibleChanged:function(Q){b==null||b(Q,{key:X.key}),Q||r.removeKey(X.key)}}),function(V,Q){return Z(O(O({},V),{},{index:f}),Q)})}))}}],[{key:"getDerivedStateFromProps",value:function(r,s){var d=r.keys,J=s.keyEntities,Z=ZA(d),b=ZW(J,Z);return{keyEntities:b.filter(function(p){var y=J.find(function(G){var h=G.key;return p.key===h});return!(y&&y.status===kr&&p.status===JA)})}}}]),i}(u.Component);return D(l,"defaultProps",{component:"div"}),l}const EZ=yW(MZ);function kW(e){const{children:g}=e,[,l]=vn(),{motion:t}=l,I=u.useRef(!1);return I.current=I.current||t===!1,I.current?u.createElement(lW,{motion:t},g):g}const pW=()=>null;var WW=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const VW=["getTargetContainer","getPopupContainer","renderEmpty","input","pagination","form","select","button"];let tc,OZ,PZ,jZ;function ji(){return tc||ao}function fW(){return OZ||hc}function XW(e){return Object.keys(e).some(g=>g.endsWith("Color"))}const RW=e=>{const{prefixCls:g,iconPrefixCls:l,theme:t,holderRender:I}=e;g!==void 0&&(tc=g),l!==void 0&&(OZ=l),"holderRender"in e&&(jZ=I),t&&(XW(t)?Wp(ji(),t):PZ=t)},QW=()=>({getPrefixCls:(e,g)=>g||(e?`${ji()}-${e}`:ji()),getIconPrefixCls:fW,getRootPrefixCls:()=>tc||ji(),getTheme:()=>PZ,holderRender:jZ}),vW=e=>{const{children:g,csp:l,autoInsertSpaceInButton:t,alert:I,anchor:i,form:a,locale:r,componentSize:s,direction:d,space:J,splitter:Z,virtual:b,dropdownMatchSelectWidth:p,popupMatchSelectWidth:y,popupOverflow:G,legacyLocale:h,parentContext:f,iconPrefixCls:W,theme:X,componentDisabled:B,segmented:V,statistic:Q,spin:v,calendar:Y,carousel:F,cascader:L,collapse:M,typography:ee,checkbox:q,descriptions:P,divider:le,drawer:N,skeleton:w,steps:K,image:T,layout:z,list:R,mentions:H,modal:E,progress:j,result:ge,slider:ne,breadcrumb:ie,menu:Ae,pagination:ae,input:se,textArea:ze,empty:We,badge:Je,radio:ue,rate:he,switch:Se,transfer:Ke,avatar:Ye,message:Ue,tag:Me,table:Re,card:De,tabs:fe,timeline:_e,timePicker:eC,upload:IC,notification:pC,tree:cC,colorPicker:hC,datePicker:WC,rangePicker:Pe,flex:lC,wave:Te,dropdown:Ze,warning:Ee,tour:je,tooltip:ve,popover:Oe,popconfirm:$e,floatButtonGroup:ZC,variant:XC,inputNumber:LC,treeSelect:ig}=e,OC=u.useCallback((oC,GC)=>{const{prefixCls:cg}=e;if(GC)return GC;const _C=cg||f.getPrefixCls("");return oC?`${_C}-${oC}`:_C},[f.getPrefixCls,e.prefixCls]),Kg=W||f.iconPrefixCls||hc,SC=l||f.csp;$p(Kg,SC);const mg=CW(X,f.theme,{prefixCls:OC("")}),nC={csp:SC,autoInsertSpaceInButton:t,alert:I,anchor:i,locale:r||h,direction:d,space:J,splitter:Z,virtual:b,popupMatchSelectWidth:y??p,popupOverflow:G,getPrefixCls:OC,iconPrefixCls:Kg,theme:mg,segmented:V,statistic:Q,spin:v,calendar:Y,carousel:F,cascader:L,collapse:M,typography:ee,checkbox:q,descriptions:P,divider:le,drawer:N,skeleton:w,steps:K,image:T,input:se,textArea:ze,layout:z,list:R,mentions:H,modal:E,progress:j,result:ge,slider:ne,breadcrumb:ie,menu:Ae,pagination:ae,empty:We,badge:Je,radio:ue,rate:he,switch:Se,transfer:Ke,avatar:Ye,message:Ue,tag:Me,table:Re,card:De,tabs:fe,timeline:_e,timePicker:eC,upload:IC,notification:pC,tree:cC,colorPicker:hC,datePicker:WC,rangePicker:Pe,flex:lC,wave:Te,dropdown:Ze,warning:Ee,tour:je,tooltip:ve,popover:Oe,popconfirm:$e,floatButtonGroup:ZC,variant:XC,inputNumber:LC,treeSelect:ig},gC=Object.assign({},f);Object.keys(nC).forEach(oC=>{nC[oC]!==void 0&&(gC[oC]=nC[oC])}),VW.forEach(oC=>{const GC=e[oC];GC&&(gC[oC]=GC)}),typeof t<"u"&&(gC.button=Object.assign({autoInsertSpace:t},gC.button));const RC=DA(()=>gC,gC,(oC,GC)=>{const cg=Object.keys(oC),_C=Object.keys(GC);return cg.length!==_C.length||cg.some(Ng=>oC[Ng]!==GC[Ng])}),{layer:Wg}=u.useContext(ko),wg=u.useMemo(()=>({prefixCls:Kg,csp:SC,layer:Wg?"antd":void 0}),[Kg,SC,Wg]);let aC=u.createElement(u.Fragment,null,u.createElement(pW,{dropdownMatchSelectWidth:p}),g);const Hg=u.useMemo(()=>{var oC,GC,cg,_C;return Ut(((oC=Cn.Form)===null||oC===void 0?void 0:oC.defaultValidateMessages)||{},((cg=(GC=RC.locale)===null||GC===void 0?void 0:GC.Form)===null||cg===void 0?void 0:cg.defaultValidateMessages)||{},((_C=RC.form)===null||_C===void 0?void 0:_C.validateMessages)||{},(a==null?void 0:a.validateMessages)||{})},[RC,a==null?void 0:a.validateMessages]);Object.keys(Hg).length>0&&(aC=u.createElement(np.Provider,{value:Hg},aC)),r&&(aC=u.createElement(rp,{locale:r,_ANT_MARK__:ap},aC)),aC=u.createElement(UA.Provider,{value:wg},aC),s&&(aC=u.createElement(fp,{size:s},aC)),aC=u.createElement(kW,null,aC);const _g=u.useMemo(()=>{const oC=mg||{},{algorithm:GC,token:cg,components:_C,cssVar:Ng}=oC,Jg=WW(oC,["algorithm","token","components","cssVar"]),zg=GC&&(!Array.isArray(GC)||GC.length>0)?iA(GC):WZ,Vg={};Object.entries(_C||{}).forEach(dl=>{let[el,zl]=dl;const sC=Object.assign({},zl);"algorithm"in sC&&(sC.algorithm===!0?sC.theme=zg:(Array.isArray(sC.algorithm)||typeof sC.algorithm=="function")&&(sC.theme=iA(sC.algorithm)),delete sC.algorithm),Vg[el]=sC});const fg=Object.assign(Object.assign({},co),cg);return Object.assign(Object.assign({},Jg),{theme:zg,token:fg,components:Vg,override:Object.assign({override:fg},Vg),cssVar:Ng})},[mg]);return X&&(aC=u.createElement(VZ.Provider,{value:_g},aC)),RC.warning&&(aC=u.createElement(lp.Provider,{value:RC.warning},aC)),B!==void 0&&(aC=u.createElement(Vp,{disabled:B},aC)),u.createElement(zC.Provider,{value:RC},aC)},iI=e=>{const g=u.useContext(zC),l=u.useContext(gs);return u.createElement(vW,Object.assign({parentContext:g,legacyLocale:l},e))};iI.ConfigContext=zC;iI.SizeContext=gI;iI.config=RW;iI.useConfig=Xp;Object.defineProperty(iI,"SizeContext",{get:()=>gI});var BW=`accept acceptCharset accessKey action allowFullScreen allowTransparency
    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge
    charSet checked classID className colSpan cols content contentEditable contextMenu
    controls coords crossOrigin data dateTime default defer dir disabled download draggable
    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder
    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity
    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media
    mediaGroup method min minLength multiple muted name noValidate nonce open
    optimum pattern placeholder poster preload radioGroup readOnly rel required
    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected
    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style
    summary tabIndex target title type useMap value width wmode wrap`,SW=`onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown
    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick
    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown
    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel
    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough
    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata
    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError`,YW="".concat(BW," ").concat(SW).split(/[\s\n]+/),FW="aria-",KW="data-";function Xm(e,g){return e.indexOf(g)===0}function Gc(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,l;g===!1?l={aria:!0,data:!0,attr:!0}:g===!0?l={aria:!0}:l=O({},g);var t={};return Object.keys(e).forEach(function(I){(l.aria&&(I==="role"||Xm(I,FW))||l.data&&Xm(I,KW)||l.attr&&YW.includes(I))&&(t[I]=e[I])}),t}function $Z(e){return e&&de.isValidElement(e)&&e.type===de.Fragment}const wW=(e,g,l)=>de.isValidElement(e)?de.cloneElement(e,typeof l=="function"?l(e.props||{}):l):g;function uo(e,g){return wW(e,e,g)}const yc=e=>{const[,,,,g]=vn();return g?`${e}-css-var`:""};var nI={TAB:9,ENTER:13,ESC:27,LEFT:37,RIGHT:39},qZ=u.forwardRef(function(e,g){var l=e.prefixCls,t=e.style,I=e.className,i=e.duration,a=i===void 0?4.5:i,r=e.showProgress,s=e.pauseOnHover,d=s===void 0?!0:s,J=e.eventKey,Z=e.content,b=e.closable,p=e.closeIcon,y=p===void 0?"x":p,G=e.props,h=e.onClick,f=e.onNoticeClose,W=e.times,X=e.hovering,B=u.useState(!1),V=oe(B,2),Q=V[0],v=V[1],Y=u.useState(0),F=oe(Y,2),L=F[0],M=F[1],ee=u.useState(0),q=oe(ee,2),P=q[0],le=q[1],N=X||Q,w=a>0&&r,K=function(){f(J)},T=function(ge){(ge.key==="Enter"||ge.code==="Enter"||ge.keyCode===nI.ENTER)&&K()};u.useEffect(function(){if(!N&&a>0){var j=Date.now()-P,ge=setTimeout(function(){K()},a*1e3-P);return function(){d&&clearTimeout(ge),le(Date.now()-j)}}},[a,N,W]),u.useEffect(function(){if(!N&&w&&(d||P===0)){var j=performance.now(),ge,ne=function ie(){cancelAnimationFrame(ge),ge=requestAnimationFrame(function(Ae){var ae=Ae+P-j,se=Math.min(ae/(a*1e3),1);M(se*100),se<1&&ie()})};return ne(),function(){d&&cancelAnimationFrame(ge)}}},[a,P,N,w,W]);var z=u.useMemo(function(){return Qe(b)==="object"&&b!==null?b:b?{closeIcon:y}:{}},[b,y]),R=Gc(z,!0),H=100-(!L||L<0?0:L>100?100:L),E="".concat(l,"-notice");return u.createElement("div",Be({},G,{ref:g,className:me(E,I,D({},"".concat(E,"-closable"),b)),style:t,onMouseEnter:function(ge){var ne;v(!0),G==null||(ne=G.onMouseEnter)===null||ne===void 0||ne.call(G,ge)},onMouseLeave:function(ge){var ne;v(!1),G==null||(ne=G.onMouseLeave)===null||ne===void 0||ne.call(G,ge)},onClick:h}),u.createElement("div",{className:"".concat(E,"-content")},Z),b&&u.createElement("a",Be({tabIndex:0,className:"".concat(E,"-close"),onKeyDown:T,"aria-label":"Close"},R,{onClick:function(ge){ge.preventDefault(),ge.stopPropagation(),K()}}),z.closeIcon),w&&u.createElement("progress",{className:"".concat(E,"-progress"),max:"100",value:H},H+"%"))}),_Z=de.createContext({}),HW=function(g){var l=g.children,t=g.classNames;return de.createElement(_Z.Provider,{value:{classNames:t}},l)},Rm=8,Qm=3,vm=16,NW=function(g){var l={offset:Rm,threshold:Qm,gap:vm};if(g&&Qe(g)==="object"){var t,I,i;l.offset=(t=g.offset)!==null&&t!==void 0?t:Rm,l.threshold=(I=g.threshold)!==null&&I!==void 0?I:Qm,l.gap=(i=g.gap)!==null&&i!==void 0?i:vm}return[!!g,l]},zW=["className","style","classNames","styles"],LW=function(g){var l=g.configList,t=g.placement,I=g.prefixCls,i=g.className,a=g.style,r=g.motion,s=g.onAllNoticeRemoved,d=g.onNoticeClose,J=g.stack,Z=u.useContext(_Z),b=Z.classNames,p=u.useRef({}),y=u.useState(null),G=oe(y,2),h=G[0],f=G[1],W=u.useState([]),X=oe(W,2),B=X[0],V=X[1],Q=l.map(function(N){return{config:N,key:String(N.key)}}),v=NW(J),Y=oe(v,2),F=Y[0],L=Y[1],M=L.offset,ee=L.threshold,q=L.gap,P=F&&(B.length>0||Q.length<=ee),le=typeof r=="function"?r(t):r;return u.useEffect(function(){F&&B.length>1&&V(function(N){return N.filter(function(w){return Q.some(function(K){var T=K.key;return w===T})})})},[B,Q,F]),u.useEffect(function(){var N;if(F&&p.current[(N=Q[Q.length-1])===null||N===void 0?void 0:N.key]){var w;f(p.current[(w=Q[Q.length-1])===null||w===void 0?void 0:w.key])}},[Q,F]),de.createElement(EZ,Be({key:t,className:me(I,"".concat(I,"-").concat(t),b==null?void 0:b.list,i,D(D({},"".concat(I,"-stack"),!!F),"".concat(I,"-stack-expanded"),P)),style:a,keys:Q,motionAppear:!0},le,{onAllRemoved:function(){s(t)}}),function(N,w){var K=N.config,T=N.className,z=N.style,R=N.index,H=K,E=H.key,j=H.times,ge=String(E),ne=K,ie=ne.className,Ae=ne.style,ae=ne.classNames,se=ne.styles,ze=wC(ne,zW),We=Q.findIndex(function(_e){return _e.key===ge}),Je={};if(F){var ue=Q.length-1-(We>-1?We:R-1),he=t==="top"||t==="bottom"?"-50%":"0";if(ue>0){var Se,Ke,Ye;Je.height=P?(Se=p.current[ge])===null||Se===void 0?void 0:Se.offsetHeight:h==null?void 0:h.offsetHeight;for(var Ue=0,Me=0;Me<ue;Me++){var Re;Ue+=((Re=p.current[Q[Q.length-1-Me].key])===null||Re===void 0?void 0:Re.offsetHeight)+q}var De=(P?Ue:ue*M)*(t.startsWith("top")?1:-1),fe=!P&&h!==null&&h!==void 0&&h.offsetWidth&&(Ke=p.current[ge])!==null&&Ke!==void 0&&Ke.offsetWidth?((h==null?void 0:h.offsetWidth)-M*2*(ue<3?ue:3))/((Ye=p.current[ge])===null||Ye===void 0?void 0:Ye.offsetWidth):1;Je.transform="translate3d(".concat(he,", ").concat(De,"px, 0) scaleX(").concat(fe,")")}else Je.transform="translate3d(".concat(he,", 0, 0)")}return de.createElement("div",{ref:w,className:me("".concat(I,"-notice-wrapper"),T,ae==null?void 0:ae.wrapper),style:O(O(O({},z),Je),se==null?void 0:se.wrapper),onMouseEnter:function(){return V(function(eC){return eC.includes(ge)?eC:[].concat(ye(eC),[ge])})},onMouseLeave:function(){return V(function(eC){return eC.filter(function(IC){return IC!==ge})})}},de.createElement(qZ,Be({},ze,{ref:function(eC){We>-1?p.current[ge]=eC:delete p.current[ge]},prefixCls:I,classNames:ae,styles:se,className:me(ie,b==null?void 0:b.notice),style:Ae,times:j,key:E,eventKey:E,onNoticeClose:d,hovering:F&&B.length>0})))})},UW=u.forwardRef(function(e,g){var l=e.prefixCls,t=l===void 0?"rc-notification":l,I=e.container,i=e.motion,a=e.maxCount,r=e.className,s=e.style,d=e.onAllRemoved,J=e.stack,Z=e.renderNotifications,b=u.useState([]),p=oe(b,2),y=p[0],G=p[1],h=function(F){var L,M=y.find(function(ee){return ee.key===F});M==null||(L=M.onClose)===null||L===void 0||L.call(M),G(function(ee){return ee.filter(function(q){return q.key!==F})})};u.useImperativeHandle(g,function(){return{open:function(F){G(function(L){var M=ye(L),ee=M.findIndex(function(le){return le.key===F.key}),q=O({},F);if(ee>=0){var P;q.times=(((P=L[ee])===null||P===void 0?void 0:P.times)||0)+1,M[ee]=q}else q.times=0,M.push(q);return a>0&&M.length>a&&(M=M.slice(-a)),M})},close:function(F){h(F)},destroy:function(){G([])}}});var f=u.useState({}),W=oe(f,2),X=W[0],B=W[1];u.useEffect(function(){var Y={};y.forEach(function(F){var L=F.placement,M=L===void 0?"topRight":L;M&&(Y[M]=Y[M]||[],Y[M].push(F))}),Object.keys(X).forEach(function(F){Y[F]=Y[F]||[]}),B(Y)},[y]);var V=function(F){B(function(L){var M=O({},L),ee=M[F]||[];return ee.length||delete M[F],M})},Q=u.useRef(!1);if(u.useEffect(function(){Object.keys(X).length>0?Q.current=!0:Q.current&&(d==null||d(),Q.current=!1)},[X]),!I)return null;var v=Object.keys(X);return $t.createPortal(u.createElement(u.Fragment,null,v.map(function(Y){var F=X[Y],L=u.createElement(LW,{key:Y,configList:F,placement:Y,prefixCls:t,className:r==null?void 0:r(Y),style:s==null?void 0:s(Y),motion:i,onNoticeClose:h,onAllNoticeRemoved:V,stack:J});return Z?Z(L,{prefixCls:t,key:Y}):L})),I)}),MW=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],xW=function(){return document.body},Bm=0;function TW(){for(var e={},g=arguments.length,l=new Array(g),t=0;t<g;t++)l[t]=arguments[t];return l.forEach(function(I){I&&Object.keys(I).forEach(function(i){var a=I[i];a!==void 0&&(e[i]=a)})}),e}function DW(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=e.getContainer,l=g===void 0?xW:g,t=e.motion,I=e.prefixCls,i=e.maxCount,a=e.className,r=e.style,s=e.onAllRemoved,d=e.stack,J=e.renderNotifications,Z=wC(e,MW),b=u.useState(),p=oe(b,2),y=p[0],G=p[1],h=u.useRef(),f=u.createElement(UW,{container:y,ref:h,prefixCls:I,motion:t,maxCount:i,className:a,style:r,onAllRemoved:s,stack:d,renderNotifications:J}),W=u.useState([]),X=oe(W,2),B=X[0],V=X[1],Q=u.useMemo(function(){return{open:function(Y){var F=TW(Z,Y);(F.key===null||F.key===void 0)&&(F.key="rc-notification-".concat(Bm),Bm+=1),V(function(L){return[].concat(ye(L),[{type:"open",config:F}])})},close:function(Y){V(function(F){return[].concat(ye(F),[{type:"close",key:Y}])})},destroy:function(){V(function(Y){return[].concat(ye(Y),[{type:"destroy"}])})}}},[]);return u.useEffect(function(){G(l())}),u.useEffect(function(){if(h.current&&B.length){B.forEach(function(F){switch(F.type){case"open":h.current.open(F.config);break;case"close":h.current.close(F.key);break;case"destroy":h.current.destroy();break}});var v,Y;V(function(F){return(v!==F||!Y)&&(v=F,Y=F.filter(function(L){return!B.includes(L)})),Y})}},[B]),[Q,f]}const e0=de.createContext(void 0),pn=100,EW=10,OW=pn*EW,C0={Modal:pn,Drawer:pn,Popover:pn,Popconfirm:pn,Tooltip:pn,Tour:pn,FloatButton:pn},PW={SelectLike:50,Dropdown:50,DatePicker:50,Menu:50,ImagePreview:1};function jW(e){return e in C0}const ts=(e,g)=>{const[,l]=vn(),t=de.useContext(e0),I=jW(e);let i;if(g!==void 0)i=[g,g];else{let a=t??0;I?a+=(t?0:l.zIndexPopupBase)+C0[e]:a+=PW[e],i=[t===void 0?g:a,a]}return i},$W=e=>{const{componentCls:g,iconCls:l,boxShadow:t,colorText:I,colorSuccess:i,colorError:a,colorWarning:r,colorInfo:s,fontSizeLG:d,motionEaseInOutCirc:J,motionDurationSlow:Z,marginXS:b,paddingXS:p,borderRadiusLG:y,zIndexPopup:G,contentPadding:h,contentBg:f}=e,W=`${g}-notice`,X=new $C("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:p,transform:"translateY(0)",opacity:1}}),B=new $C("MessageMoveOut",{"0%":{maxHeight:e.height,padding:p,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),V={padding:p,textAlign:"center",[`${g}-custom-content`]:{display:"flex",alignItems:"center"},[`${g}-custom-content > ${l}`]:{marginInlineEnd:b,fontSize:d},[`${W}-content`]:{display:"inline-block",padding:h,background:f,borderRadius:y,boxShadow:t,pointerEvents:"all"},[`${g}-success > ${l}`]:{color:i},[`${g}-error > ${l}`]:{color:a},[`${g}-warning > ${l}`]:{color:r},[`${g}-info > ${l},
      ${g}-loading > ${l}`]:{color:s}};return[{[g]:Object.assign(Object.assign({},po(e)),{color:I,position:"fixed",top:b,width:"100%",pointerEvents:"none",zIndex:G,[`${g}-move-up`]:{animationFillMode:"forwards"},[`
        ${g}-move-up-appear,
        ${g}-move-up-enter
      `]:{animationName:X,animationDuration:Z,animationPlayState:"paused",animationTimingFunction:J},[`
        ${g}-move-up-appear${g}-move-up-appear-active,
        ${g}-move-up-enter${g}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${g}-move-up-leave`]:{animationName:B,animationDuration:Z,animationPlayState:"paused",animationTimingFunction:J},[`${g}-move-up-leave${g}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[g]:{[`${W}-wrapper`]:Object.assign({},V)}},{[`${g}-notice-pure-panel`]:Object.assign(Object.assign({},V),{padding:0,textAlign:"start"})}]},qW=e=>({zIndexPopup:e.zIndexPopupBase+OW+10,contentBg:e.colorBgElevated,contentPadding:`${(e.controlHeightLG-e.fontSize*e.lineHeight)/2}px ${e.paddingSM}px`}),g0=gn("Message",e=>{const g=pg(e,{height:150});return[$W(g)]},qW);var _W=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const eV={info:u.createElement(UG,null),success:u.createElement(DJ,null),error:u.createElement(EJ,null),warning:u.createElement(vG,null),loading:u.createElement(_i,null)},l0=e=>{let{prefixCls:g,type:l,icon:t,children:I}=e;return u.createElement("div",{className:me(`${g}-custom-content`,`${g}-${l}`)},t||eV[l],u.createElement("span",null,I))},CV=e=>{const{prefixCls:g,className:l,type:t,icon:I,content:i}=e,a=_W(e,["prefixCls","className","type","icon","content"]),{getPrefixCls:r}=u.useContext(zC),s=g||r("message"),d=yc(s),[J,Z,b]=g0(s,d);return J(u.createElement(qZ,Object.assign({},a,{prefixCls:s,className:me(l,Z,`${s}-notice-pure-panel`,b,d),eventKey:"pure",duration:null,content:u.createElement(l0,{prefixCls:s,type:t,icon:I},i)})))};function gV(e,g){return{motionName:g??`${e}-move-up`}}function Is(e){let g;const l=new Promise(I=>{g=e(()=>{I(!0)})}),t=()=>{g==null||g()};return t.then=(I,i)=>l.then(I,i),t.promise=l,t}var lV=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const nV=8,tV=3,IV=e=>{let{children:g,prefixCls:l}=e;const t=yc(l),[I,i,a]=g0(l,t);return I(u.createElement(HW,{classNames:{list:me(i,a,t)}},g))},oV=(e,g)=>{let{prefixCls:l,key:t}=g;return u.createElement(IV,{prefixCls:l,key:t},e)},iV=u.forwardRef((e,g)=>{const{top:l,prefixCls:t,getContainer:I,maxCount:i,duration:a=tV,rtl:r,transitionName:s,onAllRemoved:d}=e,{getPrefixCls:J,getPopupContainer:Z,message:b,direction:p}=u.useContext(zC),y=t||J("message"),G=()=>({left:"50%",transform:"translateX(-50%)",top:l??nV}),h=()=>me({[`${y}-rtl`]:r??p==="rtl"}),f=()=>gV(y,s),W=u.createElement("span",{className:`${y}-close-x`},u.createElement(TA,{className:`${y}-close-icon`})),[X,B]=DW({prefixCls:y,style:G,className:h,motion:f,closable:!1,closeIcon:W,duration:a,getContainer:()=>(I==null?void 0:I())||(Z==null?void 0:Z())||document.body,maxCount:i,onAllRemoved:d,renderNotifications:oV});return u.useImperativeHandle(g,()=>Object.assign(Object.assign({},X),{prefixCls:y,message:b})),B});let Sm=0;function n0(e){const g=u.useRef(null);return Cs(),[u.useMemo(()=>{const t=s=>{var d;(d=g.current)===null||d===void 0||d.close(s)},I=s=>{if(!g.current){const Q=()=>{};return Q.then=()=>{},Q}const{open:d,prefixCls:J,message:Z}=g.current,b=`${J}-notice`,{content:p,icon:y,type:G,key:h,className:f,style:W,onClose:X}=s,B=lV(s,["content","icon","type","key","className","style","onClose"]);let V=h;return V==null&&(Sm+=1,V=`antd-message-${Sm}`),Is(Q=>(d(Object.assign(Object.assign({},B),{key:V,content:u.createElement(l0,{prefixCls:J,type:G,icon:y},p),placement:"top",className:me(G&&`${b}-${G}`,f,Z==null?void 0:Z.className),style:Object.assign(Object.assign({},Z==null?void 0:Z.style),W),onClose:()=>{X==null||X(),Q()}})),()=>{t(V)}))},a={open:I,destroy:s=>{var d;s!==void 0?t(s):(d=g.current)===null||d===void 0||d.destroy()}};return["info","success","warning","error","loading"].forEach(s=>{const d=(J,Z,b)=>{let p;J&&typeof J=="object"&&"content"in J?p=J:p={content:J};let y,G;typeof Z=="function"?G=Z:(y=Z,G=b);const h=Object.assign(Object.assign({onClose:G,duration:y},p),{type:s});return I(h)};a[s]=d}),a},[]),u.createElement(iV,Object.assign({key:"message-holder"},e,{ref:g}))]}function cV(e){return n0(e)}function bC(){bC=function(){return g};var e,g={},l=Object.prototype,t=l.hasOwnProperty,I=Object.defineProperty||function(N,w,K){N[w]=K.value},i=typeof Symbol=="function"?Symbol:{},a=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function d(N,w,K){return Object.defineProperty(N,w,{value:K,enumerable:!0,configurable:!0,writable:!0}),N[w]}try{d({},"")}catch{d=function(K,T,z){return K[T]=z}}function J(N,w,K,T){var z=w&&w.prototype instanceof f?w:f,R=Object.create(z.prototype),H=new P(T||[]);return I(R,"_invoke",{value:L(N,K,H)}),R}function Z(N,w,K){try{return{type:"normal",arg:N.call(w,K)}}catch(T){return{type:"throw",arg:T}}}g.wrap=J;var b="suspendedStart",p="suspendedYield",y="executing",G="completed",h={};function f(){}function W(){}function X(){}var B={};d(B,a,function(){return this});var V=Object.getPrototypeOf,Q=V&&V(V(le([])));Q&&Q!==l&&t.call(Q,a)&&(B=Q);var v=X.prototype=f.prototype=Object.create(B);function Y(N){["next","throw","return"].forEach(function(w){d(N,w,function(K){return this._invoke(w,K)})})}function F(N,w){function K(z,R,H,E){var j=Z(N[z],N,R);if(j.type!=="throw"){var ge=j.arg,ne=ge.value;return ne&&Qe(ne)=="object"&&t.call(ne,"__await")?w.resolve(ne.__await).then(function(ie){K("next",ie,H,E)},function(ie){K("throw",ie,H,E)}):w.resolve(ne).then(function(ie){ge.value=ie,H(ge)},function(ie){return K("throw",ie,H,E)})}E(j.arg)}var T;I(this,"_invoke",{value:function(R,H){function E(){return new w(function(j,ge){K(R,H,j,ge)})}return T=T?T.then(E,E):E()}})}function L(N,w,K){var T=b;return function(z,R){if(T===y)throw Error("Generator is already running");if(T===G){if(z==="throw")throw R;return{value:e,done:!0}}for(K.method=z,K.arg=R;;){var H=K.delegate;if(H){var E=M(H,K);if(E){if(E===h)continue;return E}}if(K.method==="next")K.sent=K._sent=K.arg;else if(K.method==="throw"){if(T===b)throw T=G,K.arg;K.dispatchException(K.arg)}else K.method==="return"&&K.abrupt("return",K.arg);T=y;var j=Z(N,w,K);if(j.type==="normal"){if(T=K.done?G:p,j.arg===h)continue;return{value:j.arg,done:K.done}}j.type==="throw"&&(T=G,K.method="throw",K.arg=j.arg)}}}function M(N,w){var K=w.method,T=N.iterator[K];if(T===e)return w.delegate=null,K==="throw"&&N.iterator.return&&(w.method="return",w.arg=e,M(N,w),w.method==="throw")||K!=="return"&&(w.method="throw",w.arg=new TypeError("The iterator does not provide a '"+K+"' method")),h;var z=Z(T,N.iterator,w.arg);if(z.type==="throw")return w.method="throw",w.arg=z.arg,w.delegate=null,h;var R=z.arg;return R?R.done?(w[N.resultName]=R.value,w.next=N.nextLoc,w.method!=="return"&&(w.method="next",w.arg=e),w.delegate=null,h):R:(w.method="throw",w.arg=new TypeError("iterator result is not an object"),w.delegate=null,h)}function ee(N){var w={tryLoc:N[0]};1 in N&&(w.catchLoc=N[1]),2 in N&&(w.finallyLoc=N[2],w.afterLoc=N[3]),this.tryEntries.push(w)}function q(N){var w=N.completion||{};w.type="normal",delete w.arg,N.completion=w}function P(N){this.tryEntries=[{tryLoc:"root"}],N.forEach(ee,this),this.reset(!0)}function le(N){if(N||N===""){var w=N[a];if(w)return w.call(N);if(typeof N.next=="function")return N;if(!isNaN(N.length)){var K=-1,T=function z(){for(;++K<N.length;)if(t.call(N,K))return z.value=N[K],z.done=!1,z;return z.value=e,z.done=!0,z};return T.next=T}}throw new TypeError(Qe(N)+" is not iterable")}return W.prototype=X,I(v,"constructor",{value:X,configurable:!0}),I(X,"constructor",{value:W,configurable:!0}),W.displayName=d(X,s,"GeneratorFunction"),g.isGeneratorFunction=function(N){var w=typeof N=="function"&&N.constructor;return!!w&&(w===W||(w.displayName||w.name)==="GeneratorFunction")},g.mark=function(N){return Object.setPrototypeOf?Object.setPrototypeOf(N,X):(N.__proto__=X,d(N,s,"GeneratorFunction")),N.prototype=Object.create(v),N},g.awrap=function(N){return{__await:N}},Y(F.prototype),d(F.prototype,r,function(){return this}),g.AsyncIterator=F,g.async=function(N,w,K,T,z){z===void 0&&(z=Promise);var R=new F(J(N,w,K,T),z);return g.isGeneratorFunction(w)?R:R.next().then(function(H){return H.done?H.value:R.next()})},Y(v),d(v,s,"Generator"),d(v,a,function(){return this}),d(v,"toString",function(){return"[object Generator]"}),g.keys=function(N){var w=Object(N),K=[];for(var T in w)K.push(T);return K.reverse(),function z(){for(;K.length;){var R=K.pop();if(R in w)return z.value=R,z.done=!1,z}return z.done=!0,z}},g.values=le,P.prototype={constructor:P,reset:function(w){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(q),!w)for(var K in this)K.charAt(0)==="t"&&t.call(this,K)&&!isNaN(+K.slice(1))&&(this[K]=e)},stop:function(){this.done=!0;var w=this.tryEntries[0].completion;if(w.type==="throw")throw w.arg;return this.rval},dispatchException:function(w){if(this.done)throw w;var K=this;function T(ge,ne){return H.type="throw",H.arg=w,K.next=ge,ne&&(K.method="next",K.arg=e),!!ne}for(var z=this.tryEntries.length-1;z>=0;--z){var R=this.tryEntries[z],H=R.completion;if(R.tryLoc==="root")return T("end");if(R.tryLoc<=this.prev){var E=t.call(R,"catchLoc"),j=t.call(R,"finallyLoc");if(E&&j){if(this.prev<R.catchLoc)return T(R.catchLoc,!0);if(this.prev<R.finallyLoc)return T(R.finallyLoc)}else if(E){if(this.prev<R.catchLoc)return T(R.catchLoc,!0)}else{if(!j)throw Error("try statement without catch or finally");if(this.prev<R.finallyLoc)return T(R.finallyLoc)}}}},abrupt:function(w,K){for(var T=this.tryEntries.length-1;T>=0;--T){var z=this.tryEntries[T];if(z.tryLoc<=this.prev&&t.call(z,"finallyLoc")&&this.prev<z.finallyLoc){var R=z;break}}R&&(w==="break"||w==="continue")&&R.tryLoc<=K&&K<=R.finallyLoc&&(R=null);var H=R?R.completion:{};return H.type=w,H.arg=K,R?(this.method="next",this.next=R.finallyLoc,h):this.complete(H)},complete:function(w,K){if(w.type==="throw")throw w.arg;return w.type==="break"||w.type==="continue"?this.next=w.arg:w.type==="return"?(this.rval=this.arg=w.arg,this.method="return",this.next="end"):w.type==="normal"&&K&&(this.next=K),h},finish:function(w){for(var K=this.tryEntries.length-1;K>=0;--K){var T=this.tryEntries[K];if(T.finallyLoc===w)return this.complete(T.completion,T.afterLoc),q(T),h}},catch:function(w){for(var K=this.tryEntries.length-1;K>=0;--K){var T=this.tryEntries[K];if(T.tryLoc===w){var z=T.completion;if(z.type==="throw"){var R=z.arg;q(T)}return R}}throw Error("illegal catch attempt")},delegateYield:function(w,K,T){return this.delegate={iterator:le(w),resultName:K,nextLoc:T},this.method==="next"&&(this.arg=e),h}},g}function Ym(e,g,l,t,I,i,a){try{var r=e[i](a),s=r.value}catch(d){return void l(d)}r.done?g(s):Promise.resolve(s).then(t,I)}function $g(e){return function(){var g=this,l=arguments;return new Promise(function(t,I){var i=e.apply(g,l);function a(s){Ym(i,t,I,a,r,"next",s)}function r(s){Ym(i,t,I,a,r,"throw",s)}a(void 0)})}}var Wo=O({},ky),aV=Wo.version,pr=Wo.render,rV=Wo.unmountComponentAtNode,kc;try{var AV=Number((aV||"").split(".")[0]);AV>=18&&(kc=Wo.createRoot)}catch{}function Fm(e){var g=Wo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;g&&Qe(g)==="object"&&(g.usingClientEntryPoint=e)}var Ic="__rc_react_root__";function sV(e,g){Fm(!0);var l=g[Ic]||kc(g);Fm(!1),l.render(e),g[Ic]=l}function dV(e,g){pr==null||pr(e,g)}function uV(e,g){if(kc){sV(e,g);return}dV(e,g)}function mV(e){return bA.apply(this,arguments)}function bA(){return bA=$g(bC().mark(function e(g){return bC().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.resolve().then(function(){var I;(I=g[Ic])===null||I===void 0||I.unmount(),delete g[Ic]}));case 1:case"end":return t.stop()}},e)})),bA.apply(this,arguments)}function JV(e){rV(e)}function ZV(e){return hA.apply(this,arguments)}function hA(){return hA=$g(bC().mark(function e(g){return bC().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(kc===void 0){t.next=2;break}return t.abrupt("return",mV(g));case 2:JV(g);case 3:case"end":return t.stop()}},e)})),hA.apply(this,arguments)}const bV=(e,g)=>(uV(e,g),()=>ZV(g));let hV=bV;function t0(){return hV}const Wr=()=>({height:0,opacity:0}),Km=e=>{const{scrollHeight:g}=e;return{height:g,opacity:1}},GV=e=>({height:e?e.offsetHeight:0}),Vr=(e,g)=>(g==null?void 0:g.deadline)===!0||g.propertyName==="height",yV=function(){return{motionName:`${arguments.length>0&&arguments[0]!==void 0?arguments[0]:ao}-motion-collapse`,onAppearStart:Wr,onEnterStart:Wr,onAppearActive:Km,onEnterActive:Km,onLeaveStart:GV,onLeaveActive:Wr,onAppearEnd:Vr,onEnterEnd:Vr,onLeaveEnd:Vr,motionDeadline:500}},mo=(e,g,l)=>l!==void 0?l:`${e}-${g}`;function os(e,g){var l=Object.assign({},e);return Array.isArray(g)&&g.forEach(function(t){delete l[t]}),l}const I0=function(e){if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){var g=e.getBBox(),l=g.width,t=g.height;if(l||t)return!0}if(e.getBoundingClientRect){var I=e.getBoundingClientRect(),i=I.width,a=I.height;if(i||a)return!0}}return!1},kV=e=>{const{componentCls:g,colorPrimary:l}=e;return{[g]:{position:"absolute",background:"transparent",pointerEvents:"none",boxSizing:"border-box",color:`var(--wave-color, ${l})`,boxShadow:"0 0 0 0 currentcolor",opacity:.2,"&.wave-motion-appear":{transition:[`box-shadow 0.4s ${e.motionEaseOutCirc}`,`opacity 2s ${e.motionEaseOutCirc}`].join(","),"&-active":{boxShadow:"0 0 0 6px currentcolor",opacity:0},"&.wave-quick":{transition:[`box-shadow ${e.motionDurationSlow} ${e.motionEaseInOut}`,`opacity ${e.motionDurationSlow} ${e.motionEaseInOut}`].join(",")}}}}},pV=Op("Wave",e=>[kV(e)]),o0=`${ao}-wave-target`;function fr(e){return e&&e!=="#fff"&&e!=="#ffffff"&&e!=="rgb(255, 255, 255)"&&e!=="rgba(255, 255, 255, 1)"&&!/rgba\((?:\d*, ){3}0\)/.test(e)&&e!=="transparent"}function WV(e){const{borderTopColor:g,borderColor:l,backgroundColor:t}=getComputedStyle(e);return fr(g)?g:fr(l)?l:fr(t)?t:null}function Xr(e){return Number.isNaN(e)?0:e}const VV=e=>{const{className:g,target:l,component:t,registerUnmount:I}=e,i=u.useRef(null),a=u.useRef(null);u.useEffect(()=>{a.current=I()},[]);const[r,s]=u.useState(null),[d,J]=u.useState([]),[Z,b]=u.useState(0),[p,y]=u.useState(0),[G,h]=u.useState(0),[f,W]=u.useState(0),[X,B]=u.useState(!1),V={left:Z,top:p,width:G,height:f,borderRadius:d.map(Y=>`${Y}px`).join(" ")};r&&(V["--wave-color"]=r);function Q(){const Y=getComputedStyle(l);s(WV(l));const F=Y.position==="static",{borderLeftWidth:L,borderTopWidth:M}=Y;b(F?l.offsetLeft:Xr(-parseFloat(L))),y(F?l.offsetTop:Xr(-parseFloat(M))),h(l.offsetWidth),W(l.offsetHeight);const{borderTopLeftRadius:ee,borderTopRightRadius:q,borderBottomLeftRadius:P,borderBottomRightRadius:le}=Y;J([ee,q,le,P].map(N=>Xr(parseFloat(N))))}if(u.useEffect(()=>{if(l){const Y=Rn(()=>{Q(),B(!0)});let F;return typeof ResizeObserver<"u"&&(F=new ResizeObserver(Q),F.observe(l)),()=>{Rn.cancel(Y),F==null||F.disconnect()}}},[]),!X)return null;const v=(t==="Checkbox"||t==="Radio")&&(l==null?void 0:l.classList.contains(o0));return u.createElement(Nl,{visible:!0,motionAppear:!0,motionName:"wave-motion",motionDeadline:5e3,onAppearEnd:(Y,F)=>{var L,M;if(F.deadline||F.propertyName==="opacity"){const ee=(L=i.current)===null||L===void 0?void 0:L.parentElement;(M=a.current)===null||M===void 0||M.call(a).then(()=>{ee==null||ee.remove()})}return!1}},(Y,F)=>{let{className:L}=Y;return u.createElement("div",{ref:uc(i,F),className:me(g,L,{"wave-quick":v}),style:V})})},fV=(e,g)=>{var l;const{component:t}=g;if(t==="Checkbox"&&!(!((l=e.querySelector("input"))===null||l===void 0)&&l.checked))return;const I=document.createElement("div");I.style.position="absolute",I.style.left="0px",I.style.top="0px",e==null||e.insertBefore(I,e==null?void 0:e.firstChild);const i=t0();let a=null;function r(){return a}a=i(u.createElement(VV,Object.assign({},g,{target:e,registerUnmount:r})),I)},XV=(e,g,l)=>{const{wave:t}=u.useContext(zC),[,I,i]=vn(),a=jg(d=>{const J=e.current;if(t!=null&&t.disabled||!J)return;const Z=J.querySelector(`.${o0}`)||J,{showEffect:b}=t||{};(b||fV)(Z,{className:g,token:I,component:l,event:d,hashId:i})}),r=u.useRef(null);return d=>{Rn.cancel(r.current),r.current=Rn(()=>{a(d)})}},RV=e=>{const{children:g,disabled:l,component:t}=e,{getPrefixCls:I}=u.useContext(zC),i=u.useRef(null),a=I("wave"),[,r]=pV(a),s=XV(i,me(a,r),t);if(de.useEffect(()=>{const J=i.current;if(!J||J.nodeType!==1||l)return;const Z=b=>{!I0(b.target)||!J.getAttribute||J.getAttribute("disabled")||J.disabled||J.className.includes("disabled")||J.className.includes("-leave")||s(b)};return J.addEventListener("click",Z,!0),()=>{J.removeEventListener("click",Z,!0)}},[l]),!de.isValidElement(g))return g??null;const d=yo(g)?uc(mc(g),i):i;return uo(g,{ref:d})},QV=e=>{const g=de.useContext(gI);return de.useMemo(()=>e?typeof e=="string"?e??g:e instanceof Function?e(g):g:g,[e,g])},i0=u.createContext(null),vV=(e,g)=>{const l=u.useContext(i0),t=u.useMemo(()=>{if(!l)return"";const{compactDirection:I,isFirstItem:i,isLastItem:a}=l,r=I==="vertical"?"-vertical-":"-";return me(`${e}-compact${r}item`,{[`${e}-compact${r}first-item`]:i,[`${e}-compact${r}last-item`]:a,[`${e}-compact${r}item-rtl`]:g==="rtl"})},[e,g,l]);return{compactSize:l==null?void 0:l.compactSize,compactDirection:l==null?void 0:l.compactDirection,compactItemClassnames:t}},BV=e=>{const{children:g}=e;return u.createElement(i0.Provider,{value:null},g)};var SV=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const c0=u.createContext(void 0),YV=e=>{const{getPrefixCls:g,direction:l}=u.useContext(zC),{prefixCls:t,size:I,className:i}=e,a=SV(e,["prefixCls","size","className"]),r=g("btn-group",t),[,,s]=vn(),d=u.useMemo(()=>{switch(I){case"large":return"lg";case"small":return"sm";default:return""}},[I]),J=me(r,{[`${r}-${d}`]:d,[`${r}-rtl`]:l==="rtl"},i,s);return u.createElement(c0.Provider,{value:I},u.createElement("div",Object.assign({},a,{className:J})))},wm=/^[\u4E00-\u9FA5]{2}$/,GA=wm.test.bind(wm);function Hm(e){return typeof e=="string"}function Rr(e){return e==="text"||e==="link"}function FV(e,g){if(e==null)return;const l=g?" ":"";return typeof e!="string"&&typeof e!="number"&&Hm(e.type)&&GA(e.props.children)?uo(e,{children:e.props.children.split("").join(l)}):Hm(e)?GA(e)?de.createElement("span",null,e.split("").join(l)):de.createElement("span",null,e):$Z(e)?de.createElement("span",null,e):e}function KV(e,g){let l=!1;const t=[];return de.Children.forEach(e,I=>{const i=typeof I,a=i==="string"||i==="number";if(l&&a){const r=t.length-1,s=t[r];t[r]=`${s}${I}`}else t.push(I);l=a}),de.Children.map(t,I=>FV(I,g))}["default","primary","danger"].concat(ye(lI));const yA=u.forwardRef((e,g)=>{const{className:l,style:t,children:I,prefixCls:i}=e,a=me(`${i}-icon`,l);return de.createElement("span",{ref:g,className:a,style:t},I)}),Nm=u.forwardRef((e,g)=>{const{prefixCls:l,className:t,style:I,iconClassName:i}=e,a=me(`${l}-loading-icon`,t);return de.createElement(yA,{prefixCls:l,className:a,style:I,ref:g},de.createElement(_i,{className:i}))}),Qr=()=>({width:0,opacity:0,transform:"scale(0)"}),vr=e=>({width:e.scrollWidth,opacity:1,transform:"scale(1)"}),wV=e=>{const{prefixCls:g,loading:l,existIcon:t,className:I,style:i,mount:a}=e,r=!!l;return t?de.createElement(Nm,{prefixCls:g,className:I,style:i}):de.createElement(Nl,{visible:r,motionName:`${g}-loading-icon-motion`,motionAppear:!a,motionEnter:!a,motionLeave:!a,removeOnLeave:!0,onAppearStart:Qr,onAppearActive:vr,onEnterStart:Qr,onEnterActive:vr,onLeaveStart:vr,onLeaveActive:Qr},(s,d)=>{let{className:J,style:Z}=s;const b=Object.assign(Object.assign({},i),Z);return de.createElement(Nm,{prefixCls:g,className:me(I,J),style:b,ref:d})})},zm=(e,g)=>({[`> span, > ${e}`]:{"&:not(:last-child)":{[`&, & > ${e}`]:{"&:not(:disabled)":{borderInlineEndColor:g}}},"&:not(:first-child)":{[`&, & > ${e}`]:{"&:not(:disabled)":{borderInlineStartColor:g}}}}}),HV=e=>{const{componentCls:g,fontSize:l,lineWidth:t,groupBorderColor:I,colorErrorHover:i}=e;return{[`${g}-group`]:[{position:"relative",display:"inline-flex",[`> span, > ${g}`]:{"&:not(:last-child)":{[`&, & > ${g}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},"&:not(:first-child)":{marginInlineStart:e.calc(t).mul(-1).equal(),[`&, & > ${g}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}},[g]:{position:"relative",zIndex:1,"&:hover, &:focus, &:active":{zIndex:2},"&[disabled]":{zIndex:0}},[`${g}-icon-only`]:{fontSize:l}},zm(`${g}-primary`,I),zm(`${g}-danger`,i)]}};var NV=["b"],zV=["v"],Br=function(g){return Math.round(Number(g||0))},LV=function(g){if(g instanceof AC)return g;if(g&&Qe(g)==="object"&&"h"in g&&"b"in g){var l=g,t=l.b,I=wC(l,NV);return O(O({},I),{},{v:t})}return typeof g=="string"&&/hsb/.test(g)?g.replace(/hsb/,"hsv"):g},Jo=function(e){wl(l,e);var g=Hl(l);function l(t){return DC(this,l),g.call(this,LV(t))}return EC(l,[{key:"toHsbString",value:function(){var I=this.toHsb(),i=Br(I.s*100),a=Br(I.b*100),r=Br(I.h),s=I.a,d="hsb(".concat(r,", ").concat(i,"%, ").concat(a,"%)"),J="hsba(".concat(r,", ").concat(i,"%, ").concat(a,"%, ").concat(s.toFixed(s===0?0:2),")");return s===1?d:J}},{key:"toHsb",value:function(){var I=this.toHsv(),i=I.v,a=wC(I,zV);return O(O({},a),{},{b:i,a:this.a})}}]),l}(AC),UV=function(g){return g instanceof Jo?g:new Jo(g)};UV("#1677ff");const MV=(e,g)=>(e==null?void 0:e.replace(/[^\w/]/g,"").slice(0,g?8:6))||"",xV=(e,g)=>e?MV(e,g):"";let TV=function(){function e(g){DC(this,e);var l;if(this.cleared=!1,g instanceof e){this.metaColor=g.metaColor.clone(),this.colors=(l=g.colors)===null||l===void 0?void 0:l.map(I=>({color:new e(I.color),percent:I.percent})),this.cleared=g.cleared;return}const t=Array.isArray(g);t&&g.length?(this.colors=g.map(I=>{let{color:i,percent:a}=I;return{color:new e(i),percent:a}}),this.metaColor=new Jo(this.colors[0].color.metaColor)):this.metaColor=new Jo(t?"":g),(!g||t&&!this.colors)&&(this.metaColor=this.metaColor.setA(0),this.cleared=!0)}return EC(e,[{key:"toHsb",value:function(){return this.metaColor.toHsb()}},{key:"toHsbString",value:function(){return this.metaColor.toHsbString()}},{key:"toHex",value:function(){return xV(this.toHexString(),this.metaColor.a<1)}},{key:"toHexString",value:function(){return this.metaColor.toHexString()}},{key:"toRgb",value:function(){return this.metaColor.toRgb()}},{key:"toRgbString",value:function(){return this.metaColor.toRgbString()}},{key:"isGradient",value:function(){return!!this.colors&&!this.cleared}},{key:"getColors",value:function(){return this.colors||[{color:this,percent:0}]}},{key:"toCssString",value:function(){const{colors:l}=this;return l?`linear-gradient(90deg, ${l.map(I=>`${I.color.toRgbString()} ${I.percent}%`).join(", ")})`:this.metaColor.toRgbString()}},{key:"equals",value:function(l){return!l||this.isGradient()!==l.isGradient()?!1:this.isGradient()?this.colors.length===l.colors.length&&this.colors.every((t,I)=>{const i=l.colors[I];return t.percent===i.percent&&t.color.equals(i.color)}):this.toHexString()===l.toHexString()}}])}();const DV=e=>({[e.componentCls]:{[`${e.antCls}-motion-collapse-legacy`]:{overflow:"hidden","&-active":{transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}},[`${e.antCls}-motion-collapse`]:{overflow:"hidden",transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}}}),EV=e=>({animationDuration:e,animationFillMode:"both"}),OV=e=>({animationDuration:e,animationFillMode:"both"}),a0=function(e,g,l,t){const i=(arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1)?"&":"";return{[`
      ${i}${e}-enter,
      ${i}${e}-appear
    `]:Object.assign(Object.assign({},EV(t)),{animationPlayState:"paused"}),[`${i}${e}-leave`]:Object.assign(Object.assign({},OV(t)),{animationPlayState:"paused"}),[`
      ${i}${e}-enter${e}-enter-active,
      ${i}${e}-appear${e}-appear-active
    `]:{animationName:g,animationPlayState:"running"},[`${i}${e}-leave${e}-leave-active`]:{animationName:l,animationPlayState:"running",pointerEvents:"none"}}},PV=new $C("antFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),jV=new $C("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),is=function(e){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{antCls:l}=e,t=`${l}-fade`,I=g?"&":"";return[a0(t,PV,jV,e.motionDurationMid,g),{[`
        ${I}${t}-enter,
        ${I}${t}-appear
      `]:{opacity:0,animationTimingFunction:"linear"},[`${I}${t}-leave`]:{animationTimingFunction:"linear"}}]},$V=new $C("antZoomIn",{"0%":{transform:"scale(0.2)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),qV=new $C("antZoomOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.2)",opacity:0}}),Lm=new $C("antZoomBigIn",{"0%":{transform:"scale(0.8)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),Um=new $C("antZoomBigOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.8)",opacity:0}}),_V=new $C("antZoomUpIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 0%"}}),ef=new $C("antZoomUpOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 0%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0}}),Cf=new $C("antZoomLeftIn",{"0%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"0% 50%"}}),gf=new $C("antZoomLeftOut",{"0%":{transform:"scale(1)",transformOrigin:"0% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0}}),lf=new $C("antZoomRightIn",{"0%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"100% 50%"}}),nf=new $C("antZoomRightOut",{"0%":{transform:"scale(1)",transformOrigin:"100% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0}}),tf=new $C("antZoomDownIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 100%"}}),If=new $C("antZoomDownOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 100%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0}}),of={zoom:{inKeyframes:$V,outKeyframes:qV},"zoom-big":{inKeyframes:Lm,outKeyframes:Um},"zoom-big-fast":{inKeyframes:Lm,outKeyframes:Um},"zoom-left":{inKeyframes:Cf,outKeyframes:gf},"zoom-right":{inKeyframes:lf,outKeyframes:nf},"zoom-up":{inKeyframes:_V,outKeyframes:ef},"zoom-down":{inKeyframes:tf,outKeyframes:If}},cs=(e,g)=>{const{antCls:l}=e,t=`${l}-${g}`,{inKeyframes:I,outKeyframes:i}=of[g];return[a0(t,I,i,g==="zoom-big-fast"?e.motionDurationFast:e.motionDurationMid),{[`
        ${t}-enter,
        ${t}-appear
      `]:{transform:"scale(0)",opacity:0,animationTimingFunction:e.motionEaseOutCirc,"&-prepare":{transform:"none"}},[`${t}-leave`]:{animationTimingFunction:e.motionEaseInOutCirc}}]},cf=(e,g)=>{const{r:l,g:t,b:I,a:i}=e.toRgb(),a=new Jo(e.toRgbString()).onBackground(g).toHsv();return i<=.5?a.v>.5:l*.299+t*.587+I*.114>192},r0=e=>{const{paddingInline:g,onlyIconSize:l}=e;return pg(e,{buttonPaddingHorizontal:g,buttonPaddingVertical:0,buttonIconOnlyFontSize:l})},A0=e=>{var g,l,t,I,i,a;const r=(g=e.contentFontSize)!==null&&g!==void 0?g:e.fontSize,s=(l=e.contentFontSizeSM)!==null&&l!==void 0?l:e.fontSize,d=(t=e.contentFontSizeLG)!==null&&t!==void 0?t:e.fontSizeLG,J=(I=e.contentLineHeight)!==null&&I!==void 0?I:Pi(r),Z=(i=e.contentLineHeightSM)!==null&&i!==void 0?i:Pi(s),b=(a=e.contentLineHeightLG)!==null&&a!==void 0?a:Pi(d),p=cf(new TV(e.colorBgSolid),"#fff")?"#000":"#fff";return{fontWeight:400,defaultShadow:`0 ${e.controlOutlineWidth}px 0 ${e.controlTmpOutline}`,primaryShadow:`0 ${e.controlOutlineWidth}px 0 ${e.controlOutline}`,dangerShadow:`0 ${e.controlOutlineWidth}px 0 ${e.colorErrorOutline}`,primaryColor:e.colorTextLightSolid,dangerColor:e.colorTextLightSolid,borderColorDisabled:e.colorBorder,defaultGhostColor:e.colorBgContainer,ghostBg:"transparent",defaultGhostBorderColor:e.colorBgContainer,paddingInline:e.paddingContentHorizontal-e.lineWidth,paddingInlineLG:e.paddingContentHorizontal-e.lineWidth,paddingInlineSM:8-e.lineWidth,onlyIconSize:"inherit",onlyIconSizeSM:"inherit",onlyIconSizeLG:"inherit",groupBorderColor:e.colorPrimaryHover,linkHoverBg:"transparent",textTextColor:e.colorText,textTextHoverColor:e.colorText,textTextActiveColor:e.colorText,textHoverBg:e.colorFillTertiary,defaultColor:e.colorText,defaultBg:e.colorBgContainer,defaultBorderColor:e.colorBorder,defaultBorderColorDisabled:e.colorBorder,defaultHoverBg:e.colorBgContainer,defaultHoverColor:e.colorPrimaryHover,defaultHoverBorderColor:e.colorPrimaryHover,defaultActiveBg:e.colorBgContainer,defaultActiveColor:e.colorPrimaryActive,defaultActiveBorderColor:e.colorPrimaryActive,solidTextColor:p,contentFontSize:r,contentFontSizeSM:s,contentFontSizeLG:d,contentLineHeight:J,contentLineHeightSM:Z,contentLineHeightLG:b,paddingBlock:Math.max((e.controlHeight-r*J)/2-e.lineWidth,0),paddingBlockSM:Math.max((e.controlHeightSM-s*Z)/2-e.lineWidth,0),paddingBlockLG:Math.max((e.controlHeightLG-d*b)/2-e.lineWidth,0)}},af=e=>{const{componentCls:g,iconCls:l,fontWeight:t,opacityLoading:I,motionDurationSlow:i,motionEaseInOut:a,marginXS:r,calc:s}=e;return{[g]:{outline:"none",position:"relative",display:"inline-flex",gap:e.marginXS,alignItems:"center",justifyContent:"center",fontWeight:t,whiteSpace:"nowrap",textAlign:"center",backgroundImage:"none",background:"transparent",border:`${Le(e.lineWidth)} ${e.lineType} transparent`,cursor:"pointer",transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,userSelect:"none",touchAction:"manipulation",color:e.colorText,"&:disabled > *":{pointerEvents:"none"},[`${g}-icon > svg`]:SZ(),"> a":{color:"currentColor"},"&:not(:disabled)":FZ(e),[`&${g}-two-chinese-chars::first-letter`]:{letterSpacing:"0.34em"},[`&${g}-two-chinese-chars > *:not(${l})`]:{marginInlineEnd:"-0.34em",letterSpacing:"0.34em"},[`&${g}-icon-only`]:{paddingInline:0,[`&${g}-compact-item`]:{flex:"none"},[`&${g}-round`]:{width:"auto"}},[`&${g}-loading`]:{opacity:I,cursor:"default"},[`${g}-loading-icon`]:{transition:["width","opacity","margin"].map(d=>`${d} ${i} ${a}`).join(",")},[`&:not(${g}-icon-end)`]:{[`${g}-loading-icon-motion`]:{"&-appear-start, &-enter-start":{marginInlineEnd:s(r).mul(-1).equal()},"&-appear-active, &-enter-active":{marginInlineEnd:0},"&-leave-start":{marginInlineEnd:0},"&-leave-active":{marginInlineEnd:s(r).mul(-1).equal()}}},"&-icon-end":{flexDirection:"row-reverse",[`${g}-loading-icon-motion`]:{"&-appear-start, &-enter-start":{marginInlineStart:s(r).mul(-1).equal()},"&-appear-active, &-enter-active":{marginInlineStart:0},"&-leave-start":{marginInlineStart:0},"&-leave-active":{marginInlineStart:s(r).mul(-1).equal()}}}}}},s0=(e,g,l)=>({[`&:not(:disabled):not(${e}-disabled)`]:{"&:hover":g,"&:active":l}}),rf=e=>({minWidth:e.controlHeight,paddingInlineStart:0,paddingInlineEnd:0,borderRadius:"50%"}),Af=e=>({borderRadius:e.controlHeight,paddingInlineStart:e.calc(e.controlHeight).div(2).equal(),paddingInlineEnd:e.calc(e.controlHeight).div(2).equal()}),sf=e=>({cursor:"not-allowed",borderColor:e.borderColorDisabled,color:e.colorTextDisabled,background:e.colorBgContainerDisabled,boxShadow:"none"}),as=(e,g,l,t,I,i,a,r)=>({[`&${e}-background-ghost`]:Object.assign(Object.assign({color:l||void 0,background:g,borderColor:t||void 0,boxShadow:"none"},s0(e,Object.assign({background:g},a),Object.assign({background:g},r))),{"&:disabled":{cursor:"not-allowed",color:I||void 0,borderColor:i||void 0}})}),df=e=>({[`&:disabled, &${e.componentCls}-disabled`]:Object.assign({},sf(e))}),uf=e=>({[`&:disabled, &${e.componentCls}-disabled`]:{cursor:"not-allowed",color:e.colorTextDisabled}}),pc=(e,g,l,t)=>{const i=t&&["link","text"].includes(t)?uf:df;return Object.assign(Object.assign({},i(e)),s0(e.componentCls,g,l))},Wc=(e,g,l,t,I)=>({[`&${e.componentCls}-variant-solid`]:Object.assign({color:g,background:l},pc(e,t,I))}),Vc=(e,g,l,t,I)=>({[`&${e.componentCls}-variant-outlined, &${e.componentCls}-variant-dashed`]:Object.assign({borderColor:g,background:l},pc(e,t,I))}),fc=e=>({[`&${e.componentCls}-variant-dashed`]:{borderStyle:"dashed"}}),Xc=(e,g,l,t)=>({[`&${e.componentCls}-variant-filled`]:Object.assign({boxShadow:"none",background:g},pc(e,l,t))}),Qn=(e,g,l,t,I)=>({[`&${e.componentCls}-variant-${l}`]:Object.assign({color:g,boxShadow:"none"},pc(e,t,I,l))}),mf=e=>{const{componentCls:g}=e;return lI.reduce((l,t)=>{const I=e[`${t}6`],i=e[`${t}1`],a=e[`${t}5`],r=e[`${t}2`],s=e[`${t}3`],d=e[`${t}7`],J=`0 ${Le(e.controlOutlineWidth)} 0 ${e[`${t}1`]}`;return Object.assign(Object.assign({},l),{[`&${g}-color-${t}`]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:I,boxShadow:J},Wc(e,e.colorTextLightSolid,I,{background:a},{background:d})),Vc(e,I,e.colorBgContainer,{color:a,borderColor:a,background:e.colorBgContainer},{color:d,borderColor:d,background:e.colorBgContainer})),fc(e)),Xc(e,i,{background:r},{background:s})),Qn(e,I,"link",{color:a},{color:d})),Qn(e,I,"text",{color:a,background:i},{color:d,background:s}))})},{})},Jf=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:e.defaultColor,boxShadow:e.defaultShadow},Wc(e,e.solidTextColor,e.colorBgSolid,{color:e.solidTextColor,background:e.colorBgSolidHover},{color:e.solidTextColor,background:e.colorBgSolidActive})),fc(e)),Xc(e,e.colorFillTertiary,{background:e.colorFillSecondary},{background:e.colorFill})),Qn(e,e.textTextColor,"link",{color:e.colorLinkHover,background:e.linkHoverBg},{color:e.colorLinkActive})),as(e.componentCls,e.ghostBg,e.defaultGhostColor,e.defaultGhostBorderColor,e.colorTextDisabled,e.colorBorder)),Zf=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:e.colorPrimary,boxShadow:e.primaryShadow},Vc(e,e.colorPrimary,e.colorBgContainer,{color:e.colorPrimaryTextHover,borderColor:e.colorPrimaryHover,background:e.colorBgContainer},{color:e.colorPrimaryTextActive,borderColor:e.colorPrimaryActive,background:e.colorBgContainer})),fc(e)),Xc(e,e.colorPrimaryBg,{background:e.colorPrimaryBgHover},{background:e.colorPrimaryBorder})),Qn(e,e.colorLink,"text",{color:e.colorPrimaryTextHover,background:e.colorPrimaryBg},{color:e.colorPrimaryTextActive,background:e.colorPrimaryBorder})),as(e.componentCls,e.ghostBg,e.colorPrimary,e.colorPrimary,e.colorTextDisabled,e.colorBorder,{color:e.colorPrimaryHover,borderColor:e.colorPrimaryHover},{color:e.colorPrimaryActive,borderColor:e.colorPrimaryActive})),bf=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:e.colorError,boxShadow:e.dangerShadow},Wc(e,e.dangerColor,e.colorError,{background:e.colorErrorHover},{background:e.colorErrorActive})),Vc(e,e.colorError,e.colorBgContainer,{color:e.colorErrorHover,borderColor:e.colorErrorBorderHover},{color:e.colorErrorActive,borderColor:e.colorErrorActive})),fc(e)),Xc(e,e.colorErrorBg,{background:e.colorErrorBgFilledHover},{background:e.colorErrorBgActive})),Qn(e,e.colorError,"text",{color:e.colorErrorHover,background:e.colorErrorBg},{color:e.colorErrorHover,background:e.colorErrorBgActive})),Qn(e,e.colorError,"link",{color:e.colorErrorHover},{color:e.colorErrorActive})),as(e.componentCls,e.ghostBg,e.colorError,e.colorError,e.colorTextDisabled,e.colorBorder,{color:e.colorErrorHover,borderColor:e.colorErrorHover},{color:e.colorErrorActive,borderColor:e.colorErrorActive})),hf=e=>{const{componentCls:g}=e;return Object.assign({[`${g}-color-default`]:Jf(e),[`${g}-color-primary`]:Zf(e),[`${g}-color-dangerous`]:bf(e)},mf(e))},Gf=e=>Object.assign(Object.assign(Object.assign(Object.assign({},Vc(e,e.defaultBorderColor,e.defaultBg,{color:e.defaultHoverColor,borderColor:e.defaultHoverBorderColor,background:e.defaultHoverBg},{color:e.defaultActiveColor,borderColor:e.defaultActiveBorderColor,background:e.defaultActiveBg})),Qn(e,e.textTextColor,"text",{color:e.textTextHoverColor,background:e.textHoverBg},{color:e.textTextActiveColor,background:e.colorBgTextActive})),Wc(e,e.primaryColor,e.colorPrimary,{background:e.colorPrimaryHover,color:e.primaryColor},{background:e.colorPrimaryActive,color:e.primaryColor})),Qn(e,e.colorLink,"link",{color:e.colorLinkHover,background:e.linkHoverBg},{color:e.colorLinkActive})),rs=function(e){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const{componentCls:l,controlHeight:t,fontSize:I,borderRadius:i,buttonPaddingHorizontal:a,iconCls:r,buttonPaddingVertical:s,buttonIconOnlyFontSize:d}=e;return[{[g]:{fontSize:I,height:t,padding:`${Le(s)} ${Le(a)}`,borderRadius:i,[`&${l}-icon-only`]:{width:t,[r]:{fontSize:d}}}},{[`${l}${l}-circle${g}`]:rf(e)},{[`${l}${l}-round${g}`]:Af(e)}]},yf=e=>{const g=pg(e,{fontSize:e.contentFontSize});return rs(g,e.componentCls)},kf=e=>{const g=pg(e,{controlHeight:e.controlHeightSM,fontSize:e.contentFontSizeSM,padding:e.paddingXS,buttonPaddingHorizontal:e.paddingInlineSM,buttonPaddingVertical:0,borderRadius:e.borderRadiusSM,buttonIconOnlyFontSize:e.onlyIconSizeSM});return rs(g,`${e.componentCls}-sm`)},pf=e=>{const g=pg(e,{controlHeight:e.controlHeightLG,fontSize:e.contentFontSizeLG,buttonPaddingHorizontal:e.paddingInlineLG,buttonPaddingVertical:0,borderRadius:e.borderRadiusLG,buttonIconOnlyFontSize:e.onlyIconSizeLG});return rs(g,`${e.componentCls}-lg`)},Wf=e=>{const{componentCls:g}=e;return{[g]:{[`&${g}-block`]:{width:"100%"}}}},Vf=gn("Button",e=>{const g=r0(e);return[af(g),yf(g),kf(g),pf(g),Wf(g),hf(g),Gf(g),HV(g)]},A0,{unitless:{fontWeight:!0,contentLineHeight:!0,contentLineHeightSM:!0,contentLineHeightLG:!0}});function ff(e,g,l){const{focusElCls:t,focus:I,borderElCls:i}=l,a=i?"> *":"",r=["hover",I?"focus":null,"active"].filter(Boolean).map(s=>`&:${s} ${a}`).join(",");return{[`&-item:not(${g}-last-item)`]:{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal()},"&-item":Object.assign(Object.assign({[r]:{zIndex:2}},t?{[`&${t}`]:{zIndex:2}}:{}),{[`&[disabled] ${a}`]:{zIndex:0}})}}function Xf(e,g,l){const{borderElCls:t}=l,I=t?`> ${t}`:"";return{[`&-item:not(${g}-first-item):not(${g}-last-item) ${I}`]:{borderRadius:0},[`&-item:not(${g}-last-item)${g}-first-item`]:{[`& ${I}, &${e}-sm ${I}, &${e}-lg ${I}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&-item:not(${g}-first-item)${g}-last-item`]:{[`& ${I}, &${e}-sm ${I}, &${e}-lg ${I}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}function Rf(e){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{focus:!0};const{componentCls:l}=e,t=`${l}-compact`;return{[t]:Object.assign(Object.assign({},ff(e,t,g)),Xf(l,t,g))}}function Qf(e,g){return{[`&-item:not(${g}-last-item)`]:{marginBottom:e.calc(e.lineWidth).mul(-1).equal()},"&-item":{"&:hover,&:focus,&:active":{zIndex:2},"&[disabled]":{zIndex:0}}}}function vf(e,g){return{[`&-item:not(${g}-first-item):not(${g}-last-item)`]:{borderRadius:0},[`&-item${g}-first-item:not(${g}-last-item)`]:{[`&, &${e}-sm, &${e}-lg`]:{borderEndEndRadius:0,borderEndStartRadius:0}},[`&-item${g}-last-item:not(${g}-first-item)`]:{[`&, &${e}-sm, &${e}-lg`]:{borderStartStartRadius:0,borderStartEndRadius:0}}}}function Bf(e){const g=`${e.componentCls}-compact-vertical`;return{[g]:Object.assign(Object.assign({},Qf(e,g)),vf(e.componentCls,g))}}const Sf=e=>{const{componentCls:g,colorPrimaryHover:l,lineWidth:t,calc:I}=e,i=I(t).mul(-1).equal(),a=r=>{const s=`${g}-compact${r?"-vertical":""}-item${g}-primary:not([disabled])`;return{[`${s} + ${s}::before`]:{position:"absolute",top:r?i:0,insetInlineStart:r?0:i,backgroundColor:l,content:'""',width:r?"100%":t,height:r?t:"100%"}}};return Object.assign(Object.assign({},a()),a(!0))},Yf=Pp(["Button","compact"],e=>{const g=r0(e);return[Rf(g),Bf(g),Sf(g)]},A0);var Ff=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};function Kf(e){if(typeof e=="object"&&e){let g=e==null?void 0:e.delay;return g=!Number.isNaN(g)&&typeof g=="number"?g:0,{loading:g<=0,delay:g}}return{loading:!!e,delay:0}}const wf={default:["default","outlined"],primary:["primary","solid"],dashed:["default","dashed"],link:["primary","link"],text:["default","text"]},Hf=de.forwardRef((e,g)=>{var l,t,I,i;const{loading:a=!1,prefixCls:r,color:s,variant:d,type:J,danger:Z=!1,shape:b="default",size:p,styles:y,disabled:G,className:h,rootClassName:f,children:W,icon:X,iconPosition:B="start",ghost:V=!1,block:Q=!1,htmlType:v="button",classNames:Y,style:F={},autoInsertSpace:L,autoFocus:M}=e,ee=Ff(e,["loading","prefixCls","color","variant","type","danger","shape","size","styles","disabled","className","rootClassName","children","icon","iconPosition","ghost","block","htmlType","classNames","style","autoInsertSpace","autoFocus"]),q=J||"default",[P,le]=u.useMemo(()=>{if(s&&d)return[s,d];const Te=wf[q]||[];return Z?["danger",Te[1]]:Te},[J,s,d,Z]),w=P==="danger"?"dangerous":P,{getPrefixCls:K,direction:T,button:z}=u.useContext(zC),R=(l=L??(z==null?void 0:z.autoInsertSpace))!==null&&l!==void 0?l:!0,H=K("btn",r),[E,j,ge]=Vf(H),ne=u.useContext(ro),ie=G??ne,Ae=u.useContext(c0),ae=u.useMemo(()=>Kf(a),[a]),[se,ze]=u.useState(ae.loading),[We,Je]=u.useState(!1),ue=u.useRef(null),he=Go(g,ue),Se=u.Children.count(W)===1&&!X&&!Rr(le),Ke=u.useRef(!0);de.useEffect(()=>(Ke.current=!1,()=>{Ke.current=!0}),[]),u.useEffect(()=>{let Te=null;ae.delay>0?Te=setTimeout(()=>{Te=null,ze(!0)},ae.delay):ze(ae.loading);function Ze(){Te&&(clearTimeout(Te),Te=null)}return Ze},[ae]),u.useEffect(()=>{if(!ue.current||!R)return;const Te=ue.current.textContent||"";Se&&GA(Te)?We||Je(!0):We&&Je(!1)}),u.useEffect(()=>{M&&ue.current&&ue.current.focus()},[]);const Ye=de.useCallback(Te=>{var Ze;if(se||ie){Te.preventDefault();return}(Ze=e.onClick)===null||Ze===void 0||Ze.call(e,Te)},[e.onClick,se,ie]),{compactSize:Ue,compactItemClassnames:Me}=vV(H,T),Re={large:"lg",small:"sm",middle:void 0},De=QV(Te=>{var Ze,Ee;return(Ee=(Ze=p??Ue)!==null&&Ze!==void 0?Ze:Ae)!==null&&Ee!==void 0?Ee:Te}),fe=De&&(t=Re[De])!==null&&t!==void 0?t:"",_e=se?"loading":X,eC=os(ee,["navigate"]),IC=me(H,j,ge,{[`${H}-${b}`]:b!=="default"&&b,[`${H}-${q}`]:q,[`${H}-dangerous`]:Z,[`${H}-color-${w}`]:w,[`${H}-variant-${le}`]:le,[`${H}-${fe}`]:fe,[`${H}-icon-only`]:!W&&W!==0&&!!_e,[`${H}-background-ghost`]:V&&!Rr(le),[`${H}-loading`]:se,[`${H}-two-chinese-chars`]:We&&R&&!se,[`${H}-block`]:Q,[`${H}-rtl`]:T==="rtl",[`${H}-icon-end`]:B==="end"},Me,h,f,z==null?void 0:z.className),pC=Object.assign(Object.assign({},z==null?void 0:z.style),F),cC=me(Y==null?void 0:Y.icon,(I=z==null?void 0:z.classNames)===null||I===void 0?void 0:I.icon),hC=Object.assign(Object.assign({},(y==null?void 0:y.icon)||{}),((i=z==null?void 0:z.styles)===null||i===void 0?void 0:i.icon)||{}),WC=X&&!se?de.createElement(yA,{prefixCls:H,className:cC,style:hC},X):a&&typeof a=="object"&&a.icon?de.createElement(yA,{prefixCls:H,className:cC,style:hC},a.icon):de.createElement(wV,{existIcon:!!X,prefixCls:H,loading:se,mount:Ke.current}),Pe=W||W===0?KV(W,Se&&R):null;if(eC.href!==void 0)return E(de.createElement("a",Object.assign({},eC,{className:me(IC,{[`${H}-disabled`]:ie}),href:ie?void 0:eC.href,style:pC,onClick:Ye,ref:he,tabIndex:ie?-1:0}),WC,Pe));let lC=de.createElement("button",Object.assign({},ee,{type:v,className:IC,style:pC,onClick:Ye,disabled:ie,ref:he}),WC,Pe,Me&&de.createElement(Yf,{prefixCls:H}));return Rr(le)||(lC=de.createElement(RV,{component:"Button",disabled:se},lC)),E(lC)}),oc=Hf;oc.Group=YV;oc.__ANT_BUTTON=!0;var d0=u.createContext(null),Mm=[];function Nf(e,g){var l=u.useState(function(){if(!Fg())return null;var y=document.createElement("div");return y}),t=oe(l,1),I=t[0],i=u.useRef(!1),a=u.useContext(d0),r=u.useState(Mm),s=oe(r,2),d=s[0],J=s[1],Z=a||(i.current?void 0:function(y){J(function(G){var h=[y].concat(ye(G));return h})});function b(){I.parentElement||document.body.appendChild(I),i.current=!0}function p(){var y;(y=I.parentElement)===null||y===void 0||y.removeChild(I),i.current=!1}return kg(function(){return e?a?a(b):b():p(),p},[e]),kg(function(){d.length&&(d.forEach(function(y){return y()}),J(Mm))},[d]),[I,Z]}function zf(e){var g="rc-scrollbar-measure-".concat(Math.random().toString(36).substring(7)),l=document.createElement("div");l.id=g;var t=l.style;t.position="absolute",t.left="0",t.top="0",t.width="100px",t.height="100px",t.overflow="scroll";var I,i;if(e){var a=getComputedStyle(e);t.scrollbarColor=a.scrollbarColor,t.scrollbarWidth=a.scrollbarWidth;var r=getComputedStyle(e,"::-webkit-scrollbar"),s=parseInt(r.width,10),d=parseInt(r.height,10);try{var J=s?"width: ".concat(r.width,";"):"",Z=d?"height: ".concat(r.height,";"):"";en(`
#`.concat(g,`::-webkit-scrollbar {
`).concat(J,`
`).concat(Z,`
}`),g)}catch(y){console.error(y),I=s,i=d}}document.body.appendChild(l);var b=e&&I&&!isNaN(I)?I:l.offsetWidth-l.clientWidth,p=e&&i&&!isNaN(i)?i:l.offsetHeight-l.clientHeight;return document.body.removeChild(l),go(g),{width:b,height:p}}function Lf(e){return typeof document>"u"||!e||!(e instanceof Element)?{width:0,height:0}:zf(e)}function Uf(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var Mf="rc-util-locker-".concat(Date.now()),xm=0;function xf(e){var g=!!e,l=u.useState(function(){return xm+=1,"".concat(Mf,"_").concat(xm)}),t=oe(l,1),I=t[0];kg(function(){if(g){var i=Lf(document.body).width,a=Uf();en(`
html body {
  overflow-y: hidden;
  `.concat(a?"width: calc(100% - ".concat(i,"px);"):"",`
}`),I)}else go(I);return function(){go(I)}},[g,I])}var Tf=!1;function Df(e){return Tf}var Tm=function(g){return g===!1?!1:!Fg()||!g?null:typeof g=="string"?document.querySelector(g):typeof g=="function"?g():g},Rc=u.forwardRef(function(e,g){var l=e.open,t=e.autoLock,I=e.getContainer;e.debug;var i=e.autoDestroy,a=i===void 0?!0:i,r=e.children,s=u.useState(l),d=oe(s,2),J=d[0],Z=d[1],b=J||l;u.useEffect(function(){(a||l)&&Z(l)},[l,a]);var p=u.useState(function(){return Tm(I)}),y=oe(p,2),G=y[0],h=y[1];u.useEffect(function(){var M=Tm(I);h(M??null)});var f=Nf(b&&!G),W=oe(f,2),X=W[0],B=W[1],V=G??X;xf(t&&l&&Fg()&&(V===X||V===document.body));var Q=null;if(r&&yo(r)&&g){var v=r;Q=v.ref}var Y=Go(Q,g);if(!b||!Fg()||G===void 0)return null;var F=V===!1||Df(),L=r;return g&&(L=u.cloneElement(r,{ref:Y})),u.createElement(d0.Provider,{value:B},F?L:$t.createPortal(L,V))}),u0=u.createContext({});function Ef(){var e=O({},sc);return e.useId}var Dm=0,Em=Ef();const m0=Em?function(g){var l=Em();return g||l}:function(g){var l=u.useState("ssr-id"),t=oe(l,2),I=t[0],i=t[1];return u.useEffect(function(){var a=Dm;Dm+=1,i("rc_unique_".concat(a))},[]),g||I};function Om(e,g,l){var t=g;return!t&&l&&(t="".concat(e,"-").concat(l)),t}function Pm(e,g){var l=e["page".concat(g?"Y":"X","Offset")],t="scroll".concat(g?"Top":"Left");if(typeof l!="number"){var I=e.document;l=I.documentElement[t],typeof l!="number"&&(l=I.body[t])}return l}function Of(e){var g=e.getBoundingClientRect(),l={left:g.left,top:g.top},t=e.ownerDocument,I=t.defaultView||t.parentWindow;return l.left+=Pm(I),l.top+=Pm(I,!0),l}const Pf=u.memo(function(e){var g=e.children;return g},function(e,g){var l=g.shouldUpdate;return!l});var jf={width:0,height:0,overflow:"hidden",outline:"none"},$f={outline:"none"},qf=de.forwardRef(function(e,g){var l=e.prefixCls,t=e.className,I=e.style,i=e.title,a=e.ariaId,r=e.footer,s=e.closable,d=e.closeIcon,J=e.onClose,Z=e.children,b=e.bodyStyle,p=e.bodyProps,y=e.modalRender,G=e.onMouseDown,h=e.onMouseUp,f=e.holderRef,W=e.visible,X=e.forceRender,B=e.width,V=e.height,Q=e.classNames,v=e.styles,Y=de.useContext(u0),F=Y.panel,L=Go(f,F),M=u.useRef(),ee=u.useRef();de.useImperativeHandle(g,function(){return{focus:function(){var H;(H=M.current)===null||H===void 0||H.focus({preventScroll:!0})},changeActive:function(H){var E=document,j=E.activeElement;H&&j===ee.current?M.current.focus({preventScroll:!0}):!H&&j===M.current&&ee.current.focus({preventScroll:!0})}}});var q={};B!==void 0&&(q.width=B),V!==void 0&&(q.height=V);var P=r?de.createElement("div",{className:me("".concat(l,"-footer"),Q==null?void 0:Q.footer),style:O({},v==null?void 0:v.footer)},r):null,le=i?de.createElement("div",{className:me("".concat(l,"-header"),Q==null?void 0:Q.header),style:O({},v==null?void 0:v.header)},de.createElement("div",{className:"".concat(l,"-title"),id:a},i)):null,N=u.useMemo(function(){return Qe(s)==="object"&&s!==null?s:s?{closeIcon:d??de.createElement("span",{className:"".concat(l,"-close-x")})}:{}},[s,d,l]),w=Gc(N,!0),K=Qe(s)==="object"&&s.disabled,T=s?de.createElement("button",Be({type:"button",onClick:J,"aria-label":"Close"},w,{className:"".concat(l,"-close"),disabled:K}),N.closeIcon):null,z=de.createElement("div",{className:me("".concat(l,"-content"),Q==null?void 0:Q.content),style:v==null?void 0:v.content},T,le,de.createElement("div",Be({className:me("".concat(l,"-body"),Q==null?void 0:Q.body),style:O(O({},b),v==null?void 0:v.body)},p),Z),P);return de.createElement("div",{key:"dialog-element",role:"dialog","aria-labelledby":i?a:null,"aria-modal":"true",ref:L,style:O(O({},I),q),className:me(l,t),onMouseDown:G,onMouseUp:h},de.createElement("div",{ref:M,tabIndex:0,style:$f},de.createElement(Pf,{shouldUpdate:W||X},y?y(z):z)),de.createElement("div",{tabIndex:0,ref:ee,style:jf}))}),J0=u.forwardRef(function(e,g){var l=e.prefixCls,t=e.title,I=e.style,i=e.className,a=e.visible,r=e.forceRender,s=e.destroyOnClose,d=e.motionName,J=e.ariaId,Z=e.onVisibleChanged,b=e.mousePosition,p=u.useRef(),y=u.useState(),G=oe(y,2),h=G[0],f=G[1],W={};h&&(W.transformOrigin=h);function X(){var B=Of(p.current);f(b&&(b.x||b.y)?"".concat(b.x-B.left,"px ").concat(b.y-B.top,"px"):"")}return u.createElement(Nl,{visible:a,onVisibleChanged:Z,onAppearPrepare:X,onEnterPrepare:X,forceRender:r,motionName:d,removeOnLeave:s,ref:p},function(B,V){var Q=B.className,v=B.style;return u.createElement(qf,Be({},e,{ref:g,title:t,ariaId:J,prefixCls:l,holderRef:V,style:O(O(O({},v),I),W),className:me(i,Q)}))})});J0.displayName="Content";var _f=function(g){var l=g.prefixCls,t=g.style,I=g.visible,i=g.maskProps,a=g.motionName,r=g.className;return u.createElement(Nl,{key:"mask",visible:I,motionName:a,leavedClassName:"".concat(l,"-mask-hidden")},function(s,d){var J=s.className,Z=s.style;return u.createElement("div",Be({ref:d,style:O(O({},Z),t),className:me("".concat(l,"-mask"),J,r)},i))})},eX=function(g){var l=g.prefixCls,t=l===void 0?"rc-dialog":l,I=g.zIndex,i=g.visible,a=i===void 0?!1:i,r=g.keyboard,s=r===void 0?!0:r,d=g.focusTriggerAfterClose,J=d===void 0?!0:d,Z=g.wrapStyle,b=g.wrapClassName,p=g.wrapProps,y=g.onClose,G=g.afterOpenChange,h=g.afterClose,f=g.transitionName,W=g.animation,X=g.closable,B=X===void 0?!0:X,V=g.mask,Q=V===void 0?!0:V,v=g.maskTransitionName,Y=g.maskAnimation,F=g.maskClosable,L=F===void 0?!0:F,M=g.maskStyle,ee=g.maskProps,q=g.rootClassName,P=g.classNames,le=g.styles,N=u.useRef(),w=u.useRef(),K=u.useRef(),T=u.useState(a),z=oe(T,2),R=z[0],H=z[1],E=m0();function j(){CA(w.current,document.activeElement)||(N.current=document.activeElement)}function ge(){if(!CA(w.current,document.activeElement)){var he;(he=K.current)===null||he===void 0||he.focus()}}function ne(he){if(he)ge();else{if(H(!1),Q&&N.current&&J){try{N.current.focus({preventScroll:!0})}catch{}N.current=null}R&&(h==null||h())}G==null||G(he)}function ie(he){y==null||y(he)}var Ae=u.useRef(!1),ae=u.useRef(),se=function(){clearTimeout(ae.current),Ae.current=!0},ze=function(){ae.current=setTimeout(function(){Ae.current=!1})},We=null;L&&(We=function(Se){Ae.current?Ae.current=!1:w.current===Se.target&&ie(Se)});function Je(he){if(s&&he.keyCode===nI.ESC){he.stopPropagation(),ie(he);return}a&&he.keyCode===nI.TAB&&K.current.changeActive(!he.shiftKey)}u.useEffect(function(){a&&(H(!0),j())},[a]),u.useEffect(function(){return function(){clearTimeout(ae.current)}},[]);var ue=O(O(O({zIndex:I},Z),le==null?void 0:le.wrapper),{},{display:R?null:"none"});return u.createElement("div",Be({className:me("".concat(t,"-root"),q)},Gc(g,{data:!0})),u.createElement(_f,{prefixCls:t,visible:Q&&a,motionName:Om(t,v,Y),style:O(O({zIndex:I},M),le==null?void 0:le.mask),maskProps:ee,className:P==null?void 0:P.mask}),u.createElement("div",Be({tabIndex:-1,onKeyDown:Je,className:me("".concat(t,"-wrap"),b,P==null?void 0:P.wrapper),ref:w,onClick:We,style:ue},p),u.createElement(J0,Be({},g,{onMouseDown:se,onMouseUp:ze,ref:K,closable:B,ariaId:E,prefixCls:t,visible:a&&R,onClose:ie,onVisibleChanged:ne,motionName:Om(t,f,W)}))))},Z0=function(g){var l=g.visible,t=g.getContainer,I=g.forceRender,i=g.destroyOnClose,a=i===void 0?!1:i,r=g.afterClose,s=g.panelRef,d=u.useState(l),J=oe(d,2),Z=J[0],b=J[1],p=u.useMemo(function(){return{panel:s}},[s]);return u.useEffect(function(){l&&b(!0)},[l]),!I&&a&&!Z?null:u.createElement(u0.Provider,{value:p},u.createElement(Rc,{open:l||I||Z,autoDestroy:!1,getContainer:t,autoLock:l||Z},u.createElement(eX,Be({},g,{destroyOnClose:a,afterClose:function(){r==null||r(),b(!1)}}))))};Z0.displayName="Dialog";var et="RC_FORM_INTERNAL_HOOKS",JC=function(){Yg(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},tI=u.createContext({getFieldValue:JC,getFieldsValue:JC,getFieldError:JC,getFieldWarning:JC,getFieldsError:JC,isFieldsTouched:JC,isFieldTouched:JC,isFieldValidating:JC,isFieldsValidating:JC,resetFields:JC,setFields:JC,setFieldValue:JC,setFieldsValue:JC,validateFields:JC,submit:JC,getInternalHooks:function(){return JC(),{dispatch:JC,initEntityValue:JC,registerField:JC,useSubscribe:JC,setInitialValues:JC,destroyForm:JC,setCallbacks:JC,registerWatch:JC,getFields:JC,setValidateMessages:JC,setPreserve:JC,getInitialValue:JC}}}),ic=u.createContext(null);function kA(e){return e==null?[]:Array.isArray(e)?e:[e]}function CX(e){return e&&!!e._init}function pA(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var g=JSON.parse(JSON.stringify(this));return g.clone=this.clone,g}}}var WA=pA();function gX(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function lX(e,g,l){if(OA())return Reflect.construct.apply(null,arguments);var t=[null];t.push.apply(t,g);var I=new(e.bind.apply(e,t));return l&&to(I,l.prototype),I}function VA(e){var g=typeof Map=="function"?new Map:void 0;return VA=function(t){if(t===null||!gX(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(g!==void 0){if(g.has(t))return g.get(t);g.set(t,I)}function I(){return lX(t,arguments,Io(this).constructor)}return I.prototype=Object.create(t.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),to(I,t)},VA(e)}var nX=/%[sdj%]/g,tX=function(){};function fA(e){if(!e||!e.length)return null;var g={};return e.forEach(function(l){var t=l.field;g[t]=g[t]||[],g[t].push(l)}),g}function qg(e){for(var g=arguments.length,l=new Array(g>1?g-1:0),t=1;t<g;t++)l[t-1]=arguments[t];var I=0,i=l.length;if(typeof e=="function")return e.apply(null,l);if(typeof e=="string"){var a=e.replace(nX,function(r){if(r==="%%")return"%";if(I>=i)return r;switch(r){case"%s":return String(l[I++]);case"%d":return Number(l[I++]);case"%j":try{return JSON.stringify(l[I++])}catch{return"[Circular]"}break;default:return r}});return a}return e}function IX(e){return e==="string"||e==="url"||e==="hex"||e==="email"||e==="date"||e==="pattern"}function qC(e,g){return!!(e==null||g==="array"&&Array.isArray(e)&&!e.length||IX(g)&&typeof e=="string"&&!e)}function oX(e,g,l){var t=[],I=0,i=e.length;function a(r){t.push.apply(t,ye(r||[])),I++,I===i&&l(t)}e.forEach(function(r){g(r,a)})}function jm(e,g,l){var t=0,I=e.length;function i(a){if(a&&a.length){l(a);return}var r=t;t=t+1,r<I?g(e[r],i):l([])}i([])}function iX(e){var g=[];return Object.keys(e).forEach(function(l){g.push.apply(g,ye(e[l]||[]))}),g}var $m=function(e){wl(l,e);var g=Hl(l);function l(t,I){var i;return DC(this,l),i=g.call(this,"Async Validation Error"),D(Ne(i),"errors",void 0),D(Ne(i),"fields",void 0),i.errors=t,i.fields=I,i}return EC(l)}(VA(Error));function cX(e,g,l,t,I){if(g.first){var i=new Promise(function(b,p){var y=function(f){return t(f),f.length?p(new $m(f,fA(f))):b(I)},G=iX(e);jm(G,l,y)});return i.catch(function(b){return b}),i}var a=g.firstFields===!0?Object.keys(e):g.firstFields||[],r=Object.keys(e),s=r.length,d=0,J=[],Z=new Promise(function(b,p){var y=function(h){if(J.push.apply(J,h),d++,d===s)return t(J),J.length?p(new $m(J,fA(J))):b(I)};r.length||(t(J),b(I)),r.forEach(function(G){var h=e[G];a.indexOf(G)!==-1?jm(h,l,y):oX(h,l,y)})});return Z.catch(function(b){return b}),Z}function aX(e){return!!(e&&e.message!==void 0)}function rX(e,g){for(var l=e,t=0;t<g.length;t++){if(l==null)return l;l=l[g[t]]}return l}function qm(e,g){return function(l){var t;return e.fullFields?t=rX(g,e.fullFields):t=g[l.field||e.fullField],aX(l)?(l.field=l.field||e.fullField,l.fieldValue=t,l):{message:typeof l=="function"?l():l,fieldValue:t,field:l.field||e.fullField}}}function _m(e,g){if(g){for(var l in g)if(g.hasOwnProperty(l)){var t=g[l];Qe(t)==="object"&&Qe(e[l])==="object"?e[l]=O(O({},e[l]),t):e[l]=t}}return e}var Ft="enum",AX=function(g,l,t,I,i){g[Ft]=Array.isArray(g[Ft])?g[Ft]:[],g[Ft].indexOf(l)===-1&&I.push(qg(i.messages[Ft],g.fullField,g[Ft].join(", ")))},sX=function(g,l,t,I,i){if(g.pattern){if(g.pattern instanceof RegExp)g.pattern.lastIndex=0,g.pattern.test(l)||I.push(qg(i.messages.pattern.mismatch,g.fullField,l,g.pattern));else if(typeof g.pattern=="string"){var a=new RegExp(g.pattern);a.test(l)||I.push(qg(i.messages.pattern.mismatch,g.fullField,l,g.pattern))}}},dX=function(g,l,t,I,i){var a=typeof g.len=="number",r=typeof g.min=="number",s=typeof g.max=="number",d=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,J=l,Z=null,b=typeof l=="number",p=typeof l=="string",y=Array.isArray(l);if(b?Z="number":p?Z="string":y&&(Z="array"),!Z)return!1;y&&(J=l.length),p&&(J=l.replace(d,"_").length),a?J!==g.len&&I.push(qg(i.messages[Z].len,g.fullField,g.len)):r&&!s&&J<g.min?I.push(qg(i.messages[Z].min,g.fullField,g.min)):s&&!r&&J>g.max?I.push(qg(i.messages[Z].max,g.fullField,g.max)):r&&s&&(J<g.min||J>g.max)&&I.push(qg(i.messages[Z].range,g.fullField,g.min,g.max))},b0=function(g,l,t,I,i,a){g.required&&(!t.hasOwnProperty(g.field)||qC(l,a||g.type))&&I.push(qg(i.messages.required,g.fullField))},Ki;const uX=function(){if(Ki)return Ki;var e="[a-fA-F\\d:]",g=function(Q){return Q&&Q.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(e,")|(?<=").concat(e,")(?=\\s|$))"):""},l="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",t="[a-fA-F\\d]{1,4}",I=["(?:".concat(t,":){7}(?:").concat(t,"|:)"),"(?:".concat(t,":){6}(?:").concat(l,"|:").concat(t,"|:)"),"(?:".concat(t,":){5}(?::").concat(l,"|(?::").concat(t,"){1,2}|:)"),"(?:".concat(t,":){4}(?:(?::").concat(t,"){0,1}:").concat(l,"|(?::").concat(t,"){1,3}|:)"),"(?:".concat(t,":){3}(?:(?::").concat(t,"){0,2}:").concat(l,"|(?::").concat(t,"){1,4}|:)"),"(?:".concat(t,":){2}(?:(?::").concat(t,"){0,3}:").concat(l,"|(?::").concat(t,"){1,5}|:)"),"(?:".concat(t,":){1}(?:(?::").concat(t,"){0,4}:").concat(l,"|(?::").concat(t,"){1,6}|:)"),"(?::(?:(?::".concat(t,"){0,5}:").concat(l,"|(?::").concat(t,"){1,7}|:))")],i="(?:%[0-9a-zA-Z]{1,})?",a="(?:".concat(I.join("|"),")").concat(i),r=new RegExp("(?:^".concat(l,"$)|(?:^").concat(a,"$)")),s=new RegExp("^".concat(l,"$")),d=new RegExp("^".concat(a,"$")),J=function(Q){return Q&&Q.exact?r:new RegExp("(?:".concat(g(Q)).concat(l).concat(g(Q),")|(?:").concat(g(Q)).concat(a).concat(g(Q),")"),"g")};J.v4=function(V){return V&&V.exact?s:new RegExp("".concat(g(V)).concat(l).concat(g(V)),"g")},J.v6=function(V){return V&&V.exact?d:new RegExp("".concat(g(V)).concat(a).concat(g(V)),"g")};var Z="(?:(?:[a-z]+:)?//)",b="(?:\\S+(?::\\S*)?@)?",p=J.v4().source,y=J.v6().source,G="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",h="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",f="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",W="(?::\\d{2,5})?",X='(?:[/?#][^\\s"]*)?',B="(?:".concat(Z,"|www\\.)").concat(b,"(?:localhost|").concat(p,"|").concat(y,"|").concat(G).concat(h).concat(f,")").concat(W).concat(X);return Ki=new RegExp("(?:^".concat(B,"$)"),"i"),Ki};var eJ={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},OI={integer:function(g){return OI.number(g)&&parseInt(g,10)===g},float:function(g){return OI.number(g)&&!OI.integer(g)},array:function(g){return Array.isArray(g)},regexp:function(g){if(g instanceof RegExp)return!0;try{return!!new RegExp(g)}catch{return!1}},date:function(g){return typeof g.getTime=="function"&&typeof g.getMonth=="function"&&typeof g.getYear=="function"&&!isNaN(g.getTime())},number:function(g){return isNaN(g)?!1:typeof g=="number"},object:function(g){return Qe(g)==="object"&&!OI.array(g)},method:function(g){return typeof g=="function"},email:function(g){return typeof g=="string"&&g.length<=320&&!!g.match(eJ.email)},url:function(g){return typeof g=="string"&&g.length<=2048&&!!g.match(uX())},hex:function(g){return typeof g=="string"&&!!g.match(eJ.hex)}},mX=function(g,l,t,I,i){if(g.required&&l===void 0){b0(g,l,t,I,i);return}var a=["integer","float","array","regexp","object","method","email","number","date","url","hex"],r=g.type;a.indexOf(r)>-1?OI[r](l)||I.push(qg(i.messages.types[r],g.fullField,g.type)):r&&Qe(l)!==g.type&&I.push(qg(i.messages.types[r],g.fullField,g.type))},JX=function(g,l,t,I,i){(/^\s+$/.test(l)||l==="")&&I.push(qg(i.messages.whitespace,g.fullField))};const CC={required:b0,whitespace:JX,type:mX,range:dX,enum:AX,pattern:sX};var ZX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i)}t(a)},bX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(l==null&&!g.required)return t();CC.required(g,l,I,a,i,"array"),l!=null&&(CC.type(g,l,I,a,i),CC.range(g,l,I,a,i))}t(a)},hX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&CC.type(g,l,I,a,i)}t(a)},GX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l,"date")&&!g.required)return t();if(CC.required(g,l,I,a,i),!qC(l,"date")){var s;l instanceof Date?s=l:s=new Date(l),CC.type(g,s,I,a,i),s&&CC.range(g,s.getTime(),I,a,i)}}t(a)},yX="enum",kX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&CC[yX](g,l,I,a,i)}t(a)},pX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&(CC.type(g,l,I,a,i),CC.range(g,l,I,a,i))}t(a)},WX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&(CC.type(g,l,I,a,i),CC.range(g,l,I,a,i))}t(a)},VX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&CC.type(g,l,I,a,i)}t(a)},fX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(l===""&&(l=void 0),qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&(CC.type(g,l,I,a,i),CC.range(g,l,I,a,i))}t(a)},XX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),l!==void 0&&CC.type(g,l,I,a,i)}t(a)},RX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l,"string")&&!g.required)return t();CC.required(g,l,I,a,i),qC(l,"string")||CC.pattern(g,l,I,a,i)}t(a)},QX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l)&&!g.required)return t();CC.required(g,l,I,a,i),qC(l)||CC.type(g,l,I,a,i)}t(a)},vX=function(g,l,t,I,i){var a=[],r=Array.isArray(l)?"array":Qe(l);CC.required(g,l,I,a,i,r),t(a)},BX=function(g,l,t,I,i){var a=[],r=g.required||!g.required&&I.hasOwnProperty(g.field);if(r){if(qC(l,"string")&&!g.required)return t();CC.required(g,l,I,a,i,"string"),qC(l,"string")||(CC.type(g,l,I,a,i),CC.range(g,l,I,a,i),CC.pattern(g,l,I,a,i),g.whitespace===!0&&CC.whitespace(g,l,I,a,i))}t(a)},Sr=function(g,l,t,I,i){var a=g.type,r=[],s=g.required||!g.required&&I.hasOwnProperty(g.field);if(s){if(qC(l,a)&&!g.required)return t();CC.required(g,l,I,r,i,a),qC(l,a)||CC.type(g,l,I,r,i)}t(r)};const eo={string:BX,method:VX,number:fX,boolean:hX,regexp:QX,integer:WX,float:pX,array:bX,object:XX,enum:kX,pattern:RX,date:GX,url:Sr,hex:Sr,email:Sr,required:vX,any:ZX};var Vo=function(){function e(g){DC(this,e),D(this,"rules",null),D(this,"_messages",WA),this.define(g)}return EC(e,[{key:"define",value:function(l){var t=this;if(!l)throw new Error("Cannot configure a schema with no rules");if(Qe(l)!=="object"||Array.isArray(l))throw new Error("Rules must be an object");this.rules={},Object.keys(l).forEach(function(I){var i=l[I];t.rules[I]=Array.isArray(i)?i:[i]})}},{key:"messages",value:function(l){return l&&(this._messages=_m(pA(),l)),this._messages}},{key:"validate",value:function(l){var t=this,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},a=l,r=I,s=i;if(typeof r=="function"&&(s=r,r={}),!this.rules||Object.keys(this.rules).length===0)return s&&s(null,a),Promise.resolve(a);function d(y){var G=[],h={};function f(X){if(Array.isArray(X)){var B;G=(B=G).concat.apply(B,ye(X))}else G.push(X)}for(var W=0;W<y.length;W++)f(y[W]);G.length?(h=fA(G),s(G,h)):s(null,a)}if(r.messages){var J=this.messages();J===WA&&(J=pA()),_m(J,r.messages),r.messages=J}else r.messages=this.messages();var Z={},b=r.keys||Object.keys(this.rules);b.forEach(function(y){var G=t.rules[y],h=a[y];G.forEach(function(f){var W=f;typeof W.transform=="function"&&(a===l&&(a=O({},a)),h=a[y]=W.transform(h),h!=null&&(W.type=W.type||(Array.isArray(h)?"array":Qe(h)))),typeof W=="function"?W={validator:W}:W=O({},W),W.validator=t.getValidationMethod(W),W.validator&&(W.field=y,W.fullField=W.fullField||y,W.type=t.getType(W),Z[y]=Z[y]||[],Z[y].push({rule:W,value:h,source:a,field:y}))})});var p={};return cX(Z,r,function(y,G){var h=y.rule,f=(h.type==="object"||h.type==="array")&&(Qe(h.fields)==="object"||Qe(h.defaultField)==="object");f=f&&(h.required||!h.required&&y.value),h.field=y.field;function W(v,Y){return O(O({},Y),{},{fullField:"".concat(h.fullField,".").concat(v),fullFields:h.fullFields?[].concat(ye(h.fullFields),[v]):[v]})}function X(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Y=Array.isArray(v)?v:[v];!r.suppressWarning&&Y.length&&e.warning("async-validator:",Y),Y.length&&h.message!==void 0&&(Y=[].concat(h.message));var F=Y.map(qm(h,a));if(r.first&&F.length)return p[h.field]=1,G(F);if(!f)G(F);else{if(h.required&&!y.value)return h.message!==void 0?F=[].concat(h.message).map(qm(h,a)):r.error&&(F=[r.error(h,qg(r.messages.required,h.field))]),G(F);var L={};h.defaultField&&Object.keys(y.value).map(function(q){L[q]=h.defaultField}),L=O(O({},L),y.rule.fields);var M={};Object.keys(L).forEach(function(q){var P=L[q],le=Array.isArray(P)?P:[P];M[q]=le.map(W.bind(null,q))});var ee=new e(M);ee.messages(r.messages),y.rule.options&&(y.rule.options.messages=r.messages,y.rule.options.error=r.error),ee.validate(y.value,y.rule.options||r,function(q){var P=[];F&&F.length&&P.push.apply(P,ye(F)),q&&q.length&&P.push.apply(P,ye(q)),G(P.length?P:null)})}}var B;if(h.asyncValidator)B=h.asyncValidator(h,y.value,X,y.source,r);else if(h.validator){try{B=h.validator(h,y.value,X,y.source,r)}catch(v){var V,Q;(V=(Q=console).error)===null||V===void 0||V.call(Q,v),r.suppressValidatorError||setTimeout(function(){throw v},0),X(v.message)}B===!0?X():B===!1?X(typeof h.message=="function"?h.message(h.fullField||h.field):h.message||"".concat(h.fullField||h.field," fails")):B instanceof Array?X(B):B instanceof Error&&X(B.message)}B&&B.then&&B.then(function(){return X()},function(v){return X(v)})},function(y){d(y)},a)}},{key:"getType",value:function(l){if(l.type===void 0&&l.pattern instanceof RegExp&&(l.type="pattern"),typeof l.validator!="function"&&l.type&&!eo.hasOwnProperty(l.type))throw new Error(qg("Unknown rule type %s",l.type));return l.type||"string"}},{key:"getValidationMethod",value:function(l){if(typeof l.validator=="function")return l.validator;var t=Object.keys(l),I=t.indexOf("message");return I!==-1&&t.splice(I,1),t.length===1&&t[0]==="required"?eo.required:eo[this.getType(l)]||void 0}}]),e}();D(Vo,"register",function(g,l){if(typeof l!="function")throw new Error("Cannot register a validator by type, validator is not a function");eo[g]=l});D(Vo,"warning",tX);D(Vo,"messages",WA);D(Vo,"validators",eo);var Pg="'${name}' is not a valid ${type}",h0={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:Pg,method:Pg,array:Pg,object:Pg,number:Pg,date:Pg,boolean:Pg,integer:Pg,float:Pg,regexp:Pg,email:Pg,url:Pg,hex:Pg},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},CJ=Vo;function SX(e,g){return e.replace(/\\?\$\{\w+\}/g,function(l){if(l.startsWith("\\"))return l.slice(1);var t=l.slice(2,-1);return g[t]})}var gJ="CODE_LOGIC_ERROR";function XA(e,g,l,t,I){return RA.apply(this,arguments)}function RA(){return RA=$g(bC().mark(function e(g,l,t,I,i){var a,r,s,d,J,Z,b,p,y;return bC().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return a=O({},t),delete a.ruleIndex,CJ.warning=function(){},a.validator&&(r=a.validator,a.validator=function(){try{return r.apply(void 0,arguments)}catch(f){return console.error(f),Promise.reject(gJ)}}),s=null,a&&a.type==="array"&&a.defaultField&&(s=a.defaultField,delete a.defaultField),d=new CJ(D({},g,[a])),J=Ut(h0,I.validateMessages),d.messages(J),Z=[],h.prev=10,h.next=13,Promise.resolve(d.validate(D({},g,l),O({},I)));case 13:h.next=18;break;case 15:h.prev=15,h.t0=h.catch(10),h.t0.errors&&(Z=h.t0.errors.map(function(f,W){var X=f.message,B=X===gJ?J.default:X;return u.isValidElement(B)?u.cloneElement(B,{key:"error_".concat(W)}):B}));case 18:if(!(!Z.length&&s)){h.next=23;break}return h.next=21,Promise.all(l.map(function(f,W){return XA("".concat(g,".").concat(W),f,s,I,i)}));case 21:return b=h.sent,h.abrupt("return",b.reduce(function(f,W){return[].concat(ye(f),ye(W))},[]));case 23:return p=O(O({},t),{},{name:g,enum:(t.enum||[]).join(", ")},i),y=Z.map(function(f){return typeof f=="string"?SX(f,p):f}),h.abrupt("return",y);case 26:case"end":return h.stop()}},e,null,[[10,15]])})),RA.apply(this,arguments)}function YX(e,g,l,t,I,i){var a=e.join("."),r=l.map(function(J,Z){var b=J.validator,p=O(O({},J),{},{ruleIndex:Z});return b&&(p.validator=function(y,G,h){var f=!1,W=function(){for(var V=arguments.length,Q=new Array(V),v=0;v<V;v++)Q[v]=arguments[v];Promise.resolve().then(function(){Yg(!f,"Your validator function has already return a promise. `callback` will be ignored."),f||h.apply(void 0,Q)})},X=b(y,G,W);f=X&&typeof X.then=="function"&&typeof X.catch=="function",Yg(f,"`callback` is deprecated. Please return a promise instead."),f&&X.then(function(){h()}).catch(function(B){h(B||" ")})}),p}).sort(function(J,Z){var b=J.warningOnly,p=J.ruleIndex,y=Z.warningOnly,G=Z.ruleIndex;return!!b==!!y?p-G:b?1:-1}),s;if(I===!0)s=new Promise(function(){var J=$g(bC().mark(function Z(b,p){var y,G,h;return bC().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:y=0;case 1:if(!(y<r.length)){W.next=12;break}return G=r[y],W.next=5,XA(a,g,G,t,i);case 5:if(h=W.sent,!h.length){W.next=9;break}return p([{errors:h,rule:G}]),W.abrupt("return");case 9:y+=1,W.next=1;break;case 12:b([]);case 13:case"end":return W.stop()}},Z)}));return function(Z,b){return J.apply(this,arguments)}}());else{var d=r.map(function(J){return XA(a,g,J,t,i).then(function(Z){return{errors:Z,rule:J}})});s=(I?KX(d):FX(d)).then(function(J){return Promise.reject(J)})}return s.catch(function(J){return J}),s}function FX(e){return QA.apply(this,arguments)}function QA(){return QA=$g(bC().mark(function e(g){return bC().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(g).then(function(I){var i,a=(i=[]).concat.apply(i,ye(I));return a}));case 1:case"end":return t.stop()}},e)})),QA.apply(this,arguments)}function KX(e){return vA.apply(this,arguments)}function vA(){return vA=$g(bC().mark(function e(g){var l;return bC().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return l=0,I.abrupt("return",new Promise(function(i){g.forEach(function(a){a.then(function(r){r.errors.length&&i([r]),l+=1,l===g.length&&i([])})})}));case 2:case"end":return I.stop()}},e)})),vA.apply(this,arguments)}function NC(e){return kA(e)}function lJ(e,g){var l={};return g.forEach(function(t){var I=Kl(e,t);l=pl(l,t,I)}),l}function Pt(e,g){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e&&e.some(function(t){return G0(g,t,l)})}function G0(e,g){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return!e||!g||!l&&e.length!==g.length?!1:g.every(function(t,I){return e[I]===t})}function wX(e,g){if(e===g)return!0;if(!e&&g||e&&!g||!e||!g||Qe(e)!=="object"||Qe(g)!=="object")return!1;var l=Object.keys(e),t=Object.keys(g),I=new Set([].concat(l,t));return ye(I).every(function(i){var a=e[i],r=g[i];return typeof a=="function"&&typeof r=="function"?!0:a===r})}function HX(e){var g=arguments.length<=1?void 0:arguments[1];return g&&g.target&&Qe(g.target)==="object"&&e in g.target?g.target[e]:g}function nJ(e,g,l){var t=e.length;if(g<0||g>=t||l<0||l>=t)return e;var I=e[g],i=g-l;return i>0?[].concat(ye(e.slice(0,l)),[I],ye(e.slice(l,g)),ye(e.slice(g+1,t))):i<0?[].concat(ye(e.slice(0,g)),ye(e.slice(g+1,l+1)),[I],ye(e.slice(l+1,t))):e}var NX=["name"],al=[];function Yr(e,g,l,t,I,i){return typeof e=="function"?e(g,l,"source"in i?{source:i.source}:{}):t!==I}var As=function(e){wl(l,e);var g=Hl(l);function l(t){var I;if(DC(this,l),I=g.call(this,t),D(Ne(I),"state",{resetCount:0}),D(Ne(I),"cancelRegisterFunc",null),D(Ne(I),"mounted",!1),D(Ne(I),"touched",!1),D(Ne(I),"dirty",!1),D(Ne(I),"validatePromise",void 0),D(Ne(I),"prevValidating",void 0),D(Ne(I),"errors",al),D(Ne(I),"warnings",al),D(Ne(I),"cancelRegister",function(){var s=I.props,d=s.preserve,J=s.isListField,Z=s.name;I.cancelRegisterFunc&&I.cancelRegisterFunc(J,d,NC(Z)),I.cancelRegisterFunc=null}),D(Ne(I),"getNamePath",function(){var s=I.props,d=s.name,J=s.fieldContext,Z=J.prefixName,b=Z===void 0?[]:Z;return d!==void 0?[].concat(ye(b),ye(d)):[]}),D(Ne(I),"getRules",function(){var s=I.props,d=s.rules,J=d===void 0?[]:d,Z=s.fieldContext;return J.map(function(b){return typeof b=="function"?b(Z):b})}),D(Ne(I),"refresh",function(){I.mounted&&I.setState(function(s){var d=s.resetCount;return{resetCount:d+1}})}),D(Ne(I),"metaCache",null),D(Ne(I),"triggerMetaEvent",function(s){var d=I.props.onMetaChange;if(d){var J=O(O({},I.getMeta()),{},{destroy:s});lc(I.metaCache,J)||d(J),I.metaCache=J}else I.metaCache=null}),D(Ne(I),"onStoreChange",function(s,d,J){var Z=I.props,b=Z.shouldUpdate,p=Z.dependencies,y=p===void 0?[]:p,G=Z.onReset,h=J.store,f=I.getNamePath(),W=I.getValue(s),X=I.getValue(h),B=d&&Pt(d,f);switch(J.type==="valueUpdate"&&J.source==="external"&&!lc(W,X)&&(I.touched=!0,I.dirty=!0,I.validatePromise=null,I.errors=al,I.warnings=al,I.triggerMetaEvent()),J.type){case"reset":if(!d||B){I.touched=!1,I.dirty=!1,I.validatePromise=void 0,I.errors=al,I.warnings=al,I.triggerMetaEvent(),G==null||G(),I.refresh();return}break;case"remove":{if(b&&Yr(b,s,h,W,X,J)){I.reRender();return}break}case"setField":{var V=J.data;if(B){"touched"in V&&(I.touched=V.touched),"validating"in V&&!("originRCField"in V)&&(I.validatePromise=V.validating?Promise.resolve([]):null),"errors"in V&&(I.errors=V.errors||al),"warnings"in V&&(I.warnings=V.warnings||al),I.dirty=!0,I.triggerMetaEvent(),I.reRender();return}else if("value"in V&&Pt(d,f,!0)){I.reRender();return}if(b&&!f.length&&Yr(b,s,h,W,X,J)){I.reRender();return}break}case"dependenciesUpdate":{var Q=y.map(NC);if(Q.some(function(v){return Pt(J.relatedFields,v)})){I.reRender();return}break}default:if(B||(!y.length||f.length||b)&&Yr(b,s,h,W,X,J)){I.reRender();return}break}b===!0&&I.reRender()}),D(Ne(I),"validateRules",function(s){var d=I.getNamePath(),J=I.getValue(),Z=s||{},b=Z.triggerName,p=Z.validateOnly,y=p===void 0?!1:p,G=Promise.resolve().then($g(bC().mark(function h(){var f,W,X,B,V,Q,v;return bC().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(I.mounted){F.next=2;break}return F.abrupt("return",[]);case 2:if(f=I.props,W=f.validateFirst,X=W===void 0?!1:W,B=f.messageVariables,V=f.validateDebounce,Q=I.getRules(),b&&(Q=Q.filter(function(L){return L}).filter(function(L){var M=L.validateTrigger;if(!M)return!0;var ee=kA(M);return ee.includes(b)})),!(V&&b)){F.next=10;break}return F.next=8,new Promise(function(L){setTimeout(L,V)});case 8:if(I.validatePromise===G){F.next=10;break}return F.abrupt("return",[]);case 10:return v=YX(d,J,Q,s,X,B),v.catch(function(L){return L}).then(function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:al;if(I.validatePromise===G){var M;I.validatePromise=null;var ee=[],q=[];(M=L.forEach)===null||M===void 0||M.call(L,function(P){var le=P.rule.warningOnly,N=P.errors,w=N===void 0?al:N;le?q.push.apply(q,ye(w)):ee.push.apply(ee,ye(w))}),I.errors=ee,I.warnings=q,I.triggerMetaEvent(),I.reRender()}}),F.abrupt("return",v);case 13:case"end":return F.stop()}},h)})));return y||(I.validatePromise=G,I.dirty=!0,I.errors=al,I.warnings=al,I.triggerMetaEvent(),I.reRender()),G}),D(Ne(I),"isFieldValidating",function(){return!!I.validatePromise}),D(Ne(I),"isFieldTouched",function(){return I.touched}),D(Ne(I),"isFieldDirty",function(){if(I.dirty||I.props.initialValue!==void 0)return!0;var s=I.props.fieldContext,d=s.getInternalHooks(et),J=d.getInitialValue;return J(I.getNamePath())!==void 0}),D(Ne(I),"getErrors",function(){return I.errors}),D(Ne(I),"getWarnings",function(){return I.warnings}),D(Ne(I),"isListField",function(){return I.props.isListField}),D(Ne(I),"isList",function(){return I.props.isList}),D(Ne(I),"isPreserve",function(){return I.props.preserve}),D(Ne(I),"getMeta",function(){I.prevValidating=I.isFieldValidating();var s={touched:I.isFieldTouched(),validating:I.prevValidating,errors:I.errors,warnings:I.warnings,name:I.getNamePath(),validated:I.validatePromise===null};return s}),D(Ne(I),"getOnlyChild",function(s){if(typeof s=="function"){var d=I.getMeta();return O(O({},I.getOnlyChild(s(I.getControlled(),d,I.props.fieldContext))),{},{isFunction:!0})}var J=ec(s);return J.length!==1||!u.isValidElement(J[0])?{child:J,isFunction:!1}:{child:J[0],isFunction:!1}}),D(Ne(I),"getValue",function(s){var d=I.props.fieldContext.getFieldsValue,J=I.getNamePath();return Kl(s||d(!0),J)}),D(Ne(I),"getControlled",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=I.props,J=d.name,Z=d.trigger,b=d.validateTrigger,p=d.getValueFromEvent,y=d.normalize,G=d.valuePropName,h=d.getValueProps,f=d.fieldContext,W=b!==void 0?b:f.validateTrigger,X=I.getNamePath(),B=f.getInternalHooks,V=f.getFieldsValue,Q=B(et),v=Q.dispatch,Y=I.getValue(),F=h||function(P){return D({},G,P)},L=s[Z],M=J!==void 0?F(Y):{},ee=O(O({},s),M);ee[Z]=function(){I.touched=!0,I.dirty=!0,I.triggerMetaEvent();for(var P,le=arguments.length,N=new Array(le),w=0;w<le;w++)N[w]=arguments[w];p?P=p.apply(void 0,N):P=HX.apply(void 0,[G].concat(N)),y&&(P=y(P,Y,V(!0))),P!==Y&&v({type:"updateValue",namePath:X,value:P}),L&&L.apply(void 0,N)};var q=kA(W||[]);return q.forEach(function(P){var le=ee[P];ee[P]=function(){le&&le.apply(void 0,arguments);var N=I.props.rules;N&&N.length&&v({type:"validateField",namePath:X,triggerName:P})}}),ee}),t.fieldContext){var i=t.fieldContext.getInternalHooks,a=i(et),r=a.initEntityValue;r(Ne(I))}return I}return EC(l,[{key:"componentDidMount",value:function(){var I=this.props,i=I.shouldUpdate,a=I.fieldContext;if(this.mounted=!0,a){var r=a.getInternalHooks,s=r(et),d=s.registerField;this.cancelRegisterFunc=d(this)}i===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var I=this.state.resetCount,i=this.props.children,a=this.getOnlyChild(i),r=a.child,s=a.isFunction,d;return s?d=r:u.isValidElement(r)?d=u.cloneElement(r,this.getControlled(r.props)):(Yg(!r,"`children` of Field is not validate ReactElement."),d=r),u.createElement(u.Fragment,{key:I},d)}}]),l}(u.Component);D(As,"contextType",tI);D(As,"defaultProps",{trigger:"onChange",valuePropName:"value"});function y0(e){var g,l=e.name,t=wC(e,NX),I=u.useContext(tI),i=u.useContext(ic),a=l!==void 0?NC(l):void 0,r=(g=t.isListField)!==null&&g!==void 0?g:!!i,s="keep";return r||(s="_".concat((a||[]).join("_"))),u.createElement(As,Be({key:s,name:a,isListField:r},t,{fieldContext:I}))}function zX(e){var g=e.name,l=e.initialValue,t=e.children,I=e.rules,i=e.validateTrigger,a=e.isListField,r=u.useContext(tI),s=u.useContext(ic),d=u.useRef({keys:[],id:0}),J=d.current,Z=u.useMemo(function(){var G=NC(r.prefixName)||[];return[].concat(ye(G),ye(NC(g)))},[r.prefixName,g]),b=u.useMemo(function(){return O(O({},r),{},{prefixName:Z})},[r,Z]),p=u.useMemo(function(){return{getKey:function(h){var f=Z.length,W=h[f];return[J.keys[W],h.slice(f+1)]}}},[Z]);if(typeof t!="function")return Yg(!1,"Form.List only accepts function as children."),null;var y=function(h,f,W){var X=W.source;return X==="internal"?!1:h!==f};return u.createElement(ic.Provider,{value:p},u.createElement(tI.Provider,{value:b},u.createElement(y0,{name:[],shouldUpdate:y,rules:I,validateTrigger:i,initialValue:l,isList:!0,isListField:a??!!s},function(G,h){var f=G.value,W=f===void 0?[]:f,X=G.onChange,B=r.getFieldValue,V=function(){var F=B(Z||[]);return F||[]},Q={add:function(F,L){var M=V();L>=0&&L<=M.length?(J.keys=[].concat(ye(J.keys.slice(0,L)),[J.id],ye(J.keys.slice(L))),X([].concat(ye(M.slice(0,L)),[F],ye(M.slice(L))))):(J.keys=[].concat(ye(J.keys),[J.id]),X([].concat(ye(M),[F]))),J.id+=1},remove:function(F){var L=V(),M=new Set(Array.isArray(F)?F:[F]);M.size<=0||(J.keys=J.keys.filter(function(ee,q){return!M.has(q)}),X(L.filter(function(ee,q){return!M.has(q)})))},move:function(F,L){if(F!==L){var M=V();F<0||F>=M.length||L<0||L>=M.length||(J.keys=nJ(J.keys,F,L),X(nJ(M,F,L)))}}},v=W||[];return Array.isArray(v)||(v=[]),t(v.map(function(Y,F){var L=J.keys[F];return L===void 0&&(J.keys[F]=J.id,L=J.keys[F],J.id+=1),{name:F,key:L,isListField:!0}}),Q,h)})))}function LX(e){var g=!1,l=e.length,t=[];return e.length?new Promise(function(I,i){e.forEach(function(a,r){a.catch(function(s){return g=!0,s}).then(function(s){l-=1,t[r]=s,!(l>0)&&(g&&i(t),I(t))})})}):Promise.resolve([])}var k0="__@field_split__";function Fr(e){return e.map(function(g){return"".concat(Qe(g),":").concat(g)}).join(k0)}var Kt=function(){function e(){DC(this,e),D(this,"kvs",new Map)}return EC(e,[{key:"set",value:function(l,t){this.kvs.set(Fr(l),t)}},{key:"get",value:function(l){return this.kvs.get(Fr(l))}},{key:"update",value:function(l,t){var I=this.get(l),i=t(I);i?this.set(l,i):this.delete(l)}},{key:"delete",value:function(l){this.kvs.delete(Fr(l))}},{key:"map",value:function(l){return ye(this.kvs.entries()).map(function(t){var I=oe(t,2),i=I[0],a=I[1],r=i.split(k0);return l({key:r.map(function(s){var d=s.match(/^([^:]*):(.*)$/),J=oe(d,3),Z=J[1],b=J[2];return Z==="number"?Number(b):b}),value:a})})}},{key:"toJSON",value:function(){var l={};return this.map(function(t){var I=t.key,i=t.value;return l[I.join(".")]=i,null}),l}}]),e}(),UX=["name"],MX=EC(function e(g){var l=this;DC(this,e),D(this,"formHooked",!1),D(this,"forceRootUpdate",void 0),D(this,"subscribable",!0),D(this,"store",{}),D(this,"fieldEntities",[]),D(this,"initialValues",{}),D(this,"callbacks",{}),D(this,"validateMessages",null),D(this,"preserve",null),D(this,"lastValidatePromise",null),D(this,"getForm",function(){return{getFieldValue:l.getFieldValue,getFieldsValue:l.getFieldsValue,getFieldError:l.getFieldError,getFieldWarning:l.getFieldWarning,getFieldsError:l.getFieldsError,isFieldsTouched:l.isFieldsTouched,isFieldTouched:l.isFieldTouched,isFieldValidating:l.isFieldValidating,isFieldsValidating:l.isFieldsValidating,resetFields:l.resetFields,setFields:l.setFields,setFieldValue:l.setFieldValue,setFieldsValue:l.setFieldsValue,validateFields:l.validateFields,submit:l.submit,_init:!0,getInternalHooks:l.getInternalHooks}}),D(this,"getInternalHooks",function(t){return t===et?(l.formHooked=!0,{dispatch:l.dispatch,initEntityValue:l.initEntityValue,registerField:l.registerField,useSubscribe:l.useSubscribe,setInitialValues:l.setInitialValues,destroyForm:l.destroyForm,setCallbacks:l.setCallbacks,setValidateMessages:l.setValidateMessages,getFields:l.getFields,setPreserve:l.setPreserve,getInitialValue:l.getInitialValue,registerWatch:l.registerWatch}):(Yg(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),D(this,"useSubscribe",function(t){l.subscribable=t}),D(this,"prevWithoutPreserves",null),D(this,"setInitialValues",function(t,I){if(l.initialValues=t||{},I){var i,a=Ut(t,l.store);(i=l.prevWithoutPreserves)===null||i===void 0||i.map(function(r){var s=r.key;a=pl(a,s,Kl(t,s))}),l.prevWithoutPreserves=null,l.updateStore(a)}}),D(this,"destroyForm",function(t){if(t)l.updateStore({});else{var I=new Kt;l.getFieldEntities(!0).forEach(function(i){l.isMergedPreserve(i.isPreserve())||I.set(i.getNamePath(),!0)}),l.prevWithoutPreserves=I}}),D(this,"getInitialValue",function(t){var I=Kl(l.initialValues,t);return t.length?Ut(I):I}),D(this,"setCallbacks",function(t){l.callbacks=t}),D(this,"setValidateMessages",function(t){l.validateMessages=t}),D(this,"setPreserve",function(t){l.preserve=t}),D(this,"watchList",[]),D(this,"registerWatch",function(t){return l.watchList.push(t),function(){l.watchList=l.watchList.filter(function(I){return I!==t})}}),D(this,"notifyWatch",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(l.watchList.length){var I=l.getFieldsValue(),i=l.getFieldsValue(!0);l.watchList.forEach(function(a){a(I,i,t)})}}),D(this,"timeoutId",null),D(this,"warningUnhooked",function(){}),D(this,"updateStore",function(t){l.store=t}),D(this,"getFieldEntities",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return t?l.fieldEntities.filter(function(I){return I.getNamePath().length}):l.fieldEntities}),D(this,"getFieldsMap",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,I=new Kt;return l.getFieldEntities(t).forEach(function(i){var a=i.getNamePath();I.set(a,i)}),I}),D(this,"getFieldEntitiesForNamePathList",function(t){if(!t)return l.getFieldEntities(!0);var I=l.getFieldsMap(!0);return t.map(function(i){var a=NC(i);return I.get(a)||{INVALIDATE_NAME_PATH:NC(i)}})}),D(this,"getFieldsValue",function(t,I){l.warningUnhooked();var i,a,r;if(t===!0||Array.isArray(t)?(i=t,a=I):t&&Qe(t)==="object"&&(r=t.strict,a=t.filter),i===!0&&!a)return l.store;var s=l.getFieldEntitiesForNamePathList(Array.isArray(i)?i:null),d=[];return s.forEach(function(J){var Z,b,p="INVALIDATE_NAME_PATH"in J?J.INVALIDATE_NAME_PATH:J.getNamePath();if(r){var y,G;if((y=(G=J).isList)!==null&&y!==void 0&&y.call(G))return}else if(!i&&(Z=(b=J).isListField)!==null&&Z!==void 0&&Z.call(b))return;if(!a)d.push(p);else{var h="getMeta"in J?J.getMeta():null;a(h)&&d.push(p)}}),lJ(l.store,d.map(NC))}),D(this,"getFieldValue",function(t){l.warningUnhooked();var I=NC(t);return Kl(l.store,I)}),D(this,"getFieldsError",function(t){l.warningUnhooked();var I=l.getFieldEntitiesForNamePathList(t);return I.map(function(i,a){return i&&!("INVALIDATE_NAME_PATH"in i)?{name:i.getNamePath(),errors:i.getErrors(),warnings:i.getWarnings()}:{name:NC(t[a]),errors:[],warnings:[]}})}),D(this,"getFieldError",function(t){l.warningUnhooked();var I=NC(t),i=l.getFieldsError([I])[0];return i.errors}),D(this,"getFieldWarning",function(t){l.warningUnhooked();var I=NC(t),i=l.getFieldsError([I])[0];return i.warnings}),D(this,"isFieldsTouched",function(){l.warningUnhooked();for(var t=arguments.length,I=new Array(t),i=0;i<t;i++)I[i]=arguments[i];var a=I[0],r=I[1],s,d=!1;I.length===0?s=null:I.length===1?Array.isArray(a)?(s=a.map(NC),d=!1):(s=null,d=a):(s=a.map(NC),d=r);var J=l.getFieldEntities(!0),Z=function(h){return h.isFieldTouched()};if(!s)return d?J.every(function(G){return Z(G)||G.isList()}):J.some(Z);var b=new Kt;s.forEach(function(G){b.set(G,[])}),J.forEach(function(G){var h=G.getNamePath();s.forEach(function(f){f.every(function(W,X){return h[X]===W})&&b.update(f,function(W){return[].concat(ye(W),[G])})})});var p=function(h){return h.some(Z)},y=b.map(function(G){var h=G.value;return h});return d?y.every(p):y.some(p)}),D(this,"isFieldTouched",function(t){return l.warningUnhooked(),l.isFieldsTouched([t])}),D(this,"isFieldsValidating",function(t){l.warningUnhooked();var I=l.getFieldEntities();if(!t)return I.some(function(a){return a.isFieldValidating()});var i=t.map(NC);return I.some(function(a){var r=a.getNamePath();return Pt(i,r)&&a.isFieldValidating()})}),D(this,"isFieldValidating",function(t){return l.warningUnhooked(),l.isFieldsValidating([t])}),D(this,"resetWithFieldInitialValue",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=new Kt,i=l.getFieldEntities(!0);i.forEach(function(s){var d=s.props.initialValue,J=s.getNamePath();if(d!==void 0){var Z=I.get(J)||new Set;Z.add({entity:s,value:d}),I.set(J,Z)}});var a=function(d){d.forEach(function(J){var Z=J.props.initialValue;if(Z!==void 0){var b=J.getNamePath(),p=l.getInitialValue(b);if(p!==void 0)Yg(!1,"Form already set 'initialValues' with path '".concat(b.join("."),"'. Field can not overwrite it."));else{var y=I.get(b);if(y&&y.size>1)Yg(!1,"Multiple Field with path '".concat(b.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(y){var G=l.getFieldValue(b),h=J.isListField();!h&&(!t.skipExist||G===void 0)&&l.updateStore(pl(l.store,b,ye(y)[0].value))}}}})},r;t.entities?r=t.entities:t.namePathList?(r=[],t.namePathList.forEach(function(s){var d=I.get(s);if(d){var J;(J=r).push.apply(J,ye(ye(d).map(function(Z){return Z.entity})))}})):r=i,a(r)}),D(this,"resetFields",function(t){l.warningUnhooked();var I=l.store;if(!t){l.updateStore(Ut(l.initialValues)),l.resetWithFieldInitialValue(),l.notifyObservers(I,null,{type:"reset"}),l.notifyWatch();return}var i=t.map(NC);i.forEach(function(a){var r=l.getInitialValue(a);l.updateStore(pl(l.store,a,r))}),l.resetWithFieldInitialValue({namePathList:i}),l.notifyObservers(I,i,{type:"reset"}),l.notifyWatch(i)}),D(this,"setFields",function(t){l.warningUnhooked();var I=l.store,i=[];t.forEach(function(a){var r=a.name,s=wC(a,UX),d=NC(r);i.push(d),"value"in s&&l.updateStore(pl(l.store,d,s.value)),l.notifyObservers(I,[d],{type:"setField",data:a})}),l.notifyWatch(i)}),D(this,"getFields",function(){var t=l.getFieldEntities(!0),I=t.map(function(i){var a=i.getNamePath(),r=i.getMeta(),s=O(O({},r),{},{name:a,value:l.getFieldValue(a)});return Object.defineProperty(s,"originRCField",{value:!0}),s});return I}),D(this,"initEntityValue",function(t){var I=t.props.initialValue;if(I!==void 0){var i=t.getNamePath(),a=Kl(l.store,i);a===void 0&&l.updateStore(pl(l.store,i,I))}}),D(this,"isMergedPreserve",function(t){var I=t!==void 0?t:l.preserve;return I??!0}),D(this,"registerField",function(t){l.fieldEntities.push(t);var I=t.getNamePath();if(l.notifyWatch([I]),t.props.initialValue!==void 0){var i=l.store;l.resetWithFieldInitialValue({entities:[t],skipExist:!0}),l.notifyObservers(i,[t.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(a,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(l.fieldEntities=l.fieldEntities.filter(function(Z){return Z!==t}),!l.isMergedPreserve(r)&&(!a||s.length>1)){var d=a?void 0:l.getInitialValue(I);if(I.length&&l.getFieldValue(I)!==d&&l.fieldEntities.every(function(Z){return!G0(Z.getNamePath(),I)})){var J=l.store;l.updateStore(pl(J,I,d,!0)),l.notifyObservers(J,[I],{type:"remove"}),l.triggerDependenciesUpdate(J,I)}}l.notifyWatch([I])}}),D(this,"dispatch",function(t){switch(t.type){case"updateValue":{var I=t.namePath,i=t.value;l.updateValue(I,i);break}case"validateField":{var a=t.namePath,r=t.triggerName;l.validateFields([a],{triggerName:r});break}}}),D(this,"notifyObservers",function(t,I,i){if(l.subscribable){var a=O(O({},i),{},{store:l.getFieldsValue(!0)});l.getFieldEntities().forEach(function(r){var s=r.onStoreChange;s(t,I,a)})}else l.forceRootUpdate()}),D(this,"triggerDependenciesUpdate",function(t,I){var i=l.getDependencyChildrenFields(I);return i.length&&l.validateFields(i),l.notifyObservers(t,i,{type:"dependenciesUpdate",relatedFields:[I].concat(ye(i))}),i}),D(this,"updateValue",function(t,I){var i=NC(t),a=l.store;l.updateStore(pl(l.store,i,I)),l.notifyObservers(a,[i],{type:"valueUpdate",source:"internal"}),l.notifyWatch([i]);var r=l.triggerDependenciesUpdate(a,i),s=l.callbacks.onValuesChange;if(s){var d=lJ(l.store,[i]);s(d,l.getFieldsValue())}l.triggerOnFieldsChange([i].concat(ye(r)))}),D(this,"setFieldsValue",function(t){l.warningUnhooked();var I=l.store;if(t){var i=Ut(l.store,t);l.updateStore(i)}l.notifyObservers(I,null,{type:"valueUpdate",source:"external"}),l.notifyWatch()}),D(this,"setFieldValue",function(t,I){l.setFields([{name:t,value:I,errors:[],warnings:[]}])}),D(this,"getDependencyChildrenFields",function(t){var I=new Set,i=[],a=new Kt;l.getFieldEntities().forEach(function(s){var d=s.props.dependencies;(d||[]).forEach(function(J){var Z=NC(J);a.update(Z,function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return b.add(s),b})})});var r=function s(d){var J=a.get(d)||new Set;J.forEach(function(Z){if(!I.has(Z)){I.add(Z);var b=Z.getNamePath();Z.isFieldDirty()&&b.length&&(i.push(b),s(b))}})};return r(t),i}),D(this,"triggerOnFieldsChange",function(t,I){var i=l.callbacks.onFieldsChange;if(i){var a=l.getFields();if(I){var r=new Kt;I.forEach(function(d){var J=d.name,Z=d.errors;r.set(J,Z)}),a.forEach(function(d){d.errors=r.get(d.name)||d.errors})}var s=a.filter(function(d){var J=d.name;return Pt(t,J)});s.length&&i(s,a)}}),D(this,"validateFields",function(t,I){l.warningUnhooked();var i,a;Array.isArray(t)||typeof t=="string"||typeof I=="string"?(i=t,a=I):a=t;var r=!!i,s=r?i.map(NC):[],d=[],J=String(Date.now()),Z=new Set,b=a||{},p=b.recursive,y=b.dirty;l.getFieldEntities(!0).forEach(function(W){if(r||s.push(W.getNamePath()),!(!W.props.rules||!W.props.rules.length)&&!(y&&!W.isFieldDirty())){var X=W.getNamePath();if(Z.add(X.join(J)),!r||Pt(s,X,p)){var B=W.validateRules(O({validateMessages:O(O({},h0),l.validateMessages)},a));d.push(B.then(function(){return{name:X,errors:[],warnings:[]}}).catch(function(V){var Q,v=[],Y=[];return(Q=V.forEach)===null||Q===void 0||Q.call(V,function(F){var L=F.rule.warningOnly,M=F.errors;L?Y.push.apply(Y,ye(M)):v.push.apply(v,ye(M))}),v.length?Promise.reject({name:X,errors:v,warnings:Y}):{name:X,errors:v,warnings:Y}}))}}});var G=LX(d);l.lastValidatePromise=G,G.catch(function(W){return W}).then(function(W){var X=W.map(function(B){var V=B.name;return V});l.notifyObservers(l.store,X,{type:"validateFinish"}),l.triggerOnFieldsChange(X,W)});var h=G.then(function(){return l.lastValidatePromise===G?Promise.resolve(l.getFieldsValue(s)):Promise.reject([])}).catch(function(W){var X=W.filter(function(B){return B&&B.errors.length});return Promise.reject({values:l.getFieldsValue(s),errorFields:X,outOfDate:l.lastValidatePromise!==G})});h.catch(function(W){return W});var f=s.filter(function(W){return Z.has(W.join(J))});return l.triggerOnFieldsChange(f),h}),D(this,"submit",function(){l.warningUnhooked(),l.validateFields().then(function(t){var I=l.callbacks.onFinish;if(I)try{I(t)}catch(i){console.error(i)}}).catch(function(t){var I=l.callbacks.onFinishFailed;I&&I(t)})}),this.forceRootUpdate=g});function p0(e){var g=u.useRef(),l=u.useState({}),t=oe(l,2),I=t[1];if(!g.current)if(e)g.current=e;else{var i=function(){I({})},a=new MX(i);g.current=a.getForm()}return[g.current]}var BA=u.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),xX=function(g){var l=g.validateMessages,t=g.onFormChange,I=g.onFormFinish,i=g.children,a=u.useContext(BA),r=u.useRef({});return u.createElement(BA.Provider,{value:O(O({},a),{},{validateMessages:O(O({},a.validateMessages),l),triggerFormChange:function(d,J){t&&t(d,{changedFields:J,forms:r.current}),a.triggerFormChange(d,J)},triggerFormFinish:function(d,J){I&&I(d,{values:J,forms:r.current}),a.triggerFormFinish(d,J)},registerForm:function(d,J){d&&(r.current=O(O({},r.current),{},D({},d,J))),a.registerForm(d,J)},unregisterForm:function(d){var J=O({},r.current);delete J[d],r.current=J,a.unregisterForm(d)}})},i)},TX=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed","clearOnDestroy"],DX=function(g,l){var t=g.name,I=g.initialValues,i=g.fields,a=g.form,r=g.preserve,s=g.children,d=g.component,J=d===void 0?"form":d,Z=g.validateMessages,b=g.validateTrigger,p=b===void 0?"onChange":b,y=g.onValuesChange,G=g.onFieldsChange,h=g.onFinish,f=g.onFinishFailed,W=g.clearOnDestroy,X=wC(g,TX),B=u.useRef(null),V=u.useContext(BA),Q=p0(a),v=oe(Q,1),Y=v[0],F=Y.getInternalHooks(et),L=F.useSubscribe,M=F.setInitialValues,ee=F.setCallbacks,q=F.setValidateMessages,P=F.setPreserve,le=F.destroyForm;u.useImperativeHandle(l,function(){return O(O({},Y),{},{nativeElement:B.current})}),u.useEffect(function(){return V.registerForm(t,Y),function(){V.unregisterForm(t)}},[V,Y,t]),q(O(O({},V.validateMessages),Z)),ee({onValuesChange:y,onFieldsChange:function(j){if(V.triggerFormChange(t,j),G){for(var ge=arguments.length,ne=new Array(ge>1?ge-1:0),ie=1;ie<ge;ie++)ne[ie-1]=arguments[ie];G.apply(void 0,[j].concat(ne))}},onFinish:function(j){V.triggerFormFinish(t,j),h&&h(j)},onFinishFailed:f}),P(r);var N=u.useRef(null);M(I,!N.current),N.current||(N.current=!0),u.useEffect(function(){return function(){return le(W)}},[]);var w,K=typeof s=="function";if(K){var T=Y.getFieldsValue(!0);w=s(T,Y)}else w=s;L(!K);var z=u.useRef();u.useEffect(function(){wX(z.current||[],i||[])||Y.setFields(i||[]),z.current=i},[i,Y]);var R=u.useMemo(function(){return O(O({},Y),{},{validateTrigger:p})},[Y,p]),H=u.createElement(ic.Provider,{value:null},u.createElement(tI.Provider,{value:R},w));return J===!1?H:u.createElement(J,Be({},X,{ref:B,onSubmit:function(j){j.preventDefault(),j.stopPropagation(),Y.submit()},onReset:function(j){var ge;j.preventDefault(),Y.resetFields(),(ge=X.onReset)===null||ge===void 0||ge.call(X,j)}}),H)};function tJ(e){try{return JSON.stringify(e)}catch{return Math.random()}}function EX(){for(var e=arguments.length,g=new Array(e),l=0;l<e;l++)g[l]=arguments[l];var t=g[0],I=g[1],i=I===void 0?{}:I,a=CX(i)?{form:i}:i,r=a.form,s=u.useState(),d=oe(s,2),J=d[0],Z=d[1],b=u.useMemo(function(){return tJ(J)},[J]),p=u.useRef(b);p.current=b;var y=u.useContext(tI),G=r||y,h=G&&G._init,f=NC(t),W=u.useRef(f);return W.current=f,u.useEffect(function(){if(h){var X=G.getFieldsValue,B=G.getInternalHooks,V=B(et),Q=V.registerWatch,v=function(M,ee){var q=a.preserve?ee:M;return typeof t=="function"?t(q):Kl(q,W.current)},Y=Q(function(L,M){var ee=v(L,M),q=tJ(ee);p.current!==q&&(p.current=q,Z(ee))}),F=v(X(),X(!0));return J!==F&&Z(F),Y}},[h]),J}var OX=u.forwardRef(DX),fo=OX;fo.FormProvider=xX;fo.Field=y0;fo.List=zX;fo.useForm=p0;fo.useWatch=EX;const IJ=u.createContext({}),PX=e=>{let{children:g,status:l,override:t}=e;const I=u.useContext(IJ),i=u.useMemo(()=>{const a=Object.assign({},I);return t&&delete a.isFormItemInput,l&&(delete a.status,delete a.hasFeedback,delete a.feedbackIcon),a},[l,t,I]);return u.createElement(IJ.Provider,{value:i},g)},jX=e=>{const{space:g,form:l,children:t}=e;if(t==null)return null;let I=t;return l&&(I=de.createElement(PX,{override:!0,status:!0},I)),g&&(I=de.createElement(BV,null,I)),I},$X=e=>{const{componentCls:g}=e;return{[g]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},qX=e=>{const{componentCls:g}=e;return{[g]:{position:"relative",maxWidth:"100%",minHeight:1}}},_X=(e,g)=>{const{prefixCls:l,componentCls:t,gridColumns:I}=e,i={};for(let a=I;a>=0;a--)a===0?(i[`${t}${g}-${a}`]={display:"none"},i[`${t}-push-${a}`]={insetInlineStart:"auto"},i[`${t}-pull-${a}`]={insetInlineEnd:"auto"},i[`${t}${g}-push-${a}`]={insetInlineStart:"auto"},i[`${t}${g}-pull-${a}`]={insetInlineEnd:"auto"},i[`${t}${g}-offset-${a}`]={marginInlineStart:0},i[`${t}${g}-order-${a}`]={order:0}):(i[`${t}${g}-${a}`]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${a/I*100}%`,maxWidth:`${a/I*100}%`}],i[`${t}${g}-push-${a}`]={insetInlineStart:`${a/I*100}%`},i[`${t}${g}-pull-${a}`]={insetInlineEnd:`${a/I*100}%`},i[`${t}${g}-offset-${a}`]={marginInlineStart:`${a/I*100}%`},i[`${t}${g}-order-${a}`]={order:a});return i[`${t}${g}-flex`]={flex:`var(--${l}${g}-flex)`},i},SA=(e,g)=>_X(e,g),eR=(e,g,l)=>({[`@media (min-width: ${Le(g)})`]:Object.assign({},SA(e,l))}),CR=()=>({}),gR=()=>({});gn("Grid",$X,CR);const W0=e=>({xs:e.screenXSMin,sm:e.screenSMMin,md:e.screenMDMin,lg:e.screenLGMin,xl:e.screenXLMin,xxl:e.screenXXLMin});gn("Grid",e=>{const g=pg(e,{gridColumns:24}),l=W0(g);return delete l.xs,[qX(g),SA(g,""),SA(g,"-xs"),Object.keys(l).map(t=>eR(g,l[t],`-${t}`)).reduce((t,I)=>Object.assign(Object.assign({},t),I),{})]},gR);function oJ(e){return{position:e,inset:0}}const V0=e=>{const{componentCls:g,antCls:l}=e;return[{[`${g}-root`]:{[`${g}${l}-zoom-enter, ${g}${l}-zoom-appear`]:{transform:"none",opacity:0,animationDuration:e.motionDurationSlow,userSelect:"none"},[`${g}${l}-zoom-leave ${g}-content`]:{pointerEvents:"none"},[`${g}-mask`]:Object.assign(Object.assign({},oJ("fixed")),{zIndex:e.zIndexPopupBase,height:"100%",backgroundColor:e.colorBgMask,pointerEvents:"none",[`${g}-hidden`]:{display:"none"}}),[`${g}-wrap`]:Object.assign(Object.assign({},oJ("fixed")),{zIndex:e.zIndexPopupBase,overflow:"auto",outline:0,WebkitOverflowScrolling:"touch"})}},{[`${g}-root`]:is(e)}]},lR=e=>{const{componentCls:g}=e;return[{[`${g}-root`]:{[`${g}-wrap-rtl`]:{direction:"rtl"},[`${g}-centered`]:{textAlign:"center","&::before":{display:"inline-block",width:0,height:"100%",verticalAlign:"middle",content:'""'},[g]:{top:0,display:"inline-block",paddingBottom:0,textAlign:"start",verticalAlign:"middle"}},[`@media (max-width: ${e.screenSMMax}px)`]:{[g]:{maxWidth:"calc(100vw - 16px)",margin:`${Le(e.marginXS)} auto`},[`${g}-centered`]:{[g]:{flex:1}}}}},{[g]:Object.assign(Object.assign({},po(e)),{pointerEvents:"none",position:"relative",top:100,width:"auto",maxWidth:`calc(100vw - ${Le(e.calc(e.margin).mul(2).equal())})`,margin:"0 auto",paddingBottom:e.paddingLG,[`${g}-title`]:{margin:0,color:e.titleColor,fontWeight:e.fontWeightStrong,fontSize:e.titleFontSize,lineHeight:e.titleLineHeight,wordWrap:"break-word"},[`${g}-content`]:{position:"relative",backgroundColor:e.contentBg,backgroundClip:"padding-box",border:0,borderRadius:e.borderRadiusLG,boxShadow:e.boxShadow,pointerEvents:"auto",padding:e.contentPadding},[`${g}-close`]:Object.assign({position:"absolute",top:e.calc(e.modalHeaderHeight).sub(e.modalCloseBtnSize).div(2).equal(),insetInlineEnd:e.calc(e.modalHeaderHeight).sub(e.modalCloseBtnSize).div(2).equal(),zIndex:e.calc(e.zIndexPopupBase).add(10).equal(),padding:0,color:e.modalCloseIconColor,fontWeight:e.fontWeightStrong,lineHeight:1,textDecoration:"none",background:"transparent",borderRadius:e.borderRadiusSM,width:e.modalCloseBtnSize,height:e.modalCloseBtnSize,border:0,outline:0,cursor:"pointer",transition:`color ${e.motionDurationMid}, background-color ${e.motionDurationMid}`,"&-x":{display:"flex",fontSize:e.fontSizeLG,fontStyle:"normal",lineHeight:Le(e.modalCloseBtnSize),justifyContent:"center",textTransform:"none",textRendering:"auto"},"&:disabled":{pointerEvents:"none"},"&:hover":{color:e.modalCloseIconHoverColor,backgroundColor:e.colorBgTextHover,textDecoration:"none"},"&:active":{backgroundColor:e.colorBgTextActive}},FZ(e)),[`${g}-header`]:{color:e.colorText,background:e.headerBg,borderRadius:`${Le(e.borderRadiusLG)} ${Le(e.borderRadiusLG)} 0 0`,marginBottom:e.headerMarginBottom,padding:e.headerPadding,borderBottom:e.headerBorderBottom},[`${g}-body`]:{fontSize:e.fontSize,lineHeight:e.lineHeight,wordWrap:"break-word",padding:e.bodyPadding,[`${g}-body-skeleton`]:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",margin:`${Le(e.margin)} auto`}},[`${g}-footer`]:{textAlign:"end",background:e.footerBg,marginTop:e.footerMarginTop,padding:e.footerPadding,borderTop:e.footerBorderTop,borderRadius:e.footerBorderRadius,[`> ${e.antCls}-btn + ${e.antCls}-btn`]:{marginInlineStart:e.marginXS}},[`${g}-open`]:{overflow:"hidden"}})},{[`${g}-pure-panel`]:{top:"auto",padding:0,display:"flex",flexDirection:"column",[`${g}-content,
          ${g}-body,
          ${g}-confirm-body-wrapper`]:{display:"flex",flexDirection:"column",flex:"auto"},[`${g}-confirm-body`]:{marginBottom:"auto"}}}]},nR=e=>{const{componentCls:g}=e;return{[`${g}-root`]:{[`${g}-wrap-rtl`]:{direction:"rtl",[`${g}-confirm-body`]:{direction:"rtl"}}}}},tR=e=>{const{componentCls:g}=e,l=W0(e);delete l.xs;const t=Object.keys(l).map(I=>({[`@media (min-width: ${Le(l[I])})`]:{width:`var(--${g.replace(".","")}-${I}-width)`}}));return{[`${g}-root`]:{[g]:[{width:`var(--${g.replace(".","")}-xs-width)`}].concat(ye(t))}}},IR=e=>{const g=e.padding,l=e.fontSizeHeading5,t=e.lineHeightHeading5;return pg(e,{modalHeaderHeight:e.calc(e.calc(t).mul(l).equal()).add(e.calc(g).mul(2).equal()).equal(),modalFooterBorderColorSplit:e.colorSplit,modalFooterBorderStyle:e.lineType,modalFooterBorderWidth:e.lineWidth,modalCloseIconColor:e.colorIcon,modalCloseIconHoverColor:e.colorIconHover,modalCloseBtnSize:e.controlHeight,modalConfirmIconSize:e.fontHeight,modalTitleHeight:e.calc(e.titleFontSize).mul(e.titleLineHeight).equal()})},oR=e=>({footerBg:"transparent",headerBg:e.colorBgElevated,titleLineHeight:e.lineHeightHeading5,titleFontSize:e.fontSizeHeading5,contentBg:e.colorBgElevated,titleColor:e.colorTextHeading,contentPadding:e.wireframe?0:`${Le(e.paddingMD)} ${Le(e.paddingContentHorizontalLG)}`,headerPadding:e.wireframe?`${Le(e.padding)} ${Le(e.paddingLG)}`:0,headerBorderBottom:e.wireframe?`${Le(e.lineWidth)} ${e.lineType} ${e.colorSplit}`:"none",headerMarginBottom:e.wireframe?0:e.marginXS,bodyPadding:e.wireframe?e.paddingLG:0,footerPadding:e.wireframe?`${Le(e.paddingXS)} ${Le(e.padding)}`:0,footerBorderTop:e.wireframe?`${Le(e.lineWidth)} ${e.lineType} ${e.colorSplit}`:"none",footerBorderRadius:e.wireframe?`0 0 ${Le(e.borderRadiusLG)} ${Le(e.borderRadiusLG)}`:0,footerMarginTop:e.wireframe?0:e.marginSM,confirmBodyPadding:e.wireframe?`${Le(e.padding*2)} ${Le(e.padding*2)} ${Le(e.paddingLG)}`:0,confirmIconMarginInlineEnd:e.wireframe?e.margin:e.marginSM,confirmBtnsMarginTop:e.wireframe?e.marginLG:e.marginSM});gn("Modal",e=>{const g=IR(e);return[lR(g),nR(g),V0(g),cs(g,"zoom"),tR(g)]},oR,{unitless:{titleLineHeight:!0}});const iR=de.createContext({}),cR=function(){if(typeof navigator>"u"||typeof window>"u")return!1;var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e==null?void 0:e.substr(0,4))};function aR(e){var g=e.prefixCls,l=e.align,t=e.arrow,I=e.arrowPos,i=t||{},a=i.className,r=i.content,s=I.x,d=s===void 0?0:s,J=I.y,Z=J===void 0?0:J,b=u.useRef();if(!l||!l.points)return null;var p={position:"absolute"};if(l.autoArrow!==!1){var y=l.points[0],G=l.points[1],h=y[0],f=y[1],W=G[0],X=G[1];h===W||!["t","b"].includes(h)?p.top=Z:h==="t"?p.top=0:p.bottom=0,f===X||!["l","r"].includes(f)?p.left=d:f==="l"?p.left=0:p.right=0}return u.createElement("div",{ref:b,className:me("".concat(g,"-arrow"),a),style:p},r)}function rR(e){var g=e.prefixCls,l=e.open,t=e.zIndex,I=e.mask,i=e.motion;return I?u.createElement(Nl,Be({},i,{motionAppear:!0,visible:l,removeOnLeave:!0}),function(a){var r=a.className;return u.createElement("div",{style:{zIndex:t},className:me("".concat(g,"-mask"),r)})}):null}var AR=u.memo(function(e){var g=e.children;return g},function(e,g){return g.cache}),sR=u.forwardRef(function(e,g){var l=e.popup,t=e.className,I=e.prefixCls,i=e.style,a=e.target,r=e.onVisibleChanged,s=e.open,d=e.keepDom,J=e.fresh,Z=e.onClick,b=e.mask,p=e.arrow,y=e.arrowPos,G=e.align,h=e.motion,f=e.maskMotion,W=e.forceRender,X=e.getPopupContainer,B=e.autoDestroy,V=e.portal,Q=e.zIndex,v=e.onMouseEnter,Y=e.onMouseLeave,F=e.onPointerEnter,L=e.onPointerDownCapture,M=e.ready,ee=e.offsetX,q=e.offsetY,P=e.offsetR,le=e.offsetB,N=e.onAlign,w=e.onPrepare,K=e.stretch,T=e.targetWidth,z=e.targetHeight,R=typeof l=="function"?l():l,H=s||d,E=(X==null?void 0:X.length)>0,j=u.useState(!X||!E),ge=oe(j,2),ne=ge[0],ie=ge[1];if(kg(function(){!ne&&E&&a&&ie(!0)},[ne,E,a]),!ne)return null;var Ae="auto",ae={left:"-1000vw",top:"-1000vh",right:Ae,bottom:Ae};if(M||!s){var se,ze=G.points,We=G.dynamicInset||((se=G._experimental)===null||se===void 0?void 0:se.dynamicInset),Je=We&&ze[0][1]==="r",ue=We&&ze[0][0]==="b";Je?(ae.right=P,ae.left=Ae):(ae.left=ee,ae.right=Ae),ue?(ae.bottom=le,ae.top=Ae):(ae.top=q,ae.bottom=Ae)}var he={};return K&&(K.includes("height")&&z?he.height=z:K.includes("minHeight")&&z&&(he.minHeight=z),K.includes("width")&&T?he.width=T:K.includes("minWidth")&&T&&(he.minWidth=T)),s||(he.pointerEvents="none"),u.createElement(V,{open:W||H,getContainer:X&&function(){return X(a)},autoDestroy:B},u.createElement(rR,{prefixCls:I,open:s,zIndex:Q,mask:b,motion:f}),u.createElement(PA,{onResize:N,disabled:!s},function(Se){return u.createElement(Nl,Be({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:W,leavedClassName:"".concat(I,"-hidden")},h,{onAppearPrepare:w,onEnterPrepare:w,visible:s,onVisibleChanged:function(Ye){var Ue;h==null||(Ue=h.onVisibleChanged)===null||Ue===void 0||Ue.call(h,Ye),r(Ye)}}),function(Ke,Ye){var Ue=Ke.className,Me=Ke.style,Re=me(I,Ue,t);return u.createElement("div",{ref:uc(Se,g,Ye),className:Re,style:O(O(O(O({"--arrow-x":"".concat(y.x||0,"px"),"--arrow-y":"".concat(y.y||0,"px")},ae),he),Me),{},{boxSizing:"border-box",zIndex:Q},i),onMouseEnter:v,onMouseLeave:Y,onPointerEnter:F,onClick:Z,onPointerDownCapture:L},p&&u.createElement(aR,{prefixCls:I,arrow:p,arrowPos:y,align:G}),u.createElement(AR,{cache:!s&&!J},R))})}))}),dR=u.forwardRef(function(e,g){var l=e.children,t=e.getTriggerDOMNode,I=yo(l),i=u.useCallback(function(r){EA(g,t?t(r):r)},[t]),a=Go(i,mc(l));return I?u.cloneElement(l,{ref:a}):l}),iJ=u.createContext(null);function cJ(e){return e?Array.isArray(e)?e:[e]:[]}function uR(e,g,l,t){return u.useMemo(function(){var I=cJ(l??g),i=cJ(t??g),a=new Set(I),r=new Set(i);return e&&(a.has("hover")&&(a.delete("hover"),a.add("click")),r.has("hover")&&(r.delete("hover"),r.add("click"))),[a,r]},[e,g,l,t])}function mR(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=arguments.length>2?arguments[2]:void 0;return l?e[0]===g[0]:e[0]===g[0]&&e[1]===g[1]}function JR(e,g,l,t){for(var I=l.points,i=Object.keys(e),a=0;a<i.length;a+=1){var r,s=i[a];if(mR((r=e[s])===null||r===void 0?void 0:r.points,I,t))return"".concat(g,"-placement-").concat(s)}return""}function aJ(e,g,l,t){return g||(l?{motionName:"".concat(e,"-").concat(l)}:t?{motionName:t}:null)}function Xo(e){return e.ownerDocument.defaultView}function YA(e){for(var g=[],l=e==null?void 0:e.parentElement,t=["hidden","scroll","clip","auto"];l;){var I=Xo(l).getComputedStyle(l),i=I.overflowX,a=I.overflowY,r=I.overflow;[i,a,r].some(function(s){return t.includes(s)})&&g.push(l),l=l.parentElement}return g}function Zo(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Number.isNaN(e)?g:e}function TI(e){return Zo(parseFloat(e),0)}function rJ(e,g){var l=O({},e);return(g||[]).forEach(function(t){if(!(t instanceof HTMLBodyElement||t instanceof HTMLHtmlElement)){var I=Xo(t).getComputedStyle(t),i=I.overflow,a=I.overflowClipMargin,r=I.borderTopWidth,s=I.borderBottomWidth,d=I.borderLeftWidth,J=I.borderRightWidth,Z=t.getBoundingClientRect(),b=t.offsetHeight,p=t.clientHeight,y=t.offsetWidth,G=t.clientWidth,h=TI(r),f=TI(s),W=TI(d),X=TI(J),B=Zo(Math.round(Z.width/y*1e3)/1e3),V=Zo(Math.round(Z.height/b*1e3)/1e3),Q=(y-G-W-X)*B,v=(b-p-h-f)*V,Y=h*V,F=f*V,L=W*B,M=X*B,ee=0,q=0;if(i==="clip"){var P=TI(a);ee=P*B,q=P*V}var le=Z.x+L-ee,N=Z.y+Y-q,w=le+Z.width+2*ee-L-M-Q,K=N+Z.height+2*q-Y-F-v;l.left=Math.max(l.left,le),l.top=Math.max(l.top,N),l.right=Math.min(l.right,w),l.bottom=Math.min(l.bottom,K)}}),l}function AJ(e){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l="".concat(g),t=l.match(/^(.*)\%$/);return t?e*(parseFloat(t[1])/100):parseFloat(l)}function sJ(e,g){var l=g||[],t=oe(l,2),I=t[0],i=t[1];return[AJ(e.width,I),AJ(e.height,i)]}function dJ(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return[e[0],e[1]]}function wt(e,g){var l=g[0],t=g[1],I,i;return l==="t"?i=e.y:l==="b"?i=e.y+e.height:i=e.y+e.height/2,t==="l"?I=e.x:t==="r"?I=e.x+e.width:I=e.x+e.width/2,{x:I,y:i}}function Gn(e,g){var l={t:"b",b:"t",l:"r",r:"l"};return e.map(function(t,I){return I===g?l[t]||"c":t}).join("")}function ZR(e,g,l,t,I,i,a){var r=u.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:I[t]||{}}),s=oe(r,2),d=s[0],J=s[1],Z=u.useRef(0),b=u.useMemo(function(){return g?YA(g):[]},[g]),p=u.useRef({}),y=function(){p.current={}};e||y();var G=jg(function(){if(g&&l&&e){let MC=function(hg,tg){var gl=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_e,Rl=j.x+hg,Mg=j.y+tg,sI=Rl+Je,Ge=Mg+We,Fe=Math.max(Rl,gl.left),yC=Math.max(Mg,gl.top),QC=Math.min(sI,gl.right),mC=Math.min(Ge,gl.bottom);return Math.max(0,(QC-Fe)*(mC-yC))},bg=function(){zg=j.y+gC,Vg=zg+We,fg=j.x+nC,dl=fg+Je};var AI=MC,rt=bg,W,X,B,V,Q=g,v=Q.ownerDocument,Y=Xo(Q),F=Y.getComputedStyle(Q),L=F.width,M=F.height,ee=F.position,q=Q.style.left,P=Q.style.top,le=Q.style.right,N=Q.style.bottom,w=Q.style.overflow,K=O(O({},I[t]),i),T=v.createElement("div");(W=Q.parentElement)===null||W===void 0||W.appendChild(T),T.style.left="".concat(Q.offsetLeft,"px"),T.style.top="".concat(Q.offsetTop,"px"),T.style.position=ee,T.style.height="".concat(Q.offsetHeight,"px"),T.style.width="".concat(Q.offsetWidth,"px"),Q.style.left="0",Q.style.top="0",Q.style.right="auto",Q.style.bottom="auto",Q.style.overflow="hidden";var z;if(Array.isArray(l))z={x:l[0],y:l[1],width:0,height:0};else{var R,H,E=l.getBoundingClientRect();E.x=(R=E.x)!==null&&R!==void 0?R:E.left,E.y=(H=E.y)!==null&&H!==void 0?H:E.top,z={x:E.x,y:E.y,width:E.width,height:E.height}}var j=Q.getBoundingClientRect();j.x=(X=j.x)!==null&&X!==void 0?X:j.left,j.y=(B=j.y)!==null&&B!==void 0?B:j.top;var ge=v.documentElement,ne=ge.clientWidth,ie=ge.clientHeight,Ae=ge.scrollWidth,ae=ge.scrollHeight,se=ge.scrollTop,ze=ge.scrollLeft,We=j.height,Je=j.width,ue=z.height,he=z.width,Se={left:0,top:0,right:ne,bottom:ie},Ke={left:-ze,top:-se,right:Ae-ze,bottom:ae-se},Ye=K.htmlRegion,Ue="visible",Me="visibleFirst";Ye!=="scroll"&&Ye!==Me&&(Ye=Ue);var Re=Ye===Me,De=rJ(Ke,b),fe=rJ(Se,b),_e=Ye===Ue?fe:De,eC=Re?fe:_e;Q.style.left="auto",Q.style.top="auto",Q.style.right="0",Q.style.bottom="0";var IC=Q.getBoundingClientRect();Q.style.left=q,Q.style.top=P,Q.style.right=le,Q.style.bottom=N,Q.style.overflow=w,(V=Q.parentElement)===null||V===void 0||V.removeChild(T);var pC=Zo(Math.round(Je/parseFloat(L)*1e3)/1e3),cC=Zo(Math.round(We/parseFloat(M)*1e3)/1e3);if(pC===0||cC===0||no(l)&&!I0(l))return;var hC=K.offset,WC=K.targetOffset,Pe=sJ(j,hC),lC=oe(Pe,2),Te=lC[0],Ze=lC[1],Ee=sJ(z,WC),je=oe(Ee,2),ve=je[0],Oe=je[1];z.x-=ve,z.y-=Oe;var $e=K.points||[],ZC=oe($e,2),XC=ZC[0],LC=ZC[1],ig=dJ(LC),OC=dJ(XC),Kg=wt(z,ig),SC=wt(j,OC),mg=O({},K),nC=Kg.x-SC.x+Te,gC=Kg.y-SC.y+Ze,RC=MC(nC,gC),Wg=MC(nC,gC,fe),wg=wt(z,["t","l"]),aC=wt(j,["t","l"]),Hg=wt(z,["b","r"]),_g=wt(j,["b","r"]),oC=K.overflow||{},GC=oC.adjustX,cg=oC.adjustY,_C=oC.shiftX,Ng=oC.shiftY,Jg=function(tg){return typeof tg=="boolean"?tg:tg>=0},zg,Vg,fg,dl;bg();var el=Jg(cg),zl=OC[0]===ig[0];if(el&&OC[0]==="t"&&(Vg>eC.bottom||p.current.bt)){var sC=gC;zl?sC-=We-ue:sC=wg.y-_g.y-Ze;var nt=MC(nC,sC),cI=MC(nC,sC,fe);nt>RC||nt===RC&&(!Re||cI>=Wg)?(p.current.bt=!0,gC=sC,Ze=-Ze,mg.points=[Gn(OC,0),Gn(ig,0)]):p.current.bt=!1}if(el&&OC[0]==="b"&&(zg<eC.top||p.current.tb)){var uC=gC;zl?uC+=We-ue:uC=Hg.y-aC.y-Ze;var tt=MC(nC,uC),Bn=MC(nC,uC,fe);tt>RC||tt===RC&&(!Re||Bn>=Wg)?(p.current.tb=!0,gC=uC,Ze=-Ze,mg.points=[Gn(OC,0),Gn(ig,0)]):p.current.tb=!1}var Sn=Jg(GC),Ll=OC[1]===ig[1];if(Sn&&OC[1]==="l"&&(dl>eC.right||p.current.rl)){var Ul=nC;Ll?Ul-=Je-he:Ul=wg.x-_g.x-Te;var Yn=MC(Ul,gC),ul=MC(Ul,gC,fe);Yn>RC||Yn===RC&&(!Re||ul>=Wg)?(p.current.rl=!0,nC=Ul,Te=-Te,mg.points=[Gn(OC,1),Gn(ig,1)]):p.current.rl=!1}if(Sn&&OC[1]==="r"&&(fg<eC.left||p.current.lr)){var UC=nC;Ll?UC+=Je-he:UC=Hg.x-aC.x-Te;var It=MC(UC,gC),ag=MC(UC,gC,fe);It>RC||It===RC&&(!Re||ag>=Wg)?(p.current.lr=!0,nC=UC,Te=-Te,mg.points=[Gn(OC,1),Gn(ig,1)]):p.current.lr=!1}bg();var Cl=_C===!0?0:_C;typeof Cl=="number"&&(fg<fe.left&&(nC-=fg-fe.left-Te,z.x+he<fe.left+Cl&&(nC+=z.x-fe.left+he-Cl)),dl>fe.right&&(nC-=dl-fe.right-Te,z.x>fe.right-Cl&&(nC+=z.x-fe.right+Cl)));var Lg=Ng===!0?0:Ng;typeof Lg=="number"&&(zg<fe.top&&(gC-=zg-fe.top-Ze,z.y+ue<fe.top+Lg&&(gC+=z.y-fe.top+ue-Lg)),Vg>fe.bottom&&(gC-=Vg-fe.bottom-Ze,z.y>fe.bottom-Lg&&(gC+=z.y-fe.bottom+Lg)));var ln=j.x+nC,ml=ln+Je,Zg=j.y+gC,Ml=Zg+We,xl=z.x,aI=xl+he,Fn=z.y,Kn=Fn+ue,ot=Math.max(ln,xl),wn=Math.min(ml,aI),Xl=(ot+wn)/2,rI=Xl-ln,Hn=Math.max(Zg,Fn),tC=Math.min(Ml,Kn),it=(Hn+tC)/2,ct=it-Zg;a==null||a(g,mg);var Tl=IC.right-j.x-(nC+j.width),Ug=IC.bottom-j.y-(gC+j.height);pC===1&&(nC=Math.round(nC),Tl=Math.round(Tl)),cC===1&&(gC=Math.round(gC),Ug=Math.round(Ug));var at={ready:!0,offsetX:nC/pC,offsetY:gC/cC,offsetR:Tl/pC,offsetB:Ug/cC,arrowX:rI/pC,arrowY:ct/cC,scaleX:pC,scaleY:cC,align:mg};J(at)}}),h=function(){Z.current+=1;var X=Z.current;Promise.resolve().then(function(){Z.current===X&&G()})},f=function(){J(function(X){return O(O({},X),{},{ready:!1})})};return kg(f,[t]),kg(function(){e||f()},[e]),[d.ready,d.offsetX,d.offsetY,d.offsetR,d.offsetB,d.arrowX,d.arrowY,d.scaleX,d.scaleY,d.align,h]}function bR(e,g,l,t,I){kg(function(){if(e&&g&&l){let b=function(){t(),I()};var Z=b,i=g,a=l,r=YA(i),s=YA(a),d=Xo(a),J=new Set([d].concat(ye(r),ye(s)));return J.forEach(function(p){p.addEventListener("scroll",b,{passive:!0})}),d.addEventListener("resize",b,{passive:!0}),t(),function(){J.forEach(function(p){p.removeEventListener("scroll",b),d.removeEventListener("resize",b)})}}},[e,g,l])}function hR(e,g,l,t,I,i,a,r){var s=u.useRef(e);s.current=e;var d=u.useRef(!1);u.useEffect(function(){if(g&&t&&(!I||i)){var Z=function(){d.current=!1},b=function(h){var f;s.current&&!a(((f=h.composedPath)===null||f===void 0||(f=f.call(h))===null||f===void 0?void 0:f[0])||h.target)&&!d.current&&r(!1)},p=Xo(t);p.addEventListener("pointerdown",Z,!0),p.addEventListener("mousedown",b,!0),p.addEventListener("contextmenu",b,!0);var y=qi(l);return y&&(y.addEventListener("mousedown",b,!0),y.addEventListener("contextmenu",b,!0)),function(){p.removeEventListener("pointerdown",Z,!0),p.removeEventListener("mousedown",b,!0),p.removeEventListener("contextmenu",b,!0),y&&(y.removeEventListener("mousedown",b,!0),y.removeEventListener("contextmenu",b,!0))}}},[g,l,t,I,i]);function J(){d.current=!0}return J}var GR=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];function yR(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Rc,g=u.forwardRef(function(l,t){var I=l.prefixCls,i=I===void 0?"rc-trigger-popup":I,a=l.children,r=l.action,s=r===void 0?"hover":r,d=l.showAction,J=l.hideAction,Z=l.popupVisible,b=l.defaultPopupVisible,p=l.onPopupVisibleChange,y=l.afterPopupVisibleChange,G=l.mouseEnterDelay,h=l.mouseLeaveDelay,f=h===void 0?.1:h,W=l.focusDelay,X=l.blurDelay,B=l.mask,V=l.maskClosable,Q=V===void 0?!0:V,v=l.getPopupContainer,Y=l.forceRender,F=l.autoDestroy,L=l.destroyPopupOnHide,M=l.popup,ee=l.popupClassName,q=l.popupStyle,P=l.popupPlacement,le=l.builtinPlacements,N=le===void 0?{}:le,w=l.popupAlign,K=l.zIndex,T=l.stretch,z=l.getPopupClassNameFromAlign,R=l.fresh,H=l.alignPoint,E=l.onPopupClick,j=l.onPopupAlign,ge=l.arrow,ne=l.popupMotion,ie=l.maskMotion,Ae=l.popupTransitionName,ae=l.popupAnimation,se=l.maskTransitionName,ze=l.maskAnimation,We=l.className,Je=l.getTriggerDOMNode,ue=wC(l,GR),he=F||L||!1,Se=u.useState(!1),Ke=oe(Se,2),Ye=Ke[0],Ue=Ke[1];kg(function(){Ue(cR())},[]);var Me=u.useRef({}),Re=u.useContext(iJ),De=u.useMemo(function(){return{registerSubPopup:function(Fe,yC){Me.current[Fe]=yC,Re==null||Re.registerSubPopup(Fe,yC)}}},[Re]),fe=m0(),_e=u.useState(null),eC=oe(_e,2),IC=eC[0],pC=eC[1],cC=u.useRef(null),hC=jg(function(Ge){cC.current=Ge,no(Ge)&&IC!==Ge&&pC(Ge),Re==null||Re.registerSubPopup(fe,Ge)}),WC=u.useState(null),Pe=oe(WC,2),lC=Pe[0],Te=Pe[1],Ze=u.useRef(null),Ee=jg(function(Ge){no(Ge)&&lC!==Ge&&(Te(Ge),Ze.current=Ge)}),je=u.Children.only(a),ve=(je==null?void 0:je.props)||{},Oe={},$e=jg(function(Ge){var Fe,yC,QC=lC;return(QC==null?void 0:QC.contains(Ge))||((Fe=qi(QC))===null||Fe===void 0?void 0:Fe.host)===Ge||Ge===QC||(IC==null?void 0:IC.contains(Ge))||((yC=qi(IC))===null||yC===void 0?void 0:yC.host)===Ge||Ge===IC||Object.values(Me.current).some(function(mC){return(mC==null?void 0:mC.contains(Ge))||Ge===mC})}),ZC=aJ(i,ne,ae,Ae),XC=aJ(i,ie,ze,se),LC=u.useState(b||!1),ig=oe(LC,2),OC=ig[0],Kg=ig[1],SC=Z??OC,mg=jg(function(Ge){Z===void 0&&Kg(Ge)});kg(function(){Kg(Z||!1)},[Z]);var nC=u.useRef(SC);nC.current=SC;var gC=u.useRef([]);gC.current=[];var RC=jg(function(Ge){var Fe;mg(Ge),((Fe=gC.current[gC.current.length-1])!==null&&Fe!==void 0?Fe:SC)!==Ge&&(gC.current.push(Ge),p==null||p(Ge))}),Wg=u.useRef(),wg=function(){clearTimeout(Wg.current)},aC=function(Fe){var yC=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;wg(),yC===0?RC(Fe):Wg.current=setTimeout(function(){RC(Fe)},yC*1e3)};u.useEffect(function(){return wg},[]);var Hg=u.useState(!1),_g=oe(Hg,2),oC=_g[0],GC=_g[1];kg(function(Ge){(!Ge||SC)&&GC(!0)},[SC]);var cg=u.useState(null),_C=oe(cg,2),Ng=_C[0],Jg=_C[1],zg=u.useState(null),Vg=oe(zg,2),fg=Vg[0],dl=Vg[1],el=function(Fe){dl([Fe.clientX,Fe.clientY])},zl=ZR(SC,IC,H&&fg!==null?fg:lC,P,N,w,j),sC=oe(zl,11),nt=sC[0],cI=sC[1],uC=sC[2],tt=sC[3],Bn=sC[4],Sn=sC[5],Ll=sC[6],Ul=sC[7],Yn=sC[8],ul=sC[9],UC=sC[10],It=uR(Ye,s,d,J),ag=oe(It,2),Cl=ag[0],Lg=ag[1],ln=Cl.has("click"),ml=Lg.has("click")||Lg.has("contextMenu"),Zg=jg(function(){oC||UC()}),Ml=function(){nC.current&&H&&ml&&aC(!1)};bR(SC,lC,IC,Zg,Ml),kg(function(){Zg()},[fg,P]),kg(function(){SC&&!(N!=null&&N[P])&&Zg()},[JSON.stringify(w)]);var xl=u.useMemo(function(){var Ge=JR(N,i,ul,H);return me(Ge,z==null?void 0:z(ul))},[ul,z,N,i,H]);u.useImperativeHandle(t,function(){return{nativeElement:Ze.current,popupElement:cC.current,forceAlign:Zg}});var aI=u.useState(0),Fn=oe(aI,2),Kn=Fn[0],ot=Fn[1],wn=u.useState(0),Xl=oe(wn,2),rI=Xl[0],Hn=Xl[1],tC=function(){if(T&&lC){var Fe=lC.getBoundingClientRect();ot(Fe.width),Hn(Fe.height)}},it=function(){tC(),Zg()},ct=function(Fe){GC(!1),UC(),y==null||y(Fe)},Tl=function(){return new Promise(function(Fe){tC(),Jg(function(){return Fe})})};kg(function(){Ng&&(UC(),Ng(),Jg(null))},[Ng]);function Ug(Ge,Fe,yC,QC){Oe[Ge]=function(mC){var Nn;QC==null||QC(mC),aC(Fe,yC);for(var dI=arguments.length,nn=new Array(dI>1?dI-1:0),Ql=1;Ql<dI;Ql++)nn[Ql-1]=arguments[Ql];(Nn=ve[Ge])===null||Nn===void 0||Nn.call.apply(Nn,[ve,mC].concat(nn))}}(ln||ml)&&(Oe.onClick=function(Ge){var Fe;nC.current&&ml?aC(!1):!nC.current&&ln&&(el(Ge),aC(!0));for(var yC=arguments.length,QC=new Array(yC>1?yC-1:0),mC=1;mC<yC;mC++)QC[mC-1]=arguments[mC];(Fe=ve.onClick)===null||Fe===void 0||Fe.call.apply(Fe,[ve,Ge].concat(QC))});var at=hR(SC,ml,lC,IC,B,Q,$e,aC),AI=Cl.has("hover"),rt=Lg.has("hover"),MC,bg;AI&&(Ug("onMouseEnter",!0,G,function(Ge){el(Ge)}),Ug("onPointerEnter",!0,G,function(Ge){el(Ge)}),MC=function(Fe){(SC||oC)&&IC!==null&&IC!==void 0&&IC.contains(Fe.target)&&aC(!0,G)},H&&(Oe.onMouseMove=function(Ge){var Fe;(Fe=ve.onMouseMove)===null||Fe===void 0||Fe.call(ve,Ge)})),rt&&(Ug("onMouseLeave",!1,f),Ug("onPointerLeave",!1,f),bg=function(){aC(!1,f)}),Cl.has("focus")&&Ug("onFocus",!0,W),Lg.has("focus")&&Ug("onBlur",!1,X),Cl.has("contextMenu")&&(Oe.onContextMenu=function(Ge){var Fe;nC.current&&Lg.has("contextMenu")?aC(!1):(el(Ge),aC(!0)),Ge.preventDefault();for(var yC=arguments.length,QC=new Array(yC>1?yC-1:0),mC=1;mC<yC;mC++)QC[mC-1]=arguments[mC];(Fe=ve.onContextMenu)===null||Fe===void 0||Fe.call.apply(Fe,[ve,Ge].concat(QC))}),We&&(Oe.className=me(ve.className,We));var hg=O(O({},ve),Oe),tg={},gl=["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"];gl.forEach(function(Ge){ue[Ge]&&(tg[Ge]=function(){for(var Fe,yC=arguments.length,QC=new Array(yC),mC=0;mC<yC;mC++)QC[mC]=arguments[mC];(Fe=hg[Ge])===null||Fe===void 0||Fe.call.apply(Fe,[hg].concat(QC)),ue[Ge].apply(ue,QC)})});var Rl=u.cloneElement(je,O(O({},hg),tg)),Mg={x:Sn,y:Ll},sI=ge?O({},ge!==!0?ge:{}):null;return u.createElement(u.Fragment,null,u.createElement(PA,{disabled:!SC,ref:Ee,onResize:it},u.createElement(dR,{getTriggerDOMNode:Je},Rl)),u.createElement(iJ.Provider,{value:De},u.createElement(sR,{portal:e,ref:hC,prefixCls:i,popup:M,className:me(ee,xl),style:q,target:lC,onMouseEnter:MC,onMouseLeave:bg,onPointerEnter:MC,zIndex:K,open:SC,keepDom:oC,fresh:R,onClick:E,onPointerDownCapture:at,mask:B,motion:ZC,maskMotion:XC,onVisibleChanged:ct,onPrepare:Tl,forceRender:Y,autoDestroy:he,getPopupContainer:v,align:ul,arrow:sI,arrowPos:Mg,ready:nt,offsetX:cI,offsetY:uC,offsetR:tt,offsetB:Bn,onAlign:Zg,stretch:T,targetWidth:Kn/Ul,targetHeight:rI/Yn})))});return g}const kR=yR(Rc);function pR(){const[,e]=u.useReducer(g=>g+1,0);return e}function f0(e){var g=e.children,l=e.prefixCls,t=e.id,I=e.overlayInnerStyle,i=e.bodyClassName,a=e.className,r=e.style;return u.createElement("div",{className:me("".concat(l,"-content"),a),style:r},u.createElement("div",{className:me("".concat(l,"-inner"),i),id:t,role:"tooltip",style:I},typeof g=="function"?g():g))}var Ht={shiftX:64,adjustY:1},Nt={adjustX:1,shiftY:!0},rl=[0,0],WR={left:{points:["cr","cl"],overflow:Nt,offset:[-4,0],targetOffset:rl},right:{points:["cl","cr"],overflow:Nt,offset:[4,0],targetOffset:rl},top:{points:["bc","tc"],overflow:Ht,offset:[0,-4],targetOffset:rl},bottom:{points:["tc","bc"],overflow:Ht,offset:[0,4],targetOffset:rl},topLeft:{points:["bl","tl"],overflow:Ht,offset:[0,-4],targetOffset:rl},leftTop:{points:["tr","tl"],overflow:Nt,offset:[-4,0],targetOffset:rl},topRight:{points:["br","tr"],overflow:Ht,offset:[0,-4],targetOffset:rl},rightTop:{points:["tl","tr"],overflow:Nt,offset:[4,0],targetOffset:rl},bottomRight:{points:["tr","br"],overflow:Ht,offset:[0,4],targetOffset:rl},rightBottom:{points:["bl","br"],overflow:Nt,offset:[4,0],targetOffset:rl},bottomLeft:{points:["tl","bl"],overflow:Ht,offset:[0,4],targetOffset:rl},leftBottom:{points:["br","bl"],overflow:Nt,offset:[-4,0],targetOffset:rl}},VR=["overlayClassName","trigger","mouseEnterDelay","mouseLeaveDelay","overlayStyle","prefixCls","children","onVisibleChange","afterVisibleChange","transitionName","animation","motion","placement","align","destroyTooltipOnHide","defaultVisible","getTooltipContainer","overlayInnerStyle","arrowContent","overlay","id","showArrow","classNames","styles"],fR=function(g,l){var t=g.overlayClassName,I=g.trigger,i=I===void 0?["hover"]:I,a=g.mouseEnterDelay,r=a===void 0?0:a,s=g.mouseLeaveDelay,d=s===void 0?.1:s,J=g.overlayStyle,Z=g.prefixCls,b=Z===void 0?"rc-tooltip":Z,p=g.children,y=g.onVisibleChange,G=g.afterVisibleChange,h=g.transitionName,f=g.animation,W=g.motion,X=g.placement,B=X===void 0?"right":X,V=g.align,Q=V===void 0?{}:V,v=g.destroyTooltipOnHide,Y=v===void 0?!1:v,F=g.defaultVisible,L=g.getTooltipContainer,M=g.overlayInnerStyle;g.arrowContent;var ee=g.overlay,q=g.id,P=g.showArrow,le=P===void 0?!0:P,N=g.classNames,w=g.styles,K=wC(g,VR),T=u.useRef(null);u.useImperativeHandle(l,function(){return T.current});var z=O({},K);"visible"in g&&(z.popupVisible=g.visible);var R=function(){return u.createElement(f0,{key:"content",prefixCls:b,id:q,bodyClassName:N==null?void 0:N.body,overlayInnerStyle:O(O({},M),w==null?void 0:w.body)},ee)};return u.createElement(kR,Be({popupClassName:me(t,N==null?void 0:N.root),prefixCls:b,popup:R,action:i,builtinPlacements:WR,popupPlacement:B,ref:T,popupAlign:Q,getPopupContainer:L,onPopupVisibleChange:y,afterPopupVisibleChange:G,popupTransitionName:h,popupAnimation:f,popupMotion:W,defaultPopupVisible:F,autoDestroy:Y,mouseLeaveDelay:d,popupStyle:O(O({},J),w==null?void 0:w.root),mouseEnterDelay:r,arrow:le},z),p)};const XR=u.forwardRef(fR);function RR(e){const{sizePopupArrow:g,borderRadiusXS:l,borderRadiusOuter:t}=e,I=g/2,i=0,a=I,r=t*1/Math.sqrt(2),s=I-t*(1-1/Math.sqrt(2)),d=I-l*(1/Math.sqrt(2)),J=t*(Math.sqrt(2)-1)+l*(1/Math.sqrt(2)),Z=2*I-d,b=J,p=2*I-r,y=s,G=2*I-i,h=a,f=I*Math.sqrt(2)+t*(Math.sqrt(2)-2),W=t*(Math.sqrt(2)-1),X=`polygon(${W}px 100%, 50% ${W}px, ${2*I-W}px 100%, ${W}px 100%)`,B=`path('M ${i} ${a} A ${t} ${t} 0 0 0 ${r} ${s} L ${d} ${J} A ${l} ${l} 0 0 1 ${Z} ${b} L ${p} ${y} A ${t} ${t} 0 0 0 ${G} ${h} Z')`;return{arrowShadowWidth:f,arrowPath:B,arrowPolygon:X}}const QR=(e,g,l)=>{const{sizePopupArrow:t,arrowPolygon:I,arrowPath:i,arrowShadowWidth:a,borderRadiusXS:r,calc:s}=e;return{pointerEvents:"none",width:t,height:t,overflow:"hidden","&::before":{position:"absolute",bottom:0,insetInlineStart:0,width:t,height:s(t).div(2).equal(),background:g,clipPath:{_multi_value_:!0,value:[I,i]},content:'""'},"&::after":{content:'""',position:"absolute",width:a,height:a,bottom:0,insetInline:0,margin:"auto",borderRadius:{_skip_check_:!0,value:`0 0 ${Le(r)} 0`},transform:"translateY(50%) rotate(-135deg)",boxShadow:l,zIndex:0,background:"transparent"}}},X0=8;function R0(e){const{contentRadius:g,limitVerticalRadius:l}=e,t=g>12?g+2:12;return{arrowOffsetHorizontal:t,arrowOffsetVertical:l?X0:t}}function wi(e,g){return e?g:{}}function vR(e,g,l){const{componentCls:t,boxShadowPopoverArrow:I,arrowOffsetVertical:i,arrowOffsetHorizontal:a}=e,{arrowDistance:r=0,arrowPlacement:s={left:!0,right:!0,top:!0,bottom:!0}}={};return{[t]:Object.assign(Object.assign(Object.assign(Object.assign({[`${t}-arrow`]:[Object.assign(Object.assign({position:"absolute",zIndex:1,display:"block"},QR(e,g,I)),{"&:before":{background:g}})]},wi(!!s.top,{[[`&-placement-top > ${t}-arrow`,`&-placement-topLeft > ${t}-arrow`,`&-placement-topRight > ${t}-arrow`].join(",")]:{bottom:r,transform:"translateY(100%) rotate(180deg)"},[`&-placement-top > ${t}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(100%) rotate(180deg)"},"&-placement-topLeft":{"--arrow-offset-horizontal":a,[`> ${t}-arrow`]:{left:{_skip_check_:!0,value:a}}},"&-placement-topRight":{"--arrow-offset-horizontal":`calc(100% - ${Le(a)})`,[`> ${t}-arrow`]:{right:{_skip_check_:!0,value:a}}}})),wi(!!s.bottom,{[[`&-placement-bottom > ${t}-arrow`,`&-placement-bottomLeft > ${t}-arrow`,`&-placement-bottomRight > ${t}-arrow`].join(",")]:{top:r,transform:"translateY(-100%)"},[`&-placement-bottom > ${t}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(-100%)"},"&-placement-bottomLeft":{"--arrow-offset-horizontal":a,[`> ${t}-arrow`]:{left:{_skip_check_:!0,value:a}}},"&-placement-bottomRight":{"--arrow-offset-horizontal":`calc(100% - ${Le(a)})`,[`> ${t}-arrow`]:{right:{_skip_check_:!0,value:a}}}})),wi(!!s.left,{[[`&-placement-left > ${t}-arrow`,`&-placement-leftTop > ${t}-arrow`,`&-placement-leftBottom > ${t}-arrow`].join(",")]:{right:{_skip_check_:!0,value:r},transform:"translateX(100%) rotate(90deg)"},[`&-placement-left > ${t}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(100%) rotate(90deg)"},[`&-placement-leftTop > ${t}-arrow`]:{top:i},[`&-placement-leftBottom > ${t}-arrow`]:{bottom:i}})),wi(!!s.right,{[[`&-placement-right > ${t}-arrow`,`&-placement-rightTop > ${t}-arrow`,`&-placement-rightBottom > ${t}-arrow`].join(",")]:{left:{_skip_check_:!0,value:r},transform:"translateX(-100%) rotate(-90deg)"},[`&-placement-right > ${t}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"},[`&-placement-rightTop > ${t}-arrow`]:{top:i},[`&-placement-rightBottom > ${t}-arrow`]:{bottom:i}}))}}function BR(e,g,l,t){if(t===!1)return{adjustX:!1,adjustY:!1};const I=t&&typeof t=="object"?t:{},i={};switch(e){case"top":case"bottom":i.shiftX=g.arrowOffsetHorizontal*2+l,i.shiftY=!0,i.adjustY=!0;break;case"left":case"right":i.shiftY=g.arrowOffsetVertical*2+l,i.shiftX=!0,i.adjustX=!0;break}const a=Object.assign(Object.assign({},i),I);return a.shiftX||(a.adjustX=!0),a.shiftY||(a.adjustY=!0),a}const uJ={left:{points:["cr","cl"]},right:{points:["cl","cr"]},top:{points:["bc","tc"]},bottom:{points:["tc","bc"]},topLeft:{points:["bl","tl"]},leftTop:{points:["tr","tl"]},topRight:{points:["br","tr"]},rightTop:{points:["tl","tr"]},bottomRight:{points:["tr","br"]},rightBottom:{points:["bl","br"]},bottomLeft:{points:["tl","bl"]},leftBottom:{points:["br","bl"]}},SR={topLeft:{points:["bl","tc"]},leftTop:{points:["tr","cl"]},topRight:{points:["br","tc"]},rightTop:{points:["tl","cr"]},bottomRight:{points:["tr","bc"]},rightBottom:{points:["bl","cr"]},bottomLeft:{points:["tl","bc"]},leftBottom:{points:["br","cl"]}},YR=new Set(["topLeft","topRight","bottomLeft","bottomRight","leftTop","leftBottom","rightTop","rightBottom"]);function FR(e){const{arrowWidth:g,autoAdjustOverflow:l,arrowPointAtCenter:t,offset:I,borderRadius:i}=e,a=g/2,r={};return Object.keys(uJ).forEach(s=>{const d=t&&SR[s]||uJ[s],J=Object.assign(Object.assign({},d),{offset:[0,0],dynamicInset:!0});switch(r[s]=J,YR.has(s)&&(J.autoArrow=!1),s){case"top":case"topLeft":case"topRight":J.offset[1]=-a-I;break;case"bottom":case"bottomLeft":case"bottomRight":J.offset[1]=a+I;break;case"left":case"leftTop":case"leftBottom":J.offset[0]=-a-I;break;case"right":case"rightTop":case"rightBottom":J.offset[0]=a+I;break}const Z=R0({contentRadius:i,limitVerticalRadius:!0});if(t)switch(s){case"topLeft":case"bottomLeft":J.offset[0]=-Z.arrowOffsetHorizontal-a;break;case"topRight":case"bottomRight":J.offset[0]=Z.arrowOffsetHorizontal+a;break;case"leftTop":case"rightTop":J.offset[1]=-Z.arrowOffsetHorizontal*2+a;break;case"leftBottom":case"rightBottom":J.offset[1]=Z.arrowOffsetHorizontal*2-a;break}J.overflow=BR(s,Z,g,l),J.htmlRegion="visibleFirst"}),r}const KR=e=>{const{calc:g,componentCls:l,tooltipMaxWidth:t,tooltipColor:I,tooltipBg:i,tooltipBorderRadius:a,zIndexPopup:r,controlHeight:s,boxShadowSecondary:d,paddingSM:J,paddingXS:Z,arrowOffsetHorizontal:b,sizePopupArrow:p}=e,y=g(a).add(p).add(b).equal(),G=g(a).mul(2).add(p).equal();return[{[l]:Object.assign(Object.assign(Object.assign(Object.assign({},po(e)),{position:"absolute",zIndex:r,display:"block",width:"max-content",maxWidth:t,visibility:"visible","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"&-hidden":{display:"none"},"--antd-arrow-background-color":i,[`${l}-inner`]:{minWidth:G,minHeight:s,padding:`${Le(e.calc(J).div(2).equal())} ${Le(Z)}`,color:I,textAlign:"start",textDecoration:"none",wordWrap:"break-word",backgroundColor:i,borderRadius:a,boxShadow:d,boxSizing:"border-box"},[["&-placement-topLeft","&-placement-topRight","&-placement-bottomLeft","&-placement-bottomRight"].join(",")]:{minWidth:y},[["&-placement-left","&-placement-leftTop","&-placement-leftBottom","&-placement-right","&-placement-rightTop","&-placement-rightBottom"].join(",")]:{[`${l}-inner`]:{borderRadius:e.min(a,X0)}},[`${l}-content`]:{position:"relative"}}),jp(e,(h,f)=>{let{darkColor:W}=f;return{[`&${l}-${h}`]:{[`${l}-inner`]:{backgroundColor:W},[`${l}-arrow`]:{"--antd-arrow-background-color":W}}}})),{"&-rtl":{direction:"rtl"}})},vR(e,"var(--antd-arrow-background-color)"),{[`${l}-pure`]:{position:"relative",maxWidth:"none",margin:e.sizePopupArrow}}]},wR=e=>Object.assign(Object.assign({zIndexPopup:e.zIndexPopupBase+70},R0({contentRadius:e.borderRadius,limitVerticalRadius:!0})),RR(pg(e,{borderRadiusOuter:Math.min(e.borderRadiusOuter,4)}))),Q0=function(e){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return gn("Tooltip",t=>{const{borderRadius:I,colorTextLightSolid:i,colorBgSpotlight:a}=t,r=pg(t,{tooltipMaxWidth:250,tooltipColor:i,tooltipBorderRadius:I,tooltipBg:a});return[KR(r),cs(t,"zoom-big-fast")]},wR,{resetStyle:!1,injectStyle:g})(e)},HR=lI.map(e=>`${e}-inverse`);function NR(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?[].concat(ye(HR),ye(lI)).includes(e):lI.includes(e)}function v0(e,g){const l=NR(g),t=me({[`${e}-${g}`]:g&&l}),I={},i={};return g&&!l&&(I.background=g,i["--antd-arrow-background-color"]=g),{className:t,overlayStyle:I,arrowStyle:i}}const zR=e=>{const{prefixCls:g,className:l,placement:t="top",title:I,color:i,overlayInnerStyle:a}=e,{getPrefixCls:r}=u.useContext(zC),s=r("tooltip",g),[d,J,Z]=Q0(s),b=v0(s,i),p=b.arrowStyle,y=Object.assign(Object.assign({},a),b.overlayStyle),G=me(J,Z,s,`${s}-pure`,`${s}-placement-${t}`,l,b.className);return d(u.createElement("div",{className:G,style:p},u.createElement("div",{className:`${s}-arrow`}),u.createElement(f0,Object.assign({},e,{className:J,prefixCls:s,overlayInnerStyle:y}),I)))};var LR=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const UR=u.forwardRef((e,g)=>{var l,t,I,i,a,r;const{prefixCls:s,openClassName:d,getTooltipContainer:J,color:Z,overlayInnerStyle:b,children:p,afterOpenChange:y,afterVisibleChange:G,destroyTooltipOnHide:h,arrow:f=!0,title:W,overlay:X,builtinPlacements:B,arrowPointAtCenter:V=!1,autoAdjustOverflow:Q=!0,motion:v,getPopupContainer:Y,placement:F="top",mouseEnterDelay:L=.1,mouseLeaveDelay:M=.1,overlayStyle:ee,rootClassName:q,overlayClassName:P,styles:le,classNames:N}=e,w=LR(e,["prefixCls","openClassName","getTooltipContainer","color","overlayInnerStyle","children","afterOpenChange","afterVisibleChange","destroyTooltipOnHide","arrow","title","overlay","builtinPlacements","arrowPointAtCenter","autoAdjustOverflow","motion","getPopupContainer","placement","mouseEnterDelay","mouseLeaveDelay","overlayStyle","rootClassName","overlayClassName","styles","classNames"]),K=!!f,[,T]=vn(),{getPopupContainer:z,getPrefixCls:R,direction:H,tooltip:E}=u.useContext(zC),j=Cs(),ge=u.useRef(null),ne=()=>{var Pe;(Pe=ge.current)===null||Pe===void 0||Pe.forceAlign()};u.useImperativeHandle(g,()=>{var Pe;return{forceAlign:ne,forcePopupAlign:()=>{j.deprecated(!1,"forcePopupAlign","forceAlign"),ne()},nativeElement:(Pe=ge.current)===null||Pe===void 0?void 0:Pe.nativeElement}});const[ie,Ae]=so(!1,{value:(l=e.open)!==null&&l!==void 0?l:e.visible,defaultValue:(t=e.defaultOpen)!==null&&t!==void 0?t:e.defaultVisible}),ae=!W&&!X&&W!==0,se=Pe=>{var lC,Te;Ae(ae?!1:Pe),ae||((lC=e.onOpenChange)===null||lC===void 0||lC.call(e,Pe),(Te=e.onVisibleChange)===null||Te===void 0||Te.call(e,Pe))},ze=u.useMemo(()=>{var Pe,lC;let Te=V;return typeof f=="object"&&(Te=(lC=(Pe=f.pointAtCenter)!==null&&Pe!==void 0?Pe:f.arrowPointAtCenter)!==null&&lC!==void 0?lC:V),B||FR({arrowPointAtCenter:Te,autoAdjustOverflow:Q,arrowWidth:K?T.sizePopupArrow:0,borderRadius:T.borderRadius,offset:T.marginXXS})},[V,f,B,T]),We=u.useMemo(()=>W===0?W:X||W||"",[X,W]),Je=u.createElement(jX,{space:!0},typeof We=="function"?We():We),ue=R("tooltip",s),he=R(),Se=e["data-popover-inject"];let Ke=ie;!("open"in e)&&!("visible"in e)&&ae&&(Ke=!1);const Ye=u.isValidElement(p)&&!$Z(p)?p:u.createElement("span",null,p),Ue=Ye.props,Me=!Ue.className||typeof Ue.className=="string"?me(Ue.className,d||`${ue}-open`):Ue.className,[Re,De,fe]=Q0(ue,!Se),_e=v0(ue,Z),eC=_e.arrowStyle,IC=me(P,{[`${ue}-rtl`]:H==="rtl"},_e.className,q,De,fe,E==null?void 0:E.className,(I=E==null?void 0:E.classNames)===null||I===void 0?void 0:I.root,N==null?void 0:N.root),pC=me((i=E==null?void 0:E.classNames)===null||i===void 0?void 0:i.body,N==null?void 0:N.body),[cC,hC]=ts("Tooltip",w.zIndex),WC=u.createElement(XR,Object.assign({},w,{zIndex:cC,showArrow:K,placement:F,mouseEnterDelay:L,mouseLeaveDelay:M,prefixCls:ue,classNames:{root:IC,body:pC},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},eC),(a=E==null?void 0:E.styles)===null||a===void 0?void 0:a.root),E==null?void 0:E.style),ee),le==null?void 0:le.root),body:Object.assign(Object.assign(Object.assign(Object.assign({},(r=E==null?void 0:E.styles)===null||r===void 0?void 0:r.body),b),le==null?void 0:le.body),_e.overlayStyle)},getTooltipContainer:Y||J||z,ref:ge,builtinPlacements:ze,overlay:Je,visible:Ke,onVisibleChange:se,afterVisibleChange:y??G,arrowContent:u.createElement("span",{className:`${ue}-arrow-content`}),motion:{motionName:mo(he,"zoom-big-fast",e.transitionName),motionDeadline:1e3},destroyTooltipOnHide:!!h}),Ke?uo(Ye,{className:Me}):Ye);return Re(u.createElement(e0.Provider,{value:hC},WC))}),ss=UR;ss._InternalPanelDoNotUseOrYouWillBeFired=zR;function B0(){var e=document.documentElement.clientWidth,g=window.innerHeight||document.documentElement.clientHeight;return{width:e,height:g}}function MR(e){var g=e.getBoundingClientRect(),l=document.documentElement;return{left:g.left+(window.pageXOffset||l.scrollLeft)-(l.clientLeft||document.body.clientLeft||0),top:g.top+(window.pageYOffset||l.scrollTop)-(l.clientTop||document.body.clientTop||0)}}function Tt(e,g,l,t){var I=lo.unstable_batchedUpdates?function(a){lo.unstable_batchedUpdates(l,a)}:l;return e!=null&&e.addEventListener&&e.addEventListener(g,I,t),{remove:function(){e!=null&&e.removeEventListener&&e.removeEventListener(g,I,t)}}}var Ro=u.createContext(null),xR=function(g){var l=g.visible,t=g.maskTransitionName,I=g.getContainer,i=g.prefixCls,a=g.rootClassName,r=g.icons,s=g.countRender,d=g.showSwitch,J=g.showProgress,Z=g.current,b=g.transform,p=g.count,y=g.scale,G=g.minScale,h=g.maxScale,f=g.closeIcon,W=g.onActive,X=g.onClose,B=g.onZoomIn,V=g.onZoomOut,Q=g.onRotateRight,v=g.onRotateLeft,Y=g.onFlipX,F=g.onFlipY,L=g.onReset,M=g.toolbarRender,ee=g.zIndex,q=g.image,P=u.useContext(Ro),le=r.rotateLeft,N=r.rotateRight,w=r.zoomIn,K=r.zoomOut,T=r.close,z=r.left,R=r.right,H=r.flipX,E=r.flipY,j="".concat(i,"-operations-operation");u.useEffect(function(){var Se=function(Ye){Ye.keyCode===nI.ESC&&X()};return l&&window.addEventListener("keydown",Se),function(){window.removeEventListener("keydown",Se)}},[l]);var ge=function(Ke,Ye){Ke.preventDefault(),Ke.stopPropagation(),W(Ye)},ne=u.useCallback(function(Se){var Ke=Se.type,Ye=Se.disabled,Ue=Se.onClick,Me=Se.icon;return u.createElement("div",{key:Ke,className:me(j,"".concat(i,"-operations-operation-").concat(Ke),D({},"".concat(i,"-operations-operation-disabled"),!!Ye)),onClick:Ue},Me)},[j,i]),ie=d?ne({icon:z,onClick:function(Ke){return ge(Ke,-1)},type:"prev",disabled:Z===0}):void 0,Ae=d?ne({icon:R,onClick:function(Ke){return ge(Ke,1)},type:"next",disabled:Z===p-1}):void 0,ae=ne({icon:E,onClick:F,type:"flipY"}),se=ne({icon:H,onClick:Y,type:"flipX"}),ze=ne({icon:le,onClick:v,type:"rotateLeft"}),We=ne({icon:N,onClick:Q,type:"rotateRight"}),Je=ne({icon:K,onClick:V,type:"zoomOut",disabled:y<=G}),ue=ne({icon:w,onClick:B,type:"zoomIn",disabled:y===h}),he=u.createElement("div",{className:"".concat(i,"-operations")},ae,se,ze,We,Je,ue);return u.createElement(Nl,{visible:l,motionName:t},function(Se){var Ke=Se.className,Ye=Se.style;return u.createElement(Rc,{open:!0,getContainer:I??document.body},u.createElement("div",{className:me("".concat(i,"-operations-wrapper"),Ke,a),style:O(O({},Ye),{},{zIndex:ee})},f===null?null:u.createElement("button",{className:"".concat(i,"-close"),onClick:X},f||T),d&&u.createElement(u.Fragment,null,u.createElement("div",{className:me("".concat(i,"-switch-left"),D({},"".concat(i,"-switch-left-disabled"),Z===0)),onClick:function(Me){return ge(Me,-1)}},z),u.createElement("div",{className:me("".concat(i,"-switch-right"),D({},"".concat(i,"-switch-right-disabled"),Z===p-1)),onClick:function(Me){return ge(Me,1)}},R)),u.createElement("div",{className:"".concat(i,"-footer")},J&&u.createElement("div",{className:"".concat(i,"-progress")},s?s(Z+1,p):"".concat(Z+1," / ").concat(p)),M?M(he,O(O({icons:{prevIcon:ie,nextIcon:Ae,flipYIcon:ae,flipXIcon:se,rotateLeftIcon:ze,rotateRightIcon:We,zoomOutIcon:Je,zoomInIcon:ue},actions:{onActive:W,onFlipY:F,onFlipX:Y,onRotateLeft:v,onRotateRight:Q,onZoomOut:V,onZoomIn:B,onReset:L,onClose:X},transform:b},P?{current:Z,total:p}:{}),{},{image:q})):he)))})},Hi={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function TR(e,g,l,t){var I=u.useRef(null),i=u.useRef([]),a=u.useState(Hi),r=oe(a,2),s=r[0],d=r[1],J=function(y){d(Hi),lc(Hi,s)||t==null||t({transform:Hi,action:y})},Z=function(y,G){I.current===null&&(i.current=[],I.current=Rn(function(){d(function(h){var f=h;return i.current.forEach(function(W){f=O(O({},f),W)}),I.current=null,t==null||t({transform:f,action:G}),f})})),i.current.push(O(O({},s),y))},b=function(y,G,h,f,W){var X=e.current,B=X.width,V=X.height,Q=X.offsetWidth,v=X.offsetHeight,Y=X.offsetLeft,F=X.offsetTop,L=y,M=s.scale*y;M>l?(M=l,L=l/s.scale):M<g&&(M=W?M:g,L=M/s.scale);var ee=h??innerWidth/2,q=f??innerHeight/2,P=L-1,le=P*B*.5,N=P*V*.5,w=P*(ee-s.x-Y),K=P*(q-s.y-F),T=s.x-(w-le),z=s.y-(K-N);if(y<1&&M===1){var R=Q*M,H=v*M,E=B0(),j=E.width,ge=E.height;R<=j&&H<=ge&&(T=0,z=0)}Z({x:T,y:z,scale:M},G)};return{transform:s,resetTransform:J,updateTransform:Z,dispatchZoomChange:b}}function mJ(e,g,l,t){var I=g+l,i=(l-t)/2;if(l>t){if(g>0)return D({},e,i);if(g<0&&I<t)return D({},e,-i)}else if(g<0||I>t)return D({},e,g<0?i:-i);return{}}function S0(e,g,l,t){var I=B0(),i=I.width,a=I.height,r=null;return e<=i&&g<=a?r={x:0,y:0}:(e>i||g>a)&&(r=O(O({},mJ("x",l,e,i)),mJ("y",t,g,a))),r}var Dt=1,DR=1;function ER(e,g,l,t,I,i,a){var r=I.rotate,s=I.scale,d=I.x,J=I.y,Z=u.useState(!1),b=oe(Z,2),p=b[0],y=b[1],G=u.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),h=function(V){!g||V.button!==0||(V.preventDefault(),V.stopPropagation(),G.current={diffX:V.pageX-d,diffY:V.pageY-J,transformX:d,transformY:J},y(!0))},f=function(V){l&&p&&i({x:V.pageX-G.current.diffX,y:V.pageY-G.current.diffY},"move")},W=function(){if(l&&p){y(!1);var V=G.current,Q=V.transformX,v=V.transformY,Y=d!==Q&&J!==v;if(!Y)return;var F=e.current.offsetWidth*s,L=e.current.offsetHeight*s,M=e.current.getBoundingClientRect(),ee=M.left,q=M.top,P=r%180!==0,le=S0(P?L:F,P?F:L,ee,q);le&&i(O({},le),"dragRebound")}},X=function(V){if(!(!l||V.deltaY==0)){var Q=Math.abs(V.deltaY/100),v=Math.min(Q,DR),Y=Dt+v*t;V.deltaY>0&&(Y=Dt/Y),a(Y,"wheel",V.clientX,V.clientY)}};return u.useEffect(function(){var B,V,Q,v;if(g){Q=Tt(window,"mouseup",W,!1),v=Tt(window,"mousemove",f,!1);try{window.top!==window.self&&(B=Tt(window.top,"mouseup",W,!1),V=Tt(window.top,"mousemove",f,!1))}catch{}}return function(){var Y,F,L,M;(Y=Q)===null||Y===void 0||Y.remove(),(F=v)===null||F===void 0||F.remove(),(L=B)===null||L===void 0||L.remove(),(M=V)===null||M===void 0||M.remove()}},[l,p,d,J,r,g]),{isMoving:p,onMouseDown:h,onMouseMove:f,onMouseUp:W,onWheel:X}}function OR(e){return new Promise(function(g){var l=document.createElement("img");l.onerror=function(){return g(!1)},l.onload=function(){return g(!0)},l.src=e})}function Y0(e){var g=e.src,l=e.isCustomPlaceholder,t=e.fallback,I=u.useState(l?"loading":"normal"),i=oe(I,2),a=i[0],r=i[1],s=u.useRef(!1),d=a==="error";u.useEffect(function(){var p=!0;return OR(g).then(function(y){!y&&p&&r("error")}),function(){p=!1}},[g]),u.useEffect(function(){l&&!s.current?r("loading"):d&&r("normal")},[g]);var J=function(){r("normal")},Z=function(y){s.current=!1,a==="loading"&&y!==null&&y!==void 0&&y.complete&&(y.naturalWidth||y.naturalHeight)&&(s.current=!0,J())},b=d&&t?{src:t}:{onLoad:J,src:g};return[Z,b,a]}function cc(e,g){var l=e.x-g.x,t=e.y-g.y;return Math.hypot(l,t)}function PR(e,g,l,t){var I=cc(e,l),i=cc(g,t);if(I===0&&i===0)return[e.x,e.y];var a=I/(I+i),r=e.x+a*(g.x-e.x),s=e.y+a*(g.y-e.y);return[r,s]}function jR(e,g,l,t,I,i,a){var r=I.rotate,s=I.scale,d=I.x,J=I.y,Z=u.useState(!1),b=oe(Z,2),p=b[0],y=b[1],G=u.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),h=function(V){G.current=O(O({},G.current),V)},f=function(V){if(g){V.stopPropagation(),y(!0);var Q=V.touches,v=Q===void 0?[]:Q;v.length>1?h({point1:{x:v[0].clientX,y:v[0].clientY},point2:{x:v[1].clientX,y:v[1].clientY},eventType:"touchZoom"}):h({point1:{x:v[0].clientX-d,y:v[0].clientY-J},eventType:"move"})}},W=function(V){var Q=V.touches,v=Q===void 0?[]:Q,Y=G.current,F=Y.point1,L=Y.point2,M=Y.eventType;if(v.length>1&&M==="touchZoom"){var ee={x:v[0].clientX,y:v[0].clientY},q={x:v[1].clientX,y:v[1].clientY},P=PR(F,L,ee,q),le=oe(P,2),N=le[0],w=le[1],K=cc(ee,q)/cc(F,L);a(K,"touchZoom",N,w,!0),h({point1:ee,point2:q,eventType:"touchZoom"})}else M==="move"&&(i({x:v[0].clientX-F.x,y:v[0].clientY-F.y},"move"),h({eventType:"move"}))},X=function(){if(l){if(p&&y(!1),h({eventType:"none"}),t>s)return i({x:0,y:0,scale:t},"touchZoom");var V=e.current.offsetWidth*s,Q=e.current.offsetHeight*s,v=e.current.getBoundingClientRect(),Y=v.left,F=v.top,L=r%180!==0,M=S0(L?Q:V,L?V:Q,Y,F);M&&i(O({},M),"dragRebound")}};return u.useEffect(function(){var B;return l&&g&&(B=Tt(window,"touchmove",function(V){return V.preventDefault()},{passive:!1})),function(){var V;(V=B)===null||V===void 0||V.remove()}},[l,g]),{isTouching:p,onTouchStart:f,onTouchMove:W,onTouchEnd:X}}var $R=["fallback","src","imgRef"],qR=["prefixCls","src","alt","imageInfo","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],_R=function(g){var l=g.fallback,t=g.src,I=g.imgRef,i=wC(g,$R),a=Y0({src:t,fallback:l}),r=oe(a,2),s=r[0],d=r[1];return de.createElement("img",Be({ref:function(Z){I.current=Z,s(Z)}},i,d))},F0=function(g){var l=g.prefixCls,t=g.src,I=g.alt,i=g.imageInfo,a=g.fallback,r=g.movable,s=r===void 0?!0:r,d=g.onClose,J=g.visible,Z=g.icons,b=Z===void 0?{}:Z,p=g.rootClassName,y=g.closeIcon,G=g.getContainer,h=g.current,f=h===void 0?0:h,W=g.count,X=W===void 0?1:W,B=g.countRender,V=g.scaleStep,Q=V===void 0?.5:V,v=g.minScale,Y=v===void 0?1:v,F=g.maxScale,L=F===void 0?50:F,M=g.transitionName,ee=M===void 0?"zoom":M,q=g.maskTransitionName,P=q===void 0?"fade":q,le=g.imageRender,N=g.imgCommonProps,w=g.toolbarRender,K=g.onTransform,T=g.onChange,z=wC(g,qR),R=u.useRef(),H=u.useContext(Ro),E=H&&X>1,j=H&&X>=1,ge=u.useState(!0),ne=oe(ge,2),ie=ne[0],Ae=ne[1],ae=TR(R,Y,L,K),se=ae.transform,ze=ae.resetTransform,We=ae.updateTransform,Je=ae.dispatchZoomChange,ue=ER(R,s,J,Q,se,We,Je),he=ue.isMoving,Se=ue.onMouseDown,Ke=ue.onWheel,Ye=jR(R,s,J,Y,se,We,Je),Ue=Ye.isTouching,Me=Ye.onTouchStart,Re=Ye.onTouchMove,De=Ye.onTouchEnd,fe=se.rotate,_e=se.scale,eC=me(D({},"".concat(l,"-moving"),he));u.useEffect(function(){ie||Ae(!0)},[ie]);var IC=function(){ze("close")},pC=function(){Je(Dt+Q,"zoomIn")},cC=function(){Je(Dt/(Dt+Q),"zoomOut")},hC=function(){We({rotate:fe+90},"rotateRight")},WC=function(){We({rotate:fe-90},"rotateLeft")},Pe=function(){We({flipX:!se.flipX},"flipX")},lC=function(){We({flipY:!se.flipY},"flipY")},Te=function(){ze("reset")},Ze=function(ZC){var XC=f+ZC;!Number.isInteger(XC)||XC<0||XC>X-1||(Ae(!1),ze(ZC<0?"prev":"next"),T==null||T(XC,f))},Ee=function(ZC){!J||!E||(ZC.keyCode===nI.LEFT?Ze(-1):ZC.keyCode===nI.RIGHT&&Ze(1))},je=function(ZC){J&&(_e!==1?We({x:0,y:0,scale:1},"doubleClick"):Je(Dt+Q,"doubleClick",ZC.clientX,ZC.clientY))};u.useEffect(function(){var $e=Tt(window,"keydown",Ee,!1);return function(){$e.remove()}},[J,E,f]);var ve=de.createElement(_R,Be({},N,{width:g.width,height:g.height,imgRef:R,className:"".concat(l,"-img"),alt:I,style:{transform:"translate3d(".concat(se.x,"px, ").concat(se.y,"px, 0) scale3d(").concat(se.flipX?"-":"").concat(_e,", ").concat(se.flipY?"-":"").concat(_e,", 1) rotate(").concat(fe,"deg)"),transitionDuration:(!ie||Ue)&&"0s"},fallback:a,src:t,onWheel:Ke,onMouseDown:Se,onDoubleClick:je,onTouchStart:Me,onTouchMove:Re,onTouchEnd:De,onTouchCancel:De})),Oe=O({url:t,alt:I},i);return de.createElement(de.Fragment,null,de.createElement(Z0,Be({transitionName:ee,maskTransitionName:P,closable:!1,keyboard:!0,prefixCls:l,onClose:d,visible:J,classNames:{wrapper:eC},rootClassName:p,getContainer:G},z,{afterClose:IC}),de.createElement("div",{className:"".concat(l,"-img-wrapper")},le?le(ve,O({transform:se,image:Oe},H?{current:f}:{})):ve)),de.createElement(xR,{visible:J,transform:se,maskTransitionName:P,closeIcon:y,getContainer:G,prefixCls:l,rootClassName:p,icons:b,countRender:B,showSwitch:E,showProgress:j,current:f,count:X,scale:_e,minScale:Y,maxScale:L,toolbarRender:w,onActive:Ze,onZoomIn:pC,onZoomOut:cC,onRotateRight:hC,onRotateLeft:WC,onFlipX:Pe,onFlipY:lC,onClose:d,onReset:Te,zIndex:z.zIndex!==void 0?z.zIndex+1:void 0,image:Oe}))},FA=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];function eQ(e){var g=u.useState({}),l=oe(g,2),t=l[0],I=l[1],i=u.useCallback(function(r,s){return I(function(d){return O(O({},d),{},D({},r,s))}),function(){I(function(d){var J=O({},d);return delete J[r],J})}},[]),a=u.useMemo(function(){return e?e.map(function(r){if(typeof r=="string")return{data:{src:r}};var s={};return Object.keys(r).forEach(function(d){["src"].concat(ye(FA)).includes(d)&&(s[d]=r[d])}),{data:s}}):Object.keys(t).reduce(function(r,s){var d=t[s],J=d.canPreview,Z=d.data;return J&&r.push({data:Z,id:s}),r},[])},[e,t]);return[a,i,!!e]}var CQ=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],gQ=["src"],lQ=function(g){var l,t=g.previewPrefixCls,I=t===void 0?"rc-image-preview":t,i=g.children,a=g.icons,r=a===void 0?{}:a,s=g.items,d=g.preview,J=g.fallback,Z=Qe(d)==="object"?d:{},b=Z.visible,p=Z.onVisibleChange,y=Z.getContainer,G=Z.current,h=Z.movable,f=Z.minScale,W=Z.maxScale,X=Z.countRender,B=Z.closeIcon,V=Z.onChange,Q=Z.onTransform,v=Z.toolbarRender,Y=Z.imageRender,F=wC(Z,CQ),L=eQ(s),M=oe(L,3),ee=M[0],q=M[1],P=M[2],le=so(0,{value:G}),N=oe(le,2),w=N[0],K=N[1],T=u.useState(!1),z=oe(T,2),R=z[0],H=z[1],E=((l=ee[w])===null||l===void 0?void 0:l.data)||{},j=E.src,ge=wC(E,gQ),ne=so(!!b,{value:b,onChange:function(Ue,Me){p==null||p(Ue,Me,w)}}),ie=oe(ne,2),Ae=ie[0],ae=ie[1],se=u.useState(null),ze=oe(se,2),We=ze[0],Je=ze[1],ue=u.useCallback(function(Ye,Ue,Me,Re){var De=P?ee.findIndex(function(fe){return fe.data.src===Ue}):ee.findIndex(function(fe){return fe.id===Ye});K(De<0?0:De),ae(!0),Je({x:Me,y:Re}),H(!0)},[ee,P]);u.useEffect(function(){Ae?R||K(0):H(!1)},[Ae]);var he=function(Ue,Me){K(Ue),V==null||V(Ue,Me)},Se=function(){ae(!1),Je(null)},Ke=u.useMemo(function(){return{register:q,onPreview:ue}},[q,ue]);return u.createElement(Ro.Provider,{value:Ke},i,u.createElement(F0,Be({"aria-hidden":!Ae,movable:h,visible:Ae,prefixCls:I,closeIcon:B,onClose:Se,mousePosition:We,imgCommonProps:ge,src:j,fallback:J,icons:r,minScale:f,maxScale:W,getContainer:y,current:w,count:ee.length,countRender:X,onTransform:Q,toolbarRender:v,imageRender:Y,onChange:he},F)))},JJ=0;function nQ(e,g){var l=u.useState(function(){return JJ+=1,String(JJ)}),t=oe(l,1),I=t[0],i=u.useContext(Ro),a={data:g,canPreview:e};return u.useEffect(function(){if(i)return i.register(I,a)},[]),u.useEffect(function(){i&&i.register(I,a)},[e,g]),I}var tQ=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],IQ=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],ds=function(g){var l=g.src,t=g.alt,I=g.onPreviewClose,i=g.prefixCls,a=i===void 0?"rc-image":i,r=g.previewPrefixCls,s=r===void 0?"".concat(a,"-preview"):r,d=g.placeholder,J=g.fallback,Z=g.width,b=g.height,p=g.style,y=g.preview,G=y===void 0?!0:y,h=g.className,f=g.onClick,W=g.onError,X=g.wrapperClassName,B=g.wrapperStyle,V=g.rootClassName,Q=wC(g,tQ),v=d&&d!==!0,Y=Qe(G)==="object"?G:{},F=Y.src,L=Y.visible,M=L===void 0?void 0:L,ee=Y.onVisibleChange,q=ee===void 0?I:ee,P=Y.getContainer,le=P===void 0?void 0:P,N=Y.mask,w=Y.maskClassName,K=Y.movable,T=Y.icons,z=Y.scaleStep,R=Y.minScale,H=Y.maxScale,E=Y.imageRender,j=Y.toolbarRender,ge=wC(Y,IQ),ne=F??l,ie=so(!!M,{value:M,onChange:q}),Ae=oe(ie,2),ae=Ae[0],se=Ae[1],ze=Y0({src:l,isCustomPlaceholder:v,fallback:J}),We=oe(ze,3),Je=We[0],ue=We[1],he=We[2],Se=u.useState(null),Ke=oe(Se,2),Ye=Ke[0],Ue=Ke[1],Me=u.useContext(Ro),Re=!!G,De=function(){se(!1),Ue(null)},fe=me(a,X,V,D({},"".concat(a,"-error"),he==="error")),_e=u.useMemo(function(){var cC={};return FA.forEach(function(hC){g[hC]!==void 0&&(cC[hC]=g[hC])}),cC},FA.map(function(cC){return g[cC]})),eC=u.useMemo(function(){return O(O({},_e),{},{src:ne})},[ne,_e]),IC=nQ(Re,eC),pC=function(hC){var WC=MR(hC.target),Pe=WC.left,lC=WC.top;Me?Me.onPreview(IC,ne,Pe,lC):(Ue({x:Pe,y:lC}),se(!0)),f==null||f(hC)};return u.createElement(u.Fragment,null,u.createElement("div",Be({},Q,{className:fe,onClick:Re?pC:f,style:O({width:Z,height:b},B)}),u.createElement("img",Be({},_e,{className:me("".concat(a,"-img"),D({},"".concat(a,"-img-placeholder"),d===!0),h),style:O({height:b},p),ref:Je},ue,{width:Z,height:b,onError:W})),he==="loading"&&u.createElement("div",{"aria-hidden":"true",className:"".concat(a,"-placeholder")},d),N&&Re&&u.createElement("div",{className:me("".concat(a,"-mask"),w),style:{display:(p==null?void 0:p.display)==="none"?"none":void 0}},N)),!Me&&Re&&u.createElement(F0,Be({"aria-hidden":!ae,visible:ae,prefixCls:s,onClose:De,mousePosition:Ye,src:ne,alt:t,imageInfo:{width:Z,height:b},fallback:J,getContainer:le,icons:T,movable:K,scaleStep:z,minScale:R,maxScale:H,rootClassName:V,imageRender:E,imgCommonProps:_e,toolbarRender:j},ge)))};ds.PreviewGroup=lQ;const KA=e=>({position:e||"absolute",inset:0}),oQ=e=>{const{iconCls:g,motionDurationSlow:l,paddingXXS:t,marginXXS:I,prefixCls:i,colorTextLightSolid:a}=e;return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:a,background:new AC("#000").setA(.5).toRgbString(),cursor:"pointer",opacity:0,transition:`opacity ${l}`,[`.${i}-mask-info`]:Object.assign(Object.assign({},ls),{padding:`0 ${Le(t)}`,[g]:{marginInlineEnd:I,svg:{verticalAlign:"baseline"}}})}},iQ=e=>{const{previewCls:g,modalMaskBg:l,paddingSM:t,marginXL:I,margin:i,paddingLG:a,previewOperationColorDisabled:r,previewOperationHoverColor:s,motionDurationSlow:d,iconCls:J,colorTextLightSolid:Z}=e,b=new AC(l).setA(.1),p=b.clone().setA(.2);return{[`${g}-footer`]:{position:"fixed",bottom:I,left:{_skip_check_:!0,value:"50%"},display:"flex",flexDirection:"column",alignItems:"center",color:e.previewOperationColor,transform:"translateX(-50%)"},[`${g}-progress`]:{marginBottom:i},[`${g}-close`]:{position:"fixed",top:I,right:{_skip_check_:!0,value:I},display:"flex",color:Z,backgroundColor:b.toRgbString(),borderRadius:"50%",padding:t,outline:0,border:0,cursor:"pointer",transition:`all ${d}`,"&:hover":{backgroundColor:p.toRgbString()},[`& > ${J}`]:{fontSize:e.previewOperationSize}},[`${g}-operations`]:{display:"flex",alignItems:"center",padding:`0 ${Le(a)}`,backgroundColor:b.toRgbString(),borderRadius:100,"&-operation":{marginInlineStart:t,padding:t,cursor:"pointer",transition:`all ${d}`,userSelect:"none",[`&:not(${g}-operations-operation-disabled):hover > ${J}`]:{color:s},"&-disabled":{color:r,cursor:"not-allowed"},"&:first-of-type":{marginInlineStart:0},[`& > ${J}`]:{fontSize:e.previewOperationSize}}}}},cQ=e=>{const{modalMaskBg:g,iconCls:l,previewOperationColorDisabled:t,previewCls:I,zIndexPopup:i,motionDurationSlow:a}=e,r=new AC(g).setA(.1),s=r.clone().setA(.2);return{[`${I}-switch-left, ${I}-switch-right`]:{position:"fixed",insetBlockStart:"50%",zIndex:e.calc(i).add(1).equal(),display:"flex",alignItems:"center",justifyContent:"center",width:e.imagePreviewSwitchSize,height:e.imagePreviewSwitchSize,marginTop:e.calc(e.imagePreviewSwitchSize).mul(-1).div(2).equal(),color:e.previewOperationColor,background:r.toRgbString(),borderRadius:"50%",transform:"translateY(-50%)",cursor:"pointer",transition:`all ${a}`,userSelect:"none","&:hover":{background:s.toRgbString()},"&-disabled":{"&, &:hover":{color:t,background:"transparent",cursor:"not-allowed",[`> ${l}`]:{cursor:"not-allowed"}}},[`> ${l}`]:{fontSize:e.previewOperationSize}},[`${I}-switch-left`]:{insetInlineStart:e.marginSM},[`${I}-switch-right`]:{insetInlineEnd:e.marginSM}}},aQ=e=>{const{motionEaseOut:g,previewCls:l,motionDurationSlow:t,componentCls:I}=e;return[{[`${I}-preview-root`]:{[l]:{height:"100%",textAlign:"center",pointerEvents:"none"},[`${l}-body`]:Object.assign(Object.assign({},KA()),{overflow:"hidden"}),[`${l}-img`]:{maxWidth:"100%",maxHeight:"70%",verticalAlign:"middle",transform:"scale3d(1, 1, 1)",cursor:"grab",transition:`transform ${t} ${g} 0s`,userSelect:"none","&-wrapper":Object.assign(Object.assign({},KA()),{transition:`transform ${t} ${g} 0s`,display:"flex",justifyContent:"center",alignItems:"center","& > *":{pointerEvents:"auto"},"&::before":{display:"inline-block",width:1,height:"50%",marginInlineEnd:-1,content:'""'}})},[`${l}-moving`]:{[`${l}-preview-img`]:{cursor:"grabbing","&-wrapper":{transitionDuration:"0s"}}}}},{[`${I}-preview-root`]:{[`${l}-wrap`]:{zIndex:e.zIndexPopup}}},{[`${I}-preview-operations-wrapper`]:{position:"fixed",zIndex:e.calc(e.zIndexPopup).add(1).equal()},"&":[iQ(e),cQ(e)]}]},rQ=e=>{const{componentCls:g}=e;return{[g]:{position:"relative",display:"inline-block",[`${g}-img`]:{width:"100%",height:"auto",verticalAlign:"middle"},[`${g}-img-placeholder`]:{backgroundColor:e.colorBgContainerDisabled,backgroundImage:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQuNSAyLjVoLTEzQS41LjUgMCAwIDAgMSAzdjEwYS41LjUgMCAwIDAgLjUuNWgxM2EuNS41IDAgMCAwIC41LS41VjNhLjUuNSAwIDAgMC0uNS0uNXpNNS4yODEgNC43NWExIDEgMCAwIDEgMCAyIDEgMSAwIDAgMSAwLTJ6bTguMDMgNi44M2EuMTI3LjEyNyAwIDAgMS0uMDgxLjAzSDIuNzY5YS4xMjUuMTI1IDAgMCAxLS4wOTYtLjIwN2wyLjY2MS0zLjE1NmEuMTI2LjEyNiAwIDAgMSAuMTc3LS4wMTZsLjAxNi4wMTZMNy4wOCAxMC4wOWwyLjQ3LTIuOTNhLjEyNi4xMjYgMCAwIDEgLjE3Ny0uMDE2bC4wMTUuMDE2IDMuNTg4IDQuMjQ0YS4xMjcuMTI3IDAgMCAxLS4wMi4xNzV6IiBmaWxsPSIjOEM4QzhDIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L3N2Zz4=')",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"30%"},[`${g}-mask`]:Object.assign({},oQ(e)),[`${g}-mask:hover`]:{opacity:1},[`${g}-placeholder`]:Object.assign({},KA())}}},AQ=e=>{const{previewCls:g}=e;return{[`${g}-root`]:cs(e,"zoom"),"&":is(e,!0)}},sQ=e=>({zIndexPopup:e.zIndexPopupBase+80,previewOperationColor:new AC(e.colorTextLightSolid).setA(.65).toRgbString(),previewOperationHoverColor:new AC(e.colorTextLightSolid).setA(.85).toRgbString(),previewOperationColorDisabled:new AC(e.colorTextLightSolid).setA(.25).toRgbString(),previewOperationSize:e.fontSizeIcon*1.5}),K0=gn("Image",e=>{const g=`${e.componentCls}-preview`,l=pg(e,{previewCls:g,modalMaskBg:new AC("#000").setA(.45).toRgbString(),imagePreviewSwitchSize:e.controlHeightLG});return[rQ(l),aQ(l),V0(pg(l,{componentCls:g})),AQ(l)]},sQ);var dQ=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const w0={rotateLeft:u.createElement(ty,null),rotateRight:u.createElement(iy,null),zoomIn:u.createElement(sy,null),zoomOut:u.createElement(my,null),close:u.createElement(TA,null),left:u.createElement(TG,null),right:u.createElement(gy,null),flipX:u.createElement($u,null),flipY:u.createElement($u,{rotate:90})},uQ=e=>{var{previewPrefixCls:g,preview:l}=e,t=dQ(e,["previewPrefixCls","preview"]);const{getPrefixCls:I}=u.useContext(zC),i=I("image",g),a=`${i}-preview`,r=I(),s=yc(i),[d,J,Z]=K0(i,s),[b]=ts("ImagePreview",typeof l=="object"?l.zIndex:void 0),p=u.useMemo(()=>{var y;if(l===!1)return l;const G=typeof l=="object"?l:{},h=me(J,Z,s,(y=G.rootClassName)!==null&&y!==void 0?y:"");return Object.assign(Object.assign({},G),{transitionName:mo(r,"zoom",G.transitionName),maskTransitionName:mo(r,"fade",G.maskTransitionName),rootClassName:h,zIndex:b})},[l]);return d(u.createElement(ds.PreviewGroup,Object.assign({preview:p,previewPrefixCls:a,icons:w0},t)))};var ZJ=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const H0=e=>{var g;const{prefixCls:l,preview:t,className:I,rootClassName:i,style:a}=e,r=ZJ(e,["prefixCls","preview","className","rootClassName","style"]),{getPrefixCls:s,locale:d=Cn,getPopupContainer:J,image:Z}=u.useContext(zC),b=s("image",l),p=s(),y=d.Image||Cn.Image,G=yc(b),[h,f,W]=K0(b,G),X=me(i,f,W,G),B=me(I,f,Z==null?void 0:Z.className),[V]=ts("ImagePreview",typeof t=="object"?t.zIndex:void 0),Q=u.useMemo(()=>{var Y;if(t===!1)return t;const F=typeof t=="object"?t:{},{getContainer:L,closeIcon:M,rootClassName:ee}=F,q=ZJ(F,["getContainer","closeIcon","rootClassName"]);return Object.assign(Object.assign({mask:u.createElement("div",{className:`${b}-mask-info`},u.createElement(OJ,null),y==null?void 0:y.preview),icons:w0},q),{rootClassName:me(X,ee),getContainer:L??J,transitionName:mo(p,"zoom",F.transitionName),maskTransitionName:mo(p,"fade",F.maskTransitionName),zIndex:V,closeIcon:M??((Y=Z==null?void 0:Z.preview)===null||Y===void 0?void 0:Y.closeIcon)})},[t,y,(g=Z==null?void 0:Z.preview)===null||g===void 0?void 0:g.closeIcon]),v=Object.assign(Object.assign({},Z==null?void 0:Z.style),a);return h(u.createElement(ds,Object.assign({prefixCls:b,preview:Q,rootClassName:X,className:B,style:v},r)))};H0.PreviewGroup=uQ;let Al=null,Ct=e=>e(),bo=[],ho={};function bJ(){const{getContainer:e,duration:g,rtl:l,maxCount:t,top:I}=ho,i=(e==null?void 0:e())||document.body;return{getContainer:()=>i,duration:g,rtl:l,maxCount:t,top:I}}const mQ=de.forwardRef((e,g)=>{const{messageConfig:l,sync:t}=e,{getPrefixCls:I}=u.useContext(zC),i=ho.prefixCls||I("message"),a=u.useContext(iR),[r,s]=n0(Object.assign(Object.assign(Object.assign({},l),{prefixCls:i}),a.message));return de.useImperativeHandle(g,()=>{const d=Object.assign({},r);return Object.keys(d).forEach(J=>{d[J]=function(){return t(),r[J].apply(r,arguments)}}),{instance:d,sync:t}}),s}),JQ=de.forwardRef((e,g)=>{const[l,t]=de.useState(bJ),I=()=>{t(bJ)};de.useEffect(I,[]);const i=QW(),a=i.getRootPrefixCls(),r=i.getIconPrefixCls(),s=i.getTheme(),d=de.createElement(mQ,{ref:g,sync:I,messageConfig:l});return de.createElement(iI,{prefixCls:a,iconPrefixCls:r,theme:s},i.holderRender?i.holderRender(d):d)});function Qc(){if(!Al){const e=document.createDocumentFragment(),g={fragment:e};Al=g,Ct(()=>{t0()(de.createElement(JQ,{ref:t=>{const{instance:I,sync:i}=t||{};Promise.resolve().then(()=>{!g.instance&&I&&(g.instance=I,g.sync=i,Qc())})}}),e)});return}Al.instance&&(bo.forEach(e=>{const{type:g,skipped:l}=e;if(!l)switch(g){case"open":{Ct(()=>{const t=Al.instance.open(Object.assign(Object.assign({},ho),e.config));t==null||t.then(e.resolve),e.setCloseFn(t)});break}case"destroy":Ct(()=>{Al==null||Al.instance.destroy(e.key)});break;default:Ct(()=>{var t;const I=(t=Al.instance)[g].apply(t,ye(e.args));I==null||I.then(e.resolve),e.setCloseFn(I)})}}),bo=[])}function ZQ(e){ho=Object.assign(Object.assign({},ho),e),Ct(()=>{var g;(g=Al==null?void 0:Al.sync)===null||g===void 0||g.call(Al)})}function bQ(e){const g=Is(l=>{let t;const I={type:"open",config:e,resolve:l,setCloseFn:i=>{t=i}};return bo.push(I),()=>{t?Ct(()=>{t()}):I.skipped=!0}});return Qc(),g}function hQ(e,g){const l=Is(t=>{let I;const i={type:e,args:g,resolve:t,setCloseFn:a=>{I=a}};return bo.push(i),()=>{I?Ct(()=>{I()}):i.skipped=!0}});return Qc(),l}const GQ=e=>{bo.push({type:"destroy",key:e}),Qc()},yQ=["success","info","warning","error","loading"],kQ={open:bQ,destroy:GQ,config:ZQ,useMessage:cV,_InternalPanelDoNotUseOrYouWillBeFired:CV},N0=kQ;yQ.forEach(e=>{N0[e]=function(){for(var g=arguments.length,l=new Array(g),t=0;t<g;t++)l[t]=arguments[t];return hQ(e,l)}});var pQ={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},WQ=function(){var g=u.useRef([]),l=u.useRef(null);return u.useEffect(function(){var t=Date.now(),I=!1;g.current.forEach(function(i){if(i){I=!0;var a=i.style;a.transitionDuration=".3s, .3s, .3s, .06s",l.current&&t-l.current<100&&(a.transitionDuration="0s, 0s")}}),I&&(l.current=Date.now())}),g.current},hJ=0,VQ=Fg();function fQ(){var e;return VQ?(e=hJ,hJ+=1):e="TEST_OR_SSR",e}const XQ=function(e){var g=u.useState(),l=oe(g,2),t=l[0],I=l[1];return u.useEffect(function(){I("rc_progress_".concat(fQ()))},[]),e||t};var GJ=function(g){var l=g.bg,t=g.children;return u.createElement("div",{style:{width:"100%",height:"100%",background:l}},t)};function yJ(e,g){return Object.keys(e).map(function(l){var t=parseFloat(l),I="".concat(Math.floor(t*g),"%");return"".concat(e[l]," ").concat(I)})}var RQ=u.forwardRef(function(e,g){var l=e.prefixCls,t=e.color,I=e.gradientId,i=e.radius,a=e.style,r=e.ptg,s=e.strokeLinecap,d=e.strokeWidth,J=e.size,Z=e.gapDegree,b=t&&Qe(t)==="object",p=b?"#FFF":void 0,y=J/2,G=u.createElement("circle",{className:"".concat(l,"-circle-path"),r:i,cx:y,cy:y,stroke:p,strokeLinecap:s,strokeWidth:d,opacity:r===0?0:1,style:a,ref:g});if(!b)return G;var h="".concat(I,"-conic"),f=Z?"".concat(180+Z/2,"deg"):"0deg",W=yJ(t,(360-Z)/360),X=yJ(t,1),B="conic-gradient(from ".concat(f,", ").concat(W.join(", "),")"),V="linear-gradient(to ".concat(Z?"bottom":"top",", ").concat(X.join(", "),")");return u.createElement(u.Fragment,null,u.createElement("mask",{id:h},G),u.createElement("foreignObject",{x:0,y:0,width:J,height:J,mask:"url(#".concat(h,")")},u.createElement(GJ,{bg:V},u.createElement(GJ,{bg:B}))))}),PI=100,Kr=function(g,l,t,I,i,a,r,s,d,J){var Z=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,b=t/100*360*((360-a)/360),p=a===0?0:{bottom:0,top:180,left:90,right:-90}[r],y=(100-I)/100*l;d==="round"&&I!==100&&(y+=J/2,y>=l&&(y=l-.01));var G=PI/2;return{stroke:typeof s=="string"?s:void 0,strokeDasharray:"".concat(l,"px ").concat(g),strokeDashoffset:y+Z,transform:"rotate(".concat(i+b+p,"deg)"),transformOrigin:"".concat(G,"px ").concat(G,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},QQ=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function kJ(e){var g=e??[];return Array.isArray(g)?g:[g]}var vQ=function(g){var l=O(O({},pQ),g),t=l.id,I=l.prefixCls,i=l.steps,a=l.strokeWidth,r=l.trailWidth,s=l.gapDegree,d=s===void 0?0:s,J=l.gapPosition,Z=l.trailColor,b=l.strokeLinecap,p=l.style,y=l.className,G=l.strokeColor,h=l.percent,f=wC(l,QQ),W=PI/2,X=XQ(t),B="".concat(X,"-gradient"),V=W-a/2,Q=Math.PI*2*V,v=d>0?90+d/2:-90,Y=Q*((360-d)/360),F=Qe(i)==="object"?i:{count:i,gap:2},L=F.count,M=F.gap,ee=kJ(h),q=kJ(G),P=q.find(function(R){return R&&Qe(R)==="object"}),le=P&&Qe(P)==="object",N=le?"butt":b,w=Kr(Q,Y,0,100,v,d,J,Z,N,a),K=WQ(),T=function(){var H=0;return ee.map(function(E,j){var ge=q[j]||q[q.length-1],ne=Kr(Q,Y,H,E,v,d,J,ge,N,a);return H+=E,u.createElement(RQ,{key:j,color:ge,ptg:E,radius:V,prefixCls:I,gradientId:B,style:ne,strokeLinecap:N,strokeWidth:a,gapDegree:d,ref:function(Ae){K[j]=Ae},size:PI})}).reverse()},z=function(){var H=Math.round(L*(ee[0]/100)),E=100/L,j=0;return new Array(L).fill(null).map(function(ge,ne){var ie=ne<=H-1?q[0]:Z,Ae=ie&&Qe(ie)==="object"?"url(#".concat(B,")"):void 0,ae=Kr(Q,Y,j,E,v,d,J,ie,"butt",a,M);return j+=(Y-ae.strokeDashoffset+M)*100/Y,u.createElement("circle",{key:ne,className:"".concat(I,"-circle-path"),r:V,cx:W,cy:W,stroke:Ae,strokeWidth:a,opacity:1,style:ae,ref:function(ze){K[ne]=ze}})})};return u.createElement("svg",Be({className:me("".concat(I,"-circle"),y),viewBox:"0 0 ".concat(PI," ").concat(PI),style:p,id:t,role:"presentation"},f),!L&&u.createElement("circle",{className:"".concat(I,"-circle-trail"),r:V,cx:W,cy:W,stroke:Z,strokeLinecap:N,strokeWidth:r||a,style:w}),L?z():T())};function Xn(e){return!e||e<0?0:e>100?100:e}function ac(e){let{success:g,successPercent:l}=e,t=l;return g&&"progress"in g&&(t=g.progress),g&&"percent"in g&&(t=g.percent),t}const BQ=e=>{let{percent:g,success:l,successPercent:t}=e;const I=Xn(ac({success:l,successPercent:t}));return[I,Xn(Xn(g)-I)]},SQ=e=>{let{success:g={},strokeColor:l}=e;const{strokeColor:t}=g;return[t||Et.green,l||null]},vc=(e,g,l)=>{var t,I,i,a;let r=-1,s=-1;if(g==="step"){const d=l.steps,J=l.strokeWidth;typeof e=="string"||typeof e>"u"?(r=e==="small"?2:14,s=J??8):typeof e=="number"?[r,s]=[e,e]:[r=14,s=8]=Array.isArray(e)?e:[e.width,e.height],r*=d}else if(g==="line"){const d=l==null?void 0:l.strokeWidth;typeof e=="string"||typeof e>"u"?s=d||(e==="small"?6:8):typeof e=="number"?[r,s]=[e,e]:[r=-1,s=8]=Array.isArray(e)?e:[e.width,e.height]}else(g==="circle"||g==="dashboard")&&(typeof e=="string"||typeof e>"u"?[r,s]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[r,s]=[e,e]:Array.isArray(e)&&(r=(I=(t=e[0])!==null&&t!==void 0?t:e[1])!==null&&I!==void 0?I:120,s=(a=(i=e[0])!==null&&i!==void 0?i:e[1])!==null&&a!==void 0?a:120));return[r,s]},YQ=3,FQ=e=>YQ/e*100,KQ=e=>{const{prefixCls:g,trailColor:l=null,strokeLinecap:t="round",gapPosition:I,gapDegree:i,width:a=120,type:r,children:s,success:d,size:J=a,steps:Z}=e,[b,p]=vc(J,"circle");let{strokeWidth:y}=e;y===void 0&&(y=Math.max(FQ(b),6));const G={width:b,height:p,fontSize:b*.15+6},h=u.useMemo(()=>{if(i||i===0)return i;if(r==="dashboard")return 75},[i,r]),f=BQ(e),W=I||r==="dashboard"&&"bottom"||void 0,X=Object.prototype.toString.call(e.strokeColor)==="[object Object]",B=SQ({success:d,strokeColor:e.strokeColor}),V=me(`${g}-inner`,{[`${g}-circle-gradient`]:X}),Q=u.createElement(vQ,{steps:Z,percent:Z?f[1]:f,strokeWidth:y,trailWidth:y,strokeColor:Z?B[1]:B,strokeLinecap:t,trailColor:l,prefixCls:g,gapDegree:h,gapPosition:W}),v=b<=20,Y=u.createElement("div",{className:V,style:G},Q,!v&&s);return v?u.createElement(ss,{title:s},Y):Y},rc="--progress-line-stroke-color",z0="--progress-percent",pJ=e=>{const g=e?"100%":"-100%";return new $C(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${g}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${g}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},wQ=e=>{const{componentCls:g,iconCls:l}=e;return{[g]:Object.assign(Object.assign({},po(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize},[`${g}-outer`]:{display:"inline-flex",alignItems:"center",width:"100%"},[`${g}-inner`]:{position:"relative",display:"inline-block",width:"100%",flex:1,overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${g}-inner:not(${g}-circle-gradient)`]:{[`${g}-circle-path`]:{stroke:e.defaultColor}},[`${g}-success-bg, ${g}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${g}-layout-bottom`]:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[`${g}-text`]:{width:"max-content",marginInlineStart:0,marginTop:e.marginXXS}},[`${g}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${rc})`]},height:"100%",width:`calc(1 / var(${z0}) * 100%)`,display:"block"},[`&${g}-bg-inner`]:{minWidth:"max-content","&::after":{content:"none"},[`${g}-text-inner`]:{color:e.colorWhite,[`&${g}-text-bright`]:{color:"rgba(0, 0, 0, 0.45)"}}}},[`${g}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${g}-text`]:{display:"inline-block",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,width:"2em",whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[l]:{fontSize:e.fontSize},[`&${g}-text-outer`]:{width:"max-content"},[`&${g}-text-outer${g}-text-start`]:{width:"max-content",marginInlineStart:0,marginInlineEnd:e.marginXS}},[`${g}-text-inner`]:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",marginInlineStart:0,padding:`0 ${Le(e.paddingXXS)}`,[`&${g}-text-start`]:{justifyContent:"start"},[`&${g}-text-end`]:{justifyContent:"end"}},[`&${g}-status-active`]:{[`${g}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:pJ(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${g}-rtl${g}-status-active`]:{[`${g}-bg::before`]:{animationName:pJ(!0)}},[`&${g}-status-exception`]:{[`${g}-bg`]:{backgroundColor:e.colorError},[`${g}-text`]:{color:e.colorError}},[`&${g}-status-exception ${g}-inner:not(${g}-circle-gradient)`]:{[`${g}-circle-path`]:{stroke:e.colorError}},[`&${g}-status-success`]:{[`${g}-bg`]:{backgroundColor:e.colorSuccess},[`${g}-text`]:{color:e.colorSuccess}},[`&${g}-status-success ${g}-inner:not(${g}-circle-gradient)`]:{[`${g}-circle-path`]:{stroke:e.colorSuccess}}})}},HQ=e=>{const{componentCls:g,iconCls:l}=e;return{[g]:{[`${g}-circle-trail`]:{stroke:e.remainingColor},[`&${g}-circle ${g}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${g}-circle ${g}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[l]:{fontSize:e.circleIconFontSize}},[`${g}-circle&-status-exception`]:{[`${g}-text`]:{color:e.colorError}},[`${g}-circle&-status-success`]:{[`${g}-text`]:{color:e.colorSuccess}}},[`${g}-inline-circle`]:{lineHeight:1,[`${g}-inner`]:{verticalAlign:"bottom"}}}},NQ=e=>{const{componentCls:g}=e;return{[g]:{[`${g}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},zQ=e=>{const{componentCls:g,iconCls:l}=e;return{[g]:{[`${g}-small&-line, ${g}-small&-line ${g}-text ${l}`]:{fontSize:e.fontSizeSM}}}},LQ=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),UQ=gn("Progress",e=>{const g=e.calc(e.marginXXS).div(2).equal(),l=pg(e,{progressStepMarginInlineEnd:g,progressStepMinWidth:g,progressActiveMotionDuration:"2.4s"});return[wQ(l),HQ(l),NQ(l),zQ(l)]},LQ);var MQ=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const xQ=e=>{let g=[];return Object.keys(e).forEach(l=>{const t=parseFloat(l.replace(/%/g,""));Number.isNaN(t)||g.push({key:t,value:e[l]})}),g=g.sort((l,t)=>l.key-t.key),g.map(l=>{let{key:t,value:I}=l;return`${I} ${t}%`}).join(", ")},TQ=(e,g)=>{const{from:l=Et.blue,to:t=Et.blue,direction:I=g==="rtl"?"to left":"to right"}=e,i=MQ(e,["from","to","direction"]);if(Object.keys(i).length!==0){const r=xQ(i),s=`linear-gradient(${I}, ${r})`;return{background:s,[rc]:s}}const a=`linear-gradient(${I}, ${l}, ${t})`;return{background:a,[rc]:a}},DQ=e=>{const{prefixCls:g,direction:l,percent:t,size:I,strokeWidth:i,strokeColor:a,strokeLinecap:r="round",children:s,trailColor:d=null,percentPosition:J,success:Z}=e,{align:b,type:p}=J,y=a&&typeof a!="string"?TQ(a,l):{[rc]:a,background:a},G=r==="square"||r==="butt"?0:void 0,h=I??[-1,i||(I==="small"?6:8)],[f,W]=vc(h,"line",{strokeWidth:i}),X={backgroundColor:d||void 0,borderRadius:G},B=Object.assign(Object.assign({width:`${Xn(t)}%`,height:W,borderRadius:G},y),{[z0]:Xn(t)/100}),V=ac(e),Q={width:`${Xn(V)}%`,height:W,borderRadius:G,backgroundColor:Z==null?void 0:Z.strokeColor},v={width:f<0?"100%":f},Y=u.createElement("div",{className:`${g}-inner`,style:X},u.createElement("div",{className:me(`${g}-bg`,`${g}-bg-${p}`),style:B},p==="inner"&&s),V!==void 0&&u.createElement("div",{className:`${g}-success-bg`,style:Q})),F=p==="outer"&&b==="start",L=p==="outer"&&b==="end";return p==="outer"&&b==="center"?u.createElement("div",{className:`${g}-layout-bottom`},Y,s):u.createElement("div",{className:`${g}-outer`,style:v},F&&s,Y,L&&s)},EQ=e=>{const{size:g,steps:l,percent:t=0,strokeWidth:I=8,strokeColor:i,trailColor:a=null,prefixCls:r,children:s}=e,d=Math.round(l*(t/100)),Z=g??[g==="small"?2:14,I],[b,p]=vc(Z,"step",{steps:l,strokeWidth:I}),y=b/l,G=new Array(l);for(let h=0;h<l;h++){const f=Array.isArray(i)?i[h]:i;G[h]=u.createElement("div",{key:h,className:me(`${r}-steps-item`,{[`${r}-steps-item-active`]:h<=d-1}),style:{backgroundColor:h<=d-1?f:a,width:y,height:p}})}return u.createElement("div",{className:`${r}-steps-outer`},G,s)};var OQ=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const PQ=["normal","exception","active","success"],jQ=u.forwardRef((e,g)=>{const{prefixCls:l,className:t,rootClassName:I,steps:i,strokeColor:a,percent:r=0,size:s="default",showInfo:d=!0,type:J="line",status:Z,format:b,style:p,percentPosition:y={}}=e,G=OQ(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style","percentPosition"]),{align:h="end",type:f="outer"}=y,W=Array.isArray(a)?a[0]:a,X=typeof a=="string"||Array.isArray(a)?a:void 0,B=u.useMemo(()=>{if(W){const T=typeof W=="string"?W:Object.values(W)[0];return new AC(T).isLight()}return!1},[a]),V=u.useMemo(()=>{var T,z;const R=ac(e);return parseInt(R!==void 0?(T=R??0)===null||T===void 0?void 0:T.toString():(z=r??0)===null||z===void 0?void 0:z.toString(),10)},[r,e.success,e.successPercent]),Q=u.useMemo(()=>!PQ.includes(Z)&&V>=100?"success":Z||"normal",[Z,V]),{getPrefixCls:v,direction:Y,progress:F}=u.useContext(zC),L=v("progress",l),[M,ee,q]=UQ(L),P=J==="line",le=P&&!i,N=u.useMemo(()=>{if(!d)return null;const T=ac(e);let z;const R=b||(E=>`${E}%`),H=P&&B&&f==="inner";return f==="inner"||b||Q!=="exception"&&Q!=="success"?z=R(Xn(r),Xn(T)):Q==="exception"?z=P?u.createElement(EJ,null):u.createElement(TA,null):Q==="success"&&(z=P?u.createElement(DJ,null):u.createElement(ZG,null)),u.createElement("span",{className:me(`${L}-text`,{[`${L}-text-bright`]:H,[`${L}-text-${h}`]:le,[`${L}-text-${f}`]:le}),title:typeof z=="string"?z:void 0},z)},[d,r,V,Q,J,L,b]);let w;J==="line"?w=i?u.createElement(EQ,Object.assign({},e,{strokeColor:X,prefixCls:L,steps:typeof i=="object"?i.count:i}),N):u.createElement(DQ,Object.assign({},e,{strokeColor:W,prefixCls:L,direction:Y,percentPosition:{align:h,type:f}}),N):(J==="circle"||J==="dashboard")&&(w=u.createElement(KQ,Object.assign({},e,{strokeColor:W,prefixCls:L,progressStatus:Q}),N));const K=me(L,`${L}-status-${Q}`,{[`${L}-${J==="dashboard"&&"circle"||J}`]:J!=="line",[`${L}-inline-circle`]:J==="circle"&&vc(s,"circle")[0]<=20,[`${L}-line`]:le,[`${L}-line-align-${h}`]:le,[`${L}-line-position-${f}`]:le,[`${L}-steps`]:i,[`${L}-show-info`]:d,[`${L}-${s}`]:typeof s=="string",[`${L}-rtl`]:Y==="rtl"},F==null?void 0:F.className,t,I,ee,q);return M(u.createElement("div",Object.assign({ref:g,style:Object.assign(Object.assign({},F==null?void 0:F.style),p),className:K,role:"progressbar","aria-valuenow":V,"aria-valuemin":0,"aria-valuemax":100},os(G,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),w))}),wr=function(e,g){if(e&&g){var l=Array.isArray(g)?g:g.split(","),t=e.name||"",I=e.type||"",i=I.replace(/\/.*$/,"");return l.some(function(a){var r=a.trim();if(/^\*(\/\*)?$/.test(a))return!0;if(r.charAt(0)==="."){var s=t.toLowerCase(),d=r.toLowerCase(),J=[d];return(d===".jpg"||d===".jpeg")&&(J=[".jpg",".jpeg"]),J.some(function(Z){return s.endsWith(Z)})}return/\/\*$/.test(r)?i===r.replace(/\/.*$/,""):I===r?!0:/^\w+$/.test(r)?(Yg(!1,"Upload takes an invalidate 'accept' type '".concat(r,"'.Skip for check.")),!0):!1})}return!0};function $Q(e,g){var l="cannot ".concat(e.method," ").concat(e.action," ").concat(g.status,"'"),t=new Error(l);return t.status=g.status,t.method=e.method,t.url=e.action,t}function WJ(e){var g=e.responseText||e.response;if(!g)return g;try{return JSON.parse(g)}catch{return g}}function qQ(e){var g=new XMLHttpRequest;e.onProgress&&g.upload&&(g.upload.onprogress=function(i){i.total>0&&(i.percent=i.loaded/i.total*100),e.onProgress(i)});var l=new FormData;e.data&&Object.keys(e.data).forEach(function(I){var i=e.data[I];if(Array.isArray(i)){i.forEach(function(a){l.append("".concat(I,"[]"),a)});return}l.append(I,i)}),e.file instanceof Blob?l.append(e.filename,e.file,e.file.name):l.append(e.filename,e.file),g.onerror=function(i){e.onError(i)},g.onload=function(){return g.status<200||g.status>=300?e.onError($Q(e,g),WJ(g)):e.onSuccess(WJ(g),g)},g.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in g&&(g.withCredentials=!0);var t=e.headers||{};return t["X-Requested-With"]!==null&&g.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(t).forEach(function(I){t[I]!==null&&g.setRequestHeader(I,t[I])}),g.send(l),{abort:function(){g.abort()}}}var _Q=function(){var e=$g(bC().mark(function g(l,t){var I,i,a,r,s,d,J,Z;return bC().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:d=function(){return d=$g(bC().mark(function G(h){return bC().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.abrupt("return",new Promise(function(X){h.file(function(B){t(B)?(h.fullPath&&!B.webkitRelativePath&&(Object.defineProperties(B,{webkitRelativePath:{writable:!0}}),B.webkitRelativePath=h.fullPath.replace(/^\//,""),Object.defineProperties(B,{webkitRelativePath:{writable:!1}})),X(B)):X(null)})}));case 1:case"end":return W.stop()}},G)})),d.apply(this,arguments)},s=function(G){return d.apply(this,arguments)},r=function(){return r=$g(bC().mark(function G(h){var f,W,X,B,V;return bC().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:f=h.createReader(),W=[];case 2:return v.next=5,new Promise(function(Y){f.readEntries(Y,function(){return Y([])})});case 5:if(X=v.sent,B=X.length,B){v.next=9;break}return v.abrupt("break",12);case 9:for(V=0;V<B;V++)W.push(X[V]);v.next=2;break;case 12:return v.abrupt("return",W);case 13:case"end":return v.stop()}},G)})),r.apply(this,arguments)},a=function(G){return r.apply(this,arguments)},I=[],i=[],l.forEach(function(y){return i.push(y.webkitGetAsEntry())}),J=function(){var y=$g(bC().mark(function G(h,f){var W,X;return bC().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(h){V.next=2;break}return V.abrupt("return");case 2:if(h.path=f||"",!h.isFile){V.next=10;break}return V.next=6,s(h);case 6:W=V.sent,W&&I.push(W),V.next=15;break;case 10:if(!h.isDirectory){V.next=15;break}return V.next=13,a(h);case 13:X=V.sent,i.push.apply(i,ye(X));case 15:case"end":return V.stop()}},G)}));return function(h,f){return y.apply(this,arguments)}}(),Z=0;case 9:if(!(Z<i.length)){p.next=15;break}return p.next=12,J(i[Z]);case 12:Z++,p.next=9;break;case 15:return p.abrupt("return",I);case 16:case"end":return p.stop()}},g)}));return function(l,t){return e.apply(this,arguments)}}(),ev=+new Date,Cv=0;function Hr(){return"rc-upload-".concat(ev,"-").concat(++Cv)}var gv=["component","prefixCls","className","classNames","disabled","id","name","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],lv=function(e){wl(l,e);var g=Hl(l);function l(){var t;DC(this,l);for(var I=arguments.length,i=new Array(I),a=0;a<I;a++)i[a]=arguments[a];return t=g.call.apply(g,[this].concat(i)),D(Ne(t),"state",{uid:Hr()}),D(Ne(t),"reqs",{}),D(Ne(t),"fileInput",void 0),D(Ne(t),"_isMounted",void 0),D(Ne(t),"onChange",function(r){var s=t.props,d=s.accept,J=s.directory,Z=r.target.files,b=ye(Z).filter(function(p){return!J||wr(p,d)});t.uploadFiles(b),t.reset()}),D(Ne(t),"onClick",function(r){var s=t.fileInput;if(s){var d=r.target,J=t.props.onClick;if(d&&d.tagName==="BUTTON"){var Z=s.parentNode;Z.focus(),d.blur()}s.click(),J&&J(r)}}),D(Ne(t),"onKeyDown",function(r){r.key==="Enter"&&t.onClick(r)}),D(Ne(t),"onFileDrop",function(){var r=$g(bC().mark(function s(d){var J,Z,b;return bC().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(J=t.props.multiple,d.preventDefault(),d.type!=="dragover"){y.next=4;break}return y.abrupt("return");case 4:if(!t.props.directory){y.next=11;break}return y.next=7,_Q(Array.prototype.slice.call(d.dataTransfer.items),function(G){return wr(G,t.props.accept)});case 7:Z=y.sent,t.uploadFiles(Z),y.next=14;break;case 11:b=ye(d.dataTransfer.files).filter(function(G){return wr(G,t.props.accept)}),J===!1&&(b=b.slice(0,1)),t.uploadFiles(b);case 14:case"end":return y.stop()}},s)}));return function(s){return r.apply(this,arguments)}}()),D(Ne(t),"uploadFiles",function(r){var s=ye(r),d=s.map(function(J){return J.uid=Hr(),t.processFile(J,s)});Promise.all(d).then(function(J){var Z=t.props.onBatchStart;Z==null||Z(J.map(function(b){var p=b.origin,y=b.parsedFile;return{file:p,parsedFile:y}})),J.filter(function(b){return b.parsedFile!==null}).forEach(function(b){t.post(b)})})}),D(Ne(t),"processFile",function(){var r=$g(bC().mark(function s(d,J){var Z,b,p,y,G,h,f,W,X;return bC().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Z=t.props.beforeUpload,b=d,!Z){V.next=14;break}return V.prev=3,V.next=6,Z(d,J);case 6:b=V.sent,V.next=12;break;case 9:V.prev=9,V.t0=V.catch(3),b=!1;case 12:if(b!==!1){V.next=14;break}return V.abrupt("return",{origin:d,parsedFile:null,action:null,data:null});case 14:if(p=t.props.action,typeof p!="function"){V.next=21;break}return V.next=18,p(d);case 18:y=V.sent,V.next=22;break;case 21:y=p;case 22:if(G=t.props.data,typeof G!="function"){V.next=29;break}return V.next=26,G(d);case 26:h=V.sent,V.next=30;break;case 29:h=G;case 30:return f=(Qe(b)==="object"||typeof b=="string")&&b?b:d,f instanceof File?W=f:W=new File([f],d.name,{type:d.type}),X=W,X.uid=d.uid,V.abrupt("return",{origin:d,data:h,parsedFile:X,action:y});case 35:case"end":return V.stop()}},s,null,[[3,9]])}));return function(s,d){return r.apply(this,arguments)}}()),D(Ne(t),"saveFileInput",function(r){t.fileInput=r}),t}return EC(l,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(I){var i=this,a=I.data,r=I.origin,s=I.action,d=I.parsedFile;if(this._isMounted){var J=this.props,Z=J.onStart,b=J.customRequest,p=J.name,y=J.headers,G=J.withCredentials,h=J.method,f=r.uid,W=b||qQ,X={action:s,filename:p,data:a,file:d,headers:y,withCredentials:G,method:h||"post",onProgress:function(V){var Q=i.props.onProgress;Q==null||Q(V,d)},onSuccess:function(V,Q){var v=i.props.onSuccess;v==null||v(V,d,Q),delete i.reqs[f]},onError:function(V,Q){var v=i.props.onError;v==null||v(V,Q,d),delete i.reqs[f]}};Z(r),this.reqs[f]=W(X)}}},{key:"reset",value:function(){this.setState({uid:Hr()})}},{key:"abort",value:function(I){var i=this.reqs;if(I){var a=I.uid?I.uid:I;i[a]&&i[a].abort&&i[a].abort(),delete i[a]}else Object.keys(i).forEach(function(r){i[r]&&i[r].abort&&i[r].abort(),delete i[r]})}},{key:"render",value:function(){var I=this.props,i=I.component,a=I.prefixCls,r=I.className,s=I.classNames,d=s===void 0?{}:s,J=I.disabled,Z=I.id,b=I.name,p=I.style,y=I.styles,G=y===void 0?{}:y,h=I.multiple,f=I.accept,W=I.capture,X=I.children,B=I.directory,V=I.openFileDialogOnClick,Q=I.onMouseEnter,v=I.onMouseLeave,Y=I.hasControlInside,F=wC(I,gv),L=me(D(D(D({},a,!0),"".concat(a,"-disabled"),J),r,r)),M=B?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},ee=J?{}:{onClick:V?this.onClick:function(){},onKeyDown:V?this.onKeyDown:function(){},onMouseEnter:Q,onMouseLeave:v,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:Y?void 0:"0"};return de.createElement(i,Be({},ee,{className:L,role:Y?void 0:"button",style:p}),de.createElement("input",Be({},Gc(F,{aria:!0,data:!0}),{id:Z,name:b,disabled:J,type:"file",ref:this.saveFileInput,onClick:function(P){return P.stopPropagation()},key:this.state.uid,style:O({display:"none"},G.input),className:d.input,accept:f},M,{multiple:h,onChange:this.onChange},W!=null?{capture:W}:{})),X)}}]),l}(u.Component);function Nr(){}var wA=function(e){wl(l,e);var g=Hl(l);function l(){var t;DC(this,l);for(var I=arguments.length,i=new Array(I),a=0;a<I;a++)i[a]=arguments[a];return t=g.call.apply(g,[this].concat(i)),D(Ne(t),"uploader",void 0),D(Ne(t),"saveUploader",function(r){t.uploader=r}),t}return EC(l,[{key:"abort",value:function(I){this.uploader.abort(I)}},{key:"render",value:function(){return de.createElement(lv,Be({},this.props,{ref:this.saveUploader}))}}]),l}(u.Component);D(wA,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:Nr,onError:Nr,onSuccess:Nr,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const nv=e=>{const{componentCls:g,iconCls:l}=e;return{[`${g}-wrapper`]:{[`${g}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:e.colorFillAlter,border:`${Le(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[g]:{padding:e.padding},[`${g}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:e.borderRadiusLG,"&:focus-visible":{outline:`${Le(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`}},[`${g}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${g}-disabled):hover,
          &-hover:not(${g}-disabled)
        `]:{borderColor:e.colorPrimaryHover},[`p${g}-drag-icon`]:{marginBottom:e.margin,[l]:{color:e.colorPrimary,fontSize:e.uploadThumbnailSize}},[`p${g}-text`]:{margin:`0 0 ${Le(e.marginXXS)}`,color:e.colorTextHeading,fontSize:e.fontSizeLG},[`p${g}-hint`]:{color:e.colorTextDescription,fontSize:e.fontSize},[`&${g}-disabled`]:{[`p${g}-drag-icon ${l},
            p${g}-text,
            p${g}-hint
          `]:{color:e.colorTextDisabled}}}}}},tv=e=>{const{componentCls:g,iconCls:l,fontSize:t,lineHeight:I,calc:i}=e,a=`${g}-list-item`,r=`${a}-actions`,s=`${a}-action`;return{[`${g}-wrapper`]:{[`${g}-list`]:Object.assign(Object.assign({},YZ()),{lineHeight:e.lineHeight,[a]:{position:"relative",height:i(e.lineHeight).mul(t).equal(),marginTop:e.marginXS,fontSize:t,display:"flex",alignItems:"center",transition:`background-color ${e.motionDurationSlow}`,borderRadius:e.borderRadiusSM,"&:hover":{backgroundColor:e.controlItemBgHover},[`${a}-name`]:Object.assign(Object.assign({},ls),{padding:`0 ${Le(e.paddingXS)}`,lineHeight:I,flex:"auto",transition:`all ${e.motionDurationSlow}`}),[r]:{whiteSpace:"nowrap",[s]:{opacity:0},[l]:{color:e.actionsColor,transition:`all ${e.motionDurationSlow}`},[`
              ${s}:focus-visible,
              &.picture ${s}
            `]:{opacity:1}},[`${g}-icon ${l}`]:{color:e.colorTextDescription,fontSize:t},[`${a}-progress`]:{position:"absolute",bottom:e.calc(e.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:i(t).add(e.paddingXS).equal(),fontSize:t,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${a}:hover ${s}`]:{opacity:1},[`${a}-error`]:{color:e.colorError,[`${a}-name, ${g}-icon ${l}`]:{color:e.colorError},[r]:{[`${l}, ${l}:hover`]:{color:e.colorError},[s]:{opacity:1}}},[`${g}-list-item-container`]:{transition:`opacity ${e.motionDurationSlow}, height ${e.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},Iv=e=>{const{componentCls:g}=e,l=new $C("uploadAnimateInlineIn",{from:{width:0,height:0,padding:0,opacity:0,margin:e.calc(e.marginXS).div(-2).equal()}}),t=new $C("uploadAnimateInlineOut",{to:{width:0,height:0,padding:0,opacity:0,margin:e.calc(e.marginXS).div(-2).equal()}}),I=`${g}-animate-inline`;return[{[`${g}-wrapper`]:{[`${I}-appear, ${I}-enter, ${I}-leave`]:{animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseInOutCirc,animationFillMode:"forwards"},[`${I}-appear, ${I}-enter`]:{animationName:l},[`${I}-leave`]:{animationName:t}}},{[`${g}-wrapper`]:is(e)},l,t]},ov=e=>{const{componentCls:g,iconCls:l,uploadThumbnailSize:t,uploadProgressOffset:I,calc:i}=e,a=`${g}-list`,r=`${a}-item`;return{[`${g}-wrapper`]:{[`
        ${a}${a}-picture,
        ${a}${a}-picture-card,
        ${a}${a}-picture-circle
      `]:{[r]:{position:"relative",height:i(t).add(i(e.lineWidth).mul(2)).add(i(e.paddingXS).mul(2)).equal(),padding:e.paddingXS,border:`${Le(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusLG,"&:hover":{background:"transparent"},[`${r}-thumbnail`]:Object.assign(Object.assign({},ls),{width:t,height:t,lineHeight:Le(i(t).add(e.paddingSM).equal()),textAlign:"center",flex:"none",[l]:{fontSize:e.fontSizeHeading2,color:e.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${r}-progress`]:{bottom:I,width:`calc(100% - ${Le(i(e.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:i(t).add(e.paddingXS).equal()}},[`${r}-error`]:{borderColor:e.colorError,[`${r}-thumbnail ${l}`]:{[`svg path[fill='${jt[0]}']`]:{fill:e.colorErrorBg},[`svg path[fill='${jt.primary}']`]:{fill:e.colorError}}},[`${r}-uploading`]:{borderStyle:"dashed",[`${r}-name`]:{marginBottom:I}}},[`${a}${a}-picture-circle ${r}`]:{[`&, &::before, ${r}-thumbnail`]:{borderRadius:"50%"}}}}},iv=e=>{const{componentCls:g,iconCls:l,fontSizeLG:t,colorTextLightSolid:I,calc:i}=e,a=`${g}-list`,r=`${a}-item`,s=e.uploadPicCardSize;return{[`
      ${g}-wrapper${g}-picture-card-wrapper,
      ${g}-wrapper${g}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},YZ()),{display:"block",[`${g}${g}-select`]:{width:s,height:s,textAlign:"center",verticalAlign:"top",backgroundColor:e.colorFillAlter,border:`${Le(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[`> ${g}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${g}-disabled):hover`]:{borderColor:e.colorPrimary}},[`${a}${a}-picture-card, ${a}${a}-picture-circle`]:{display:"flex",flexWrap:"wrap","@supports not (gap: 1px)":{"& > *":{marginBlockEnd:e.marginXS,marginInlineEnd:e.marginXS}},"@supports (gap: 1px)":{gap:e.marginXS},[`${a}-item-container`]:{display:"inline-block",width:s,height:s,verticalAlign:"top"},"&::after":{display:"none"},"&::before":{display:"none"},[r]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${Le(i(e.paddingXS).mul(2).equal())})`,height:`calc(100% - ${Le(i(e.paddingXS).mul(2).equal())})`,backgroundColor:e.colorBgMask,opacity:0,transition:`all ${e.motionDurationSlow}`,content:'" "'}},[`${r}:hover`]:{[`&::before, ${r}-actions`]:{opacity:1}},[`${r}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${e.motionDurationSlow}`,[`
            ${l}-eye,
            ${l}-download,
            ${l}-delete
          `]:{zIndex:10,width:t,margin:`0 ${Le(e.marginXXS)}`,fontSize:t,cursor:"pointer",transition:`all ${e.motionDurationSlow}`,color:I,"&:hover":{color:I},svg:{verticalAlign:"baseline"}}},[`${r}-thumbnail, ${r}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${r}-name`]:{display:"none",textAlign:"center"},[`${r}-file + ${r}-name`]:{position:"absolute",bottom:e.margin,display:"block",width:`calc(100% - ${Le(i(e.paddingXS).mul(2).equal())})`},[`${r}-uploading`]:{[`&${r}`]:{backgroundColor:e.colorFillAlter},[`&::before, ${l}-eye, ${l}-download, ${l}-delete`]:{display:"none"}},[`${r}-progress`]:{bottom:e.marginXL,width:`calc(100% - ${Le(i(e.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${g}-wrapper${g}-picture-circle-wrapper`]:{[`${g}${g}-select`]:{borderRadius:"50%"}}}},cv=e=>{const{componentCls:g}=e;return{[`${g}-rtl`]:{direction:"rtl"}}},av=e=>{const{componentCls:g,colorTextDisabled:l}=e;return{[`${g}-wrapper`]:Object.assign(Object.assign({},po(e)),{[g]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${g}-select`]:{display:"inline-block"},[`${g}-hidden`]:{display:"none"},[`${g}-disabled`]:{color:l,cursor:"not-allowed"}})}},rv=e=>({actionsColor:e.colorTextDescription}),Av=gn("Upload",e=>{const{fontSizeHeading3:g,fontHeight:l,lineWidth:t,controlHeightLG:I,calc:i}=e,a=pg(e,{uploadThumbnailSize:i(g).mul(2).equal(),uploadProgressOffset:i(i(l).div(2)).add(t).equal(),uploadPicCardSize:i(I).mul(2.55).equal()});return[av(a),nv(a),ov(a),iv(a),tv(a),Iv(a),cv(a),DV(a)]},rv);function Ni(e){return Object.assign(Object.assign({},e),{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,uid:e.uid,percent:0,originFileObj:e})}function zi(e,g){const l=ye(g),t=l.findIndex(I=>{let{uid:i}=I;return i===e.uid});return t===-1?l.push(e):l[t]=e,l}function zr(e,g){const l=e.uid!==void 0?"uid":"name";return g.filter(t=>t[l]===e[l])[0]}function sv(e,g){const l=e.uid!==void 0?"uid":"name",t=g.filter(I=>I[l]!==e[l]);return t.length===g.length?null:t}const dv=function(){const g=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").split("/"),t=g[g.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(t)||[""])[0]},L0=e=>e.indexOf("image/")===0,uv=e=>{if(e.type&&!e.thumbUrl)return L0(e.type);const g=e.thumbUrl||e.url||"",l=dv(g);return/^data:image\//.test(g)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(l)?!0:!(/^data:/.test(g)||l)},yn=200;function mv(e){return new Promise(g=>{if(!e.type||!L0(e.type)){g("");return}const l=document.createElement("canvas");l.width=yn,l.height=yn,l.style.cssText=`position: fixed; left: 0; top: 0; width: ${yn}px; height: ${yn}px; z-index: 9999; display: none;`,document.body.appendChild(l);const t=l.getContext("2d"),I=new Image;if(I.onload=()=>{const{width:i,height:a}=I;let r=yn,s=yn,d=0,J=0;i>a?(s=a*(yn/i),J=-(s-r)/2):(r=i*(yn/a),d=-(r-s)/2),t.drawImage(I,d,J,r,s);const Z=l.toDataURL();document.body.removeChild(l),window.URL.revokeObjectURL(I.src),g(Z)},I.crossOrigin="anonymous",e.type.startsWith("image/svg+xml")){const i=new FileReader;i.onload=()=>{i.result&&typeof i.result=="string"&&(I.src=i.result)},i.readAsDataURL(e)}else if(e.type.startsWith("image/gif")){const i=new FileReader;i.onload=()=>{i.result&&g(i.result)},i.readAsDataURL(e)}else I.src=window.URL.createObjectURL(e)})}const Jv=u.forwardRef((e,g)=>{let{prefixCls:l,className:t,style:I,locale:i,listType:a,file:r,items:s,progress:d,iconRender:J,actionIconRender:Z,itemRender:b,isImgUrl:p,showPreviewIcon:y,showRemoveIcon:G,showDownloadIcon:h,previewIcon:f,removeIcon:W,downloadIcon:X,extra:B,onPreview:V,onDownload:Q,onClose:v}=e;var Y,F;const{status:L}=r,[M,ee]=u.useState(L);u.useEffect(()=>{L!=="removed"&&ee(L)},[L]);const[q,P]=u.useState(!1);u.useEffect(()=>{const Je=setTimeout(()=>{P(!0)},300);return()=>{clearTimeout(Je)}},[]);const le=J(r);let N=u.createElement("div",{className:`${l}-icon`},le);if(a==="picture"||a==="picture-card"||a==="picture-circle")if(M==="uploading"||!r.thumbUrl&&!r.url){const Je=me(`${l}-list-item-thumbnail`,{[`${l}-list-item-file`]:M!=="uploading"});N=u.createElement("div",{className:Je},le)}else{const Je=p!=null&&p(r)?u.createElement("img",{src:r.thumbUrl||r.url,alt:r.name,className:`${l}-list-item-image`,crossOrigin:r.crossOrigin}):le,ue=me(`${l}-list-item-thumbnail`,{[`${l}-list-item-file`]:p&&!p(r)});N=u.createElement("a",{className:ue,onClick:he=>V(r,he),href:r.url||r.thumbUrl,target:"_blank",rel:"noopener noreferrer"},Je)}const w=me(`${l}-list-item`,`${l}-list-item-${M}`),K=typeof r.linkProps=="string"?JSON.parse(r.linkProps):r.linkProps,T=(typeof G=="function"?G(r):G)?Z((typeof W=="function"?W(r):W)||u.createElement(WG,null),()=>v(r),l,i.removeFile,!0):null,z=(typeof h=="function"?h(r):h)&&M==="done"?Z((typeof X=="function"?X(r):X)||u.createElement(XG,null),()=>Q(r),l,i.downloadFile):null,R=a!=="picture-card"&&a!=="picture-circle"&&u.createElement("span",{key:"download-delete",className:me(`${l}-list-item-actions`,{picture:a==="picture"})},z,T),H=typeof B=="function"?B(r):B,E=H&&u.createElement("span",{className:`${l}-list-item-extra`},H),j=me(`${l}-list-item-name`),ge=r.url?u.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:j,title:r.name},K,{href:r.url,onClick:Je=>V(r,Je)}),r.name,E):u.createElement("span",{key:"view",className:j,onClick:Je=>V(r,Je),title:r.name},r.name,E),ne=(typeof y=="function"?y(r):y)&&(r.url||r.thumbUrl)?u.createElement("a",{href:r.url||r.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:Je=>V(r,Je),title:i.previewFile},typeof f=="function"?f(r):f||u.createElement(OJ,null)):null,ie=(a==="picture-card"||a==="picture-circle")&&M!=="uploading"&&u.createElement("span",{className:`${l}-list-item-actions`},ne,M==="done"&&z,T),{getPrefixCls:Ae}=u.useContext(zC),ae=Ae(),se=u.createElement("div",{className:w},N,ge,R,ie,q&&u.createElement(Nl,{motionName:`${ae}-fade`,visible:M==="uploading",motionDeadline:2e3},Je=>{let{className:ue}=Je;const he="percent"in r?u.createElement(jQ,Object.assign({},d,{type:"line",percent:r.percent,"aria-label":r["aria-label"],"aria-labelledby":r["aria-labelledby"]})):null;return u.createElement("div",{className:me(`${l}-list-item-progress`,ue)},he)})),ze=r.response&&typeof r.response=="string"?r.response:((Y=r.error)===null||Y===void 0?void 0:Y.statusText)||((F=r.error)===null||F===void 0?void 0:F.message)||i.uploadError,We=M==="error"?u.createElement(ss,{title:ze,getPopupContainer:Je=>Je.parentNode},se):se;return u.createElement("div",{className:me(`${l}-list-item-container`,t),style:I,ref:g},b?b(We,r,s,{download:Q.bind(null,r),preview:V.bind(null,r),remove:v.bind(null,r)}):We)}),Zv=(e,g)=>{const{listType:l="text",previewFile:t=mv,onPreview:I,onDownload:i,onRemove:a,locale:r,iconRender:s,isImageUrl:d=uv,prefixCls:J,items:Z=[],showPreviewIcon:b=!0,showRemoveIcon:p=!0,showDownloadIcon:y=!1,removeIcon:G,previewIcon:h,downloadIcon:f,extra:W,progress:X={size:[-1,2],showInfo:!1},appendAction:B,appendActionVisible:V=!0,itemRender:Q,disabled:v}=e,Y=pR(),[F,L]=u.useState(!1),M=["picture-card","picture-circle"].includes(l);u.useEffect(()=>{l.startsWith("picture")&&(Z||[]).forEach(E=>{!(E.originFileObj instanceof File||E.originFileObj instanceof Blob)||E.thumbUrl!==void 0||(E.thumbUrl="",t==null||t(E.originFileObj).then(j=>{E.thumbUrl=j||"",Y()}))})},[l,Z,t]),u.useEffect(()=>{L(!0)},[]);const ee=(E,j)=>{if(I)return j==null||j.preventDefault(),I(E)},q=E=>{typeof i=="function"?i(E):E.url&&window.open(E.url)},P=E=>{a==null||a(E)},le=E=>{if(s)return s(E,l);const j=E.status==="uploading";if(l.startsWith("picture")){const ge=l==="picture"?u.createElement(_i,null):r.uploading,ne=d!=null&&d(E)?u.createElement(_G,null):u.createElement(KG,null);return j?ge:ne}return j?u.createElement(_i,null):u.createElement(jG,null)},N=(E,j,ge,ne,ie)=>{const Ae={type:"text",size:"small",title:ne,onClick:ae=>{var se,ze;j(),u.isValidElement(E)&&((ze=(se=E.props).onClick)===null||ze===void 0||ze.call(se,ae))},className:`${ge}-list-item-action`};return ie&&(Ae.disabled=v),u.isValidElement(E)?u.createElement(oc,Object.assign({},Ae,{icon:uo(E,Object.assign(Object.assign({},E.props),{onClick:()=>{}}))})):u.createElement(oc,Object.assign({},Ae),u.createElement("span",null,E))};u.useImperativeHandle(g,()=>({handlePreview:ee,handleDownload:q}));const{getPrefixCls:w}=u.useContext(zC),K=w("upload",J),T=w(),z=me(`${K}-list`,`${K}-list-${l}`),R=u.useMemo(()=>os(yV(T),["onAppearEnd","onEnterEnd","onLeaveEnd"]),[T]),H=Object.assign(Object.assign({},M?{}:R),{motionDeadline:2e3,motionName:`${K}-${M?"animate-inline":"animate"}`,keys:ye(Z.map(E=>({key:E.uid,file:E}))),motionAppear:F});return u.createElement("div",{className:z},u.createElement(EZ,Object.assign({},H,{component:!1}),E=>{let{key:j,file:ge,className:ne,style:ie}=E;return u.createElement(Jv,{key:j,locale:r,prefixCls:K,className:ne,style:ie,file:ge,items:Z,progress:X,listType:l,isImgUrl:d,showPreviewIcon:b,showRemoveIcon:p,showDownloadIcon:y,removeIcon:G,previewIcon:h,downloadIcon:f,extra:W,iconRender:le,actionIconRender:N,itemRender:Q,onPreview:ee,onDownload:q,onClose:P})}),B&&u.createElement(Nl,Object.assign({},H,{visible:V,forceRender:!0}),E=>{let{className:j,style:ge}=E;return uo(B,ne=>({className:me(ne.className,j),style:Object.assign(Object.assign(Object.assign({},ge),{pointerEvents:j?"none":void 0}),ne.style)}))}))},bv=u.forwardRef(Zv);var hv=function(e,g,l,t){function I(i){return i instanceof l?i:new l(function(a){a(i)})}return new(l||(l=Promise))(function(i,a){function r(J){try{d(t.next(J))}catch(Z){a(Z)}}function s(J){try{d(t.throw(J))}catch(Z){a(Z)}}function d(J){J.done?i(J.value):I(J.value).then(r,s)}d((t=t.apply(e,[])).next())})};const jI=`__LIST_IGNORE_${Date.now()}__`,Gv=(e,g)=>{const{fileList:l,defaultFileList:t,onRemove:I,showUploadList:i=!0,listType:a="text",onPreview:r,onDownload:s,onChange:d,onDrop:J,previewFile:Z,disabled:b,locale:p,iconRender:y,isImageUrl:G,progress:h,prefixCls:f,className:W,type:X="select",children:B,style:V,itemRender:Q,maxCount:v,data:Y={},multiple:F=!1,hasControlInside:L=!0,action:M="",accept:ee="",supportServerRender:q=!0,rootClassName:P}=e,le=u.useContext(ro),N=b??le,[w,K]=so(t||[],{value:l,postState:Ze=>Ze??[]}),[T,z]=u.useState("drop"),R=u.useRef(null),H=u.useRef(null);u.useMemo(()=>{const Ze=Date.now();(l||[]).forEach((Ee,je)=>{!Ee.uid&&!Object.isFrozen(Ee)&&(Ee.uid=`__AUTO__${Ze}_${je}__`)})},[l]);const E=(Ze,Ee,je)=>{let ve=ye(Ee),Oe=!1;v===1?ve=ve.slice(-1):v&&(Oe=ve.length>v,ve=ve.slice(0,v)),$t.flushSync(()=>{K(ve)});const $e={file:Ze,fileList:ve};je&&($e.event=je),(!Oe||Ze.status==="removed"||ve.some(ZC=>ZC.uid===Ze.uid))&&$t.flushSync(()=>{d==null||d($e)})},j=(Ze,Ee)=>hv(void 0,void 0,void 0,function*(){const{beforeUpload:je,transformFile:ve}=e;let Oe=Ze;if(je){const $e=yield je(Ze,Ee);if($e===!1)return!1;if(delete Ze[jI],$e===jI)return Object.defineProperty(Ze,jI,{value:!0,configurable:!0}),!1;typeof $e=="object"&&$e&&(Oe=$e)}return ve&&(Oe=yield ve(Oe)),Oe}),ge=Ze=>{const Ee=Ze.filter(Oe=>!Oe.file[jI]);if(!Ee.length)return;const je=Ee.map(Oe=>Ni(Oe.file));let ve=ye(w);je.forEach(Oe=>{ve=zi(Oe,ve)}),je.forEach((Oe,$e)=>{let ZC=Oe;if(Ee[$e].parsedFile)Oe.status="uploading";else{const{originFileObj:XC}=Oe;let LC;try{LC=new File([XC],XC.name,{type:XC.type})}catch{LC=new Blob([XC],{type:XC.type}),LC.name=XC.name,LC.lastModifiedDate=new Date,LC.lastModified=new Date().getTime()}LC.uid=Oe.uid,ZC=LC}E(ZC,ve)})},ne=(Ze,Ee,je)=>{try{typeof Ze=="string"&&(Ze=JSON.parse(Ze))}catch{}if(!zr(Ee,w))return;const ve=Ni(Ee);ve.status="done",ve.percent=100,ve.response=Ze,ve.xhr=je;const Oe=zi(ve,w);E(ve,Oe)},ie=(Ze,Ee)=>{if(!zr(Ee,w))return;const je=Ni(Ee);je.status="uploading",je.percent=Ze.percent;const ve=zi(je,w);E(je,ve,Ze)},Ae=(Ze,Ee,je)=>{if(!zr(je,w))return;const ve=Ni(je);ve.error=Ze,ve.response=Ee,ve.status="error";const Oe=zi(ve,w);E(ve,Oe)},ae=Ze=>{let Ee;Promise.resolve(typeof I=="function"?I(Ze):I).then(je=>{var ve;if(je===!1)return;const Oe=sv(Ze,w);Oe&&(Ee=Object.assign(Object.assign({},Ze),{status:"removed"}),w==null||w.forEach($e=>{const ZC=Ee.uid!==void 0?"uid":"name";$e[ZC]===Ee[ZC]&&!Object.isFrozen($e)&&($e.status="removed")}),(ve=R.current)===null||ve===void 0||ve.abort(Ee),E(Ee,Oe))})},se=Ze=>{z(Ze.type),Ze.type==="drop"&&(J==null||J(Ze))};u.useImperativeHandle(g,()=>({onBatchStart:ge,onSuccess:ne,onProgress:ie,onError:Ae,fileList:w,upload:R.current,nativeElement:H.current}));const{getPrefixCls:ze,direction:We,upload:Je}=u.useContext(zC),ue=ze("upload",f),he=Object.assign(Object.assign({onBatchStart:ge,onError:Ae,onProgress:ie,onSuccess:ne},e),{data:Y,multiple:F,action:M,accept:ee,supportServerRender:q,prefixCls:ue,disabled:N,beforeUpload:j,onChange:void 0,hasControlInside:L});delete he.className,delete he.style,(!B||N)&&delete he.id;const Se=`${ue}-wrapper`,[Ke,Ye,Ue]=Av(ue,Se),[Me]=cp("Upload",Cn.Upload),{showRemoveIcon:Re,showPreviewIcon:De,showDownloadIcon:fe,removeIcon:_e,previewIcon:eC,downloadIcon:IC,extra:pC}=typeof i=="boolean"?{}:i,cC=typeof Re>"u"?!N:Re,hC=(Ze,Ee)=>i?u.createElement(bv,{prefixCls:ue,listType:a,items:w,previewFile:Z,onPreview:r,onDownload:s,onRemove:ae,showRemoveIcon:cC,showPreviewIcon:De,showDownloadIcon:fe,removeIcon:_e,previewIcon:eC,downloadIcon:IC,iconRender:y,extra:pC,locale:Object.assign(Object.assign({},Me),p),isImageUrl:G,progress:h,appendAction:Ze,appendActionVisible:Ee,itemRender:Q,disabled:N}):Ze,WC=me(Se,W,P,Ye,Ue,Je==null?void 0:Je.className,{[`${ue}-rtl`]:We==="rtl",[`${ue}-picture-card-wrapper`]:a==="picture-card",[`${ue}-picture-circle-wrapper`]:a==="picture-circle"}),Pe=Object.assign(Object.assign({},Je==null?void 0:Je.style),V);if(X==="drag"){const Ze=me(Ye,ue,`${ue}-drag`,{[`${ue}-drag-uploading`]:w.some(Ee=>Ee.status==="uploading"),[`${ue}-drag-hover`]:T==="dragover",[`${ue}-disabled`]:N,[`${ue}-rtl`]:We==="rtl"});return Ke(u.createElement("span",{className:WC,ref:H},u.createElement("div",{className:Ze,style:Pe,onDrop:se,onDragOver:se,onDragLeave:se},u.createElement(wA,Object.assign({},he,{ref:R,className:`${ue}-btn`}),u.createElement("div",{className:`${ue}-drag-container`},B))),hC()))}const lC=me(ue,`${ue}-select`,{[`${ue}-disabled`]:N,[`${ue}-hidden`]:!B}),Te=u.createElement("div",{className:lC},u.createElement(wA,Object.assign({},he,{ref:R})));return Ke(a==="picture-card"||a==="picture-circle"?u.createElement("span",{className:WC,ref:H},hC(Te,!!B)):u.createElement("span",{className:WC,ref:H},Te,hC()))},U0=u.forwardRef(Gv);var yv=function(e,g){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&g.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,t=Object.getOwnPropertySymbols(e);I<t.length;I++)g.indexOf(t[I])<0&&Object.prototype.propertyIsEnumerable.call(e,t[I])&&(l[t[I]]=e[t[I]]);return l};const kv=u.forwardRef((e,g)=>{var{style:l,height:t,hasControlInside:I=!1}=e,i=yv(e,["style","height","hasControlInside"]);return u.createElement(U0,Object.assign({ref:g,hasControlInside:I},i,{type:"drag",style:Object.assign(Object.assign({},l),{height:t})}))}),us=U0;us.Dragger=kv;us.LIST_IGNORE=jI;const VJ=(e,g)=>{const l=document.createElement("canvas"),t=l.getContext("2d");return l.width=e.displayWidth,l.height=e.displayHeight,t==null||t.drawImage(e,0,0,e.displayWidth,e.displayHeight),g&&(t.fillStyle="white",t.font="40px Arial",t.fillText(g,10,50)),l.toDataURL("image/png")},pv=u.forwardRef(({height:e=100,onMove:g,...l},t)=>{const I=u.useRef(null),i=u.useRef(null),a=u.useRef(),[r,s]=u.useState(!1),d=u.useRef(!1),J=u.useRef(0);u.useImperativeHandle(t,()=>({load:(p,y)=>{if(p&&p.length&&a.current){const G=p[0],h=G.displayWidth;I.current.width=h*p.length,I.current.height=G.displayHeight,J.current=h*p.length;for(let f=0;f<p.length;f++){const W=p[f];a.current.drawImage(W,h*f,0)}y&&(a.current.fillStyle="white",a.current.font="120px Arial",a.current.fillText(`${y} ms`,120,200)),s(!0)}else s(!1)}}));const[Z,b]=u.useState(0);return u.useEffect(()=>{var p,y,G,h;a.current=I.current.getContext("2d"),(p=i.current)==null||p.addEventListener("mousedown",()=>{d.current=!0}),(y=i.current)==null||y.addEventListener("mouseup",()=>{d.current=!1}),(G=I.current)==null||G.addEventListener("mousemove",f=>{if(!d.current)return;const W=I.current.getBoundingClientRect(),X=f.clientX-W.left,B=X/W.width;b(X),g==null||g(B)}),(h=I.current)==null||h.addEventListener("click",f=>{const W=I.current.getBoundingClientRect(),X=f.clientX-W.left,B=X/W.width;b(X),g==null||g(B)})},[]),ng.jsxs("div",{className:"relative rounded shadow",style:{height:`${e}px`,visibility:r?"visible":"hidden"},...l,children:[ng.jsx("canvas",{ref:I,className:"h-full rounded"}),ng.jsx("div",{ref:i,className:"absolute w-1 bg-blue-500 cursor-pointer",style:{height:`${e+12}px`,left:Z,top:"-6px"}})]})});var Wv=typeof global=="object"&&global&&global.Object===Object&&global,Vv=typeof self=="object"&&self&&self.Object===Object&&self,M0=Wv||Vv||Function("return this")(),Ac=M0.Symbol,x0=Object.prototype,fv=x0.hasOwnProperty,Xv=x0.toString,DI=Ac?Ac.toStringTag:void 0;function Rv(e){var g=fv.call(e,DI),l=e[DI];try{e[DI]=void 0;var t=!0}catch{}var I=Xv.call(e);return t&&(g?e[DI]=l:delete e[DI]),I}var Qv=Object.prototype,vv=Qv.toString;function Bv(e){return vv.call(e)}var Sv="[object Null]",Yv="[object Undefined]",fJ=Ac?Ac.toStringTag:void 0;function Fv(e){return e==null?e===void 0?Yv:Sv:fJ&&fJ in Object(e)?Rv(e):Bv(e)}function Kv(e){return e!=null&&typeof e=="object"}var wv="[object Symbol]";function Hv(e){return typeof e=="symbol"||Kv(e)&&Fv(e)==wv}var Nv=/\s/;function zv(e){for(var g=e.length;g--&&Nv.test(e.charAt(g)););return g}var Lv=/^\s+/;function Uv(e){return e&&e.slice(0,zv(e)+1).replace(Lv,"")}function HA(e){var g=typeof e;return e!=null&&(g=="object"||g=="function")}var XJ=NaN,Mv=/^[-+]0x[0-9a-f]+$/i,xv=/^0b[01]+$/i,Tv=/^0o[0-7]+$/i,Dv=parseInt;function RJ(e){if(typeof e=="number")return e;if(Hv(e))return XJ;if(HA(e)){var g=typeof e.valueOf=="function"?e.valueOf():e;e=HA(g)?g+"":g}if(typeof e!="string")return e===0?e:+e;e=Uv(e);var l=xv.test(e);return l||Tv.test(e)?Dv(e.slice(2),l?2:8):Mv.test(e)?XJ:+e}var Lr=function(){return M0.Date.now()},Ev="Expected a function",Ov=Math.max,Pv=Math.min;function jv(e,g,l){var t,I,i,a,r,s,d=0,J=!1,Z=!1,b=!0;if(typeof e!="function")throw new TypeError(Ev);g=RJ(g)||0,HA(l)&&(J=!!l.leading,Z="maxWait"in l,i=Z?Ov(RJ(l.maxWait)||0,g):i,b="trailing"in l?!!l.trailing:b);function p(Q){var v=t,Y=I;return t=I=void 0,d=Q,a=e.apply(Y,v),a}function y(Q){return d=Q,r=setTimeout(f,g),J?p(Q):a}function G(Q){var v=Q-s,Y=Q-d,F=g-v;return Z?Pv(F,i-Y):F}function h(Q){var v=Q-s,Y=Q-d;return s===void 0||v>=g||v<0||Z&&Y>=i}function f(){var Q=Lr();if(h(Q))return W(Q);r=setTimeout(f,G(Q))}function W(Q){return r=void 0,b&&t?p(Q):(t=I=void 0,a)}function X(){r!==void 0&&clearTimeout(r),d=0,t=s=I=r=void 0}function B(){return r===void 0?a:W(Lr())}function V(){var Q=Lr(),v=h(Q);if(t=arguments,I=this,s=Q,v){if(r===void 0)return y(s);if(Z)return clearTimeout(r),r=setTimeout(f,g),p(s)}return r===void 0&&(r=setTimeout(f,g)),a}return V.cancel=X,V.flush=B,V}const{Dragger:$v}=us;function qv(){const e=u.useRef(),[g,l]=u.useState(""),t=u.useRef(null),I=u.useRef(0),i={multiple:!1,accept:"video/mp4,video/quicktime",beforeUpload:async r=>{var s;e.current=new LA;try{const{duration:d}=await e.current.load(r);I.current=d;const J=performance.now(),Z=await e.current.find(0),b=performance.now()-J;if(Z){const h=VJ(Z,`${b.toFixed(2)} ms`);l(h)}const p=performance.now(),y=await e.current.thumbnails({start:0,end:d,step:1e6}),G=performance.now()-p;(s=t.current)==null||s.load(y,Number(G.toFixed(2)))}catch(d){N0.error(d.message)}return!1}},a=jv(async r=>{const s=I.current*r;if(e.current){const d=performance.now(),J=await e.current.find(s),Z=performance.now()-d;J&&l(VJ(J,`${Z.toFixed(2)} ms`))}},50);return ng.jsx(ng.Fragment,{children:ng.jsxs("div",{className:"m-auto",children:[ng.jsx("div",{className:"text-4xl font-bold mb-8",children:"WebCodecs Extract Frame"}),ng.jsxs($v,{...i,children:[ng.jsx("p",{className:"ant-upload-drag-icon",children:ng.jsx(NG,{})}),ng.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),ng.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]}),ng.jsx("div",{className:"mb-10 mt-10",children:ng.jsx(H0,{width:200,src:g})}),ng.jsx("div",{className:"mt-10",children:ng.jsx(pv,{ref:t,height:100,onMove:a})})]})})}Xh.createRoot(document.getElementById("root")).render(ng.jsx(u.StrictMode,{children:ng.jsx(qv,{})}))});export default _v();
